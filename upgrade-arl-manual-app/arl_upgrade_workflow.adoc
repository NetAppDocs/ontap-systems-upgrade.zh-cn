---
sidebar: sidebar 
permalink: upgrade-arl-manual-app/arl_upgrade_workflow.html 
keywords: upgrade workflow, procedure steps, stages 
summary: ARL 升级工作流 
---
= ARL 升级工作流
:hardbreaks:
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
在使用 ARL 升级节点之前，您应了解操作步骤的工作原理。在本文档中，操作步骤分为多个阶段。

在操作步骤期间，您可以使用替代控制器硬件升级原始控制器硬件，一次升级一个控制器，从而利用 HA 对配置重新定位非根聚合的所有权。所有非根聚合都必须进行两次重新定位，才能到达其最终目标，即正确的升级节点。

每个聚合都有一个主所有者和当前所有者。主所有者是聚合的实际所有者，当前所有者是临时所有者。

下图显示了操作步骤的各个阶段。浅灰色厚箭头表示聚合的重新定位和 LIF 的移动，而较细的黑色箭头表示原始节点的删除。较小的控制器映像代表原始节点，较大的控制器映像代表新节点。

image:arl_upgrade_manual_image1.PNG["图中显示了 ARL 操作步骤的各个阶段"]

下表介绍了您在每个阶段执行的高级任务以及此阶段结束时的聚合所有权状态。操作步骤稍后将提供详细步骤：

[cols="35,65"]
|===
| 阶段 | 步骤 


| 第 1 阶段：准备升级  a| 
. 确定控制器是否在内部磁盘驱动器上具有聚合。
+
只有在从具有内部磁盘驱动器的控制器升级时，才需要执行此步骤。

. 准备要升级的节点
. 为磁盘重新设置密钥以进行存储加密。
+
只有在从具有自加密驱动器的系统升级时，才需要执行此任务。

. 验证集群上的 SnapMirror 关系状态，并暂停集群之间的所有关系。
. 准备网络启动


阶段 1 结束时的聚合所有权：

* node1 是 node1 聚合的主所有者和当前所有者。
* node2 是 node2 聚合的主所有者和当前所有者。




| 第 2 阶段：停用 node1  a| 
. 将非根聚合从 node1 重新定位到 node2 。
. 将节点 1 拥有的非 SAN 数据 LIF 移动到节点 2 。
. 记录 node1 信息
. 重新定位失败或被否决的聚合。
. 停用 node1 。


阶段 2 结束时的聚合所有权：

* node1 是 node1 聚合的主所有者。
* node2 是 node1 聚合的当前所有者。
* node2 是 node2 聚合的主所有者和当前所有者。




| 第 3 阶段：安装并启动节点 3.  a| 
. 安装并启动 node3 。
. 在 node3 上设置 UTA/UTA2 配置。
. 将端口从 node1 映射到 node3
. 将节点 1 所拥有的非 SAN 数据 LIF 从 node2 移动到 node3 ，并验证 node3 上的 SNA LIF 。
. 将非根聚合从 node2 重新定位到 node3 。
. 将节点 2 拥有的非 SAN 数据 LIF 移动到节点 3 。


第 3 阶段结束时的聚合所有权：

* node2 是 node2 聚合的主所有者，但不是当前所有者。
* node3 是最初属于 node1 的聚合的主所有者和当前所有者。
* node2 是属于 node2 的聚合的主所有者和当前所有者，但不是主所有者。




| 第 4 阶段：停用 node2  a| 
. 记录 node2 信息。
. 停用 node2 。


聚合所有权不会发生任何更改。



| 第 5 阶段：安装并启动节点 4  a| 
. 安装并启动节点 4.
. 在 node4 上设置 UTA/UTA2 配置。
. 将端口从 node2 映射到 node4
. 将 node2 拥有的非 SAN 数据 LIF 从 node3 移动到 node4 ，并验证 node4 上的 SNA-LIF 。
. 将 node2 的非根聚合从 node3 重新定位到 node4 。


第 5 阶段结束时的聚合所有权：

* node3 是最初属于 node1 的聚合的主所有者和当前所有者。
* Node4 是最初属于 Node2 的聚合的主所有者和当前所有者。




| 第 6 阶段：完成升级  a| 
. 确保新控制器设置正确。
. 在新节点上设置存储加密。
+
只有在升级到具有自加密驱动器的系统时，才需要执行此任务。

. 停用旧系统。
. 恢复 NetApp SnapMirror 关系。
+
* 注意： * Storage Virtual Machine （ SVM ）灾难恢复更新不会按照分配的计划中断。



聚合所有权不会发生任何更改。

|===