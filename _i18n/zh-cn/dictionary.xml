<?xml version="1.0" encoding="UTF-8"?>
<blocks>
  <block id="6a537092418b1517855bd9bd8a6c8418" category="summary">您必须在机架中安装 node4 ，将 node2 连接传输到 node4 ，启动 node4 并安装 ONTAP 。</block>
  <block id="1a02fe8fc6a186319dd3345573fc3717" category="doc">安装并启动节点 4.</block>
  <block id="75586863c552442d574a9bbfc3a0d408" category="paragraph">您必须在机架中安装 node4 ，将 node2 的连接传输到 node4 ，启动 node4 并安装 ONTAP 。然后，您必须重新分配 node2 的任何备用磁盘，属于根卷的任何磁盘以及在此过程前面未重新定位到 node3 的任何非根聚合，如本节所述。</block>
  <block id="5f190baddba85177825d174bc2428bc9" category="paragraph">重新定位操作在此阶段开始时暂停。此过程大部分是自动完成的；操作将暂停，以便您可以检查其状态。您必须手动恢复此操作。</block>
  <block id="550ffaa7219faf74146770514db0d8e8" category="inline-link-macro">准备网络启动</block>
  <block id="cdb3662e6ecd47991de3008672ab3eb8" category="paragraph">如果 node4 的 ONTAP 9 版本与 node2 上安装的版本不同，则需要对其进行网络启动。安装 node4 后，从 Web 服务器上存储的 ONTAP 9 映像启动它。然后，您可以按照中的说明将正确的文件下载到启动介质设备，以供后续系统启动 <block ref="4815c2d091d790c1d3bab94177b38eaf" category="inline-link-macro-rx"></block>。</block>
  <block id="7a262cb0d3d917313c8ba12f996fe83c" category="list-title">重要</block>
  <block id="89023b09a8e04215547178052eb90222" category="inline-link-macro">在节点 4 上配置 FC 端口</block>
  <block id="113dd8c6d49d13f5871e1cbe53350eb2" category="inline-link-macro">检查并配置 node4 上的 UTA/UTA2 端口</block>
  <block id="6f4a225b29c0975663d0e4b9e1f4547f" category="inline-xref">第 1 步</block>
  <block id="2f5ad93b7f0dd7bdcdf63542c05e8ebe" category="inline-xref">第 21 步</block>
  <block id="f775037aa1f7a8a52b5159236f7449e7" category="inline-xref">第 23 步</block>
  <block id="09702fca7923997e0da2187b92badbd9" category="list-text">如果要升级连接到存储阵列的 V 系列系统或安装了 FlexArray 虚拟化软件并连接到存储阵列的系统，则必须完成升级 <block ref="72a284a0ab19d0d6976ab9f3aa1bfc65" category="inline-xref-macro-rx"></block> 到 <block ref="e953da376eb12d20ff3d04f195189ba7" category="inline-xref-macro-rx"></block>，然后退出本节并按照说明进行操作 <block ref="1d789633b45165b05bf13f9838060fe6" category="inline-link-macro-rx"></block> 和到 <block ref="15e1611f6cc2b64b7163cc152446c8c0" category="inline-link-macro-rx"></block>，在维护模式下输入命令。然后，您必须返回到此部分并继续使用 <block ref="7d33d698028361a6b46f35be2a3ff5a2" category="inline-xref-macro-rx"></block>。</block>
  <block id="df5267f8e4bbfa9add1dd732e6b68e41" category="inline-link-macro">在 node4 上设置 FC 或 UTA/UTA2 配置</block>
  <block id="ed722a5ba6799c1f65d4b9716575b170" category="list-text">但是，如果要升级具有存储磁盘的系统，则必须完成整个部分，然后继续 <block ref="a6d322e902b744ff3a11f02b5c6d9496" category="inline-link-macro-rx"></block>，在集群提示符处输入命令。</block>
  <block id="f3a29486bed19a90f2da6d007818b427" category="list-title">步骤</block>
  <block id="c7009662ac7e20dc02b0e7d7e2ed8804" category="list-text">【 auto_install4_step1]] 确保 node4 具有足够的机架空间。</block>
  <block id="82952c70726b36a56f0651368cd2be05" category="paragraph">如果 node4 与 node2 位于不同的机箱中，则可以将 node4 与 node3 放在同一位置。如果 node2 和 node4 位于同一机箱中，则 node4 已位于其相应的机架位置。</block>
  <block id="9ef9fab932162728d06bbfd2862c33d9" category="list-text">按照节点型号的 _Installation and Setup Instructions_中 的说明，在机架中安装 node4 。</block>
  <block id="179ba8fe173567627d42a1a9fc1e6948" category="list-text">为节点 4 布线，将连接从节点 2 移至节点 4 。</block>
  <block id="d95867deadfe690e40f42068d6b59df8" category="inline-link-macro">参考资料</block>
  <block id="7c37472309a8c54b0891c8e95190096e" category="list-text">控制台（远程管理端口）</block>
  <block id="f0012d7dc9fbefbb11bb69cd6932aef8" category="list-text">集群端口</block>
  <block id="b2d2606b76cd5df666c2b6a0f4bfc496" category="list-text">数据端口</block>
  <block id="f35c347c4cb65015138a4d291827b1a1" category="list-text">集群和节点管理端口</block>
  <block id="8c4aa541ee911e8d80451ef8cc304806" category="list-text">存储</block>
  <block id="e6627a49532995a915815645abe1e3bc" category="list-text">SAN 配置： iSCSI 以太网和 FC 交换机端口</block>
  <block id="0046d599de2c63ac6aee024be099994d" category="admonition">您可能不需要将互连卡 /FC-VI 卡或互连 /FC-VI 缆线连接从 node2 移至 node4 ，因为大多数平台型号都具有唯一的互连卡型号。对于 MetroCluster 配置，必须将 FC-VI 缆线连接从 node2 移至 node4 。如果新主机没有 FC-VI 卡，则可能需要移动 FC-VI 卡。</block>
  <block id="8c346c2672eda514d4b912cb897c6c54" category="list-text">打开 node4 的电源，然后在控制台终端按 `Ctrl-C` 以访问启动环境提示符，从而中断启动过程。</block>
  <block id="994bdd0bc026ec99be435de25a9ecc3d" category="admonition">启动 node4 时，您可能会看到以下警告消息：</block>
  <block id="d728df788701a4dbee2b7991f0468dad" category="list-text">如果您在步骤 4 中看到警告消息，请执行以下操作：</block>
  <block id="3e1ef1763b3680d2c8fbf0a8ea19db9b" category="list-text">检查是否存在任何可能指示 NVRAM 电池电量低以外问题的控制台消息，如有必要，请采取任何必要的更正措施。</block>
  <block id="d73910b693432e337843357586f3e39f" category="list-text">让电池充电并完成启动过程。</block>
  <block id="5d043d33743f66f7467bf67aa5653705" category="admonition">* 注意：请勿覆盖延迟；如果不允许电池充电，可能会导致数据丢失。 *</block>
  <block id="b1e6d70b6a993d323936c87bff29461b" category="admonition">请参见 <block ref="4815c2d091d790c1d3bab94177b38eaf" category="inline-link-macro-rx"></block>。</block>
  <block id="d583a56b378186283bc180e8dfcdad82" category="list-text">【第 6 步】选择以下操作之一，配置网络启动连接。</block>
  <block id="d1adb867eac5534b9fe3de6b0b271291" category="admonition">您应使用管理端口和 IP 作为网络启动连接。请勿使用数据 LIF IP ，否则在执行升级期间可能会发生数据中断。</block>
  <block id="3a325cd28eedfb6e2a8828a9cc5043a2" category="cell">动态主机配置协议（ DHCP ）</block>
  <block id="c1325f6903ebb5ebb2bb519a73ddb1b0" category="cell">那么 ...</block>
  <block id="5bda814c4aedb126839228f1a3d92f09" category="cell">正在运行</block>
  <block id="aee2adde97afad89c105aeb72e6320b3" category="cell">在启动环境提示符处使用以下命令自动配置连接： `ifconfig e0M -auto`</block>
  <block id="84435c8fed125c1f06699e20bdcee63d" category="cell">未运行</block>
  <block id="de9354e54a4c11f4eec6e3f3a44be9a1" category="cell">在启动环境提示符处输入以下命令以手动配置连接： `ifconfig e0M -addr=&lt;filer_addr&gt; -mask=&lt;netmask&gt; -gw=&lt; 网关 &gt; - DNS=&lt;DNS_addr&gt; domain=&lt;DNS_domain&gt;` ` &lt;filer_addr&gt;` 是存储系统的 IP 地址。` &lt; 网络掩码 &gt;` 是存储系统的网络掩码。` &lt; 网关 &gt;` 是存储系统的网关。` &lt;dns_addr&gt;` 是网络上名称服务器的 IP 地址。此参数是可选的。` &lt;dns_domain&gt;` 是 DNS 域名。此参数是可选的。* 注 * ：接口可能需要其他参数。有关详细信息，请在固件提示符处输入 `help ifconfig` 。</block>
  <block id="15fe98426987c07cba715dffbfb96c7e" category="list-text">对 node4 执行网络启动：</block>
  <block id="0ba2b3e0a887666765eb2d690768c576" category="cell">针对 ...</block>
  <block id="383b9c142d0ac9c95fc6323618a87c9b" category="cell">FAS/AFF8000 系列系统</block>
  <block id="8385f026f91d6fc14fd02b225112bac8" category="cell">`netboot \http://&lt;web_server_ip/path_to_web-accessible_directory&gt;/netboot/kernel`</block>
  <block id="edc91455dc5116cbd53031ff17548c91" category="cell">所有其他系统</block>
  <block id="1e3f57d872237ce4621e377ee8ff6896" category="cell">`netboot \http://&lt;web_server_ip/path_to_web-accessible_directory&gt;/&lt;ontap_version&gt;_image.tgz`</block>
  <block id="17e387f327c3866b0d0ae33451a79635" category="paragraph">` &lt;path_to_the_web-accessible_directory&gt;` 应指向您在本节第 1 步中下载 ` &lt;ontap_version&gt;_image.tgz` 的位置 <block ref="4815c2d091d790c1d3bab94177b38eaf" category="inline-link-macro-rx"></block>。</block>
  <block id="85bd8aebb41cb27f7bc364e977313958" category="admonition">请勿中断启动。</block>
  <block id="45b788b600b6973bddaa17d7d85de037" category="list-text">从启动菜单中，选择选项 ` （ 7 ） Install new software first` 。</block>
  <block id="adcfa58e9fef1d45cc4bd403ac68eb9f" category="paragraph">此菜单选项可下载新的 ONTAP 映像并将其安装到启动设备中。</block>
  <block id="161347e221ff82d9edced01f7b383668" category="admonition">请忽略以下消息： `HA 对上的无中断升级不支持此操作步骤` 请注意适用场景无中断升级 ONTAP ，而不是升级控制器。请始终使用 netboot 将新节点更新为所需映像。如果使用其他方法在新控制器上安装映像，则可能安装了错误的映像。此问题描述适用场景所有 ONTAP 版本。</block>
  <block id="0b22fb8d0feec85055f45c8c4a298766" category="list-text">如果系统提示您继续运行操作步骤，请输入 `y` ，并在系统提示您输入软件包时，输入 URL ：</block>
  <block id="84ea00dba7c6a1cf0426e58385307e4f" category="paragraph">` http://&lt;web_server_ip/path_to_web-accessible_directory&gt;/&lt;ontap_version&gt;_image.tgz`</block>
  <block id="7b3f6c26774d36cd594edf297f0f8f57" category="list-text">完成以下子步骤以重新启动控制器模块：</block>
  <block id="7043cc5b7b924f62a8af6f3d2e706c77" category="list-text">出现以下提示时，输入 `n` 以跳过备份恢复：</block>
  <block id="330edabea721cfdb93e4a4aed8cd1730" category="list-text">出现以下提示时，输入 `y` 以重新启动：</block>
  <block id="504d065328326a8677a260e4447bea63" category="paragraph">控制器模块重新启动，但停留在启动菜单处，因为启动设备已重新格式化，并且需要还原配置数据。</block>
  <block id="ca95d6295c1b1cab041926d491fa54ba" category="list-text">从启动菜单中选择维护模式 `5` ，并在系统提示您继续启动时输入 `y` 。</block>
  <block id="bea7673b9c3eda34bfe449c80f92539f" category="list-text">验证控制器和机箱是否已配置为 HA ：</block>
  <block id="70cfb57c22486ea2d08d331675532dce" category="paragraph">`ha-config show`</block>
  <block id="d66825c57ef1d03f12142772b5cb7bae" category="paragraph">以下示例显示了 `ha-config show` 命令的输出：</block>
  <block id="8d88ee8626e30313013b223ba409abaa" category="admonition">系统会在 PROM 中记录它们是采用 HA 对还是独立配置。独立系统或 HA 对中的所有组件的状态都必须相同。</block>
  <block id="55c802ca03b1fc5b58c1d59d28131125" category="list-text">如果控制器和机箱未配置为 HA ，请使用以下命令更正配置：</block>
  <block id="dd974151ca8e1528e09f3e46a090f617" category="paragraph">`ha-config modify controller ha`</block>
  <block id="898e93ac193351b4a5f895216aad0508" category="paragraph">`ha-config modify chassis ha`</block>
  <block id="236df8dd892b4bd6bb01e86747337e6f" category="paragraph">如果您使用的是 MetroCluster 配置，请使用以下命令修改控制器和机箱：</block>
  <block id="911c90c39145c3c3c0d524809f4a16c8" category="paragraph">`ha-config modify controller mcc`</block>
  <block id="1d3bd99dc4d12eba418aa32c0e69ed77" category="paragraph">`ha-config modify chassis mcc`</block>
  <block id="d09b053bad809215bd1c4350481aba44" category="list-text">退出维护模式：</block>
  <block id="819817945fea31f0c3596c841e685904" category="paragraph">`halt`</block>
  <block id="106cd92eb2d2b994c9a8675214fd438c" category="paragraph">在启动环境提示符处按 Ctrl-C 中断自动启动。</block>
  <block id="088efa1f2f879b1cccaa5b548a064885" category="list-text">在 node3 上，检查系统日期，时间和时区：</block>
  <block id="0dbad5b96349237116f63f0f389bd7f4" category="paragraph">`dATE`</block>
  <block id="68dd867f743672fe385fd727b406983a" category="list-text">在 node4 上，在启动环境提示符处使用以下命令检查日期：</block>
  <block id="3e72511c09e554faf49052f79d627689" category="paragraph">`s如何选择日期`</block>
  <block id="10615484104523967682784d6824a536" category="list-text">如有必要，请在 node4 上设置日期：</block>
  <block id="833ce90830a0406f310191c0da1f76da" category="paragraph">`set date &lt;MM/dd/yyy&gt;`</block>
  <block id="aa03f64841cdad6f19ac1550e1ad8c29" category="list-text">在 node4 上，在启动环境提示符处使用以下命令检查时间：</block>
  <block id="667f3a6a11750e110d0c1442d2aa20e7" category="paragraph">`s时间`</block>
  <block id="7651eb09fbac7d811bab7ed026019b25" category="list-text">如有必要，请在 node4 上设置时间：</block>
  <block id="25a249a3cdba620e6eba67639be13589" category="paragraph">`set time &lt;hh ： mm ： ss&gt;`</block>
  <block id="55f472f17ae9bd54337956b780332fff" category="list-text">如有必要，请在 node4 上设置配对系统 ID ：</block>
  <block id="50e811b2a9396215b344a15d01fc1fea" category="paragraph">`setenv partner- sysid &lt;node2_sysid&gt;`</block>
  <block id="e02ed2f754f906507b04045b6d64c6a8" category="list-text">保存设置：</block>
  <block id="4efce637d6ec3bc2a69f403fd39b9b41" category="paragraph">`saveenv`</block>
  <block id="a41540a4727489355ce1dd1fcda58843" category="list-text">在新节点的启动加载程序中，必须设置 `partner- sysid` 参数。对于 node4 ， `partn- sysid` 必须为 node3 。验证 node3 的 `partn- sysid` ：</block>
  <block id="fbe3b6f75f2d8164c601fbd0fdb2d3cd" category="paragraph">`printenv partn- sysid`</block>
  <block id="62ac7cf3796c3e4bbe3285d1976b1c2c" category="list-text">【第 22 步】执行以下操作之一：</block>
  <block id="a566a7773caad8e1452ad7591dace303" category="cell">如果您的系统 ...</block>
  <block id="b0d05d370a8e827d5c1d1e92258a25b2" category="cell">具有磁盘，无后端存储</block>
  <block id="7f3ec1ffd93dbf53956485464c8f29a2" category="cell">转至 <block ref="7d33d698028361a6b46f35be2a3ff5a2" category="inline-xref-macro-rx"></block>。</block>
  <block id="c9d3e45a02f36166b1f2d250fefe0e40" category="cell">是 V 系列系统或已将 FlexArray 虚拟化软件连接到存储阵列的系统</block>
  <block id="d41d8cd98f00b204e9800998ecf8427e" category="doc"></block>
  <block id="6c87f26ede26b8a4600cd3be3a5c4a39" category="list-text">转至第节 <block ref="a6d322e902b744ff3a11f02b5c6d9496" category="inline-link-macro-rx"></block> 并完成本节中的各小节。</block>
  <block id="d4bf40b038a0294c5a0c9cfeacb6b991" category="list-text">返回到此部分，完成从开始的其余步骤 <block ref="7d33d698028361a6b46f35be2a3ff5a2" category="inline-xref-macro-rx"></block>。</block>
  <block id="340156df6d6753b1e8aa84113b4a83e9" category="paragraph">* 重要信息 * ：在使用 FlexArray 虚拟化软件的 V 系列或系统上启动 ONTAP 之前，必须重新配置 FC 板载端口， CNA 板载端口和 CNA 卡。</block>
  <block id="f1f401fda84803d54fb9ed083d0ebefa" category="list-text">【 auto_install4_step23]] 将新节点的 FC 启动程序端口添加到交换机分区。</block>
  <block id="2a1ffcfd9b3fe851dbeca2f509c1f7a3" category="paragraph">如果您的系统具有磁带 SAN ，则需要对启动程序进行分区。如果需要，请参考将板载端口修改为启动程序 <block ref="1d789633b45165b05bf13f9838060fe6" category="inline-link-macro-rx"></block>。有关分区的详细说明，请参见存储阵列和分区文档。</block>
  <block id="626097c557d64952b56d6d6e63d3ad8e" category="list-text">将 FC 启动程序端口作为新主机添加到存储阵列，从而将阵列 LUN 映射到新主机。</block>
  <block id="c90869b8dd8fd41fd210932364a2caf7" category="paragraph">有关说明，请参见存储阵列和分区文档。</block>
  <block id="20285adb42be1ddc0c2df8f7a2de7595" category="list-text">修改与存储阵列上的阵列 LUN 关联的主机或卷组中的全球通用端口名称（ WWPN ）值。</block>
  <block id="a2b95adba38da1a033c4cae3447040cc" category="paragraph">安装新控制器模块会更改与每个板载 FC 端口关联的 WWPN 值。</block>
  <block id="23eacbaf200afc53fbaaaaa3d6705308" category="list-text">如果您的配置使用基于交换机的分区，请调整分区以反映新的 WWPN 值。</block>
  <block id="561611b8a20e2e0f3f7213992d997278" category="list-text">`s步骤 27]] 如果在此配置上使用 NetApp 存储加密（ NSE ），则必须将` etenv bootarg.storageencryption.support `命令设置为` true `，并将 kmip.init.maxwait` `变量设置为` off ，以避免在加载 node2 配置后出现启动环路：</block>
  <block id="0ab3dc62b58693ac60ff9111f9d60a74" category="paragraph">`setenv bootarg.storageencryption.support true`</block>
  <block id="461db791196d5961d2d12d83cd09d8ef" category="paragraph">`setenv kmip.init.maxwait off`</block>
  <block id="d1cffd7fada9f21315c30db304bb2ca9" category="list-text">启动节点进入启动菜单：</block>
  <block id="a94e69437db24dee798bbd90bce4ee0a" category="paragraph">`boot_ontap 菜单`</block>
  <block id="64782ddcc78f95845d4571abdc1d5f5a" category="inline-link-macro">检查并配置 node4 上的 UTA/UTA2 端口，步骤 15</block>
  <block id="f5de4d1593689e91265cc76abd91be3e" category="paragraph">如果您没有 FC 或 UTA/UTA2 配置，请执行 <block ref="65c4c751ac1fc661b74f2a8dfa84d816" category="inline-link-macro-rx"></block> 以便 node4 可以识别 node2 的磁盘。</block>
  <block id="9f6c1c59e595c7b6b493f92b24930c14" category="inline-link-macro">在 node4 上设置 FC 或 UTA/Ut2 配置</block>
  <block id="cbe290335ddc7c966d9c148980b1ddd5" category="list-text">【第 29 步】对于 MetroCluster 配置， V 系列系统以及将 FlexArray 虚拟化软件连接到存储阵列的系统，您必须在 node4 上设置和配置 FC 或 UTA/UTA2 端口，以检测连接到节点的磁盘。要完成此任务，请转至第节 <block ref="39202fc611c1fcac2f1575fc00cb55d3" category="inline-link-macro-rx"></block>。</block>
  <block id="b9afc0f55ceae0ffd6b6f1e1c9a8f62e" category="summary">在 node4 上验证网络配置之后，以及在将聚合从 node3 重新定位到 node4 之前。</block>
  <block id="32d978cffec9875e4d92dc55b84df69b" category="doc">将 node2 拥有的非根聚合和 NAS 数据 LIF 从 node3 移动到 node4</block>
  <block id="33b455f1b5d98f0ba5db998a78bbbbe3" category="paragraph">在验证 node4 上的网络配置以及将聚合从 node3 重新定位到 node4 之前，您必须验证当前位于 node3 上的 node2 所属的 NAS 数据 LIF 是否已从 node3 重新定位到 node4 。您还必须验证 node4 上是否存在 SAN LIF 。</block>
  <block id="d2f28697e2bc23acb2a0a646043ffac0" category="paragraph">在升级操作步骤期间，远程 LIF 处理 SAN LUN 的流量。升级期间，集群或服务运行状况无需移动 SAN LIF 。除非需要将 SAN LIF 映射到新端口，否则不会移动这些 LIF 。使 node4 联机后，您将验证 LIF 是否运行正常并位于相应的端口上。</block>
  <block id="761fe912511daeb08557e2215d0085e3" category="list-text">恢复重新定位操作：</block>
  <block id="d6fd449bc639f92f27b747fd5b40361d" category="paragraph">`s系统控制器更换恢复`</block>
  <block id="0088774945c7d5ae5289c2de3632524f" category="paragraph">系统将执行以下任务：</block>
  <block id="8f1335854a57fa62ce5fd7596399825b" category="list-text">集群仲裁检查</block>
  <block id="9ebfbaf3d8306da9bc975b709c5ec632" category="list-text">系统 ID 检查</block>
  <block id="02d365a95e78a8c9b434a9c521f379c8" category="list-text">映像版本检查</block>
  <block id="2540df2535b5361f67db0cb18a3f91a5" category="list-text">目标平台检查</block>
  <block id="c8740509193885a8e40f7a7fb84ebff6" category="list-text">网络可访问性检查</block>
  <block id="93328d3894b0eabbdee40ef873079464" category="paragraph">此操作将在网络可访问性检查的此阶段暂停。</block>
  <block id="ba825b8ec370a1f6fa3b0b9ac48b0036" category="paragraph">系统将执行以下检查：</block>
  <block id="e31fb2dedfef9337a9708f375d220030" category="list-text">集群运行状况检查</block>
  <block id="8ea7886b35c3e44ad6fcf3a1535ab9e7" category="list-text">集群 LIF 状态检查</block>
  <block id="545969fcc9e42f8cf5ca0598e1ec25f6" category="paragraph">执行这些检查后，系统会将 node2 拥有的非根聚合和 NAS 数据 LIF 重新定位到新控制器 node4 。资源重新定位完成后，控制器更换操作将暂停。</block>
  <block id="9b1668278d2d17d21775af5a0c8c14b3" category="list-text">检查聚合重新定位和 NAS 数据 LIF 移动操作的状态：</block>
  <block id="f1e1b94ce2ba7179506b74127da77af2" category="paragraph">`s系统控制器更换 show-details`</block>
  <block id="ff23473696232fd91c1e2dcb460109e4" category="paragraph">如果控制器更换操作步骤已暂停，请检查并更正错误（如果有），然后选择问题描述 `reume` 继续操作。</block>
  <block id="b5cd09b90221c700e1c2cf9d6253d6a1" category="list-text">如有必要，还原和还原任何已替换的 LIF 。列出所有已替换的 LIF ：</block>
  <block id="0b66eef739f727e3f877d8fd0e6b8862" category="paragraph">`cluster controller-replacement network placed-interface show`</block>
  <block id="e288d72d848472060faab52648a13f10" category="paragraph">如果已替换任何 LIF ，请将主节点还原回 node4 ：</block>
  <block id="26490175c6a9bb3f68c33041e7c3bd2e" category="paragraph">`cluster controller-replacement network placed-interface restore-home-node`</block>
  <block id="6def760ec3a422405912b1de335c67db" category="list-text">恢复此操作以提示系统执行所需的后检查：</block>
  <block id="f3bf2563f63e5f2af4793dec3cbb4411" category="paragraph">系统将执行以下后检查：</block>
  <block id="9e9f6a103b5a748cadf8dfd54b8e29ac" category="list-text">聚合重建检查</block>
  <block id="ea017e018f3e760c65f3b02f928b8e43" category="list-text">聚合状态检查</block>
  <block id="08f0db77633fd9c7f12fcd8827332b9d" category="list-text">磁盘状态检查</block>
  <block id="3c1799bbeb29b748f57f26ac2c4fc6f9" category="list-text">卷检查</block>
  <block id="14c464f3076760dd0c7480550e4464d7" category="summary">要停用 node2 ，您需要正确关闭 node2 并将其从机架或机箱中卸下。</block>
  <block id="befd434b83717d2b7bd83967d66e9157" category="doc">停用 node2</block>
  <block id="3b70100fce1839004dba40191f90a2c9" category="list-text">恢复操作：</block>
  <block id="21d67404cbc8811a82f375c6eb59ce82" category="paragraph">节点会自动暂停。</block>
  <block id="ac616410952c35e808a3c7ce4ea5b4a7" category="inline-link-macro">停用旧系统</block>
  <block id="b39850fa882a12596e03ef7779fcfebc" category="list-text"><block ref="5e1bb6d16e6bc7a1d750ae669f510747" category="inline-xref-macro-rx"></block></block>
  <block id="2061ab494eae73f1e7251b76a58b27d3" category="cell">介绍如何通过移动存储或卷快速升级集群中的控制器硬件。还介绍如何将受支持的型号转换为磁盘架。</block>
  <block id="5d1afe326f483a14ce8cd69456db1384" category="cell">介绍如何在网络结构配置中安装和配置 MetroCluster 硬件和软件组件。</block>
  <block id="e5c39acdb0f682a22a7b242d48ac3ce5" category="inline-link-macro">《 FlexArray 虚拟化安装要求和参考》</block>
  <block id="d1d13e1cdd7f75473f7902868b6ba3d7" category="cell">包含 FlexArray 虚拟化系统的布线说明和其他信息。</block>
  <block id="34e4a4d5395b895e2a8897ebef238c1a" category="cell">介绍如何在计划内维护操作或发生灾难时执行 MetroCluster 切换和切回操作。</block>
  <block id="595e15ec8af10c3d959522d0d1eab769" category="cell">介绍升级 MetroCluster 配置中的控制器和存储型号，从 MetroCluster FC 过渡到 MetroCluster IP 配置以及通过添加更多节点扩展 MetroCluster 配置的过程。</block>
  <block id="b42a2144e64bfdf4eecf966f7bb495c5" category="inline-link-macro">《 ONTAP 9.0 命令：手册页参考》</block>
  <block id="a4117daa2ff8204dba8b79ed1da09e5b" category="cell"><block ref="a4117daa2ff8204dba8b79ed1da09e5b" category="inline-link-macro-rx"></block></block>
  <block id="81f65dde1fe71b470218b0fbe6dafc23" category="cell">介绍支持的 ONTAP 9.0 命令的语法和用法。</block>
  <block id="1447526d9bfec11c73a566b23b4f87ab" category="inline-link-macro">《 ONTAP 9.1 命令：手册页参考》</block>
  <block id="3f651f32c2efae31cb0b4da82294b37b" category="cell"><block ref="3f651f32c2efae31cb0b4da82294b37b" category="inline-link-macro-rx"></block></block>
  <block id="d7e58a36d2ecf34ed950099c1e30e349" category="cell">介绍支持的 ONTAP 9.1 命令的语法和用法。</block>
  <block id="25d709d9429cb9179fe81f4343515fa1" category="inline-link-macro">《 ONTAP 9.2 命令：手册页参考》</block>
  <block id="89065c0795a681c066df18ebe55464d3" category="cell"><block ref="89065c0795a681c066df18ebe55464d3" category="inline-link-macro-rx"></block></block>
  <block id="be948fce3cd6e191738619444b30062e" category="cell">介绍支持的 ONTAP 9.2 命令的语法和用法。</block>
  <block id="46490acdb4b495cbc81468a4840d2c5d" category="inline-link-macro">《 ONTAP 9.3 命令：手册页参考》</block>
  <block id="9d087aa4c3e3015b8ac013580c0f90d4" category="cell"><block ref="9d087aa4c3e3015b8ac013580c0f90d4" category="inline-link-macro-rx"></block></block>
  <block id="119362933ed4ef8c2dbccecbb68cc43b" category="cell">介绍支持的 ONTAP 9.3 命令的语法和用法。</block>
  <block id="1aeb70ab3e33d74db4928037aa88a7eb" category="inline-link-macro">《 ONTAP 9.4 命令：手册页参考》</block>
  <block id="8a14044dc26b4cb3bb6448492e70e961" category="cell"><block ref="8a14044dc26b4cb3bb6448492e70e961" category="inline-link-macro-rx"></block></block>
  <block id="929d0856b69565e71fefd5bef5533d93" category="cell">介绍支持的 ONTAP 9.4 命令的语法和用法。</block>
  <block id="6ea3af7ae81e05b625440926c8fcc6ea" category="inline-link-macro">《 ONTAP 9.5 命令：手册页参考》</block>
  <block id="78610e5d700899a0dc146918529c56af" category="cell"><block ref="78610e5d700899a0dc146918529c56af" category="inline-link-macro-rx"></block></block>
  <block id="db0052a2214aa0ca3e4d7e0a79e8d79a" category="cell">介绍支持的 ONTAP 9.5 命令的语法和用法。</block>
  <block id="384be8d232a0ab0b84a145e4bf59bbed" category="inline-link-macro">《 ONTAP 9.6 命令：手册页参考》</block>
  <block id="84d45c7d2db474ca3af465732948fd8d" category="cell"><block ref="84d45c7d2db474ca3af465732948fd8d" category="inline-link-macro-rx"></block></block>
  <block id="7478969542b0a3320dd1f9c09d30231a" category="cell">介绍支持的 ONTAP 9.6 命令的语法和用法。</block>
  <block id="c9aa14f76f0f0a25762ef86776113011" category="inline-link-macro">《 ONTAP 9.7 命令：手册页参考》</block>
  <block id="edcc14f99b45ac8b5b29319da6793eea" category="cell"><block ref="edcc14f99b45ac8b5b29319da6793eea" category="inline-link-macro-rx"></block></block>
  <block id="849578c3a682cf124d61ab2b562aa1fa" category="cell">介绍支持的 ONTAP 9.7 命令的语法和用法。</block>
  <block id="112d3c239cd86d18383aedfae5ed632b" category="inline-link-macro">《 ONTAP 9.8 命令：手册页参考》</block>
  <block id="a206ae5c7f29407f29397485796cc31c" category="cell"><block ref="a206ae5c7f29407f29397485796cc31c" category="inline-link-macro-rx"></block></block>
  <block id="c85c87a5f255edc538c88661bb863907" category="cell">介绍支持的 ONTAP 9.8 命令的语法和用法。</block>
  <block id="8514bd0cded8da51b71a7aba8599153c" category="cell">介绍如何安装和管理高可用性集群配置，包括存储故障转移和接管 / 交还。</block>
  <block id="5e4a89e01c551e30f3b547a226c6e59d" category="cell">介绍如何使用卷， FlexClone 卷，文件和 LUN ， FlexCache 卷， 重复数据删除，数据压缩， qtree 和配额。</block>
  <block id="ed99eca5665640e9b0e3fced8264b368" category="cell">介绍如何在集群中配置和管理物理和虚拟网络端口（ VLAN 和接口组）， LIF ，路由和主机解析服务；如何通过负载平衡优化网络流量；以及如何使用 SNMP 监控集群。</block>
  <block id="684c05de33c5ed574435c18094046bde" category="cell">包含有关 FC 和 iSCSI 拓扑和布线方案的信息。</block>
  <block id="ec8a498c0ff432b735ba28247dbb239f" category="cell">介绍如何设置和配置 ONTAP 。</block>
  <block id="38f19900a80b03ef2e62f2105ab6323a" category="cell">介绍如何管理 ONTAP 系统，向您展示如何使用命令行界面，如何访问集群，如何管理节点等。</block>
  <block id="25c1844876df2afa3616f32befb014b3" category="cell">包含有关下载和升级 ONTAP 的说明。</block>
  <block id="9bd1a11fb0d175da8194074a575cbf3a" category="inline-link-macro">使用 system controller replace 命令将运行 ONTAP 9.5 的控制器硬件升级到 ONTAP 9.7</block>
  <block id="f576635c194a19e5910126ab234152d9" category="cell"><block ref="f576635c194a19e5910126ab234152d9" category="inline-link-macro-rx"></block></block>
  <block id="76131ba473c7ab8f940b1defa73cba87" category="cell">介绍使用 system controller replace 命令将运行 ONTAP 9.5 的控制器无中断升级到 ONTAP 9.7 所需的聚合重新定位过程。</block>
  <block id="0e490704226a6f678e043e59eee46210" category="inline-link-macro">使用 system controller replace 命令升级运行 ONTAP 9.8 或更高版本的控制器硬件</block>
  <block id="c6f3014369a1f06fe73f7a2cba39dfb1" category="cell"><block ref="c6f3014369a1f06fe73f7a2cba39dfb1" category="inline-link-macro-rx"></block></block>
  <block id="62a92c3d7ea27667983fb6842f0835ec" category="cell">介绍使用 system controller replace 命令无中断升级运行 ONTAP 9.8 的控制器所需的聚合重新定位过程。</block>
  <block id="743707e39dafe5109cbff1b061b5b76d" category="inline-link-macro">使用聚合重新定位手动升级运行 ONTAP 9.7 或更早版本的控制器硬件</block>
  <block id="5cb60fbe51b20b5c36b7dee05c9cf1f7" category="cell"><block ref="5cb60fbe51b20b5c36b7dee05c9cf1f7" category="inline-link-macro-rx"></block></block>
  <block id="55b831f07f1b45c03df3d93cd827ad94" category="cell">介绍运行 ONTAP 9.7 或更早版本执行手动无中断控制器升级所需的聚合重新定位过程。</block>
  <block id="0fcc55966131a059d63ed79deda9a495" category="inline-link-macro">使用聚合重新定位手动升级运行 ONTAP 9.8 或更高版本的控制器硬件</block>
  <block id="48d4ce3e31086711d3ee342fa8447083" category="cell"><block ref="48d4ce3e31086711d3ee342fa8447083" category="inline-link-macro-rx"></block></block>
  <block id="f39fe3ae91660449bc81c96d4bc3f3a6" category="cell">介绍运行 ONTAP 9.8 或更高版本时执行手动无中断控制器升级所需的聚合重新定位过程。</block>
  <block id="f7e23c11beeca2c17c91f38177574a83" category="section-title">参考站点</block>
  <block id="9d2169c1c2855b78a7aeaa4f42d27dc7" category="inline-link-macro">NetApp 支持站点</block>
  <block id="da160308e3b4b4a80bf1b72b5bdbedb8" category="inline-link-macro">Hardware Universe</block>
  <block id="865e9b4ef52f3b0d3050c8b3c14eb660" category="inline-link-macro">Active IQ Config Advisor</block>
  <block id="37ca8b383b926ae9880b1b535c90290a" category="summary">在 ONTAP 命令行中输入以下命令，开始控制器更换过程。</block>
  <block id="83b27b00949218cb0d9ec7e1eb1c92ad" category="doc">准备要升级的节点</block>
  <block id="f163cd0bda37780c7a24303611dc0185" category="paragraph">您必须执行以下步骤来准备要升级的节点。</block>
  <block id="6510eaf8fd7e9800a5b7d62b06dc6e9c" category="list-text">在 ONTAP 命令行中输入以下命令，开始控制器更换过程：</block>
  <block id="f65104a2552945130cb62829d56eac5e" category="paragraph">`ssystem controller replace start -nodes &lt;node_name&gt;`</block>
  <block id="883d9d0a0453675233da0c78e0c1caac" category="admonition">此命令只能在高级权限级别执行： `set -privilege advanced`</block>
  <block id="53d5140b9db74b84bdd8037a6063ec88" category="paragraph">您将看到以下输出：</block>
  <block id="9843edc4af038cb41e5ce95e9aad1e03" category="list-text">按 `y` ，您将看到以下输出：</block>
  <block id="ffc467f3c2a85173d4529548d72d41b9" category="paragraph">系统将运行以下预检；记下每个预检的输出，以便稍后在操作步骤中使用：</block>
  <block id="495aa5c508241f1eca40fd503bc73196" category="cell">预检查</block>
  <block id="b5a7adde1af5c87d7fd797b6245c2a39" category="cell">Description</block>
  <block id="688df3b12b34ef0608e319ff169390d4" category="cell">集群运行状况检查</block>
  <block id="2ebe98702ab3694ec3ccfe3e623a124e" category="cell">检查集群中的所有节点以确认其运行状况良好。</block>
  <block id="56beb58e6d547196c5aa44214e93ccaa" category="cell">MCC 集群检查</block>
  <block id="f8c3b8dcbd883dc2841679a94feb852a" category="cell">检查系统是否为 MetroCluster 配置。该操作会自动检测是否为 MetroCluster 配置，并执行特定的预检和验证检查。仅支持 4 节点 MetroCluster FC 配置。对于双节点 MetroCluster 配置和四节点 MetroCluster IP 配置，检查将失败。如果 MetroCluster 配置处于切换状态，则检查将失败。</block>
  <block id="b14360b478956e0213006307a2213b01" category="cell">聚合重新定位状态检查</block>
  <block id="23ecfd4d5c38f058d2a5b47f3a17a9b2" category="cell">检查聚合重新定位是否已在进行中。如果正在进行另一个聚合重新定位，则检查将失败。</block>
  <block id="2fb16648e5e222f12729fb8c953149b5" category="cell">型号名称检查</block>
  <block id="84599dff045e3f86049bc2022bf4b930" category="cell">检查此操作步骤是否支持这些控制器型号。如果不支持这些型号，则此任务将失败。</block>
  <block id="67c4a102a7629dddfcaf5472ead63dd6" category="cell">集群仲裁检查</block>
  <block id="b26031d08c55750f9480d081320ddcbe" category="cell">检查要更换的节点是否处于仲裁状态。如果节点未处于仲裁状态，则此任务将失败。</block>
  <block id="833b60ce00de23efdd84aaf2257b1cd3" category="cell">映像版本检查</block>
  <block id="4f324d87f2095ea7b3cb652dd2dc4b10" category="cell">HA 状态检查</block>
  <block id="0ec2a475eb3cc7052a2df9d912b429a5" category="cell">检查要更换的两个节点是否采用高可用性（ HA ）对配置。如果未为控制器启用存储故障转移，则任务将失败。</block>
  <block id="13953a740d52280d2268524a1a4a3535" category="cell">聚合状态检查</block>
  <block id="d2be5a07810282eec1226ecdcabc0e8d" category="cell">如果要更换的节点自身的聚合不是主所有者，则此任务将失败。节点不应拥有任何非本地聚合。</block>
  <block id="6244df7e25591403b0d5255577576eb4" category="cell">磁盘状态检查</block>
  <block id="320bc2c593ebed7e970715ea3832bc2e" category="cell">数据 LIF 状态检查</block>
  <block id="9433521f789681a1a8fd76815674c438" category="cell">检查要更换的任何节点是否具有非本地数据 LIF 。节点不应包含其不是主所有者的任何数据 LIF 。如果其中一个节点包含非本地数据 LIF ，则任务将失败。</block>
  <block id="eb694fc97d0bfef2c84584a29b318d85" category="cell">集群 LIF 状态</block>
  <block id="ce7612b7485886dbb77994528256ffe5" category="cell">检查两个节点的集群 LIF 是否均已启动。如果集群 LIF 已关闭，则此任务将失败。</block>
  <block id="35a80eab14772418cca0ff3317910419" category="cell">ASUP 状态检查</block>
  <block id="166dc880ac0c6c0bb26663235da7e471" category="cell">如果未配置 ASUP 通知，则任务将失败。在开始更换控制器操作步骤之前，必须启用 ASUP 。</block>
  <block id="d39a17fff59bba71c24822f913f16591" category="cell">CPU 利用率检查</block>
  <block id="3478400e352864eaa33992de6e976ca8" category="cell">检查要更换的任何节点的 CPU 利用率是否超过 50% 。如果 CPU 使用率在相当长的一段时间内超过 50% ，则此任务将失败。</block>
  <block id="1a0a7ab1ebbc5d1d73b48be5c234810d" category="cell">聚合重建检查</block>
  <block id="7830789d964e8c8cf3a370b1d0299a28" category="cell">检查是否正在任何数据聚合上进行重建。如果正在进行聚合重建，则此任务将失败。</block>
  <block id="c17c89f5ba46492be395e9f071e013ae" category="cell">节点关联性作业检查</block>
  <block id="83aecfe9d4bf515a2ec45766e28a4ce0" category="cell">检查是否正在运行任何节点关联作业。如果节点关联性作业正在运行，则检查将失败。</block>
  <block id="3ae0a94222b6d6378899ff73d1aad6e3" category="list-text">在启动控制器更换操作并完成预检后，此操作将暂停，以便您稍后在配置 node3 时收集可能需要的输出信息。</block>
  <block id="6c7905cfbf20ac44387cca492e010687" category="paragraph">您必须分别运行和保存以下命令的输出：</block>
  <block id="2a29db167c3a03336a9b63367df61117" category="list-text">vserver services name-service dns show</block>
  <block id="adb6c9273650502325bd84641dded06a" category="list-text">network interface show -curr-node &lt;nodename&gt; -role &lt;cluster ， intercluster ， node-mgmt ， cluster-mgmt ， data&gt;</block>
  <block id="8ba3dc8f2e507a70633697dc60de2269" category="list-text">network port show -node &lt;node_name&gt; -type physical</block>
  <block id="4b6d2742fe44e19ae334198040aa33ef" category="list-text">service-processor show -node * -instance</block>
  <block id="54435116abb139647e98feb1031829db" category="list-text">network fcp adapter show -node &lt;node_name&gt;</block>
  <block id="21ae3cd30d3faa7f1f8d97766b196a1a" category="list-text">network port ifgrp show</block>
  <block id="cbd335576ebae1caff82003d00697c97" category="list-text">system node show -instance -node &lt;node_name&gt;</block>
  <block id="a0ce199a837f76798ed0619d2ef94065" category="list-text">运行 -node &lt;node_name&gt; sysconfig</block>
  <block id="fac031b53ff277f8625f50e090a47475" category="list-text">storage aggregate show -node &lt;node_name&gt;</block>
  <block id="fbbf7d037bc226399100b8f4ea551e3a" category="list-text">volume show -node &lt;node_name&gt;</block>
  <block id="9a58231354c6d959f08b17d7fdb9350f" category="list-text">storage array config show -switch &lt;switch_name&gt;</block>
  <block id="760bdf3d6f89d3bd7422272872fc8ec1" category="list-text">system license show -owner &lt;node_name&gt;</block>
  <block id="46353f4e0bb2c136591c37c9eeedcf40" category="list-text">storage encryption disk show</block>
  <block id="6b6f6c1a8bc1fede794cda92ed140953" category="list-text">security key-manager backup show</block>
  <block id="001642cb897a8bebce3210207b7e81af" category="list-text">security key-manager external show</block>
  <block id="6afea099b023b1bd5f51935ccb31ce0a" category="list-text">security key-manager external show-status</block>
  <block id="27c32000aa45c9243e8b444a27636832" category="list-text">可访问性 show -detail</block>
  <block id="9cad135052afca91f1dd4b9f0372c825" category="admonition">如果使用板载密钥管理器（ OKM ）进行 NetApp 卷加密，请准备好密钥管理器密码短语，以便稍后在操作步骤中完成密钥管理器重新同步。</block>
  <block id="22afa574ce25ee7b49bc951eecd7f0ac" category="section-title">如果 ARL 预检失败，请更正聚合所有权</block>
  <block id="7a29204c210eec42f3d01bebd9b483ba" category="paragraph">如果聚合状态检查失败，您必须将配对节点拥有的聚合返回到主所有者节点，然后重新启动预检过程。</block>
  <block id="f38dad169237355428118b60b1896828" category="list-text">将配对节点当前拥有的聚合返回到主所有者节点：</block>
  <block id="0620f85959e7122e0e62c6193df806f8" category="paragraph">`storage aggregate relocation start -node &lt;source_node&gt; -destination &lt;destination-node&gt; - aggregate-list *`</block>
  <block id="17ef288fc5accadf7f08a6841d89c986" category="list-text">验证 node1 和 node2 均不拥有其当前所有者（而不是主所有者）的聚合：</block>
  <block id="bb496edf1f029fe3c96dcfaddbc60ab0" category="paragraph">`storage aggregate show -nodes &lt;node_name&gt; -is-home false -fields owner-name ， home-name ， state`</block>
  <block id="74aa132d7caa1904dc30e16328313124" category="paragraph">以下示例显示了当节点同时是聚合的当前所有者和主所有者时命令的输出：</block>
  <block id="bd965e38a0c9cf27aa1bde099308e23f" category="section-title">完成后</block>
  <block id="b034884667760545b9597461a985e372" category="paragraph">您必须重新启动控制器更换过程：</block>
  <block id="794df3791a8c800841516007427a2aa3" category="section-title">许可证</block>
  <block id="edfd39240931c89b8ad19f9eea422658" category="paragraph">设置集群时，设置向导会提示您输入集群基础许可证密钥。但是，某些功能需要额外的许可证，这些许可证以 _packages_ 的形式发布，其中包括一个或多个功能。集群中的每个节点都必须有自己的密钥，才能在集群中使用每个功能。</block>
  <block id="0716a66a70e59256281f4030c078ce04" category="paragraph">如果没有新的许可证密钥，则新控制器可以使用集群中当前已获得许可的功能。但是，在控制器上使用未经许可的功能可能会使您不符合您的许可协议，因此，您应在升级完成后为新控制器安装新的许可证密钥。</block>
  <block id="eb40310be53032e7e599a9070cfaf20f" category="paragraph">请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _NetApp 支持站点 _ ，在此可以获取 ONTAP 的新 2 字符许可证密钥。这些密钥位于 _Software licenses_ 下的 _My Support_ 部分中。如果此站点没有所需的许可证密钥，您可以联系您的 NetApp 销售代表。</block>
  <block id="556a407c4a4faf57fc56c1b7137d5f36" category="paragraph">有关许可的详细信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到系统管理参考。</block>
  <block id="ea6471fa3c0b778358a74a483b65908e" category="summary">如果 node4 具有板载 FC 端口， UTA/UTA2 端口或 UTA/UTA2 卡，则必须先配置这些设置，然后才能完成其余操作步骤。</block>
  <block id="291e8826d2b19041a0543b448060f314" category="paragraph">如果 node4 具有板载 FC 端口，板载统一目标适配器（ UTA/UTA2 ）端口或 UTA/UTA2 卡，则必须先配置这些设置，然后才能完成其余操作步骤。</block>
  <block id="85f1449ea514e1be4b11527eb6fbce31" category="paragraph">您可能需要完成 <block ref="b22a2e603d310a795a7b59d2bdda39ee" category="inline-xref-macro-rx"></block> 部分 <block ref="5752cac0a470e06ffceef40fba1931c1" category="inline-xref-macro-rx"></block>或这两个部分。</block>
  <block id="405ab80b96586360ea83735c37305935" category="inline-link-macro">验证 node4 安装</block>
  <block id="e5d8ce1e4e0f9c50b3cbdf452d60972e" category="inline-link-macro">第 22 步</block>
  <block id="3dc7a36efda97abdf7240a1ca32de490" category="admonition">如果 node4 没有板载 FC 端口，板载 UTA/UTA2 端口或 UTA/UTA2 卡，并且您要升级具有存储磁盘的系统，则可以跳至 <block ref="3a339ed5bdc85366b677c546716fabfa" category="inline-link-macro-rx"></block>。但是，如果您使用的是 V 系列系统或 FlexArray 虚拟化软件并连接到存储阵列，并且 node4 没有板载 FC 端口，板载 UTA/UTA2 端口或 UTA/UTA2 卡，则必须返回 _Install and boot node4_ 部分并继续执行 <block ref="1a99f6ce933cd745b2b02e54c9272506" category="inline-link-macro-rx"></block>。确保 node4 具有足够的机架空间。如果 node4 与 node2 位于不同的机箱中，则可以将 node4 与 node3 放在同一位置。如果 node2 和 node4 位于同一机箱中，则 node4 已位于其相应的机架位置。</block>
  <block id="6ef697f11922be2e4de0971f7d70997f" category="list-title">选项</block>
  <block id="32681c366792ff09536e44772a3bddf2" category="list-text"><block ref="b22a2e603d310a795a7b59d2bdda39ee" category="inline-xref-macro-rx"></block></block>
  <block id="17889f6fb09adc44188f6076a9e7852a" category="list-text"><block ref="5752cac0a470e06ffceef40fba1931c1" category="inline-xref-macro-rx"></block></block>
  <block id="cd7dd5075be56af4a3298feff04bb98a" category="paragraph">如果 node4 具有板载或 FC 适配器上的 FC 端口，则必须先在节点上设置端口配置，然后再将其投入使用，因为这些端口未经过预配置。如果未配置端口，则可能会发生服务中断。</block>
  <block id="3bb2def349bd01a4e09f553241c547bb" category="paragraph">您必须具有在部分中保存的 node2 中的 FC 端口设置值 <block ref="cd8ad1809865824065fe011b80800cd6" category="inline-link-macro-rx"></block>。</block>
  <block id="8651f71cd1a76b7df1a83cae390627a8" category="paragraph">如果您的系统没有 FC 配置，则可以跳过此部分。如果您的系统具有板载 UTA/UTA2 端口或 UTA/UTA2 适配器，则可以在中对其进行配置 <block ref="5752cac0a470e06ffceef40fba1931c1" category="inline-xref-macro-rx"></block>。</block>
  <block id="b075444cf1672de101272f1c40d6530b" category="paragraph">* 重要说明 * ：如果系统具有存储磁盘，则必须在集群提示符处输入本节中的命令。如果您的 V 系列系统或系统已将 FlexArray 虚拟化软件连接到存储阵列，则可以在维护模式下在此部分中输入命令。</block>
  <block id="4d65ef8cf84d37cbb99560183afc8431" category="list-text">执行以下操作之一：</block>
  <block id="78f6ac180c7bb87b8aee79da36246598" category="cell">如果要升级的系统 ...</block>
  <block id="a7a589b8e6e6d3aac1d1459d66a748a0" category="cell">然后选择…</block>
  <block id="61bc24f9f2f24029ba7b04d76f768598" category="cell">具有存储磁盘</block>
  <block id="e1a8971092776bc2e25be6babad152ab" category="cell">`ssystem node hardware unified-connect show`</block>
  <block id="58b0fc39873b9fe983d6b57e06585d6f" category="cell">是 V 系列系统或具有 FlexArray 虚拟化软件并连接到存储阵列</block>
  <block id="5344ecb990fb0b0e60a7b979eeca26cd" category="cell">`ucadmin show`</block>
  <block id="c5c0e497c3f1186f3d1cfecfc658c546" category="paragraph">系统将显示有关系统上所有 FC 和融合网络适配器的信息。</block>
  <block id="ede48791c6a4d48413c294cc39314600" category="list-text">将 node4 上的 FC 设置与先前从 node1 中捕获的设置进行比较。</block>
  <block id="bf5ce713a37cfb1c7cddb2ef1662c419" category="paragraph">根据需要修改 node4 上的 FC 端口：</block>
  <block id="2c28eea077fe0201e484901f94587d87" category="list-text">要对目标端口进行编程：</block>
  <block id="0782d8d4c61a7cd89e1abafbe5ea5255" category="paragraph">`ucadmin modify -m fc -t target &lt;adapter&gt;`</block>
  <block id="c5fb075990e07d49af83b424fc450275" category="list-text">要对启动程序端口进行编程：</block>
  <block id="713274c6cee4384b9c2c819d3adb4dd8" category="paragraph">`ucadmin modify -m fc -t initiator &lt;adapter&gt;`</block>
  <block id="2b82f33f2fca28990565d495f9d55cd3" category="paragraph">` -t` 是 FC4 类型： target 或 initiator 。</block>
  <block id="b32a6dfe19242cc4ae1651a9716c3d86" category="cell">根据需要修改 node4 上的 FC 端口： `ucadmin modify -m fc -t initiator -f &lt;adapter_port_name&gt;` ` -t` 是 FC4 类型，目标或启动程序。* 注 * ：必须将 FC 端口编程为启动程序。</block>
  <block id="97c16f2bd68041ac79ef06049407d0c7" category="list-text">退出维护模式：</block>
  <block id="cfd64d6f476de1f0b6218d6edce64ba3" category="list-text">从 LOADER 提示符启动系统：</block>
  <block id="6fbd819a7ffcfac7237456907e32238d" category="list-text">输入命令后，请等待，直到系统停留在启动环境提示符处。</block>
  <block id="4e0dd5a6524aabaa8ad8173947fbf52a" category="list-text">从维护模式的启动菜单中选择选项 `5` 。</block>
  <block id="59df83a3d8dd25ad19619fe75cc32a49" category="list-text">【第 8 步】执行以下操作之一：</block>
  <block id="f57ce051c0dd7274751c09db8a0e40b1" category="list-text">跳过此部分并转到 <block ref="3a339ed5bdc85366b677c546716fabfa" category="inline-link-macro-rx"></block> 如果 node4 没有 UTA/UTA2 卡或 UTA/UTA2 板载端口。</block>
  <block id="403ef226990b83673617ca3be4865d06" category="list-text">转至 <block ref="5752cac0a470e06ffceef40fba1931c1" category="inline-xref-macro-rx"></block> 如果 node4 具有 UTA/UTA2 卡或 UTA/UTA2 板载端口。</block>
  <block id="be1e23bb281357a07ce5db58c0e3ed83" category="list-text">如果 node4 没有 UTA/UTA2 卡或 UTA/UTA2 板载端口，请跳过 _Check and configure UTA/UTA2 ports on node4_ 一节，返回 _Install and boot node4_ 一节，然后继续执行 <block ref="ec6d4cacddb01e88226b9b376590bcc5" category="inline-link-macro-rx"></block>。</block>
  <block id="69e973a9aba58ba3c0012cb107497fbd" category="paragraph">如果 node4 具有板载 UTA/UTA2 端口或 UTA/UTA2 卡，则必须检查这些端口的配置并进行配置，具体取决于您希望如何使用升级后的系统。</block>
  <block id="cb462dbb35ebe0e4c6fef592bf7fd143" category="paragraph">您必须为 UTA/UTA2 端口配备正确的 SFP+ 模块。</block>
  <block id="c0caef2dbd4158cab9473c4f3805c920" category="paragraph">UTA/UTA2 端口可以配置为原生 FC 模式或 UTA/UTA2 模式。FC 模式支持 FC 启动程序和 FC 目标； UTA/UTA2 模式允许并发 NIC 和 FCoE 流量共享相同的 10 GbE SFP+ 接口并支持 FC 目标。</block>
  <block id="d99657bf946aa6dc77b75f8f378cf072" category="admonition">NetApp 营销材料可能会使用术语 UTA2 来指代 CNA 适配器和端口。但是，命令行界面使用术语 CNA 。</block>
  <block id="8076deb73ec5b74885a5b14258d5df96" category="paragraph">UTA/UTA2 端口可能位于具有以下配置的适配器或控制器上：</block>
  <block id="da3b32a8a5f86ee9c63b2d0328f453e3" category="list-text">与控制器同时订购的 UTA/UTA2 卡会在发货前配置为具有您请求的个性化设置。</block>
  <block id="494d18d03e7c6fb4b46866273ca75c34" category="list-text">与控制器分开订购的 UTA/UTA2 卡附带了默认的 FC 目标特性。</block>
  <block id="9fca14a117603ee6762ebe968e8cedec" category="list-text">新控制器上的板载 UTA/UTA2 端口（发货前）已配置为具有您请求的个性化设置。</block>
  <block id="898667c4cb95b7e44aafe17e4edf0567" category="paragraph">但是，您应检查 node4 上的 UTA/UTA2 端口的配置，并根据需要进行更改。</block>
  <block id="504b32f9515b15fa8407335de4be00e7" category="admonition">* 注意 * ：如果您的系统具有存储磁盘，除非指示您进入维护模式，否则您可以在集群提示符处输入本节中的命令。如果您的 MetroCluster FC 系统， V 系列系统或安装了 FlexArray 虚拟化软件的系统连接到存储阵列，则必须处于维护模式才能配置 UTA/UTA2 端口。</block>
  <block id="5113998ac3c679e0d1220f045f54831f" category="list-text">在 node4 上使用以下命令之一检查端口的当前配置方式：</block>
  <block id="8eae44e92f7155cef20bea12cd5a16c8" category="cell">如果系统 ...</block>
  <block id="fd894a783c8c8400a3021bd2ad147cba" category="paragraph">系统将显示类似于以下示例的输出：</block>
  <block id="64da799aef6205bb6034c61f1f25c391" category="list-text">如果当前 SFP+ 模块与所需用途不匹配，请将其更换为正确的 SFP+ 模块。</block>
  <block id="d72066c585919f0b5faa9807de695bf8" category="paragraph">请联系您的 NetApp 代表以获取正确的 SFP+ 模块。</block>
  <block id="89d66b059cd78c250aa205de02793541" category="list-text">检查 `ucadmin show` 命令的输出，并确定 UTA/UTA2 端口是否具有所需的个性化设置。</block>
  <block id="d4a3eb778a9003e6551eb488099a389d" category="cell">如果 CNA 端口 ...</block>
  <block id="2a6b2595426d2565bc2823be04753585" category="cell">没有所需的个性化设置</block>
  <block id="0011237e8dc98411a0794ba6dddb9989" category="inline-xref">第 5 步</block>
  <block id="feb4c7d35f5c6972a78c24ac4caebf00" category="cell">转至 <block ref="7ffb05d2232c9c60f695127651bcf871" category="inline-xref-macro-rx"></block>。</block>
  <block id="3fa4c0ba2b210d02bdf49ea3e2812989" category="cell">拥有所需的个性化特性</block>
  <block id="c0f1d3db2a584ee59498c0abaa47adf7" category="inline-xref">第 13 步</block>
  <block id="a06e3550b827dbbc3fa903ada41f165b" category="cell">跳过步骤 5 到步骤 12 ，然后转到 <block ref="8c1d75fc2023dc4e109b4251bd0229b1" category="inline-xref-macro-rx"></block>。</block>
  <block id="1228ef3c4a262a3a23b05009801f9d74" category="list-text">【 auto_check_4_step5]] 执行以下操作之一：</block>
  <block id="bb8715eb9d3c8fc0a643a55fc3e9ed29" category="cell">如果要配置</block>
  <block id="c4c1b40245719a0e56eb453401560e8e" category="cell">UTA/UTA2 卡上的端口</block>
  <block id="805e47ec7b4ef2165b02c8ff12688343" category="inline-xref">第 7 步</block>
  <block id="5ab10acc3f713db2883e41aeefc0a947" category="cell">转至 <block ref="8fa9bd2d3aca152bc08859144a7af8fa" category="inline-xref-macro-rx"></block></block>
  <block id="a7f2071dd0b7eee34d97c156132a3210" category="cell">板载 UTA/UTA2 端口</block>
  <block id="d60d761a93da31e724112577c571c923" category="inline-xref">第 8 步</block>
  <block id="5014f056b226c4802b8e30f5800a2ea3" category="cell">跳过第 7 步，转到 <block ref="3d86a68aa8fb2ef1661a4814f02f3b64" category="inline-xref-macro-rx"></block>。</block>
  <block id="ef0770e5329716a78bdc700afc4541c1" category="list-text">如果适配器处于启动程序模式，并且 UTA/UTA2 端口处于联机状态，请使 UTA/UTA2 端口脱机：</block>
  <block id="b3c0d59f1fa098e490810b0e947e6307" category="paragraph">`storage disable adapter &lt;adapter_name&gt;`</block>
  <block id="fff4e24de6543fad49dbe48a7b01e1d1" category="paragraph">目标模式下的适配器会在维护模式下自动脱机。</block>
  <block id="d8f98bdc807ae3903ae80ea0b78fbd6e" category="list-text">【 auto_check_4_step7]] 如果当前配置与所需用途不匹配，请根据需要更改配置：</block>
  <block id="749cabc3295eb5c2617db20882147797" category="paragraph">`ucadmin modify -m fc|cna -t initiators|target &lt;adapter_name&gt;`</block>
  <block id="d014763bc3b52aee3850e01f8065200f" category="list-text">` -m` 是特性模式 FC 或 10 GbE UTA 。</block>
  <block id="2e23b3b6b4b04a1d678f35eda127d4d6" category="list-text">` -t` 是 FC4 类型， `target` 或 `initiator` 。</block>
  <block id="3f0869d2c33ab7caf7185458236590fe" category="admonition">您必须对磁带驱动器， FlexArray 虚拟化系统和 MetroCluster 配置使用 FC 启动程序。您必须对 SAN 客户端使用 FC 目标。</block>
  <block id="7e0be6e2a6d4c241d66e582ce0ecbcea" category="list-text">【 auto_check_4_step8]] 使用以下命令并检查其输出，以验证设置：</block>
  <block id="fe040552b4fc83efe2ba593498969954" category="list-text">验证设置：</block>
  <block id="38827adabf48650b74e5fe794b8f2413" category="paragraph">以下示例中的输出显示， FC4 类型的适配器 "1b" 更改为 `initiator` ，适配器 "2a" 和 "2b" 的模式更改为 `CNA` ：</block>
  <block id="4cf4d3bfbda859f7fbe3247599afeba5" category="list-text">输入以下命令之一，使所有目标端口联机，每个端口输入一次：</block>
  <block id="efdbd48524f71c2dd98be1f586e183b7" category="cell">`network fcp adapter modify -node &lt;node_name&gt; -adapter &lt;adapter_name&gt; -state up`</block>
  <block id="4d6e26003e754a745cf62eed31431aad" category="cell">`FCP 配置 &lt;adapter_name&gt; up`</block>
  <block id="b50635aa317c4f94943cbad3bf2ffdf2" category="list-text">为端口布线。</block>
  <block id="8eeb6ccf00d6f27741c5b734b3130459" category="list-text">【第 12 步】执行以下操作之一：</block>
  <block id="803497e06fb63becf479290f3ae30e01" category="cell">转至 <block ref="3a339ed5bdc85366b677c546716fabfa" category="inline-link-macro-rx"></block>。</block>
  <block id="00538e299fb2786306fe6cdcd6e9fd03" category="cell">返回到 _Install and boot node4_ 部分，然后继续执行 <block ref="ec6d4cacddb01e88226b9b376590bcc5" category="inline-link-macro-rx"></block>。</block>
  <block id="4a137bad34f46785824a8100e1c6cba6" category="list-text">【 auto_check_4_step13]] 退出维护模式：</block>
  <block id="479951d6e509fddf053f700071fd43a4" category="list-text">【第 14 步】启动节点进入启动菜单：</block>
  <block id="204783b1ca658239a7b205df8e2d83dd" category="paragraph">`boot_ontap 菜单`</block>
  <block id="d27b8c8cfb6e88cecd06bd564e90cd36" category="paragraph">如果要升级到 A800 ，请转至 <block ref="1917bbf2d6d289423b4a495f5ba4fcca" category="inline-xref-macro-rx"></block></block>
  <block id="cd642c3a70cf520cbc7cc74da7b6cf70" category="list-text">在 node4 上，转到启动菜单并使用 22/7 并选择隐藏选项 `boot_after_controller_replacement` 。在提示符处，输入 node2 以将 node2 的磁盘重新分配给 node4 ，如以下示例所示。</block>
  <block id="f91809c39c7c5ad59f2475c5ee644448" category="admonition">在上述控制台输出示例中，如果系统使用高级磁盘分区（ ADP ）磁盘， ONTAP 将提示您输入配对节点名称。</block>
  <block id="9c709df0d0930ada3ab147bf9abe8f06" category="inline-xref">第 17 步</block>
  <block id="5dbdf6da1c2d885026bcf4a6be74a4b0" category="list-text">如果系统进入重新启动循环并显示消息 `no disks found` ，则表示系统已将 FC 或 UTA/UTA2 端口重置回目标模式，因此无法看到任何磁盘。要解决此问题，请继续 <block ref="d55e3a0f9758a99c055e4411cec66cde" category="inline-xref-macro-rx"></block> to <block ref="1abe7aef97cf6f4670adea7171f10403" category="inline-xref-macro-rx"></block> 或者转到第节 <block ref="3a339ed5bdc85366b677c546716fabfa" category="inline-link-macro-rx"></block>。</block>
  <block id="00454a3a0a181cf262da410213cfcb17" category="list-text">在自动启动期间按 `Ctrl-C` 在 `LOADER&gt;` 提示符处停止节点。</block>
  <block id="8923acb8081affcd156ba6d58720db9b" category="list-text">在 LOADER 提示符处，进入维护模式：</block>
  <block id="24655647ccabfd614d439a15f52407aa" category="paragraph">`boot_ontap maint`</block>
  <block id="82b61383829ad9f7c791ca9adcbe4b1f" category="list-text">在维护模式下，显示先前设置的所有启动程序端口，这些端口现在处于目标模式：</block>
  <block id="0237455b5c9b0d306e2c96ee6c599c24" category="paragraph">将端口改回启动程序模式：</block>
  <block id="cf3e9bc0a901473a585931eab06fd36e" category="paragraph">`ucadmin modify -m fc -t initiator -f &lt; 适配器名称 &gt;`</block>
  <block id="7dca1ec13f028b73f4170b0124cf9d45" category="list-text">验证端口是否已更改为启动程序模式：</block>
  <block id="a04a9fc20b8a671e539314c55bde8973" category="list-text">在 LOADER 提示符处启动：</block>
  <block id="bf1d9c5801bc3674bc765551ff2f2964" category="paragraph">`boot_ontap`</block>
  <block id="eedc84ab2e1ed2d5f77ae259bcc2e53d" category="paragraph">现在，在启动时，节点可以检测到先前分配给它的所有磁盘，并可按预期启动。</block>
  <block id="a615e77be7318a1511c3e98bbe302ca7" category="list-text">【自动检查 _4_step23]] 如果要从具有外部磁盘的系统升级到支持内部和外部磁盘的系统（例如， AFF A800 系统），请将 node2 聚合设置为根聚合，以确保 node4 从 node2 的根聚合启动。要设置根聚合，请转到启动菜单并选择选项 `5` 以进入维护模式。</block>
  <block id="60429a189ace5d1ba3d34868ab11d685" category="admonition">* 您必须按所示的确切顺序执行以下子步骤；否则可能发生原因会导致中断甚至数据丢失。 *</block>
  <block id="534c28a3529827f81e0580e98c2c91b5" category="paragraph">以下操作步骤会将 node4 设置为从 node2 的根聚合启动：</block>
  <block id="c9029dad52ad7bd50890b949161a37e6" category="list-text">进入维护模式。</block>
  <block id="a1dd60e47fece6bf56643327d78025eb" category="list-text">检查 node2 聚合的 RAID ，丛和校验和信息：</block>
  <block id="d54681223c9aa263c12e4a2a2a99ab44" category="paragraph">`aggr status -r`</block>
  <block id="cf43f30b70f96333f3d873e68b6170ad" category="list-text">检查 node2 聚合的状态：</block>
  <block id="39cff9999d84ec4289e4ab2ff2e81c67" category="paragraph">`聚合状态`</block>
  <block id="4c7213f8f3213d4809b8212b52bfc23a" category="list-text">如有必要，将 node2 聚合置于联机状态：</block>
  <block id="b64fc01bc73df9f024483d0ebe029c8f" category="paragraph">`aggr_online root_aggr_from_&lt;node2&gt;`</block>
  <block id="40418d7b25faced12b99f33b2265e3b3" category="list-text">阻止 node4 从其原始根聚合启动：</block>
  <block id="99748e6869c558cd84e1f7cd78209e7e" category="paragraph">`aggr offline &lt;root_aggr_on_node4&gt;`</block>
  <block id="2f71ad2b913b1589756e19c235187106" category="list-text">将 node2 根聚合设置为 node4 的新根聚合：</block>
  <block id="fb7c6c0ffab0377659471575f7daad3e" category="paragraph">`aggr options aggr_from_&lt;node2&gt;root`</block>
  <block id="cb891bf7e336200833c9e240c76a0cc6" category="list-text">验证 node4 的根聚合是否脱机，从 node2 接管的磁盘的根聚合是否联机并设置为 root ：</block>
  <block id="6bab8b4510fec23b1120be927a0bfea7" category="admonition">如果不执行上一个子步骤，发生原因 node4 可能会从内部根聚合启动，或者它可能会发生原因系统以假定存在新的集群配置或提示您确定一个集群配置。</block>
  <block id="c06377da744f281f74d745bd6cf53c71" category="paragraph">下面显示了命令输出的示例：</block>
  <block id="a7dd277c916b5584ac7bfa0e2a0e1091" category="summary">如果使用 NetApp 卷加密（ NVE ）对要升级的系统上的卷进行加密。</block>
  <block id="7ce57c4ce051863fc414ccd402a178f5" category="doc">还原 node3 上的 key-manager 配置</block>
  <block id="510e98cf2edb71945018bbd3f1de261d" category="paragraph">如果使用 NetApp 卷加密（ NVE ）对要升级的系统上的卷进行加密，则加密配置必须与新节点同步。从 node2 到 node3 的 node1 聚合的 ARL 完成后，加密卷将脱机。</block>
  <block id="594ac9e04c14065852f0e508c7b91ccb" category="paragraph">执行以下步骤，将加密配置同步到新节点：</block>
  <block id="b58a207eb69ca3cec4fba13daf9dd85a" category="list-text">在集群提示符处使用以下命令同步 OKM 的加密配置：</block>
  <block id="0a83ed732b07426c840d56d0ee6e648b" category="paragraph">`sSecurity key-manager 板载同步`</block>
  <block id="9fe909e2cd822e396eda1b615c821ed1" category="list-text">输入 OKM 的集群范围密码短语。</block>
  <block id="8bd97ccee6af0cbb00432913fef95f69" category="summary">升级节点对。</block>
  <block id="15577d2c813239ab53fdc6f35d8a1dc5" category="doc">升级节点对</block>
  <block id="5634325c9c7a1ed8bb239cc0f0ecea96" category="paragraph">要升级节点对，您需要准备原始节点，然后对原始节点和新节点执行一系列步骤。然后，您可以停用原始节点。</block>
  <block id="a1bf01274d938e19b1e43eb57fc3c557" category="summary">您应验证 MetroCluster 配置的切换，修复和切回操作。</block>
  <block id="9759ad3dfabdb9631ec5fba47d71c313" category="doc">验证切换，修复和切回</block>
  <block id="c9c93a19732545b8a8812f3665050df3" category="summary">升级后，您必须立即配置存储加密。</block>
  <block id="26678fb639f40f31f518f926dd61b9ab" category="doc">获取用于存储加密的外部密钥管理服务器的 IP 地址</block>
  <block id="7acef9ce6b481d82dc187cf0cd0ba769" category="paragraph">升级后，您必须立即配置存储加密并建立集群范围的身份验证密钥，以替换先前的节点级别身份验证密钥。</block>
  <block id="bc528557a58db2778646f31143323c9a" category="list-text">安装与密钥管理服务器通信所需的客户端和服务器安全套接字层（ SSL ）证书：</block>
  <block id="6b3a21077187795e57ca156a1f7425b1" category="paragraph">`s安全证书安装`</block>
  <block id="cbb3eece6687c0e5f34c4dd9eec3d644" category="list-text">在每个节点上使用以下命令，在所有节点上配置存储加密：</block>
  <block id="36b59c92319c91ef4b062f7a5735609c" category="paragraph">`s安全密钥管理器设置`</block>
  <block id="c3da263b79224793b774d0b2cb2d9fe1" category="list-text">添加每个密钥管理服务器的 IP 地址：</block>
  <block id="4ddacc4fe876ce1520a863683e858a54" category="paragraph">`s安全密钥管理器 add`</block>
  <block id="126ba987a97e09c07ace066db3597dbe" category="list-text">验证是否已在集群中的所有节点上配置相同的密钥管理服务器并使其可用：</block>
  <block id="a57b36ea9f75076c6744f1f269e29bd8" category="paragraph">`security key-manager show -status`</block>
  <block id="463cf5d698fac90be015c82e1bfb13fd" category="list-text">创建新的集群范围身份验证密钥：</block>
  <block id="16ad807911a8c9b345c579c4bcb340cb" category="paragraph">`s安全密钥管理器 create-key`</block>
  <block id="cf838fadddca3730f4efc72c1c3c093c" category="list-text">记下新的身份验证密钥 ID 。</block>
  <block id="470fc1401dbcb8983abb71c0870d4258" category="list-text">使用新的身份验证密钥重新设置所有自加密驱动器的密钥：</block>
  <block id="6228599495561d44995cb3ef3f353e9b" category="paragraph">`storage encryption disk modify -disk * -data-key-id &lt;authentication_key_id&gt;`</block>
  <block id="d3632885c406f1fdf833bfa7e1f0af27" category="section-title">使用 KMIP 服务器管理身份验证</block>
  <block id="eef7c3c189b38852fa6fd7ff22f1836c" category="paragraph">对于 ONTAP 9.8 或更高版本，您可以使用密钥管理互操作性协议（ KMIP ）服务器管理身份验证密钥。</block>
  <block id="761ac244160bc99600210b11c30dc464" category="list-text">添加新控制器：</block>
  <block id="0d51f1cd2b3f0ee725fef68026226c50" category="paragraph">`security key-manager setup -node &lt;new_controller_name&gt;`</block>
  <block id="5b84aee6aa26cfb08d3ab766a49e026d" category="list-text">添加密钥管理器：</block>
  <block id="d972edad5fb5c103c1c6f1ac23a3cdf1" category="paragraph">`security key-manager -add &lt;key_management_server_ip_address&gt;`</block>
  <block id="321aa19fc0cdb52498a74f6673729f5e" category="list-text">验证密钥管理服务器是否已配置且可供集群中的所有节点使用：</block>
  <block id="a1b7f6ea0d485d5a6890d4047d37884c" category="list-text">将所有链接的密钥管理服务器中的身份验证密钥还原到新节点：</block>
  <block id="441e1cbf2c222517b5366ca827ed309d" category="paragraph">`security key-manager restore -node &lt;new_controller_name&gt;`</block>
  <block id="a4ad027ddee7647712bbf971c8d839c4" category="list-text">使用新的身份验证密钥重新设置所有自加密磁盘的密钥：</block>
  <block id="bf0679d0cb7aea4f9f1e7253a96643cf" category="paragraph">`storage encryption disk modify -disk * （ -data-key-id nonMSID AK ）`</block>
  <block id="42cbbc611cf1111ca13ce179f80d2257" category="list-text">如果使用联邦信息处理标准（ FIPS ），请使用新的身份验证密钥重新设置所有自加密磁盘的密钥：</block>
  <block id="5beb4b8523f6870e231ec55cdf442a39" category="paragraph">`storage encryption disk* modify -disk * "-fips-key-id nonMSID AK]`</block>
  <block id="666d41f92db6a2191af16e999d035f4f" category="section-title">使用板载密钥管理器管理存储加密</block>
  <block id="54279af53279de10320508d0526f332e" category="paragraph">您可以使用 OKM 管理加密密钥。如果您计划使用 OKM ，则必须在开始升级之前记录密码短语和备份材料。</block>
  <block id="259c8a53b900b4102babb5d05e113f67" category="list-text">将密码短语保存到安全位置。</block>
  <block id="19077cc2690337623f542cbef7fae627" category="list-text">创建备份以进行恢复。运行以下命令并保存输出：</block>
  <block id="d1599347e2c1e8206cd8017da7de3ee0" category="paragraph">`key-manager 板载 show-backup`</block>
  <block id="bad82f8550ff52390ef854218320ca8e" category="list-text">验证目标集群上的 SnapMirror 关系状态：</block>
  <block id="5bab70a374b8d81dfb1cf1f910800c2a" category="paragraph">`snapmirror show`</block>
  <block id="4240e52a9ba444973cab2a23381467d2" category="paragraph">如果 SnapMirror 关系未处于 " 正在传输 " 状态，则中止将失败。</block>
  <block id="39ab24c8bbd04eb5a8927ffbecfe915d" category="list-text">暂停集群之间的所有关系：</block>
  <block id="969f0a2571a7738a949482044a778723" category="summary">如果任何聚合无法重新定位或被否决，您必须手动重新定位这些聚合。</block>
  <block id="97075c537f59de355c8d44c57697ef74" category="doc">重新定位失败或被否决的聚合</block>
  <block id="1a246f70242ad6a20257f6b2816e32b7" category="paragraph">如果任何聚合无法重新定位或被否决，您必须手动重新定位聚合，或者在必要时覆盖否决或目标检查。</block>
  <block id="d5b52813fd23e774f0e560e7d8ecc452" category="paragraph">由于此错误，重新定位操作将暂停。</block>
  <block id="b10c9e2a07f0bd22d85f72c5fb19d122" category="list-text">检查事件管理系统（ EMS ）日志以确定聚合无法重新定位或被否决的原因。</block>
  <block id="f5bf9910c32ce3468dc3a0f80ee2e47a" category="list-text">重新定位任何出现故障或被否决的聚合：</block>
  <block id="f31ceb40ff7b8a0764fb7750bb94fd7b" category="paragraph">`storage aggregate relocation start -node &lt;node1&gt; -destination &lt;node2&gt; aggregate-list &lt;aggr_name&gt; -no-controller-upgrade true`</block>
  <block id="4f6da995dc4a823a0d6529c9d724b695" category="list-text">出现提示时，输入 `y` 。</block>
  <block id="d5f8db2e1eae8ada3af51a497dead90d" category="list-text">您可以使用以下方法之一强制重新定位：</block>
  <block id="054b4f3ea543c990f6b125f41af6ebf7" category="cell">选项</block>
  <block id="bca8a20f71b5dee00fa30d0570b83068" category="cell">覆盖否决检查</block>
  <block id="63e95f3a5b822c0e1e5f710174695047" category="cell">使用以下命令： `storage aggregate relocation start -node node1 -destination node2 -aggregate-list &lt;aggr_list&gt; -no-controller-upgrade true -override-vetoes true`</block>
  <block id="1b27217f602bc4090b93bc2c72ec2c38" category="cell">覆盖目标检查</block>
  <block id="2b0aaee5d2bb595c0dd13e304bb34c55" category="cell">使用以下命令： `storage aggregate relocation start -node node1 -destination node2 -aggregate-list &lt;aggr_list&gt; -no-controller-upgrade true -override-vetoes true -override-destination-checks true`</block>
  <block id="3656662210f47dcbe034b998e90c0643" category="summary">了解是否可以使用 ARL 升级一对运行 ONTAP 9.8 的控制器。</block>
  <block id="da289ccf0fe9b7b8a0a8c3f55c76c877" category="doc">使用 ARL 升级控制器的准则</block>
  <block id="1b41541e73f4542502d0cb8be4fcb926" category="paragraph">要了解是否可以使用 ARL 升级一对运行 ONTAP 9.8 或更高版本的控制器，取决于原始控制器和替代控制器的平台和配置。</block>
  <block id="da9431cc35c8bdde2930587bdcf661c2" category="section-title">支持 ARL 升级</block>
  <block id="bd405ef9149168a4cb18dfb9e68d4d1e" category="paragraph">在使用适用于 ONTAP 9.8 或更高版本的 ARL 操作步骤升级一对节点时，您必须验证是否可以对原始控制器和替代控制器执行 ARL 。</block>
  <block id="40f65e1794d8ec4dad51ff791dc15d0b" category="paragraph">您应检查所有已定义聚合的大小以及原始系统支持的磁盘数。然后，您必须将支持的聚合大小和磁盘数量与新系统支持的聚合大小和磁盘数量进行比较。请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到可 Hardware Universe 提供此信息的 _SIL_ 。新系统支持的聚合大小和磁盘数必须等于或大于原始系统支持的聚合大小和磁盘数。</block>
  <block id="9946e270e76872acf9a74362eac1a32a" category="paragraph">您应在集群混用规则中验证在更换原始控制器后，新节点是否可以成为现有节点集群的一部分。有关集群混合规则的详细信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _SIL_ Hardware Universe 。</block>
  <block id="5dab68a78b9466ced5074675f91c7438" category="paragraph">配置了 SnapLock 企业版和 SnapLock 合规性卷的系统支持使用 ARL 升级控制器。</block>
  <block id="cb0385d0286af5544c83edeb7702b741" category="section-title">双节点无交换机集群</block>
  <block id="69ceb2d36918ef5eab686101ab353f0d" category="paragraph">如果要升级双节点无交换机集群中的节点，则可以在执行升级时将这些节点保留在无交换机集群中。您无需将其转换为交换集群。</block>
  <block id="bea87fe3e38e1c2fba92c7b4ca690a9d" category="section-title">ARL 不支持升级</block>
  <block id="d061d57f2d82b85a7aa74e13aaec4c96" category="paragraph">您不能执行以下升级：</block>
  <block id="70a3b031f6a4e388e4285d647440ec82" category="list-text">更换不支持与原始控制器相连的磁盘架的控制器</block>
  <block id="23498de552873202eefb3139773f663c" category="paragraph">请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _disk_ Hardware Universe 以获取磁盘支持信息。</block>
  <block id="d5457a285ea7fce244bde8387644b062" category="list-text">具有内部驱动器的入门级控制器，例如： FAS 2500 。</block>
  <block id="231cf4c70d866b616c21baddaeed0696" category="section-title">故障排除</block>
  <block id="d60c463bb4096f3ed4bd1618626dfe10" category="inline-link-macro">故障排除</block>
  <block id="bc11cb73d84dd1ca35d5b999ca9afb54" category="paragraph">如果在升级控制器时出现任何问题，请参见 <block ref="5b03d19ea0e9e656b77e7538c0164f96" category="inline-link-macro-rx"></block> 部分，请参见操作步骤末尾的详细信息和可能的解决方案。</block>
  <block id="aaa66a015fd5899ae88e1fe7fce7257c" category="paragraph">如果您未找到与遇到的问题相关的解决方案，则应联系技术支持。</block>
  <block id="d5dcbeb79cc6a2aa334dc821840400c2" category="summary">在升级期间，聚合重新定位（ ARL ）可能会在不同点失败。</block>
  <block id="b02aac451baf6d7b36d981f898537961" category="doc">聚合重新定位失败</block>
  <block id="bdbf296139657929f989f110dccebbd3" category="section-title">检查聚合重新定位失败</block>
  <block id="12f0aff6b7931a4b46dc6629c132816a" category="paragraph">在操作步骤期间， ARL 可能会在第 2 阶段，第 3 阶段或第 5 阶段失败。</block>
  <block id="a5c607fe9749b0c2b2f2e3b910604ce4" category="list-text">输入以下命令并检查输出：</block>
  <block id="535fb4b2db5d261fd8e82fde21d267f2" category="paragraph">`s存储聚合重新定位显示`</block>
  <block id="e0fafb56752a62a2c5a8a941a4fa2864" category="paragraph">`storage aggregate relocation show` 命令可显示哪些聚合已成功重新定位，哪些聚合未成功重新定位以及故障原因。</block>
  <block id="85dae5feb66033271bbd3fea4eca5f7e" category="list-text">检查控制台是否存在任何 EMS 消息。</block>
  <block id="fe96c3f5ae23f058575d629b1b1befa1" category="list-text">根据 `storage aggregate relocation show` 命令的输出以及 EMS 消息的输出，采取适当的更正操作。</block>
  <block id="b3663b253690ee49735db122d80571d6" category="list-text">使用 `storage aggregate relocation start` 命令的 `override-vetoes` 选项或 `override-destination-checks` 选项强制重新定位聚合。</block>
  <block id="4a2f4a10945c2742a986196d1a41e0c8" category="paragraph">有关 `storage aggregate relocation start` ， `override-vetoes` 和 `override-destination-checks` 选项的详细信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _Microsoft ONTAP 9.8 命令：手册页参考 _ 。</block>
  <block id="64f7904c016a035f1928a2cbeea82ab1" category="section-title">升级完成后， node1 上的聚合属于 node4</block>
  <block id="2e352bfe9deb78b924bf0f5e67164c3c" category="paragraph">升级操作步骤结束时， node3 应为聚合的新主节点，而这些聚合最初将 node1 作为主节点。您可以在升级后重新定位它们。</block>
  <block id="5d59517a984e405c3da4037ff1d7d898" category="paragraph">在以下情况下，聚合可能无法正确重新定位，将 node1 作为其主节点，而不是 node3 ：</block>
  <block id="0aedbbe9928008ef20e9f0f31cd1ec93" category="list-text">在第 3 阶段，聚合从 node2 重新定位到 node3 。要重新定位的某些聚合的主节点为 node1 。例如，此类聚合可以称为 aggr_node_1 。如果 aggr_node_1 的重新定位在第 3 阶段失败，并且无法强制重新定位，则聚合将留在 node2 上。</block>
  <block id="94db9769a66bbb4255b02f44f30a1506" category="list-text">在第 4 阶段之后，将 node2 替换为 node4 。更换 node2 后， aggr_node_1 将联机，并将 node4 作为其主节点，而不是 node3 。</block>
  <block id="ba508067c72d91e8f63afe491acaa462" category="paragraph">启用存储故障转移后，您可以通过完成以下步骤在第 6 阶段后修复不正确的所有权问题：</block>
  <block id="c76bc65b459278a8c28b143bd2794d8c" category="list-text">输入以下命令以获取聚合列表：</block>
  <block id="482c91d6a5bf35c82ea857455c024d88" category="paragraph">`storage aggregate show -nodes &lt;node4&gt;-is-home true`</block>
  <block id="d088dd9060f2818253fb3709d9939a18" category="paragraph">要确定未正确重新定位的聚合，请参阅在一节中获取的主所有者为 node1 的聚合列表 <block ref="cd8ad1809865824065fe011b80800cd6" category="inline-link-macro-rx"></block> 并将其与上述命令的输出进行比较。</block>
  <block id="a3249f2582556adc14fc6268c4136b8c" category="list-text">将步骤 1 的输出与您在一节中为 node1 捕获的输出进行比较 <block ref="cd8ad1809865824065fe011b80800cd6" category="inline-link-macro-rx"></block> 并记下未正确重新定位的所有聚合。</block>
  <block id="6351a4102dcb6a482f6002fe35685d71" category="list-text">【 auto_aggr_relocate_fail_Step3]] 重新定位节点 4 上遗留的聚合：</block>
  <block id="d104a5e5375beeea24cb6ac3c7c3d89f" category="paragraph">`storage aggregate relocation start -node &lt;node4&gt;-aggr &lt;aggr_node_1&gt; -destination &lt;node3&gt;`</block>
  <block id="19289925f6f4d12d2796b14d773968dd" category="paragraph">在此重新定位期间，请勿使用 ` -nt-controller-upgrade` 参数。</block>
  <block id="0bc9088bdd248bcc7cf35ab01ea701a4" category="list-text">验证 node3 现在是否为聚合的主所有者：</block>
  <block id="efe0e1623e3de58285e110eadbfa034a" category="paragraph">`storage aggregate show -aggregate &lt;aggr1 ， aggr2 ， aggr3...&gt; -fields home-name`</block>
  <block id="3b6b92b0cbab52f7f27f444cda7f83aa" category="paragraph">` &lt;aggr1 ， aggr2 ， aggr3...&gt;` 是将 node1 作为原始主所有者的聚合列表。</block>
  <block id="2d5ce426423eeeead4f35769cd8b1b27" category="inline-xref">第 3 步</block>
  <block id="65f247827acd19f6f7debcc6880344b0" category="paragraph">如果聚合的主所有者不是 node3 ，则可以在中使用相同的重新定位命令将其重新定位到 node3 <block ref="b826fa5e08f60e3e6100c14200617b18" category="inline-xref-macro-rx"></block>。</block>
  <block id="5889ed673e50bf5bb2f31df8c0d66478" category="summary">开始升级 Fabric MetroCluster 配置之前。</block>
  <block id="e7323a54c9f53a295a2c4d707c7b3fce" category="doc">验证 MetroCluster 配置的运行状况。</block>
  <block id="57b41b4e6b26c5d81b64f649f73c20f8" category="paragraph">在开始对光纤 MetroCluster 配置进行升级之前，您必须检查 MetroCluster 配置的运行状况以验证是否正常运行。</block>
  <block id="ce1ec3b6f165be8cdde0654c531487e5" category="list-text">验证 MetroCluster 组件是否运行正常：</block>
  <block id="b39709ac0ef947bdc090084f89c2ad94" category="paragraph">`MetroCluster check run`</block>
  <block id="f005234d35c44406394bfc86ede22866" category="paragraph">此操作将在后台运行。</block>
  <block id="8600ca2371816e2374e80e982b51e056" category="list-text">在 `MetroCluster check run` 操作完成后，查看结果：</block>
  <block id="e3ccf677e56366a417a172944cdd9599" category="paragraph">MetroCluster check show`</block>
  <block id="070a4bbedae89743ad2f6646a3f23205" category="paragraph">大约五分钟后，将显示以下结果：</block>
  <block id="1a9778326fd00d0e011a777089b2bc6a" category="list-text">检查正在运行的 MetroCluster 检查操作的状态：</block>
  <block id="fbd55aa6c7d3ee9ec90836dfa01b62d2" category="paragraph">MetroCluster 操作历史记录显示 -job-id 38`</block>
  <block id="74553544aa9c0c94d16a5a5ed85d6720" category="list-text">验证是否没有运行状况警报：</block>
  <block id="838f9a3aa0c54c620c1dab5cccc98ca5" category="paragraph">`s系统运行状况警报显示`</block>
  <block id="b180c3a6690338cc8cfaeb6b4c37008c" category="summary">您必须在机架中安装 node3 ，将 node1 的连接传输到 node3 ，启动 node3 并安装 ONTAP 。</block>
  <block id="5ff20c188ceb23808ed9b47d8e5637ff" category="doc">安装并启动 node3</block>
  <block id="80f347da1888e440d3f1755d2e9ca001" category="paragraph">您必须在机架中安装 node3 ，将 node1 的连接传输到 node3 ，启动 node3 并安装 ONTAP 。然后，您必须重新分配 node1 的任何备用磁盘，属于根卷的任何磁盘以及此过程先前未重新定位到 node2 的任何非根聚合，如本节所述。</block>
  <block id="cabcb5ad3a57db50c098cbabe3b6d8c5" category="paragraph">重新定位操作在此阶段开始时暂停。此过程大部分是自动化的；操作将暂停，以便您可以检查其状态。您必须手动恢复此操作。此外，您还必须验证 SAN LIF 是否已成功移至 node3 。</block>
  <block id="31ccaad020ad8995655b8785712ac7b9" category="paragraph">如果 node3 与 node1 上安装的 ONTAP 9 版本不同，则需要对其进行网络启动。安装 node3 后，从 Web 服务器上存储的 ONTAP 9 映像启动它。然后，您可以按照中的说明将正确的文件下载到启动介质设备，以供后续系统启动 <block ref="4815c2d091d790c1d3bab94177b38eaf" category="inline-link-macro-rx"></block>。</block>
  <block id="2ad1e670b60bb257ae5313d5009813a5" category="inline-link-macro">在 node3 上配置 FC 端口</block>
  <block id="b6f436f6398306a921de09279a6a8256" category="inline-link-macro">检查并配置 node3 上的 UTA/UTA2 端口</block>
  <block id="9a1df33637b4fc5aa325b169d3a7aa84" category="list-text">如果要升级连接到存储阵列的 V 系列系统或安装了 FlexArray 虚拟化软件并连接到存储阵列的系统，则需要完成升级 <block ref="7c8db700ba9d62850f8b66020ea3d4b9" category="inline-xref-macro-rx"></block> 到 <block ref="d133a54ce8997c6b3c1ffdd4bfb32c84" category="inline-xref-macro-rx"></block>，然后退出本节并按照中的说明进行操作 <block ref="b8be2332e6727dc6b48478780a30df1b" category="inline-link-macro-rx"></block> 和 <block ref="e1881302722b07e924682c0aeef752a5" category="inline-link-macro-rx"></block> 根据需要输入相应部分，在维护模式下输入命令。然后，您必须返回到此部分并继续使用 <block ref="d602dbbaca50060142dad0af29921558" category="inline-xref-macro-rx"></block>。</block>
  <block id="80f025cc78499a80da49bd37c9bde220" category="list-text">如果要升级具有存储磁盘的系统，则需要完成整个部分，然后转到 <block ref="b8be2332e6727dc6b48478780a30df1b" category="inline-link-macro-rx"></block> 和 <block ref="e1881302722b07e924682c0aeef752a5" category="inline-link-macro-rx"></block> 部分，在集群提示符处输入命令。</block>
  <block id="56fd5e5051297f55fa1e22d93c8d71b8" category="list-text">【 auto_install3_step1]] 请确保为 node3 预留机架空间。</block>
  <block id="2c6541bc32b15b7aae8bab68f0ca5874" category="paragraph">如果 node1 和 node2 位于不同的机箱中，则可以将 node3 与 node1 放在同一机架位置。但是，如果 node1 与 node2 位于同一机箱中，则需要将 node3 置于其自身的机架空间中，最好靠近 node1 的位置。</block>
  <block id="b76de3994341c25067b438fe161926b7" category="list-text">【 auto_install3_step2]] 按照适用于您的节点型号的 _Installation and Setup Instructions_ 在机架中安装 node3 。</block>
  <block id="e642674ff2b68ba9c6309b786d87c4f9" category="admonition">如果要升级到两个节点位于同一机箱中的系统，请在机箱中安装 node4 以及 node3 。否则，在启动 node3 时，该节点的行为将如同处于双机箱配置中，而在启动 node4 时，节点之间的互连将不会启动。</block>
  <block id="c558275e7d3a61c5ffa4c89d17138a8e" category="list-text">【 auto_install3_step3]] 为节点 3 布线，将连接从节点 1 移动到节点 3 。</block>
  <block id="a237c9d74ab3870e45b318a1071c10f4" category="admonition">您可能不需要将互连卡或集群互连缆线连接从 node1 移至 node3 ，因为大多数平台型号都具有唯一的互连卡型号。对于 MetroCluster 配置，您需要将 FC-VI 缆线连接从 node1 移至 node3 。如果新主机没有 FC-VI 卡，则可能需要移动 FC-VI 卡。</block>
  <block id="a5492c1c64c93543c424918fe38a847e" category="list-text">【 auto_install3_step4]] 打开 node3 的电源，然后在控制台终端按 Ctrl-C 访问启动环境提示符，以中断启动过程。</block>
  <block id="db32660dfabf573a3553146b10c4b358" category="paragraph">如果要升级到两个节点位于同一机箱中的系统， node4 也会重新启动。但是，您可以忽略 node4 启动，直到稍后再启动。</block>
  <block id="93bd68c37b47b8665f3fe8bb9add087f" category="admonition">启动 node3 时，您可能会看到以下警告消息：</block>
  <block id="7882a4b556b6996eaf604413a9e602d9" category="inline-xref">第 4 步</block>
  <block id="b64113c5a70901151e544500a7cb6e41" category="list-text">如果您在中看到警告消息，则需要执行以下操作 <block ref="07e6330d4bc574888011bcb486743c88" category="inline-xref-macro-rx"></block>，执行以下操作：</block>
  <block id="c05c7a2303ef34ab95234ebadd79fc8f" category="cell">在启动环境提示符处使用以下命令自动配置连接： `ifconfig e0M -auto`</block>
  <block id="96e59e91cef900d59b3ce93f663391f3" category="cell">在启动环境提示符处使用以下命令手动配置连接： `ifconfig e0M -addr=&lt;filer_addr&gt; -mask=&lt;netmask&gt; -gw=&lt;gateway&gt; - dns=&lt;dns_addr&gt; domain=&lt;dns_domain&gt;` ` &lt;filer_addr&gt;` 是存储系统的 IP 地址。` &lt; 网络掩码 &gt;` 是存储系统的网络掩码。` &lt; 网关 &gt;` 是存储系统的网关。` &lt;dns_addr&gt;` 是网络上名称服务器的 IP 地址。此参数是可选的。` &lt;dns_domain&gt;` 是域名服务（ DNS ）域名。此参数是可选的。* 注 * ：接口可能需要其他参数。有关详细信息，请在固件提示符处输入 `help ifconfig` 。</block>
  <block id="48060f068bd1fae855e05859f04c5e3f" category="list-text">【第 7 步】对 node3 执行网络启动：</block>
  <block id="526c6586cac2a5ca719ec72a9f077f53" category="paragraph">` &lt;path_to_the_web-accessible_directory&gt;` 应指向您在部分中下载 ` &lt;ontap_version&gt;_image.tgz` 的位置 <block ref="4815c2d091d790c1d3bab94177b38eaf" category="inline-link-macro-rx"></block>。</block>
  <block id="00a7cfe4f4da76897b759c2fe0aa87e4" category="list-text">【第 8 步】从启动菜单中选择选项 ` （ 7 ）首先安装新软件` 。</block>
  <block id="734f579e8fa44e795a2d8f03940b3b8e" category="admonition">请忽略以下消息： `HA 对上的无中断升级不支持此操作步骤` 。注意适用场景可无中断升级 ONTAP ，而不是升级控制器。请始终使用 netboot 将新节点更新为所需映像。如果使用其他方法在新控制器上安装映像，则可能安装了错误的映像。此问题描述适用场景所有 ONTAP 版本。</block>
  <block id="f0546cfa67e11944c3c115c55c0d74c6" category="list-text">【第 9 步】如果系统提示您继续运行操作步骤，请输入 `y` ，当系统提示您输入软件包时，请输入 URL ：</block>
  <block id="b420e8eb0083114b740da33989940785" category="list-text">【第 10 步】完成以下子步骤以重新启动控制器模块：</block>
  <block id="dab98833427c3d8aa8eeb5d6db41328b" category="paragraph">`d要立即还原备份配置？｛ y|n ｝`</block>
  <block id="78531eca4abf30d4c07d610d913a17b4" category="list-text">出现以下提示时，输入 `y` 以重新启动：</block>
  <block id="3cab3f136b2c476f859a364c003079c3" category="paragraph">`要开始使用新安装的软件，必须重新启动节点。是否要立即重新启动？｛ y|n ｝`</block>
  <block id="665b6d787a8576ee10e9c9cee3583341" category="list-text">【第 11 步】从启动菜单中选择维护模式 `5` ，并在系统提示您继续启动时输入 `y` 。</block>
  <block id="d268c4054cbf23abb6afc6dec45039b4" category="list-text">【第 12 步】验证控制器和机箱是否配置为 ha ：</block>
  <block id="51c448ec2d072d0227e5d83964636a54" category="list-text">【第 13 步】如果控制器和机箱未配置为 ha ，请使用以下命令更正配置：</block>
  <block id="a73d1d9d7a9d36edb67531c5cdd004f4" category="list-text">【第 14 步】退出维护模式：</block>
  <block id="c3f299c216a4d01822966fa31545bf67" category="paragraph">在启动环境提示符处按 `Ctrl-C` 以中断自动启动。</block>
  <block id="46b4ada45ce5a9b580d12f2837589006" category="list-text">在 node2 上，检查系统日期，时间和时区：</block>
  <block id="f68146a357d007c5719e57f0df2f6cea" category="list-text">在 node3 上，在启动环境提示符处使用以下命令检查日期：</block>
  <block id="92b09953e03c695a41d0eca9cc7a70b3" category="list-text">【第 17 步】如有必要，请在 node3 上设置日期：</block>
  <block id="a35c7561d833fab42eb0820cd7256987" category="list-text">在 node3 上，在启动环境提示符处使用以下命令检查时间：</block>
  <block id="8fa05814ac535bc4cac5dc313de56abe" category="list-text">【第 19 步】如有必要，请在 node3 上设置时间：</block>
  <block id="671e8c839701c582dc6d924cc3f17c82" category="list-text">【第 20 步】如有必要，请在 node3 上设置配对系统 ID ：</block>
  <block id="9b0061842e9b4b978c7b1f439fbd5125" category="paragraph">`setenv partner-sysid &lt;node2_sysid&gt;`</block>
  <block id="adf02be63922314f36e41d4ce1193e79" category="list-text">在新节点的启动加载程序中，需要设置 `partner-sysid` 参数。对于 node3 ， `partner-sysid` 必须为 node2 。验证 node3 的 `partner-sysid` ：</block>
  <block id="b7b77c4a8d173f38e98b19b6fa156359" category="paragraph">`printenv partner-sysid`</block>
  <block id="1bf7d37df6710b2cae5f87ffc87ac7ca" category="cell">转至 <block ref="d602dbbaca50060142dad0af29921558" category="inline-xref-macro-rx"></block></block>
  <block id="74c497c4741babe01069b2689c6f6d96" category="inline-link-macro">在 node3 上设置 FC 或 UTA/UTA2 配置</block>
  <block id="2987901eef48d33908a5fe3bc58101db" category="list-text">转至第节 <block ref="9cb2fecd70723749806307bb1e7fc101" category="inline-link-macro-rx"></block> 并完成本节中的各小节。</block>
  <block id="824a922c708e37c4e38da69123f1f712" category="list-text">返回到此部分，完成从开始的其余步骤 <block ref="d602dbbaca50060142dad0af29921558" category="inline-xref-macro-rx"></block>。</block>
  <block id="d2382bf853b3c31a2584de4ebbcb20f5" category="list-text">【 auto_install3_step23]] 将新节点的 FC 启动程序端口添加到交换机分区。</block>
  <block id="72797da0a6dd02827100892ec56ff0f7" category="inline-link-macro">在节点 3 上配置 FC 端口</block>
  <block id="33b34c9b4b9fcbf19dc61172941a60f7" category="paragraph">如果您的系统具有磁带 SAN ，则需要对启动程序进行分区。如果需要，请参考将板载端口修改为启动程序 <block ref="587d3c60b98ebe686bf65e1387fc811f" category="inline-link-macro-rx"></block>。有关分区的详细说明，请参见存储阵列和分区文档。</block>
  <block id="c72fdddc98e37cd5e62f25b9974065fc" category="list-text">【第 24 步】将 FC 启动程序端口作为新主机添加到存储阵列，将阵列 LUN 映射到新主机。</block>
  <block id="3ba1b014c973048d41b40e37b1cfeb69" category="list-text">【第 25 步】修改与存储阵列上的阵列 LUN 关联的主机或卷组中的全球通用端口名称（ WWPN ）值。</block>
  <block id="be6df649a349785ed8ec2a552e7c8903" category="list-text">【第 26 步】如果您的配置使用基于交换机的分区，请调整分区以反映新的 WWPN 值。</block>
  <block id="76e2b1ef0b0a726203126fcf7ef71a45" category="list-text">`s步骤 27]] 如果在此配置上使用 NetApp 存储加密（ NSE ），则必须将` etenv bootarg.storageencryption.support `命令设置为` true `，并将 kmip.init.maxwait` `变量设置为` off ，以避免在加载 node1 配置后出现启动环路：</block>
  <block id="dc19b23ad13df9e69f052ca959f75ad8" category="list-text">【第 28 步】启动节点进入启动菜单：</block>
  <block id="d5a2736750f555e1b93002d11e192b77" category="inline-link-macro">检查并配置节点 3 上的 UTA/UTA2 端口，步骤 15</block>
  <block id="8105e4198590e4ba2b52ef420719d8f6" category="paragraph">如果您没有 FC 或 UTA/UTA2 配置，请执行 <block ref="197bcdf5306898ec17e6022b26568f43" category="inline-link-macro-rx"></block> 以便 node3 可以识别 node1 的磁盘。</block>
  <block id="bc26b5e5559721e19875fb91dce22cec" category="inline-link-macro">在 node3 上设置 FC 或 UTA/UTA2 配置</block>
  <block id="8ba547e72776f098f3b70a6614639f73" category="list-text">【第 29 步】对于 MetroCluster 配置， V 系列系统以及将 FlexArray 虚拟化软件连接到存储阵列的系统，您必须在 node3 上设置和配置 FC 或 UTA/UTA2 端口，以检测连接到节点的磁盘。要完成此任务，请转至第节 <block ref="c73225f56714e22dffa9ff7369895ce1" category="inline-link-macro-rx"></block>。</block>
  <block id="de73c7940eaf280bb4c1867652fc7e01" category="summary">要确保设置正确，必须启用 HA 对。</block>
  <block id="1a4d3feb333aa03c1008e54bae47d8e9" category="doc">确保新控制器设置正确</block>
  <block id="bf029ec4ec6e853d0d08bafbb1c50927" category="paragraph">要确保设置正确，必须启用 HA 对。此外，还必须验证 node3 和 node4 是否可以访问彼此的存储，并且它们都不拥有属于集群上其他节点的数据 LIF 。此外，您必须确保 node3 拥有 node1 的聚合， node4 拥有 node2 的聚合，并且两个节点的卷均联机。</block>
  <block id="ca710412a883d1570696f0510733c7a0" category="list-text">在对 node2 执行后检之后，将为 node2 集群启用存储故障转移和集群 HA 对。操作完成后，两个节点均显示为已完成，系统将执行一些清理操作。</block>
  <block id="9d070d121ee26abdb5d314d6fff4c15c" category="list-text">验证是否已启用存储故障转移：</block>
  <block id="751035e5db88d172e881299c202d9b13" category="paragraph">`s存储故障转移显示`</block>
  <block id="715940e961cf53af2ba53d695b5bdb37" category="paragraph">以下示例显示了启用存储故障转移时命令的输出：</block>
  <block id="9e6e3ee8077a0815c415187bf7e78b19" category="list-text">使用以下命令并检查输出，验证 node3 和 node4 是否属于同一集群：</block>
  <block id="494cb4f7976c64f111b74e9089d5bbd5" category="paragraph">`cluster show`</block>
  <block id="fd3a247231846521133c845ae4c424c0" category="list-text">使用以下命令并检查输出，验证 node3 和 node4 是否可以访问彼此的存储：</block>
  <block id="ca4a5bf327945cfdd4e55b64a87076b5" category="paragraph">`storage failover show -fields local-missing- disks ， partner-missing-disks`</block>
  <block id="ed63866964a059112ba504e1f09aa077" category="list-text">使用以下命令并检查输出，验证 node3 和 node4 均不拥有集群中其他节点拥有的主数据 LIF ：</block>
  <block id="6485b14c0e329aebda0c4dcd7d09dbd0" category="paragraph">`network interface show`</block>
  <block id="dc85e26538718b459bdf2a353367f497" category="paragraph">如果 node3 或 node4 都不拥有集群中其他节点拥有的主数据 LIF ，请将数据 LIF 还原到其主所有者：</block>
  <block id="98ab56275ed98fed50530abdb3a97ee7" category="paragraph">`网络接口还原`</block>
  <block id="f67d0a54b752ca4f669625b9f2eba648" category="list-text">确认 node3 拥有 node1 中的聚合，而 node4 拥有 node2 中的聚合：</block>
  <block id="570743d2305de7bd0a4e44c426b2db21" category="paragraph">`storage aggregate show -owner-name &lt;node3&gt;`</block>
  <block id="75cf0b763a8b4981f23b004d1b96a715" category="paragraph">`storage aggregate show -owner-name &lt;node4&gt;`</block>
  <block id="862da4c0b3b19ba62c050373943cd909" category="list-text">确定是否有任何卷脱机：</block>
  <block id="498a7d30e002a0545e05d9bfce9c6fd7" category="paragraph">`volume show -node &lt;node3&gt; -state offline`</block>
  <block id="26391f3798784439b28190a843ccb233" category="paragraph">`volume show -node &lt;node4&gt; -state offline`</block>
  <block id="b2ec89d698c3bc26ab79d7bad283a953" category="list-text">如果任何卷处于脱机状态，请将其与您在部分中捕获的脱机卷列表进行比较 <block ref="cd8ad1809865824065fe011b80800cd6" category="inline-link-macro-rx"></block>，并根据需要使用以下命令使每个卷的任何脱机卷联机一次：</block>
  <block id="f7d167d02c4419aa4a6731264ec3b0f2" category="paragraph">`volume online -vserver &lt;vserver-name&gt; -volume &lt;volume_name&gt;`</block>
  <block id="8b2ba35c1767c4b484add2236c0ffa6c" category="list-text">对每个节点使用以下命令，为新节点安装新许可证：</block>
  <block id="d68dddaa399afd62872ccc142420c8e8" category="paragraph">`ssystem license add - license-code &lt; 许可证代码，许可证代码，许可证代码 ...&gt;`</block>
  <block id="539b1b58f1be38076506f35eb15e4340" category="paragraph">license-code 参数接受一个包含 28 个大写字母字符密钥的列表。您可以一次添加一个许可证，也可以一次添加多个许可证，并以逗号分隔每个许可证密钥。</block>
  <block id="8fb49e1f692fe82fa4072e7f3b3adc5d" category="list-text">使用以下命令之一从原始节点中删除所有旧许可证：</block>
  <block id="3ce96f90e07aec61f73d0c41634c6aa1" category="paragraph">`ssystem license clean-up -unused -expired`</block>
  <block id="10c0851b91ac12edf49186d6d3d1f9e8" category="paragraph">`ssystem license delete -serial number &lt;node_serial number&gt; -package &lt;licensable_package&gt;`</block>
  <block id="b71fdf79c90ac84b34d2470620eeaa18" category="list-text">删除所有已过期的许可证：</block>
  <block id="df1e7bcee84d26ba3ee0e0f129bf90c0" category="paragraph">`ssystem license clean-up -expired`</block>
  <block id="b162df50db538c8339d7ad30f407e32f" category="list-text">删除所有未使用的许可证：</block>
  <block id="32be9f537283877b6e62fd279a4f5513" category="paragraph">`ssystem license clean-up -unused`</block>
  <block id="9501cf64d3b2dae298a8bc24331bd5f4" category="list-text">在节点上使用以下命令从集群中删除特定许可证：</block>
  <block id="9a940b51cdd2b2d508cffc6eecff9e32" category="paragraph">此时将显示以下输出：</block>
  <block id="0b0ab53ca7ce0880a8c5c074d260f0ab" category="paragraph">输入 `y` 删除所有软件包。</block>
  <block id="583284b695f33c141c3b00d7dbad074f" category="list-text">使用以下命令并检查输出，以验证是否已正确安装许可证：</block>
  <block id="f52d44aaa981f34fa588225f9d4cc820" category="paragraph">`s系统许可证显示`</block>
  <block id="465b7cedf5deb460a2aa173308f5656a" category="paragraph">您可能需要将输出与在部分中捕获的输出进行比较 <block ref="cd8ad1809865824065fe011b80800cd6" category="inline-link-macro-rx"></block>。</block>
  <block id="9dabc4c6addd92ab1be1dd1cd49038f7" category="inline-link-macro">安装并启动 node4 步骤 27</block>
  <block id="772f7f66af9503bd28ba599cf5b8a6ea" category="list-text">如果在配置中使用了 NetApp 存储加密（ NSE ），并且您将 `setenv bootarg.storageencryption.support` 命令设置为 `true` ，并使用 ` &lt;kmip.init.maxwait&gt;` 变量 `off` （在 <block ref="8eec167848fab5c118476094c3efd320" category="inline-link-macro-rx"></block>），您需要重置变量：</block>
  <block id="1534946b2dbb4d79955a0d451c913c4c" category="list-text">在两个节点上使用以下命令配置 SP ：</block>
  <block id="dde01ffa3dbac07014347a80fbf42f2f" category="paragraph">`ssystem service-processor network modify -node &lt;node_name&gt;`</block>
  <block id="e4c074cd0d17a1426d4153413c21f2b8" category="paragraph">请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 ONTAP `s管理参考 _ 以了解 SP 的相关信息，以及 _SP 9.8 命令：手册页参考 _ 以了解有关 system` service-processor network modify 命令的详细信息。</block>
  <block id="c3e44bb7c41d54ab04ed9048fc5b39f1" category="list-text">对其中一个新节点执行以下操作：</block>
  <block id="102261de999f6bca12acc79b316dfb42" category="list-text">输入高级权限级别：</block>
  <block id="5fd1bcc8472b38442961eb87ca3f844a" category="paragraph">`set -privilege advanced`</block>
  <block id="6dcd1ebf4390170868ab9bcdfd967581" category="list-text">输入以下命令：</block>
  <block id="1b4358359b751ff53e2d497527507190" category="paragraph">`storage failover modify -node &lt;node_name&gt; - cifs- no-duration default_medium_low`</block>
  <block id="bdaf872fbb56ca73fe6e9dd9a980aba6" category="list-text">如果系统的工作负载的 50% 到 75% 的操作小于 4 KB ，请输入 `medium` 。</block>
  <block id="c347ef9cd4bc7e044fc3d1aa22c41ed4" category="list-text">如果系统的工作负载的 75% 到 100% 的操作小于或小于 4 KB ，请输入 `low` 。</block>
  <block id="0ac9d40efe1470ec53257470c91f7314" category="list-text">返回到管理员级别：</block>
  <block id="d260c71f1d73fe6dce24fae82cd28aca" category="paragraph">`set -privilege admin`</block>
  <block id="0fbda10a905dbd102127a7a65daf7abd" category="list-text">重新启动系统以确保更改生效。</block>
  <block id="01e6682dee79033af96ab718c5ec6c11" category="list-text">如果要在新节点上设置无交换机集群，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 要链接到 _NetApp 支持站点 _ 并按照 _switchover to a two-node switchless cluster_ 中的说明进行操作。</block>
  <block id="27af4227ca8acc558df96e2723ec9b37" category="inline-link-macro">在新控制器模块上设置存储加密</block>
  <block id="a1e79be82a0d3f4b4c3568d0f3e32af4" category="paragraph">如果在 node3 和 node4 上启用了存储加密，请完成此部分 <block ref="18c90c300c0b71334b8b427eaf4f38a3" category="inline-link-macro-rx"></block>。否则，请完成部分 <block ref="6e48b929ca0767f00c15eeb6d7e78755" category="inline-link-macro-rx"></block>。</block>
  <block id="6af295d62e510174dc8b78d80e744fc4" category="summary">您可以无中断地升级运行 ONTAP 9.8 的一对节点上的控制器硬件。</block>
  <block id="8fb4b518ce39a0704f920c9d4f2f7b77" category="doc">使用聚合重新定位升级控制器硬件</block>
  <block id="88eee2e6d438ad3ba132fc6cdf4398d7" category="paragraph">在操作步骤期间，您可以使用替代控制器硬件升级原始控制器硬件，从而重新定位非根聚合的所有权。您可以在节点之间多次迁移聚合，以确保在整个升级操作步骤中至少有一个节点从聚合提供数据。您还可以迁移数据逻辑接口（ LIF ），并在继续操作时将新控制器上的网络端口分配给接口组。</block>
  <block id="2b8ce2a5a31645114136f0f0bb138e41" category="paragraph">在此信息中，原始节点称为 "node1" 和 "node2" ，新节点称为 "node3" 和 "node4" 。在所述的操作步骤期间， node1 将替换为 node3 ， node2 将替换为 node4 。术语 "node1" ， "node2" ， "node3" 和 "node4" 仅用于区分原始节点和新节点。在操作步骤之后，必须替换原始节点和新节点的实际名称。但是，实际上，节点名称不会更改：在升级控制器硬件后， node3 的名称为 node1 ， node4 的名称为 node2 。</block>
  <block id="997df92b20e351845274e553840f1763" category="paragraph">在整个信息中，术语 " 使用 FlexArray 虚拟化软件的系统 " 是指属于这些新平台的系统。术语 "V 系列系统 " 是指可以连接到存储阵列的单独硬件系统。</block>
  <block id="b6ba15c100cec3519d48bc58279da3c3" category="list-title">需要注意的重要信息</block>
  <block id="32de3fe80cc3182e6d21291decbf392a" category="inline-link-macro">ARL 升级概述</block>
  <block id="2b5992c45bfbea896711ff945a4844aa" category="list-text">此操作步骤非常复杂，假定您具备高级 ONTAP 管理技能。您还应阅读并了解 <block ref="4839d43871fe29773e86f5cefcab0e32" category="inline-link-macro-rx"></block> 和 <block ref="57e14e08755134bb6fef9ad899bb58ee" category="inline-link-macro-rx"></block> 开始升级前的章节。</block>
  <block id="bc0c3600d83329affdb0d85df2aeac56" category="list-text">此操作步骤假定更换用的控制器硬件是新的，尚未使用。使用 `wipeconfig` 命令准备已用控制器所需的步骤不在此操作步骤中。如果先前使用的是替代控制器硬件，则必须联系技术支持，尤其是在控制器以 7- 模式运行 Data ONTAP 时。</block>
  <block id="8d7b68591c9cb3f00554e8b1dd0cc34a" category="list-text">您可以使用 ARL 无中断地将控制器升级到运行的 ONTAP 版本高于要升级的集群上运行的版本的新控制器。新旧控制器的 ONTAP 版本组合取决于 ONTAP 软件版本 NDU 的节奏模型。例如，如果您的控制器运行的是 ONTAP 9.8 ，而该控制器最后支持的版本是 ONTAP 9.8 ，则可以升级到运行 ONTAP 9.8 之后版本的新控制器。</block>
  <block id="12e5dea4b29b66ec41d8307d3502847c" category="summary">在阶段 3 中，您将安装并启动 node3 。</block>
  <block id="3f765691a1037f4fcf966c679a3f3a4a" category="doc">第 3 阶段。安装并启动 node3</block>
  <block id="aed0650ed977ce1ee331d98fdf3fb87b" category="paragraph">在第 3 阶段，您安装并启动 node3 ，检查 node1 中的集群和节点管理端口是否在 node3 上联机，并验证 node3 安装。属于 node1 的非 SAN 数据 LIF 和非根聚合将从 node2 移动到 node3 。</block>
  <block id="b27daeccf5fbd8a2e88a3636ee615b74" category="list-text"><block ref="b27daeccf5fbd8a2e88a3636ee615b74" category="inline-link-macro-rx"></block></block>
  <block id="c73225f56714e22dffa9ff7369895ce1" category="list-text"><block ref="c73225f56714e22dffa9ff7369895ce1" category="inline-link-macro-rx"></block></block>
  <block id="63ad3c4d36a1a9f413872ac57af754a7" category="inline-link-macro">验证 node3 安装</block>
  <block id="35ed01fca1dde6c35ca197b89d2bbfc7" category="list-text"><block ref="35ed01fca1dde6c35ca197b89d2bbfc7" category="inline-link-macro-rx"></block></block>
  <block id="f6eafe551d29e5e1c533099843028759" category="list-text"><block ref="f6eafe551d29e5e1c533099843028759" category="inline-link-macro-rx"></block></block>
  <block id="840820d31f6c078aeb1567ce302bdd05" category="inline-link-macro">将 node1 拥有的非根聚合和 NAS 数据 LIF 从 node2 移动到 node3</block>
  <block id="6acca98fea84a4d59c293fb72d8b9155" category="list-text"><block ref="6acca98fea84a4d59c293fb72d8b9155" category="inline-link-macro-rx"></block></block>
  <block id="1ccbd6f617ebfa1f7b6d1b6f16222909" category="summary">重新定位和停用节点 1</block>
  <block id="bbbe961bb71cae13cea3f5b878f4dbb9" category="doc">第 2 阶段。重新定位和停用节点 1</block>
  <block id="a87bccd109d187061a4e62dfad783508" category="paragraph">在阶段 2 中，您将 node1 聚合和 LIF 重新定位到 node2 ，记录 node1 信息，然后停用 node1 。此过程大部分是自动化的；操作将暂停，以便您可以检查其状态。您必须手动恢复此操作。</block>
  <block id="7de24b16e7313de118da7559fecd8fd4" category="inline-link-macro">将节点 1 拥有的非根聚合和 NAS 数据 LIF 重新定位到节点 2</block>
  <block id="22e9bda17d40c1dbdb534fd455e19fcd" category="list-text"><block ref="22e9bda17d40c1dbdb534fd455e19fcd" category="inline-link-macro-rx"></block></block>
  <block id="650a4c1ea41a0f666ee188ff323d26b9" category="list-text"><block ref="650a4c1ea41a0f666ee188ff323d26b9" category="inline-link-macro-rx"></block></block>
  <block id="93d6a78ca650a17d67b6a45ca81b7f3f" category="inline-link-macro">停用 node1</block>
  <block id="830cfeba72054433fc0dcccc19f6d055" category="list-text"><block ref="830cfeba72054433fc0dcccc19f6d055" category="inline-link-macro-rx"></block></block>
  <block id="4815c2d091d790c1d3bab94177b38eaf" category="list-text"><block ref="4815c2d091d790c1d3bab94177b38eaf" category="inline-link-macro-rx"></block></block>
  <block id="53bf10d232214698fea58c12013ebb0b" category="summary">在第 1 阶段，您必须准备好节点进行升级并运行一系列预检。</block>
  <block id="81605039a97ca73a232818034b412a87" category="doc">第 1 阶段。准备升级</block>
  <block id="6c0e9c6d05c6f91d2edf95d8ad8f212d" category="paragraph">在第 1 阶段，您必须准备好节点进行升级并运行一系列预检。您可能需要为磁盘重新设置密钥以进行存储加密。您还必须准备通过网络启动新控制器。</block>
  <block id="cd8ad1809865824065fe011b80800cd6" category="list-text"><block ref="cd8ad1809865824065fe011b80800cd6" category="inline-link-macro-rx"></block></block>
  <block id="0ae607be61578c5416aa071902ff0f19" category="list-text"><block ref="0ae607be61578c5416aa071902ff0f19" category="inline-link-macro-rx"></block></block>
  <block id="26f21c512ab4d5d4b123c5b8a953bb85" category="paragraph">您必须验证 node2 中的物理端口是否正确映射到 node4 上的物理端口。这样， node4 便可在升级后与集群中的其他节点以及网络进行通信。</block>
  <block id="4ded4d845e551767daf131f3a1827b13" category="paragraph">请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _Node_ Hardware Universe 以捕获有关新节点上端口的信息。您将在本节稍后部分使用此信息。</block>
  <block id="3e1a89708cfe8d08896ed24a0d0be5e8" category="paragraph">物理端口布局可能因节点型号而异。当新节点启动时， ONTAP 将尝试确定应托管集群 LIF 的端口，以便自动达到仲裁。</block>
  <block id="98ba93dd4de23479aa574bba16f17db7" category="paragraph">如果 node2 上的物理端口未直接映射到 node4 上的物理端口，请执行下一节 <block ref="364d871b05cd34ae9893fc6fc54b8984" category="inline-xref-macro-rx"></block> 必须用于修复网络连接。</block>
  <block id="e39c239523fa2335eed92e50ae0e2208" category="paragraph">安装并启动 node4 后，您必须验证是否已正确安装它。您必须等待 node4 加入仲裁，然后恢复重新定位操作。</block>
  <block id="ed944478e87ce6285850bdd8efb0399a" category="paragraph">此时，在操作步骤中，操作将暂停，因为 node4 加入仲裁。</block>
  <block id="6a8e851d9f61a3ae03d77096370ca9c6" category="list-text">验证 node4 是否已加入仲裁：</block>
  <block id="4395613c979349d83b9f7a1fd64ad821" category="paragraph">`cluster show -node node4 -fields health`</block>
  <block id="a5c25ebe0ba44233d498c66cb77e22f2" category="paragraph">`health` 字段的输出应为 `true` 。</block>
  <block id="f9bb6290635aecbf1e553e1d48da4966" category="list-text">确认 node4 与 node3 属于同一集群，并且运行状况良好：</block>
  <block id="1b294cfbc51db8a82a21bedd0caea1b7" category="list-text">切换到高级权限模式：</block>
  <block id="248f892426f89c07bc5999439096f3e0" category="paragraph">`set advanced`</block>
  <block id="b1ce2a2b9289e0bdc7f0dcbfb19de9c2" category="list-text">检查控制器更换操作的状态，并验证它是否处于暂停状态以及 node2 暂停之前的相同状态，以便执行安装新控制器和移动缆线的物理任务：</block>
  <block id="8005ab9a73c38cc367636a0ec9e8fa35" category="paragraph">`ssystem controller replace show`</block>
  <block id="cf24b4fbdd5de5d1db8e8fd45a8826f7" category="list-text">如果您正在处理 MetroCluster 系统，请验证是否已为 MetroCluster 配置正确配置更换的控制器； MetroCluster 配置应处于运行状况良好的状态。请参见 <block ref="14c0e32a98a31f9fd4a16b635b2f7ebd" category="inline-link-macro-rx"></block>。</block>
  <block id="f5ce4d426c8852e0090ab32842d1cd09" category="inline-xref">第 6 步</block>
  <block id="459235ad323edd7deeae2dc5ded37b95" category="paragraph">在 MetroCluster 节点 node4 上重新配置集群间 LIF ，并检查集群对等关系以恢复 MetroCluster 节点之间的通信，然后再继续 <block ref="ee95d9bf63146ca7fe271f7654fa2f7c" category="inline-xref-macro-rx"></block>。</block>
  <block id="45b045cb31b53300f077fd700437de5a" category="paragraph">检查 MetroCluster 节点状态：</block>
  <block id="ecada3140a47012aab89f14c63ba9190" category="paragraph">`MetroCluster node show`</block>
  <block id="973e4031ed35bf66df5741d51fd988da" category="list-text">【 auto_verify_4_Step6]] 恢复控制器更换操作：</block>
  <block id="2a2c4f4e7fd268d1d4c0dda8807d69e2" category="list-text">控制器更换将暂停以进行干预，并显示以下消息：</block>
  <block id="6f399bf4f62f96a02d91e295630626e7" category="list-text">在控制器更换处于暂停状态的情况下，继续执行本文档的下一节以还原节点上的网络配置。</block>
  <block id="ad642c9296b70fbec2ff690ecca7088a" category="section-title">还原 node4 上的网络配置</block>
  <block id="51c7cb1cccc939f5c24359054f6e087c" category="paragraph">确认 node4 处于仲裁状态并可与 node3 通信后，请确认 node4 上显示了 node2 的 VLAN ，接口组和广播域。此外，验证所有 node4 网络端口是否均已配置在其正确的广播域中。</block>
  <block id="c4d5be310a7b3c7d734bbcc91e576fc5" category="list-text">列出已升级的 node2 （称为 node4 ）上的所有物理端口：</block>
  <block id="932f91b355fe820e44bf7015a07fe9d1" category="paragraph">`network port show -node node4`</block>
  <block id="7201bec4fa4ce45284b39257c7ebc9bd" category="paragraph">此时将显示节点上的所有物理网络端口， VLAN 端口和接口组端口。在此输出中，您可以看到 ONTAP 已将任何物理端口移至 `集群` 广播域。您可以使用此输出来帮助确定应将哪些端口用作接口组成员端口， VLAN 基本端口或独立物理端口来托管 LIF 。</block>
  <block id="f12a8cebc5d18fa1d15cbfd16990a033" category="list-text">列出集群上的广播域：</block>
  <block id="3723e98cfe679a4d7a6a396b19de8982" category="paragraph">`broadcast-domain show`</block>
  <block id="5e805181dd219e5299df90fe82dbae5d" category="paragraph">`网络端口可访问性显示`</block>
  <block id="b60798a4e8624ef10969a61bd2f1a5a7" category="paragraph">命令的输出类似于以下示例：</block>
  <block id="84bdf9c97b15a3e6ea78416bdc99e1ee" category="paragraph">在上面的示例中， node2_node4 是在更换控制器后刚刚启动的。它具有多个不可访问的端口，并且正在等待可访问性扫描。</block>
  <block id="7e4772f5da93344d8ada20b9c581e1f9" category="list-text">【 auto_restore_4_Step4]] 修复 node4 上每个端口的可访问性状态不是 `ok` 的可访问性。首先对任何物理端口运行以下命令，然后对任何 VLAN 端口运行以下命令，一次运行一个：</block>
  <block id="d8c7ef2c85a7a25537cac9242cffa1bd" category="paragraph">`network port reachability repair -node &lt;node_name&gt; -port &lt;port_name&gt;`</block>
  <block id="b784d8e9f422428eac76c9239f75fe91" category="paragraph">输出如下所示：</block>
  <block id="6da5520b869a50ed547a761fe1f0e10e" category="paragraph">对于可访问性状态可能与当前所在广播域的可访问性状态不同的端口，应显示一条警告消息，如上所示。</block>
  <block id="2b17ef3c860c2adf63f0265d9181acce" category="paragraph">根据需要查看端口和问题解答 `y` 或 `n` 的连接。</block>
  <block id="88e1ec169a4d9b4d08505d76c6e1eb13" category="paragraph">验证所有物理端口是否具有预期可访问性：</block>
  <block id="763c4b6560b672163a09cf2e67ba8d89" category="paragraph">在执行可访问性修复时， ONTAP 会尝试将端口放置在正确的广播域中。但是，如果无法确定某个端口的可访问性，并且该端口不属于任何现有广播域，则 ONTAP 将为这些端口创建新的广播域。</block>
  <block id="6c2174965c1dafdd591752b78b10faa9" category="list-text">如果接口组配置与新控制器物理端口布局不匹配，请按照以下步骤进行修改。</block>
  <block id="a0c9e092b3640057dbbb2fad95c8d7be" category="list-text">您必须先从其广播域成员资格中删除接口组成员端口的物理端口。您可以使用以下命令执行此操作：</block>
  <block id="d8f20787d5ec4fcacf599bd56be2bbd1" category="paragraph">`network port broadcast-domain remove-ports -broadcast-domain &lt;broadcast_domain_name&gt; -ports &lt;node_name ： port_name&gt;`</block>
  <block id="62c1275f11de1967a743be3b315a5af6" category="list-text">将成员端口添加到接口组：</block>
  <block id="a53c80be8dbadd4ecfb18eacac1d405c" category="paragraph">`network port ifgrp add-port -node &lt;node_name&gt; - ifgrp &lt;ifgrp&gt; -port &lt;port_name&gt;`</block>
  <block id="0abff6a62b49a7204a8ea4607845ec05" category="list-text">在添加第一个成员端口后大约一分钟，接口组会自动添加到广播域中。</block>
  <block id="8f16f590f8016a4aad84ad6c5a34e114" category="list-text">验证接口组是否已添加到相应的广播域：</block>
  <block id="d8f93cb99c84b71cefbdf673772842c8" category="paragraph">`network port reachability show -node &lt;node_name&gt; -port &lt;ifgrp&gt;`</block>
  <block id="607ae99fdc4c8f52e04ea11d57ca8694" category="paragraph">如果接口组的可访问性状态为 NOT `ok` ，请将其分配给相应的广播域：</block>
  <block id="39f16ed05d559ba39f10f8313fdbdbf7" category="paragraph">`network port broadcast-domain add-ports -broadcast-domain &lt;broadcast_domain_name&gt; -ports &lt;node ： port&gt;`</block>
  <block id="1650d35c8daaa79601fdd8158052591c" category="list-text">为 `集群` 广播域分配适当的物理端口：</block>
  <block id="4c2584946af77fb7d60cf4ae472d405c" category="list-text">确定哪些端口可访问 `集群` 广播域：</block>
  <block id="a2904a68bb127cf5751716be508a8cd4" category="paragraph">`network port reachability show -reachable-broadcast-domains cluster ：集群`</block>
  <block id="9f99edf6858da9da7242d6b213567d8c" category="list-text">如果可访问性状态不是 `正常` ，请修复可访问 `集群` 广播域的任何端口：</block>
  <block id="9c0ec98274edaf49b54f8a682182e736" category="paragraph">`network port reachability repair -node &lt;node_name&gt; -port &lt;port_name&gt;`</block>
  <block id="094336d39f674644064e82381591f883" category="list-text">使用以下命令之一将其余物理端口移动到其正确的广播域中：</block>
  <block id="fc794a16843cc25cbaf14628270ab5d2" category="paragraph">`network port broadcast-domain remove-port`</block>
  <block id="db5edb9657d0577afb5f42b19b5b760f" category="paragraph">`网络端口 broadcast-domain add-port`</block>
  <block id="ce885b3d303810e3d85ace1f89c4a065" category="paragraph">确认不存在不可访问或意外的端口。使用以下命令检查所有物理端口的可访问性状态，并检查输出以确保状态为 `ok` ：</block>
  <block id="add7de11dea94372ab92280144dd2eae" category="paragraph">`网络端口可访问性 show -detail`</block>
  <block id="67d13fe1d5e641d73d6e558118a0902a" category="list-text">使用以下步骤还原可能已被替换的任何 VLAN ：</block>
  <block id="cb91f704c28ecf5de2f29274ef6bf62e" category="list-text">列出已替换的 VLAN ：</block>
  <block id="81a71f7b68d86411acd35a0832051632" category="paragraph">`displaced VLAN show`</block>
  <block id="551f04031696758c1c256f1c90e57b39" category="paragraph">此时应显示如下输出：</block>
  <block id="a806d4909353769619f495a130cabdbd" category="list-text">还原从先前的基本端口中替换的 VLAN ：</block>
  <block id="7e13cce614ffd7f318255684f22d3da9" category="paragraph">`displaced VLAN restore`</block>
  <block id="e08a0549a69b4bf0d4b807833ac0b586" category="paragraph">以下示例显示了将已从接口组 a0a 中移出的 VLAN 还原到同一接口组的过程：</block>
  <block id="5382f5bbbe74b198aaaf36efb0dd9ef3" category="paragraph">以下是将端口 "e0e" 上的已替换 VLAN 还原到 "e0h" 的示例：</block>
  <block id="2a31dfadfe9a33da55e9d278be8596a4" category="paragraph">成功还原 VLAN 后，将在指定的目标端口上创建已替换的 VLAN 。如果目标端口是接口组的成员或目标端口已关闭，则 VLAN 还原将失败。</block>
  <block id="aad2ee0340b449143fc7eaa87d78ba8b" category="paragraph">等待大约一分钟，以便将新还原的 VLAN 放置到其相应的广播域中。</block>
  <block id="3dd496dea37dae38c9dc7eb802d64409" category="list-text">根据需要为不在 `displaced - vlan show` 输出中，但应在其他物理端口上配置的 VLAN 端口创建新的 VLAN 端口。</block>
  <block id="9ba5961a2332be610ae3121c25c32aeb" category="list-text">完成所有端口修复后，删除任何空广播域：</block>
  <block id="8cb8d05546274856c8c2cb56b7cd62ac" category="paragraph">`broadcast-domain delete -broadcast-domain &lt;broadcast_domain_name&gt;`</block>
  <block id="6fbbdf7318a95fb2400613497f103b75" category="list-text">验证端口可访问性：</block>
  <block id="e3d6faf783eff413421d5abeaf1dad48" category="paragraph">如果所有端口均已正确配置并添加到正确的广播域中，则 `network port reachability show` 命令应将所有已连接端口的可访问性状态报告为 `ok` ，对于无物理连接的端口，此状态报告为 `no-reachability` 。如果任何端口报告的状态不是这两个端口，请按照中的说明执行可访问性修复并在其广播域中添加或删除端口 <block ref="4f595e600f8320b4ad2d574fa1a9fe37" category="inline-xref-macro-rx"></block>。</block>
  <block id="fb3f4ac6019d983118e241d6e496f536" category="list-text">验证所有端口是否均已置于广播域中：</block>
  <block id="47cd03a2fa721b9f4f83dca38829afea" category="paragraph">`network port show`</block>
  <block id="7b92b1d8c427dbd2b8e236ab8d9bb5f7" category="list-text">验证广播域中的所有端口是否配置了正确的最大传输单元（ MTU ）：</block>
  <block id="3ef90a77774be1f83d79d3a57d347bee" category="paragraph">`network port broadcast-domain show`</block>
  <block id="e2eec117ad4a813e49145093e5613f00" category="list-text">还原 LIF 主端口，指定需要还原的 Vserver 和 LIF 主端口（如果有）：</block>
  <block id="12c772fdba51a1a482d3e3843bdaf6c4" category="list-text">列出所有已替换的 LIF ：</block>
  <block id="b24b42eec37d4f62111bc66268ece07c" category="paragraph">`displaced interface show`</block>
  <block id="ca89b5ef1fbf8f5385df4158740fe931" category="list-text">还原 LIF 主端口：</block>
  <block id="d9c337595df87d0501bee08179c49004" category="paragraph">`displaced interface restore-home-node -node &lt;node_name&gt; -vserver &lt;vserver_name &gt; - lif-name &lt;LIF_name&gt;`</block>
  <block id="4615226c3fd7af8f5c2beb65404cb667" category="list-text">验证所有 LIF 是否都具有主端口且已由管理员启动：</block>
  <block id="d5a3621c2468f29ad4fa0ab73f4bd80a" category="paragraph">`network interface show -fields home-port ， status-admin`</block>
  <block id="cdd3eef7b8578a295d456f9eaf566e58" category="summary">在 node3 上验证网络配置之后，以及在将聚合从 node2 重新定位到 node3 之前。</block>
  <block id="338e1133e592584bd1dc26b643cbe02f" category="paragraph">在验证 node3 上的网络配置以及将聚合从 node2 重新定位到 node3 之前，您必须验证当前位于 node2 上的 node1 所属的 NAS 数据 LIF 是否已从 node2 重新定位到 node3 。您还必须验证 node3 上是否存在 SAN LIF 。</block>
  <block id="f329a7087048b2fb128acd99205356e2" category="paragraph">在升级操作步骤期间，远程 LIF 处理 SAN LUN 的流量。升级期间，集群或服务运行状况无需移动 SAN LIF 。除非需要将 SAN LIF 映射到新端口，否则不会移动这些 LIF 。使 node3 联机后，您将验证 LIF 是否运行正常并位于相应的端口上。</block>
  <block id="a29257abbaad84467babad354360d285" category="paragraph">执行这些检查后，系统会将 node1 拥有的非根聚合和 NAS 数据 LIF 重新定位到新控制器 node3 。资源重新定位完成后，控制器更换操作将暂停。</block>
  <block id="61d1def7733487d4ddcc1c11e4c26d34" category="paragraph">如果已替换任何 LIF ，请将主节点还原回 node3 ：</block>
  <block id="7e0e78e75be372751ec10514d50e55b5" category="summary">您可以使用替代控制器硬件升级原始控制器硬件，从而重新定位非根聚合的所有权。</block>
  <block id="32cbc0f35ce50a85e5c8c6b2f7b35d1f" category="paragraph">此升级操作步骤主要是适用场景升级情形，其中您要更换的控制器型号不支持更高的 ONTAP 版本，而新控制器不支持更早的 ONTAP 版本。</block>
  <block id="3f95c69711726ab20c6ad2092e62e13d" category="list-text">您可以使用此操作步骤升级具有两个以上节点的集群中的控制器硬件；但是，您需要为集群中的每个高可用性（ HA ）对单独执行操作步骤。</block>
  <block id="b63bac0d0a2ee7a43a0c82d9d71a631a" category="list-text">此操作步骤适用场景 FAS 系统， V 系列系统， AFF 系统以及安装了 FlexArray 虚拟化软件的系统。如果安装了所需的许可证，则在 ONTAP 9.5 之后发布的 FAS 系统可以连接到存储阵列。有关存储阵列和 V 系列型号的详细信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 要链接到 _V Hardware Universe 系列支持表，请访问 V 系列支持表。</block>
  <block id="9ac92b97b9314fe7c9c80b03c2f61746" category="list-text">此操作步骤适用场景系统运行 4 节点 NetApp MetroCluster 配置或更高版本。由于 MetroCluster 配置站点可以位于两个物理上不同的位置，因此对于 HA 对，必须在每个 MetroCluster 站点上单独执行控制器自动升级。</block>
  <block id="62a59e60f8dc64071df571bef45b97de" category="summary">如果更换的控制器或新控制器的 HA 配对项使用存储加密。</block>
  <block id="71dd89b192a133f8ccfd6e18f0397ebc" category="paragraph">如果更换的控制器或新控制器的 HA 配对项使用存储加密，则必须为新控制器模块配置存储加密，包括安装 SSL 证书和设置密钥管理服务器。</block>
  <block id="1bf6f98fb62d5ca413d6cce101954a5f" category="paragraph">此操作步骤包含对新控制器模块执行的步骤。您必须在正确的节点上输入命令。</block>
  <block id="d38fed7bb4bf7b2cd414582a337f388f" category="list-text">验证密钥管理服务器是否仍可用，其状态及其身份验证密钥信息：</block>
  <block id="eeb811dde1344fabc569b67ecd8b95f6" category="paragraph">`s安全密钥管理器查询`</block>
  <block id="32ce57c242557f5657864f2684cf9a96" category="list-text">将上一步中列出的密钥管理服务器添加到新控制器的密钥管理服务器列表中。</block>
  <block id="39971f39aded85b4e8e1fe2d3e1acc6d" category="list-text">添加密钥管理服务器：</block>
  <block id="74bdef17191283e61278bf225ca4520d" category="list-text">对列出的每个密钥管理服务器重复上述步骤。您最多可以链接四个密钥管理服务器。</block>
  <block id="8b2208f5ccda57697f72181172533640" category="list-text">验证是否已成功添加密钥管理服务器：</block>
  <block id="0e79decb13af5d2dc1cdba7d4607d34c" category="paragraph">`sSecurity key-manager show`</block>
  <block id="613e5831fca345289928a52de72937a1" category="list-text">在新控制器模块上，运行密钥管理设置向导以设置和安装密钥管理服务器。</block>
  <block id="bbdb53ee65b9a0c8fdb6fdf3661d0fb6" category="paragraph">您必须安装与现有控制器模块上安装的密钥管理服务器相同的密钥管理服务器。</block>
  <block id="dd0630a1638f6964504eefd155f3f818" category="list-text">在新节点上启动密钥管理服务器设置向导：</block>
  <block id="5560b948b9e6ef0348c58a90d5656939" category="list-text">完成向导中的步骤以配置密钥管理服务器。</block>
  <block id="b0b1f7cd7ad16c151d90a8783f1752db" category="list-text">将所有链接的密钥管理服务器中的身份验证密钥还原到新节点：</block>
  <block id="26a8fc3a58ee2e1f4b9b0219f3203837" category="summary">在第 5 阶段，您安装并启动 node4 ，将集群和节点管理端口从 node2 映射到 node4 。</block>
  <block id="5eb59651a7213cf4ae352b4c3ee57a36" category="doc">第 5 阶段。安装并启动节点 4.</block>
  <block id="e6cd3f4f7e85ced0a9a0f950fd761aa0" category="paragraph">在第 5 阶段，您将安装并启动 node4 ，将集群和节点管理端口从 node2 映射到 node4 ，并验证 node4 安装。您还可以将 node2 拥有的 NAS 数据 LIF 从 node3 移动到 node4 ，并将 node2 的聚合从 node3 重新定位到 node4 。</block>
  <block id="f326c815b47f4f2909494bae5cd735d5" category="list-text"><block ref="f326c815b47f4f2909494bae5cd735d5" category="inline-link-macro-rx"></block></block>
  <block id="a6d322e902b744ff3a11f02b5c6d9496" category="list-text"><block ref="a6d322e902b744ff3a11f02b5c6d9496" category="inline-link-macro-rx"></block></block>
  <block id="3a339ed5bdc85366b677c546716fabfa" category="list-text"><block ref="3a339ed5bdc85366b677c546716fabfa" category="inline-link-macro-rx"></block></block>
  <block id="6d23265c57ba430c404cc6f3a940e117" category="inline-link-macro">还原 node4 上的 key-manager 配置</block>
  <block id="c00899c784d90d8f2d9b3b0d15b36cc3" category="list-text"><block ref="c00899c784d90d8f2d9b3b0d15b36cc3" category="inline-link-macro-rx"></block></block>
  <block id="80f5c472ebe8ade631db1dde97db6a0e" category="list-text"><block ref="80f5c472ebe8ade631db1dde97db6a0e" category="inline-link-macro-rx"></block></block>
  <block id="eeb639c3d3a71ea32a9414c5e5e05d42" category="summary">在将 node1 替换为 node3 之前，必须移动非根聚合。</block>
  <block id="dd019fbf939676387b29c50185dd26bb" category="paragraph">在将 node1 替换为 node3 之前，必须先将非根聚合和 NAS 数据 LIF 从 node1 移动到 node2 ，然后再最终将 node1 的资源移动到 node3 。</block>
  <block id="231d6537090582d94372987139e9087b" category="paragraph">开始任务时，此操作应已暂停；您必须手动恢复此操作。</block>
  <block id="93847b1108029ddbe22a512a569d1038" category="paragraph">迁移聚合和 LIF 后，此操作将暂停以进行验证。在此阶段，您必须验证是否所有非根聚合和非 SAN 数据 LIF 都已迁移到 node3 。</block>
  <block id="bcc15f05fe7b911a3de9d9528ece7fc7" category="list-text">恢复聚合重新定位和 NAS 数据 LIF 移动操作：</block>
  <block id="44d6ab00bef397f6537d95a47a570251" category="paragraph">所有非根聚合和 NAS 数据 LIF 都会从 node1 迁移到 node2 。</block>
  <block id="1a5ea8528c363200c81b97bf8f1cbdc7" category="paragraph">此操作将暂停，以便验证是否已将所有 node1 非根聚合和非 SAN 数据 LIF 迁移到 node2 。</block>
  <block id="af443ed1e514e063894af87e3e0e83a6" category="list-text">在操作仍处于暂停状态的情况下，验证所有非根聚合在 node2 上的状态是否均处于联机状态：</block>
  <block id="9c328071e0321bfbe1d164cac2c22ebd" category="paragraph">`storage aggregate show -node &lt;node2&gt; -state online -root false`</block>
  <block id="e3f90b559d39f13fadeb0be05f3d5fff" category="paragraph">以下示例显示 node2 上的非根聚合处于联机状态：</block>
  <block id="761df4f887d66569090abb51e2ec705f" category="paragraph">如果 node2 上的聚合脱机或变为外部聚合，请在 node2 上使用以下命令将其联机，每个聚合一次：</block>
  <block id="a4a2e92e7d5cb408d0448b6d08752d5a" category="paragraph">`storage aggregate online -aggregate &lt;aggr_name&gt;`</block>
  <block id="f999b6b276f2c64e10bfb3630f92f94c" category="list-text">在 node2 上使用以下命令并检查其输出，以验证 node2 上的所有卷是否联机：</block>
  <block id="b3b5d42abc670ac795f4b90cfc221655" category="paragraph">`volume show -node &lt;node2&gt; -state offline`</block>
  <block id="074f2db71729d7f84803e85e33520125" category="paragraph">如果 node2 上的任何卷脱机，请在 node2 上使用以下命令将其联机，每个卷一次：</block>
  <block id="6dcd6bf9703c1093c3bd05dbdcd04551" category="paragraph">`volume online -vserver &lt;vserver-name&gt; -volume &lt;volume-name&gt;`</block>
  <block id="a3b6690b513bd53e12723fa3f48d8134" category="paragraph">要与此命令结合使用的 ` &lt;vserver-name&gt;` 可在上一个 `volume show` 命令的输出中找到。</block>
  <block id="fa39e98dea804607ace91ae82c9543d7" category="list-text">`步骤 5]] 如果任何 LIF 已关闭，请使用以下命令将 LIF 的管理状态设置为` up ，每个 LIF 一次：</block>
  <block id="a6177fa5aafac8280f0868d4d136dd02" category="paragraph">`network interface modify -vserver &lt;vserver_name&gt; -lif &lt;LIF_name&gt; -home-node &lt;nodename&gt; - status-admin up`</block>
  <block id="fdf5cd6af4cb356df1504c2897e0d9f2" category="list-text">您运行的是 ONTAP 9.8 或更高版本。</block>
  <block id="5d07aebfbe36ac522f2e416e3efcad81" category="list-text">您不希望将新控制器作为新的 HA 对添加到集群中，并使用卷移动来迁移数据。</block>
  <block id="0218d5b45eb7cfed65f2674d40f1e479" category="list-text">您拥有管理 ONTAP 的经验，并对在诊断权限模式下工作的风险感到满意。</block>
  <block id="f25ecc85a7d953e00ca5f626eeed2a96" category="admonition">您可以对此操作步骤使用 NetApp 存储加密（ NSE ）和 NetApp 卷加密（ NVE ）。</block>
  <block id="2b378caa5145e2c7adf8d8e9a477ac03" category="paragraph">下表显示了控制器升级支持的型号列表。</block>
  <block id="f37bbd4cc778d5861294352bef9c1c7f" category="cell">旧控制器</block>
  <block id="cfdade9e474e805958704ec0836f18ac" category="cell">更换控制器</block>
  <block id="8c06a9afcd20cc8675f878a8e07e16ab" category="cell">FAS8020 ， FAS8040 ， FAS8060 ， FAS8080</block>
  <block id="c86ccf041137a3e913e3e89ed65dbff5" category="cell">FAS8200 ， FAS8300 ， FAS8700 ， FAS9000</block>
  <block id="96e7c50f9e1d1f9b66d5ab1dbe5d047a" category="cell">AFF8020 ， AFF8040 ， AFF8060 ， AFF8080</block>
  <block id="c1a19380507e7e6ae4f9e86f2f492cf1" category="cell">AFF A300 ， AFF A400 ， AFF A700 ， AFF A800^1^</block>
  <block id="c37feb3492d999b3f216448183986be2" category="cell">FAS8200</block>
  <block id="7f627dd33a5bf840f270330c41badb8d" category="cell">FAS8700 ， FAS9000 ， FAS8300^3^</block>
  <block id="c78a423f3132ee2ac4f4f4c1fa5d4859" category="cell">AFF A300</block>
  <block id="09c446ae2255191f73eeab607258baaa" category="cell">AFF A700 ， AFF A800^1^ ， AFF A400^3^</block>
  <block id="73ab298c8e00d66d28156892903a39ce" category="cell">AFF A320</block>
  <block id="ce519c4631a5597216245426b360453b" category="cell">AFF A400^2^</block>
  <block id="4852954d031f57b417813707e91dd5bd" category="admonition">如果上表不包含您的控制器升级型号组合，请联系技术支持。</block>
  <block id="f02eccb3076760465f52e896d2649983" category="inline-link-macro">检查并配置 node3 上的 UTA/UTA2 端口，步骤 23</block>
  <block id="51de0f52809b4037608dba4b84c411b1" category="inline-link-macro">检查并配置 node4 上的 UTA/UTA2 端口，步骤 23</block>
  <block id="55b7ad7b49f6385bd9a88c160fc047a1" category="paragraph">^2^从 ONTAP 9.1.1 开始，支持 ARL 自动从 AFF A320 升级到 AFF A400 系统。</block>
  <block id="d94152152b104cd141cb46a6decafc34" category="paragraph">^3^如果要在双节点无交换机集群配置中从 AFF A300 升级到 AFF A400 或 FAS8200 到 FAS8300 系统，则必须选择临时集群端口进行控制器升级。AFF A400 和 FAS8300 系统采用两种配置：一种是以太网捆绑包，夹层卡端口为以太网类型；另一种是 FC 捆绑包，夹层端口为 FC 类型。</block>
  <block id="3ea026f4657fa31414c8a7e80af567b7" category="list-text">对于采用以太网类型配置的 AFF A400 或 FAS8300 ，您可以使用两个夹层端口中的任何一个作为临时集群端口。</block>
  <block id="1568a3e43a98a64aa4ad8791465c2028" category="list-text">对于采用 FC 类型配置的 AFF A400 或 FAS8300 ，您必须添加一个四端口 10 GbE 网络接口卡（部件号 X1147A ）以提供临时集群端口。</block>
  <block id="9e2cad624340fb33cab830594b4e89ee" category="list-text">使用临时集群端口完成控制器升级后，您可以无中断地将集群 LIF 迁移到 AFF A400 系统上的 E3a 和 e3b 100 GbE 端口以及 FAS8300 系统上的 e0c 和 e0d 100 GbE 端口。</block>
  <block id="68f44553add308b567f9f6bbfc94913d" category="paragraph">请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 可链接到 _ONTAP 9 文档中心 _ ，在此可以访问 ONTAP 9 产品文档。</block>
  <block id="fac54699f861d36d543f619170eba56f" category="summary">升级后，您可以通过 NetApp 支持站点停用旧系统。</block>
  <block id="12a1856797218081c363d4151a746a51" category="paragraph">升级后，您可以通过 NetApp 支持站点停用旧系统。停用系统会告知 NetApp 系统不再运行，并将其从支持数据库中删除。</block>
  <block id="822b26e0edfc2eec63c38c61151af684" category="list-text">请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _NetApp 支持站点 _ 并登录。</block>
  <block id="eb020d21f20b70e49bbe4ebed52b9e29" category="list-text">从菜单中选择 * 产品 &gt; 我的产品 * 。</block>
  <block id="4d0016e281d3a86d70ae083a04a5da95" category="list-text">在 * 查看已安装系统 * 页面上，选择要用于显示系统信息的 * 选择条件 * 。</block>
  <block id="700d67d065f1bd740439eef879e00b77" category="paragraph">您可以选择以下选项之一来查找您的系统：</block>
  <block id="9738c15508e7d3e2fce3396706fc65c8" category="list-text">序列号（位于设备背面）</block>
  <block id="fce1b48d1133d34e0a4d5fdc15e8638b" category="list-text">" 我的位置 " 的序列号</block>
  <block id="fd719eec8decd496851f7b087029e913" category="list-text">单击 * 执行！ *</block>
  <block id="a35129a35ab8aae79ad1750a3753888c" category="paragraph">下表显示了集群信息，包括序列号。</block>
  <block id="b5554c834fafdd1adbf8f16933521491" category="list-text">在表中找到集群，然后从产品工具集下拉菜单中选择 * 停用此系统 * 。</block>
  <block id="1153d5d087ce8e64810354b376fd67cd" category="summary">要停用 node1 ，您需要恢复自动操作，以便使用 node2 禁用 HA 对并正确关闭 Lonode1 。</block>
  <block id="15ae34c4770749f2042d550a9e6558a0" category="paragraph">要停用 node1 ，您需要恢复自动操作，以便使用 node2 禁用 HA 对并正确关闭 node1 。您必须稍后从机架或机箱中删除 node1 。</block>
  <block id="44d5329782b4f4acb8947c6cc4601de1" category="list-text">验证 node1 是否已暂停：</block>
  <block id="d1e63174073b4ec3e4d49ef0ca235c5b" category="paragraph">升级完成后，您可以停用 node1 。请参见 <block ref="6e48b929ca0767f00c15eeb6d7e78755" category="inline-link-macro-rx"></block>。</block>
  <block id="8c0489611df3c9267665a7d99d204fa2" category="summary">迁移 LIF 后，它们可能无法在迁移到阶段 2 ，阶段 3 或阶段 5 后联机。</block>
  <block id="06d473a91334306e0ea337d0cf403b02" category="doc">LIF 迁移失败</block>
  <block id="8fc5e587b615f796c0e6e519e500f09c" category="list-text">验证端口 MTU 大小是否与源节点的端口 MTU 大小相同。</block>
  <block id="f1dc53f85f175f3393f82fdfda459a06" category="paragraph">例如，如果源节点上的集群端口 MTU 大小为 9000 ，则目标节点上的 MTU 大小应为 9000 。</block>
  <block id="0be497933ebed90434432b1367f6ac50" category="list-text">如果端口的物理状态为 `down` ，请检查网络缆线的物理连接。</block>
  <block id="685f08a5b99430f3e9a6b908131fd4c3" category="summary">如果更换的控制器或新控制器的 HA 配对项使用 NetApp 卷加密。</block>
  <block id="da7d6f53a5e074768e000aca830b3bfa" category="doc">在新控制器模块上设置 NetApp 卷加密</block>
  <block id="0f36176e72d67a1afa95c79c3e1a12de" category="paragraph">如果更换的控制器或新控制器的 HA 配对项使用 NetApp 卷加密（ NVE ），则必须为 NVE 配置新控制器模块。</block>
  <block id="1a59e73da663791d8cc1a4162cc79daa" category="cell">对于此 ONTAP 版本 ...</block>
  <block id="394247ac369fff4729d586172906244e" category="cell">使用此命令 ...</block>
  <block id="127cae73d2b4d7758b4c0a0e3f49ba5f" category="cell">ONTAP 9.6 及更高版本</block>
  <block id="97d64be0988671e53d352ae4aa93eaf6" category="cell">`sSecurity key-manager key query -node node`</block>
  <block id="85b2cc925922ee961d8156414096bb8d" category="cell">ONTAP 9.5 及更早版本</block>
  <block id="afa9cce4f8e9d7e0dc9a3f8278517e40" category="cell">`sSecurity key-manager key show`</block>
  <block id="01a72c63e79e1fcc9b3e0cac4fb2bf75" category="list-text">将上一步中列出的密钥管理服务器添加到新控制器的密钥管理服务器列表中：</block>
  <block id="e147253c0010bdd5968cb9b4b9ddf7dc" category="cell">外部密钥管理器</block>
  <block id="3cdf420c4abece4e0eba648610592dde" category="cell">`security key-manager external restore` 此命令需要 OKM 密码短语</block>
  <block id="a9849e92b148965a7bbb6c14d0afbcd0" category="cell">板载密钥管理器（ OKM ）</block>
  <block id="f52de228b93a6f965c1879aa97b007d6" category="paragraph">检查是否有任何卷因身份验证密钥不可用或无法访问外部密钥管理服务器而脱机。使用 `volume online` 命令将这些卷恢复联机。</block>
  <block id="017b5062ed4e1498b1fe073b7b8cc546" category="summary">如果 node3 具有板载 FC 端口，板载统一目标适配器（ UTA/UTA2 ）端口或 UTA/UTA2 卡。</block>
  <block id="7bd5452d2f3a1c07fc54d3a08cc82d64" category="paragraph">如果 node3 具有板载 FC 端口，板载统一目标适配器（ UTA/UTA2 ）端口或 UTA/UTA2 卡，则必须先配置这些设置，然后才能完成其余操作步骤。</block>
  <block id="d897564a1ca4a58b7f422ba34b232ab7" category="paragraph">您可能需要完成此部分 <block ref="750d6dbe3bf1312d0d97a8f03a0d2304" category="inline-xref-macro-rx"></block>，部分 <block ref="574c49ad3466f1bed21aff7050a30e36" category="inline-xref-macro-rx"></block>或这两个部分。</block>
  <block id="61a70f63b15f41db325598863adb0177" category="inline-link-macro">验证节点 3 安装</block>
  <block id="9ddd1c356c6ec43f630dd03fa71725d5" category="list-text">如果 node3 没有板载 FC 端口，板载 UTA/UTA2 端口或 UTA/UTA2 卡，并且您要升级具有存储磁盘的系统，则可以跳至 <block ref="d402045f7964b6e0cf4fcac8fa4d9846" category="inline-link-macro-rx"></block> 部分。</block>
  <block id="be6b715addf3303698d174b13e915620" category="list-text">但是，如果您使用的是 V 系列系统或安装了 FlexArray 虚拟化软件和存储阵列的系统，并且 node3 没有板载 FC 端口，板载 UTA/UTA 端口或 UTA/UTA2 卡，请返回到 _Install and boot node3_ 部分并继续执行中的部分 <block ref="279060155dcadaa13689560d46e381cb" category="inline-link-macro-rx"></block>。</block>
  <block id="a1a2d377f686ce4835b9ee342fd6089b" category="list-text"><block ref="750d6dbe3bf1312d0d97a8f03a0d2304" category="inline-xref-macro-rx"></block></block>
  <block id="3088a544c36eafa56a0950901fa93b6a" category="list-text"><block ref="574c49ad3466f1bed21aff7050a30e36" category="inline-xref-macro-rx"></block></block>
  <block id="8992459eb47b3dc5036bd8be4d821db3" category="paragraph">如果 node3 具有板载或 FC 适配器上的 FC 端口，则必须先在节点上设置端口配置，然后再将其投入使用，因为这些端口未经过预配置。如果未配置端口，则可能会发生服务中断。</block>
  <block id="7551ace690fab9fce9d0a9cad21a0ae7" category="paragraph">您必须具有在部分中保存的 node1 中的 FC 端口设置值 <block ref="cd8ad1809865824065fe011b80800cd6" category="inline-link-macro-rx"></block>。</block>
  <block id="dfec8ed00cbb51821de82d335a0ba98b" category="paragraph">如果您的系统没有 FC 配置，则可以跳过此部分。如果您的系统具有板载 UTA/UTA2 端口或 UTA/UTA2 卡，则可以在中对其进行配置 <block ref="574c49ad3466f1bed21aff7050a30e36" category="inline-xref-macro-rx"></block>。</block>
  <block id="4499075b12fda8ae40c8f6475349240b" category="paragraph">* 重要信息 * ：如果您的系统具有存储磁盘，请在集群提示符处输入本节中的命令。如果您使用的是 V 系列系统或 FlexArray 虚拟化软件并连接到存储阵列，请在维护模式下在此部分中输入命令。</block>
  <block id="bc56374912cd801964f37da82292340c" category="list-text">【第 1 步】将 node3 上的 FC 设置与先前从 node1 中捕获的设置进行比较。</block>
  <block id="831368d2ac042989f939504faf6cdf51" category="list-text">【第 2 步】执行以下操作之一：</block>
  <block id="9e7870f5e5208d6877c9cc3acc6453c0" category="paragraph">在维护模式（启动菜单中的选项 5 ）下，根据需要修改 node3 上的 FC 端口：</block>
  <block id="ae6864bc5bb9104379f5a07233847acd" category="cell">在维护模式（启动菜单中的选项 5 ）下，根据需要修改 node3 上的 FC 端口： `ucadmin modify -m fc -t initiator -f &lt;adapter_port_name&gt;` ` -t` 是 FC4 类型，目标或启动程序。* 注 * ：必须将 FC 端口编程为启动程序。</block>
  <block id="7e6f8de582e2388fb39a5c5c26caa64f" category="list-text">【第 3 步】执行以下操作之一：</block>
  <block id="6ee9ff94b07628e8d936112db18664d2" category="cell">使用以下命令并检查输出，以验证新设置： `ucadmin show`</block>
  <block id="bc53092d23cdf154996298ad69f4e7f0" category="list-text">【第 4 步】退出维护模式：</block>
  <block id="25c2f630f05e1a3933f0c056165ae65b" category="list-text">【第 6 步】输入命令后，请等待系统在启动环境提示符处停止。</block>
  <block id="d2dce3cff13fd2c8259fdef7c637226e" category="list-text">【 auto_check3_step8]] 执行以下操作之一：</block>
  <block id="dc1d267429f36a93fe45402105c83a9b" category="list-text">如果 node3 具有 UTA/UTA2 卡或 UTA/UTA2 板载端口，请转至部分 <block ref="574c49ad3466f1bed21aff7050a30e36" category="inline-xref-macro-rx"></block>。</block>
  <block id="09a561f3362ed88514963066e3d7b720" category="list-text">如果 node3 没有 UTA/UTA2 卡或 UTA/UTA2 板载端口，请跳过部分 <block ref="574c49ad3466f1bed21aff7050a30e36" category="inline-xref-macro-rx"></block> 然后转到部分 <block ref="35ed01fca1dde6c35ca197b89d2bbfc7" category="inline-link-macro-rx"></block>。</block>
  <block id="70d6bd3154ab38128a772f6268fea926" category="list-text">如果 node3 没有 UTA/UTA2 卡或 UTA/UTA2 板载端口，请跳过部分 <block ref="574c49ad3466f1bed21aff7050a30e36" category="inline-xref-macro-rx"></block> 并返回到 _Install and boot node3_ 部分，然后在继续 <block ref="279060155dcadaa13689560d46e381cb" category="inline-link-macro-rx"></block>。</block>
  <block id="d190fd34bae28aff670090c55eb7e24b" category="paragraph">如果 node3 具有板载 UTA/UTA2 端口或 UTA/UTA2 卡，则必须检查这些端口的配置，并可能对其进行重新配置，具体取决于您希望如何使用升级后的系统。</block>
  <block id="7cda71007d207ef48448dffed511abb8" category="paragraph">如果要对 FC 使用统一目标适配器（ UTA/UTA2 ）端口，则必须先验证此端口的配置方式。</block>
  <block id="55e55fd6d28dec627ac074963cbf9279" category="paragraph">您可以使用 `ucadmin show` 命令验证当前端口配置：</block>
  <block id="b91d8d8d49f32c190d000475eaaf1a99" category="paragraph">UTA/UTA2 端口可以配置为原生 FC 模式或 UTA/UTA2 模式。FC 模式支持 FC 启动程序和 FC 目标； UTA/UTA2 模式允许并发 NIC 和 FCoE 流量共享相同的 10 GbE SFP+ 接口并支持 FC 目标。</block>
  <block id="7561dbd16073c82eda6418543cdd93ec" category="paragraph">UTA/UTA2 端口可能位于适配器或控制器上，并且具有以下配置，但您应检查 node3 上的 UTA/UTA2 端口的配置，并根据需要进行更改：</block>
  <block id="7107b4a109094877db55716e76bb317a" category="list-text">订购控制器时订购的 UTA/UTA2 卡会在发货前配置为具有您请求的个性化设置。</block>
  <block id="ac077d6a8af47d3f6459bdc75d20144c" category="list-text">新控制器上的板载 UTA/UTA2 端口会在发货前配置为具有您请求的个性化设置。</block>
  <block id="1acb31a5b3534092750f6ee560e0995c" category="admonition">* 注意 * ：如果您的系统具有存储磁盘，除非指示您进入维护模式，否则您可以在集群提示符处输入本节中的命令。如果您使用的是 V 系列系统或 FlexArray 虚拟化软件并连接到存储阵列，则可以在维护模式提示符处在此部分中输入命令。要配置 UTA/UTA2 端口，您必须处于维护模式。</block>
  <block id="acb716cb88324392697eb22eddc7c3a3" category="list-text">【第 1 步】在 node3 上输入以下命令，以检查端口当前的配置方式：</block>
  <block id="e8eedad0c370be864050462beebc8141" category="cell">无需执行任何操作。</block>
  <block id="b9372fe4eb2e1f51dc5ecc63ef944026" category="list-text">【第 2 步】如果当前 SFP+ 模块与所需用途不匹配，请将其更换为正确的 SFP+ 模块。</block>
  <block id="cf64c78b7d463ed3f7aa4e4a9d43ca20" category="list-text">`步骤 3]] 查看` ucadmin show 命令的输出，并确定 UTA/UTA2 端口是否具有所需的个性化设置。</block>
  <block id="37ba28d857fa9f472bd54799a71b4d1f" category="list-text">【第 4 步】执行以下操作之一：</block>
  <block id="2c59ff8f0f110684a1947a7be9c33989" category="cell">如果 UTA/UTA2 端口 ...</block>
  <block id="a74e65d44694577cd6490a79583dff8a" category="cell">转至 <block ref="e33bb2c935af60d67309f774bd9b33e2" category="inline-xref-macro-rx"></block>。</block>
  <block id="eb97cddf7fc62845fc1e4eea9c2d99cd" category="cell">跳过步骤 5 到步骤 12 ，然后转到 <block ref="1b9dfae277e309ab4a6eabe371e415ad" category="inline-xref-macro-rx"></block>。</block>
  <block id="c38c7f4981b1e1041fde50ff14eac24d" category="list-text">【 auto_check3_step5]] 执行以下操作之一：</block>
  <block id="19971734faa0d5692ce82090e92c08e4" category="cell">转至 <block ref="8636550629e708c32b80412fc9a4bd9f" category="inline-xref-macro-rx"></block></block>
  <block id="23cdc9078cbdc89882a254d05d67d976" category="cell">跳过第 7 步，转到 <block ref="c9ad15d95077080d869d1e4c8360803a" category="inline-xref-macro-rx"></block>。</block>
  <block id="da0cddf6f2fcc9355331e1d32bd6c782" category="list-text">【第 6 步】如果适配器处于启动程序模式，并且 UTA/UTA2 端口处于联机状态，请使 UTA/UTA2 端口脱机：</block>
  <block id="8538924568e2fc8f0f2a3823de803c1a" category="list-text">【 auto_check3_step7]] 如果当前配置与所需用途不匹配，请根据需要更改配置：</block>
  <block id="68393ca2b7b9884fdd9f7eea661220e1" category="list-text">` -m` 是特性模式， `fc` 或 `CNA` 。</block>
  <block id="47677c5f320a3d7c211f1c3bf5ad457b" category="list-text">【 auto_check3_step8]] 验证设置：</block>
  <block id="315e31e9f839439e107a11b7ff7facb6" category="list-text">【第 9 步】验证设置：</block>
  <block id="b72b45050e36429103ef8a4d16d411be" category="list-text">【第 10 步】输入以下命令之一，使所有目标端口联机，每个端口输入一次：</block>
  <block id="b479e4a9e97e157251ef3d2064ea4380" category="list-text">【第 11 步】为端口布线。</block>
  <block id="3f9068a407bdbb378e93f4d5d6b9abe6" category="list-text">[[auto_check3_step12]] 执行以下操作之一：</block>
  <block id="66610f6c17cdd2f74ae18935d0791243" category="cell">转至 <block ref="35ed01fca1dde6c35ca197b89d2bbfc7" category="inline-link-macro-rx"></block>。</block>
  <block id="f0d8df7e74601e48e696d4b303665234" category="cell">返回到 _Install and boot node3_ 部分，然后继续执行 <block ref="279060155dcadaa13689560d46e381cb" category="inline-link-macro-rx"></block>。</block>
  <block id="56b97cceb683f15e6179871d3991edcc" category="list-text">【 auto_check3_step13]] 退出维护模式：</block>
  <block id="0e0a51d5d131ec116dbea50118d432b6" category="list-text">【第 14 步】运行 `boot_ontap menu` 将节点启动到启动菜单。如果要升级到 A800 ，请转至 <block ref="8de8415e5ddf050c51dc9df1ad54385b" category="inline-xref-macro-rx"></block>。</block>
  <block id="8818e56033c79a7d315b502b9d66c4b0" category="list-text">在 node3 上，转到启动菜单并使用 22/7 并选择隐藏选项 `boot_after_controller_replacement` 。在提示符处，输入 node1 将 node1 的磁盘重新分配给 node3 ，如下例所示。</block>
  <block id="78c17ca9081fa3b223c0d18eaf556df4" category="list-text">【第 16 步】如果系统进入重新启动循环并显示消息 `未找到磁盘` ，则表示系统已将 FC 或 UTA/UTA2 端口重置回目标模式，因此无法查看任何磁盘。要解决此问题，请继续 <block ref="cc511b4dbeed99af4a19f83ac3e97f04" category="inline-xref-macro-rx"></block> to <block ref="8dac798a0974640f6cae187a1dbe2d57" category="inline-xref-macro-rx"></block>或转到第节 <block ref="35ed01fca1dde6c35ca197b89d2bbfc7" category="inline-link-macro-rx"></block>。</block>
  <block id="014925696b96cf52282301c416016c05" category="list-text">在自动启动期间按 `Ctrl-C` 在 `LOADER&gt;` 提示符处停止节点。</block>
  <block id="46f0d1accd1916f786a903c85ad13b0f" category="list-text">在 LOADER 提示符处，进入维护模式：</block>
  <block id="8e26679b9fca64c8419387ed5ddbd066" category="list-text">在维护模式下，显示先前设置的所有启动程序端口，这些端口现在均处于目标模式：</block>
  <block id="4306b082c2e67956b1918aaea01dbeec" category="list-text">【第 20 步】验证端口是否已更改为启动程序模式：</block>
  <block id="4c830d7f040ff17fe7d01c1e6f446b3f" category="list-text">【第 21 步】退出维护模式：</block>
  <block id="9ac7575b190440f1f2d6fa8d83610ea2" category="list-text">在 LOADER 提示符处启动：</block>
  <block id="eed6529f7dcdfb878ddd910a0f3cb526" category="list-text">【 ｛ auto_check3_step23]] 如果要从具有外部磁盘的系统升级到支持内部和外部磁盘的系统（例如， AFF A800 系统），请将 node1 聚合设置为根聚合，以确保 node3 从 node1 的根聚合启动。要设置根聚合，请转到启动菜单并选择选项 `5` 以进入维护模式。</block>
  <block id="2d74e383435cfe64554575d0ab7faf2a" category="paragraph">以下操作步骤会将 node3 设置为从 node1 的根聚合启动：</block>
  <block id="d354d3c68fd2aba01b58a01642bf6c97" category="list-text">检查 node1 聚合的 RAID ，丛和校验和信息：</block>
  <block id="5447152461820ee4fbd4988f18add272" category="list-text">检查 node1 聚合的状态：</block>
  <block id="beee7076b2d8936ef1f0677a931d72f4" category="list-text">如有必要，将 node1 聚合置于联机状态：</block>
  <block id="83b7dae21419642dd5e031d6fa6f2690" category="paragraph">`aggr_online root_aggr_from_&lt;node1&gt;`</block>
  <block id="59bfd9205852a4f57899d2ed024d5fcf" category="list-text">阻止 node3 从其原始根聚合启动：</block>
  <block id="1d9aa029b391cb266140104de06a9144" category="paragraph">`aggr offline &lt;root_aggr_on_node3&gt;`</block>
  <block id="7dd49fac37eb0c12415d30414f193060" category="list-text">将 node1 根聚合设置为 node3 的新根聚合：</block>
  <block id="f447db02ef1a999852a59545c4a25c75" category="paragraph">`aggr options aggr_from_&lt;node1&gt; root`</block>
  <block id="d788db47fa7ed7d234dcdfbb86c17a57" category="list-text">验证 node3 的根聚合是否脱机，从 node1 接管的磁盘的根聚合是否联机并设置为 root ：</block>
  <block id="3d7f94ab24ae28ffe95b85995cdb0a28" category="admonition">如果不执行上一个子步骤，发生原因 node3 可能会从内部根聚合启动，或者它可能会发生原因系统以假定存在新的集群配置或提示您确定一个集群配置。</block>
  <block id="91536c39913bd45a62884969813bb360" category="summary">在将 node2 替换为 node4 之前，必须将 node2 所拥有的非根聚合重新定位到 node3 。</block>
  <block id="43ccb3503988f16a767b1af1e29d2384" category="doc">将非根聚合和 NAS 数据 LIF 从 node2 重新定位到 node3</block>
  <block id="b3fb9233a2435df292df205ef05e46db" category="paragraph">在升级操作步骤期间，远程 LIF 处理 SAN LUN 的流量。升级期间，集群或服务运行状况无需移动 SAN LIF 。</block>
  <block id="0569dcac35411678d2e9cbd8034fea69" category="admonition">不会修改聚合和 LIF 的主所有者；只会修改当前所有者。</block>
  <block id="03c6c2c179dec70c786bc644e02b16df" category="list-text">验证所有非根聚合是否均已联机及其在 node3 上的状态：</block>
  <block id="7edece7677f8bef06093b6be08879c67" category="paragraph">`storage aggregate show -node node3 -state online -root false`</block>
  <block id="6702bf0268c295c6d30a4dc2db82d427" category="paragraph">如果 node3 上的聚合脱机或变为外部聚合，请在 node3 上使用以下命令将其联机，每个聚合一次：</block>
  <block id="809bea68dee4e68249aea4396bafacd3" category="list-text">在 node3 上使用以下命令并检查输出，以验证 node3 上的所有卷是否联机：</block>
  <block id="b830851aa263bbc0b84c68604beef993" category="paragraph">如果 node3 上的任何卷脱机，请在 node3 上使用以下命令将其联机，每个卷一次：</block>
  <block id="b8520ff69f6b8ffe5e588c1f7ce8e9be" category="list-text">验证 LIF 是否已移至正确的端口且状态为 `up` 。如果任何 LIF 已关闭，请为每个 LIF 输入以下命令，将 LIF 的管理状态设置为 `up` ：</block>
  <block id="e2172c82191a506ba37c37e48f854d2a" category="list-text">如果新硬件上不存在当前托管数据 LIF 的端口，请将其从广播域中删除：</block>
  <block id="ee210a0730802d9c055ca601e95c499c" category="paragraph">`network port broadcast-domain remove-ports`</block>
  <block id="99988efb9efcf982f67af1157e609379" category="list-text">【第 5 步】输入以下命令并检查输出，验证 node2 上是否没有剩余数据 LIF ：</block>
  <block id="39711e914bc528c59b5d5e3ec8e9bee0" category="paragraph">`network interface show - curr-node &lt;node2&gt;-role data`</block>
  <block id="48ce4ace02a7e66e4a302eb34827e7ee" category="paragraph">如果使用 NetApp 卷加密（ NVE ）对要升级的系统上的卷进行加密，则加密配置必须与新节点同步。从 node2 到 node4 的 node1 聚合的 ARL 完成后，加密卷将脱机。</block>
  <block id="73df6067ad433973d674881dda3dc967" category="summary">在第 6 阶段，确认新节点设置正确。</block>
  <block id="d48dfd29ad21ccd1c5cfa50ed99cd89e" category="doc">第 6 阶段。完成升级</block>
  <block id="1a477554c550b034a245bf89c3141577" category="paragraph">在第 6 阶段，确保正确设置了新节点。如果其中一个新节点具有统一目标适配器，则必须还原任何端口配置，并且可能需要更改适配器的个性化设置。如果新节点已启用加密，则还应设置存储加密。您还应停用旧节点。</block>
  <block id="35fac5692bb8027b74e3ca19683197b2" category="list-text"><block ref="35fac5692bb8027b74e3ca19683197b2" category="inline-link-macro-rx"></block></block>
  <block id="18c90c300c0b71334b8b427eaf4f38a3" category="list-text"><block ref="18c90c300c0b71334b8b427eaf4f38a3" category="inline-link-macro-rx"></block></block>
  <block id="6b08bad770533079b309e535c68e1cad" category="inline-link-macro">在新控制器模块上设置 NetApp 加密</block>
  <block id="bb524fabb33a00fa255aa2c87d91271e" category="list-text"><block ref="bb524fabb33a00fa255aa2c87d91271e" category="inline-link-macro-rx"></block></block>
  <block id="6e48b929ca0767f00c15eeb6d7e78755" category="list-text"><block ref="6e48b929ca0767f00c15eeb6d7e78755" category="inline-link-macro-rx"></block></block>
  <block id="140c4ad72e426b76f7e15699ae078635" category="inline-link-macro">恢复 SnapMirror 操作</block>
  <block id="4486de9c48a88e42de77cb0ec9f11818" category="list-text"><block ref="4486de9c48a88e42de77cb0ec9f11818" category="inline-link-macro-rx"></block></block>
  <block id="6458e4ec3f015720c168a55e444bc050" category="paragraph">对于 MetroCluster FC 配置，您必须尽快更换灾难恢复 / 故障转移站点节点。不支持 MetroCluster 中的控制器型号不匹配，因为控制器型号不匹配会使发生原因灾难恢复镜像脱机。在更换第二个站点的节点时，使用命令 `skip-metrocluster-check true` 选项绕过 MetroCluster 检查。</block>
  <block id="ec91f2dd66cb691d783fba58df9e214d" category="summary">升级节点对时可能会遇到故障。</block>
  <block id="9fd68cc494a9f57cae67ac737ab1370f" category="paragraph">升级节点对时可能会遇到故障。节点可能会崩溃，聚合可能无法重新定位或 LIF 可能无法迁移。故障的发生原因及其解决方案取决于升级操作步骤期间发生故障的时间。</block>
  <block id="148cb01915f73b429fb4402cc046fed1" category="paragraph">请参见一节中描述操作步骤不同阶段的表 <block ref="57e14e08755134bb6fef9ad899bb58ee" category="inline-link-macro-rx"></block>。有关可能发生的故障的信息按操作步骤的阶段列出。</block>
  <block id="29b9e15ece46f3444e3509682e2aee9f" category="summary">在操作步骤中物理装入 node3 和 node4 后，您可能需要通过网络启动它们。</block>
  <block id="8e79407ae69e201e60bebb326433371d" category="paragraph">在操作步骤中物理装入 node3 和 node4 后，您可能需要通过网络启动它们。术语 netboot 表示从远程服务器上存储的 ONTAP 映像启动。在准备网络启动时，您必须将 ONTAP 9 启动映像的副本放在系统可以访问的 Web 服务器上。</block>
  <block id="135b308ed83c53f1516b7c754566d1c4" category="list-title">开始之前</block>
  <block id="1d32dacc20fe1feb077659fd0bebdc03" category="list-text">确认您可以使用系统访问 HTTP 服务器。</block>
  <block id="3f8c328bf258e454068314be8aac5d75" category="list-text">请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _NetApp 支持站点 _ 并下载适用于您的平台和正确版本的 ONTAP 的必要系统文件。</block>
  <block id="48ab14af4b0090253431ed38e4cc2440" category="paragraph">如果新控制器上安装的 ONTAP 9 版本与原始控制器上安装的版本不同，则必须通过网络启动这些控制器。安装每个新控制器后，您可以从 Web 服务器上存储的 ONTAP 9 映像启动系统。然后，您可以将正确的文件下载到启动介质设备，以供后续系统启动。</block>
  <block id="302937ad7234fe283f1f179989cd1fe0" category="list-text">访问 NetApp 支持站点以下载用于执行系统网络启动的文件。</block>
  <block id="103ec41a89beb368e3357fad5f451a92" category="list-text">从 NetApp 支持站点的软件下载部分下载相应的 ONTAP 软件，并将 ` &lt;ontap_version&gt;_image.tgz` 文件存储在可通过 Web 访问的目录中。</block>
  <block id="5b1b8c3f072422a936e63f0d977e41e0" category="list-text">切换到可通过 Web 访问的目录，并验证所需文件是否可用。</block>
  <block id="5b1c9d774c9bf09143fc1c27a13dd88a" category="cell">将 ` &lt;ontap_version&gt;_image.tgz` 文件的内容解压缩到目标目录： `tar -zxvf &lt;ontap_version&gt;_image.tgz` * 注：如果要在 Windows 上提取内容，请使用 7-Zip 或 WinRAR 提取网络启动映像。您的目录列表应包含一个包含内核文件的 netboot 文件夹： `netboot/kernel`</block>
  <block id="a33229dc61132501eadfb2966e5b2d9f" category="cell">您的目录列表应包含以下文件： ` &lt;ontap_version&gt;_image.tgz` * 注释 * ：您不需要提取 ` &lt;ontap_version&gt;_image.tgz` 文件的内容。</block>
  <block id="843ab277685630f82095416c5b9ae5a1" category="inline-link-macro">第 3 阶段</block>
  <block id="c7b2f3e7dacd4ee5eb9b0618c5079d8f" category="paragraph">您将使用中目录中的信息 <block ref="1f9dd4a8865e8664f884ec11b5f13dfc" category="inline-link-macro-rx"></block>。</block>
  <block id="8e698b8d4467a7a6309118b19a3aa168" category="summary">要安装新硬件，您必须使用特定工具，并且在升级过程中需要参考其他文档。</block>
  <block id="0e635d7a91ccc4eccdfb03e35353c899" category="doc">所需的工具和文档</block>
  <block id="f987ca44be5e66313a3fedb59305367d" category="paragraph">要执行升级，您需要使用以下工具：</block>
  <block id="5fa8c0eb2f030795135e9d47077f239b" category="list-text">接地线</block>
  <block id="230a7914d7f06a8506c29d7466cb12cd" category="list-text">2 号十字螺丝刀</block>
  <block id="9bd7aca153821e782b62a5a9a23f4744" category="paragraph">转至 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 部分，以访问此升级所需的参考文档列表。</block>
  <block id="c39ea8ae7ab96639c1566b21005a53e1" category="summary">您可以使用 NetApp 支持站点上提供的 Config Advisor 工具。</block>
  <block id="f1b92e8f33cf66355b4b9762bf95256b" category="doc">检查 MetroCluster 配置错误</block>
  <block id="fcae50d4511c2dbf452f0a9593984560" category="paragraph">您可以使用 NetApp 支持站点上提供的 Active IQ Config Advisor 工具检查常见配置错误。</block>
  <block id="fa6c1be97ff8496ff36915e5e9a95f33" category="paragraph">Active IQ Config Advisor 是一款配置验证和运行状况检查工具。您可以将其部署在安全站点和非安全站点上，以便进行数据收集和系统分析。</block>
  <block id="0109999bfef624f78c3dcf4fb94f11ba" category="admonition">对 Config Advisor 的支持是有限的，并且只能联机使用。</block>
  <block id="32a404f0f31163f59d88f2d052711ecf" category="list-text">下载 <block ref="02685666481d8fcfc63d60bb8f2d7352" category="inline-link-macro-rx"></block> 工具。</block>
  <block id="6afe954858ef53a16278f4735833c1a5" category="list-text">运行 Active IQ Config Advisor ，查看输出并按照其建议解决任何问题。</block>
  <block id="7cb7e7951b479387ad32001aab9f53b2" category="summary">系统可能发生崩溃—重新启动，崩溃或重新启动。</block>
  <block id="d75bd21e9af20a5036c0fbf461bc4e2d" category="doc">重新启动，崩溃或重新启动</block>
  <block id="446d36fba2e507d61203c02578774ece" category="paragraph">在升级的不同阶段，系统可能会崩溃—重新启动，崩溃或重新启动。</block>
  <block id="dec0e91cad029c9d2b55e8bd32c88e76" category="paragraph">这些问题的解决方案取决于它们发生的时间。</block>
  <block id="343eae749a23fb17ef6cdd38fd2da8f5" category="section-title">在预检查阶段重新启动，崩溃或重新启动</block>
  <block id="8bea04524c5e6dcfb6d21a849345ee30" category="section-title">在 HA 对的预检查阶段仍处于启用状态之前，节点 1 或节点 2 崩溃</block>
  <block id="738ee8bcfd939a32f3de7df5814c6eba" category="paragraph">如果 node1 或 node2 在预检查阶段之前崩溃，则尚未重新定位任何聚合，并且 HA 对配置仍处于启用状态。</block>
  <block id="0dd6e0ba50acfc16218ced7b92e813f1" category="paragraph">接管和交还可以正常进行。</block>
  <block id="809ecf0f76cd48f719608b879e540f19" category="list-text">检查控制台是否存在系统可能已发出的 EMS 消息，并采取建议的更正操作。</block>
  <block id="0accdb9af8ee9902e6e12e8ad3c69dd6" category="list-text">继续执行节点对升级操作步骤。</block>
  <block id="32042e1cae255d52d27eb7e6f102079f" category="section-title">在第一个资源释放阶段重新启动，崩溃或重新启动</block>
  <block id="a929dc8c44e0a4c66070b18005fcda69" category="section-title">在 HA 对仍处于启用状态的情况下，节点 1 在第一个资源释放阶段崩溃</block>
  <block id="17b207ac883ad6c7c60e4c67b540500b" category="paragraph">部分或所有聚合已从 node1 重新定位到 node2 ，并且 HA 对仍处于启用状态。node2 接管 node1 的根卷以及未重新定位的任何非根聚合。</block>
  <block id="658aff35f1b2ef5bf804a6eaa8bd8834" category="paragraph">重新定位的聚合的所有权与因主所有者未发生更改而被接管的非根聚合的所有权相同。</block>
  <block id="6ccd7f2e78c66d169bbf302fa0cd170e" category="paragraph">当 node1 进入 `Waiting for giveback` 状态时， node2 将交还所有 node1 非根聚合。</block>
  <block id="207f28a21e318ac4aaec8c44877876fa" category="list-text">启动 node1 后， node1 的所有非根聚合均已移回 node1 。您必须手动将聚合从 node1 重新定位到 node2 ： `storage aggregate relocation start -node node1 -destination node2 -aggregate-list * - ndocontroller-upgrade true`</block>
  <block id="db2e31afa00c26dc29029e29d8ff4e9f" category="section-title">在禁用 HA 对的情况下， Node1 在第一个资源释放阶段崩溃</block>
  <block id="a3ab092ff29c94a2c1dce4e8e58fbab8" category="paragraph">Node2 不会接管，但它仍在从所有非根聚合提供数据。</block>
  <block id="84604a4d07dcc33bcf3def32522ced97" category="list-text">启动 node1 。</block>
  <block id="07fcb95304f9b9b6a7b8e09bf3a43b90" category="section-title">在 HA 对仍处于启用状态的情况下，节点 2 在第一个资源释放阶段失败</block>
  <block id="ea41d430c1801092eb658fc92447fa77" category="paragraph">node1 已将其部分或全部聚合重新定位到 node2 。已启用 HA 对。</block>
  <block id="4ef90a16749941dcc42841a4d350f4e3" category="paragraph">node1 接管 node2 的所有聚合以及它已重新定位到 node2 的任何自身聚合。node2 启动时，聚合重新定位将自动完成。</block>
  <block id="f377056f049a875748f0f1fb62e593b9" category="list-text">启动 node2 。</block>
  <block id="a84419db35cfbd1052a6e3367b3e6550" category="section-title">在第一个资源释放阶段以及禁用 HA 对之后， Node2 会崩溃</block>
  <block id="3902e7586591847461eb93ec52677583" category="paragraph">Node1 不接管。</block>
  <block id="209379c90008402bff9e43e926d726f5" category="paragraph">在 node2 启动期间，所有聚合都会发生客户端中断。</block>
  <block id="c69c252a29e4c40de646b133d6b89286" category="section-title">在第一个验证阶段重新启动，崩溃或重新启动</block>
  <block id="eee0c63ddb8a9ee96da6fcbaee95750f" category="section-title">在禁用 HA 对的情况下，节点 2 在第一个验证阶段崩溃</block>
  <block id="3acacc48f49902e35f2acd0532846558" category="paragraph">Node2 崩溃后 Node3 不会接管，因为 HA 对已禁用。</block>
  <block id="4d671d2255fc765ecb0c9754a61e9e19" category="section-title">在禁用 HA 对的情况下，节点 3 在第一个验证阶段崩溃</block>
  <block id="26bf9df43caced35a52d77376336d969" category="list-text">启动 node3 。</block>
  <block id="b37a13b468d5049d51c1794bdee782ea" category="section-title">在第一个资源重新获取阶段重新启动，崩溃或重新启动</block>
  <block id="cdf0fa097138599db352e67f83f4d60e" category="section-title">在聚合重新定位期间，节点 2 在第一个资源重新获取阶段崩溃</block>
  <block id="e15376fba96131cecfad3a743435774e" category="paragraph">node2 已将其部分或全部聚合从 node1 重新定位到 node3 。node3 用于从已重新定位的聚合提供数据。HA 对已禁用，因此不存在接管。</block>
  <block id="27685d530ae8434b4b7c343805519a62" category="paragraph">未重新定位的聚合发生客户端中断。启动 node2 时， node1 的聚合将重新定位到 node3 。</block>
  <block id="afac1d41da19c91d8c537c0dd081b509" category="section-title">在聚合重新定位期间，节点 3 在第一个资源重新获取阶段崩溃</block>
  <block id="4309a6885186e1d672df942c1ef7364c" category="paragraph">如果在 node2 将聚合重新定位到 node3 时 node3 崩溃，则在 node3 启动后，此任务将继续执行。</block>
  <block id="c5689b790d4c37b77d1d9d0b5eb653e8" category="paragraph">Node2 将继续为其余聚合提供服务，但已重新定位到 Node3 的聚合会在 Node3 启动期间发生客户端中断。</block>
  <block id="c3ed2d002fa1511e957ac4f0f379ab64" category="list-text">继续升级控制器。</block>
  <block id="c99650cbb2e9705200e0c65ef8112d66" category="section-title">在检查后阶段重新启动，崩溃或重新启动</block>
  <block id="cd64011aa9e337fac4267ca724c07c1a" category="section-title">在后检查阶段，节点 2 或节点 3 崩溃</block>
  <block id="6cc3572daebdd8b0893f33d359db3778" category="paragraph">HA 对已禁用，因此不是接管。重新启动的节点中的聚合发生客户端中断。</block>
  <block id="79671f1c69add8723a6562ea9207f36a" category="list-text">启动节点。</block>
  <block id="453e1c1e18302a590c41d9e178962389" category="section-title">在第二个资源释放阶段重新启动，崩溃或重新启动</block>
  <block id="48824f490a3d91487cefde6c844f77c8" category="section-title">Node3 在第二个资源释放阶段崩溃</block>
  <block id="6fdf83c70d5ac6354046a77aed7edf87" category="paragraph">如果 node2 重新定位聚合时 node3 崩溃，则在 node3 启动后，此任务将继续执行。</block>
  <block id="5731c7830057407975be490c2494fb1f" category="paragraph">Node2 继续为其余聚合提供服务，但已重新定位到 Node3 和 Node3 自己的聚合的聚合在 Node3 启动期间会发生客户端中断。</block>
  <block id="c025602fb85c6101c2c2b73f3aee8c22" category="list-text">继续执行控制器升级操作步骤。</block>
  <block id="98b7194c3f7e4d897e4fd26d695e1854" category="section-title">Node2 在第二个资源释放阶段崩溃</block>
  <block id="5824934e067c33bb3114baa4a8cf9ec5" category="paragraph">如果节点 2 在聚合重新定位期间崩溃，则不会接管节点 2 。</block>
  <block id="8e080faf36569e4b034dc52f5a78a0c9" category="paragraph">node3 将继续为已重新定位的聚合提供服务，但 node2 拥有的聚合会发生客户端中断。</block>
  <block id="7ece8f4248b2db8509ecfad31259ec79" category="section-title">在第二个验证阶段重新启动，崩溃或重新启动</block>
  <block id="844787e278f2aed416a608ecf8da2f42" category="section-title">Node3 在第二个验证阶段崩溃</block>
  <block id="78d45d4102c6b7fa82c29a7ee6d3feac" category="paragraph">如果节点 3 在此阶段崩溃，则不会发生接管，因为 HA 对已禁用。</block>
  <block id="9776e59ce7d904cfd8633f152b0e9840" category="paragraph">在 node3 重新启动之前，所有聚合都会发生客户端中断。</block>
  <block id="0e9646babd06b1afc68db209c8b7e8cc" category="section-title">Node4 在第二个验证阶段崩溃</block>
  <block id="06581dc290bb90ebdc3bff784e74c05b" category="paragraph">如果节点 4 在此阶段崩溃，则不会发生接管。node3 从聚合提供数据。</block>
  <block id="320ac33a3a3ed82ed96ef3dd7d173ed9" category="paragraph">非根聚合发生中断，这些聚合已重新定位，直到 node4 重新启动。</block>
  <block id="d2dec120c917320cae7461e84d91f23c" category="list-text">启动 node4 。</block>
  <block id="1997edef0e8dc4dfe6a4e9bb54326b4c" category="summary">在控制器升级期间，此控制器将更换为另一个控制器。</block>
  <block id="d345c906575e21a898123708bebd7b5c" category="doc">自动执行控制器升级过程</block>
  <block id="d88ce1078b12ccecbaaa871291ee2c05" category="paragraph">手动过程耗时冗长且复杂，但在此简化的操作步骤中，您可以通过聚合重新定位来实施控制器更新，从而为 HA 对实现更高效的无中断升级。手动步骤明显减少，尤其是在验证，收集信息和 POST 检查方面。</block>
  <block id="2d5a70198b86012f50adf28d146a05be" category="summary">在阶段 4 中，所有非根聚合都会从 node2 重新定位到 node3 。</block>
  <block id="7bc7e56fe8ddd27289de0794179c5451" category="doc">第 4 阶段。重新定位和停用节点 2</block>
  <block id="d4d422ac28594b1bddb2c593ae821f17" category="paragraph">在阶段 4 中，所有非根聚合将从 node2 重新定位到 node3 ； node2 拥有的非 SAN 数据 LIF 将移至 node3 。您必须记录必要的 node2 信息，然后停用 node2 。</block>
  <block id="f7f70c2c98be066b2a9d668ac7d63467" category="list-text"><block ref="f7f70c2c98be066b2a9d668ac7d63467" category="inline-link-macro-rx"></block></block>
  <block id="610cb2d6e87c5e838ceef8f48f57b082" category="list-text"><block ref="610cb2d6e87c5e838ceef8f48f57b082" category="inline-link-macro-rx"></block></block>
  <block id="0dcbb9ad75076c111ef077218e8532c1" category="summary">在使用 ARL 升级节点之前，您应了解操作步骤的工作原理。</block>
  <block id="ddfd90d1a40dc38efcde3d45c070506d" category="paragraph">在使用 ARL 升级节点之前，您应了解操作步骤的工作原理。在本文档中，操作步骤分为多个阶段。</block>
  <block id="7526cf9eecac88850b8e7b400f897378" category="paragraph">在操作步骤期间，您可以使用替代控制器硬件升级原始控制器硬件，一次升级一个控制器，从而利用 HA 对配置重新定位非根聚合的所有权。所有非根聚合都必须进行两次重新定位，才能到达其最终目标，即正确的升级节点。</block>
  <block id="dbbdd31aeee0756ad9d276a1eca618f8" category="paragraph">每个聚合都有一个主所有者和当前所有者。主所有者是聚合的实际所有者，当前所有者是临时所有者。</block>
  <block id="6a8b18850ca6073a1c6456cd619cdba6" category="paragraph">下表介绍了您在每个阶段执行的高级任务以及此阶段结束时的聚合所有权状态。操作步骤稍后将提供详细步骤：</block>
  <block id="64c6da2436465d11573858d46056b95d" category="cell">阶段</block>
  <block id="707253335c75396f2f03f01d02cd611a" category="list-text">运行预检以验证是否可以执行此操作。</block>
  <block id="f03174f8fd409d7574b9f2016f96604d" category="list-text">如果预检失败，请更正聚合所有权。</block>
  <block id="0edc7061270b8cba6c4b291d98e9b404" category="list-text">输入集群基础许可证密钥。</block>
  <block id="dfeec1b537b43dc0ea5606e832f48af2" category="list-text">获取用于存储加密的 IP 地址。</block>
  <block id="58119f526d64656dd48685b7def3abf2" category="list-text">使用 KMIP 服务器管理身份验证。</block>
  <block id="5c43723af4fc43b85ff273259b771bc0" category="list-text">使用板载密钥管理器（ OKM ）管理存储加密。</block>
  <block id="c8e64b81bcc97d8861a9f55fcb0ae9e6" category="list-text">暂停 SnapMirror 关系（可选）。</block>
  <block id="9b7c5fc0588fe7d63e81b1258a1b7a71" category="paragraph">阶段 1 结束时的聚合所有权：</block>
  <block id="b309c38149cc0e7b5e0bdcbbb02d7372" category="list-text">node1 是 node1 聚合的主所有者和当前所有者。</block>
  <block id="c9441f483586640407720ae97b71e4aa" category="list-text">node2 是 node2 聚合的主所有者和当前所有者。</block>
  <block id="248ca24967f7bb9be3cc045e68b6dabe" category="list-text">将非根聚合从 node1 重新定位到 node2 。</block>
  <block id="fe43f44a817b4a8a1c1b0fbab66f1668" category="list-text">将节点 1 拥有的非 SAN 数据 LIF 重新定位到节点 2 。</block>
  <block id="f6eec92be77ff6719e538b7c51a97f55" category="list-text">重新定位失败或被否决的聚合。</block>
  <block id="faaafe46b0a9b962f0146097c9e28518" category="list-text">停用 node1 。</block>
  <block id="023ab2fff87c666eab071e675efdacaf" category="list-text">准备网络启动（可选）。</block>
  <block id="7544a9f5c9c9ff572c11f753aae7dedf" category="paragraph">阶段 2 结束时的聚合所有权：</block>
  <block id="80056829ceb7237c21b4536a01885e13" category="list-text">node2 是 node1 聚合的当前所有者。</block>
  <block id="f6e6ad572d16caa52deed3eeb7ca0ff5" category="list-text">node2 是 node2 聚合的主所有者和当前所有者。</block>
  <block id="2ecf50ce071750046e33889f76b4ddf1" category="list-text">安装并启动 node3 。</block>
  <block id="19fa01b5e1d74520ad0be1fb6bf1fc09" category="list-text">设置 FC 或（融合网络适配器） CNA 配置。</block>
  <block id="95b4c137787b29e51c74b71475d203dd" category="list-text">配置 FC 端口。</block>
  <block id="b9dd5a9a2b21507e0342ef620ec6824d" category="list-text">检查并配置 UTA/UTA2 端口。</block>
  <block id="8de9e3207ca31bee139241ad4fc0650f" category="list-text">验证 node3 是否已成功安装。</block>
  <block id="e60e41c512cd3f2ad332e91763d4d2a5" category="list-text">还原 node3 网络配置。</block>
  <block id="6b01c45aa39022f8fcfff3f90434c89c" category="list-text">将节点 1 下的非 SAN 数据 LIF 从 node2 移动到 node3 。</block>
  <block id="fd37436f77e7bb0f803c1afad985d422" category="list-text">将 node1 拥有的非根聚合从 node2 重新定位到 node3 。</block>
  <block id="ff8f4c5aae9f0216fa1c088e4c636ab0" category="paragraph">第 3 阶段结束时的聚合所有权：</block>
  <block id="d58c33bf48643b15350ce1c80bb474d8" category="list-text">node3 是 node1 聚合的主所有者和当前所有者。</block>
  <block id="04bf2293479cb8cadbf0c59e985f585e" category="list-text">将非根聚合从 node2 重新定位到 node3 。</block>
  <block id="6ab2fb4ca5571833687af9b24c03405b" category="list-text">将节点 2 拥有的非 SAN 数据 LIF 重新定位到节点 3 。</block>
  <block id="8f4919c4d65b1afa5ab9c7d7757a53af" category="list-text">停用 node2 。</block>
  <block id="d517ee6c427837d3874a695e344df510" category="paragraph">第 4 阶段结束时的聚合所有权：</block>
  <block id="312d1c4e0e8f2ca55c86dd955ac42bff" category="list-text">node3 是最初属于 node1 的聚合的主所有者和当前所有者。</block>
  <block id="6ccf9360cf25c371211dcaee52075b0c" category="list-text">node2 是 node2 聚合的主所有者。</block>
  <block id="7c9dc4aa3c862a50866dfa4bf1cad537" category="list-text">node3 是 node2 聚合的当前所有者。</block>
  <block id="f709cec4fcbf35e8bd7dc6e974d17d00" category="list-text">安装并启动节点 4.</block>
  <block id="c62822fe3e3275534a8fb949d6c66e6c" category="list-text">在 node4 上设置 FC 或 CNA 配置。</block>
  <block id="57bf5699914e63878247f19a25930b05" category="list-text">验证 node4 是否已成功安装。</block>
  <block id="1ed5ba60b18e0aad565c48c7e13368fc" category="list-text">还原 node4 网络配置</block>
  <block id="2c9672ea46aeb54c5860dc07332bc88b" category="list-text">将 node2 拥有的非 SAN 数据 LIF 从 node3 重新定位到 node4 ，并验证 node4 上的 SAN LIF 。</block>
  <block id="ae88ee721c31093785205944b85aa4ee" category="paragraph">第 5 阶段结束时的聚合所有权：</block>
  <block id="478c619523c38faa7066d2d25b446a3d" category="list-text">node3 是最初属于 node1 的聚合的主所有者和当前所有者。</block>
  <block id="c2583ec3499fda8ccfebbd517d0af4e6" category="list-text">Node4 是最初属于 Node2 的聚合的主所有者和当前所有者。</block>
  <block id="b112f13cf4b353be9d52a7a0591716fd" category="list-text">确认系统设置正确。</block>
  <block id="6849ebd666f25feda5374c9954336e52" category="list-text">在新控制器模块上设置存储加密。</block>
  <block id="f6575cd6c144b0fafc0a4706e44b7184" category="list-text">停用旧系统。</block>
  <block id="01f95e082b71c8b8f530696c5c1e79f6" category="list-text">根据需要恢复 NetApp SnapMirror 操作。</block>
  <block id="964b0454175f6a1894f796b6a8fc4f59" category="summary">某些问题可能会在操作步骤的不同阶段发生。</block>
  <block id="e33c48b52ab7d302b4af41aca3bbe858" category="doc">操作步骤的多个阶段可能会出现的问题</block>
  <block id="84508423fbb2d015c45d8207837aede4" category="section-title">意外的 "storage failover show" 命令输出</block>
  <block id="9fae6006c452841a1b4104d26127eccf" category="paragraph">在操作步骤期间，如果托管所有数据聚合的节点发生崩溃或意外重新启动，您可能会在重新启动，崩溃或重新启动前后看到 `storage failover show` 命令的意外输出。</block>
  <block id="8a503ef07edf673987e764eff646e0d0" category="paragraph">您可能会在阶段 2 ，阶段 3 ，阶段 4 或阶段 5 中看到 `storage failover show` 命令的意外输出。</block>
  <block id="4e873fccdf7f54c0486cf43e1300ab3f" category="paragraph">以下示例显示了托管所有数据聚合的节点上没有重新启动或崩溃时 `storage failover show` 命令的预期输出：</block>
  <block id="b19cffa247e3fb2147fa3eb145c4247f" category="paragraph">以下示例显示了重新启动或崩溃后 `storage failover show` 命令的输出：</block>
  <block id="399a9894ac45311024aba0a4f4cd1197" category="paragraph">尽管输出显示某个节点正在进行部分交还，并且已禁用存储故障转移，但您可以忽略此消息。</block>
  <block id="3794e9e48df4b7a93a3321f2477f7880" category="paragraph">无需执行任何操作；请继续执行节点对升级操作步骤。</block>
  <block id="f4b0e9bc470ad2b8ac6c955fe361607e" category="summary">您可以恢复升级前暂停的 SnapMirror 传输，并恢复 SnapMirror 关系。</block>
  <block id="5f561bedca26d8d072e51e5a351d1918" category="paragraph">您可以恢复升级前暂停的 SnapMirror 传输，并恢复 SnapMirror 关系。升级完成后，更新将按计划进行。</block>
  <block id="9d65950930bb25ed46073bd7f01c7392" category="list-text">验证目标上的 SnapMirror 状态：</block>
  <block id="6e29c61f3d7ca15884f613bf76f4ad83" category="list-text">恢复 SnapMirror 关系：</block>
  <block id="52167f27ac641afda13c59903c8be219" category="paragraph">`snapmirror resume -destination – vserver &lt;vserver_name&gt;`</block>
  <block id="eb04decd1d026d2a659ebfb3bc27a9e2" category="summary">验证 node3 安装</block>
  <block id="853a38843b4d12d75ba15c53177a9637" category="paragraph">您必须验证 node1 中的物理端口是否正确映射到 node3 上的物理端口。这样， node3 便可在升级后与集群中的其他节点以及网络进行通信。</block>
  <block id="e81669be921c5bd20d872e337c5b204d" category="paragraph">如果 node1 上的物理端口未直接映射到 node3 上的物理端口，请执行下一节 <block ref="871101a3a410248482eefafa62332b63" category="inline-xref-macro-rx"></block> 必须用于修复网络连接。</block>
  <block id="3e0da2be1046cdf5d552f8adaa98c3ae" category="paragraph">安装并启动 node3 后，您必须验证是否已正确安装它。您必须等待 node3 加入仲裁，然后恢复重新定位操作。</block>
  <block id="60d0d1447a22e8eb1a7dd321b2eec56f" category="paragraph">此时，在操作步骤中，操作将暂停，因为 node3 加入仲裁。</block>
  <block id="264f45c2e8ee62b2a09c06df8f3dea0f" category="list-text">验证 node3 是否已加入仲裁：</block>
  <block id="0f452669c01e49cb27b82dac8c6f9656" category="paragraph">`cluster show -node node3 -fields health`</block>
  <block id="1c39607d3048b34130b8a3c0d2959603" category="list-text">确认 node3 与 node2 属于同一集群，并且运行状况良好：</block>
  <block id="65e2b77d04e539a041041cfc7b7c4d8f" category="list-text">检查控制器更换操作的状态，并验证其是否处于暂停状态，以及是否处于 node1 暂停之前的状态，以便执行安装新控制器和移动缆线的物理任务：</block>
  <block id="7d6da636a56e3278933335b21cca97bc" category="list-text">如果您正在处理 MetroCluster 系统，请验证是否已为 MetroCluster 配置正确配置更换的控制器； MetroCluster 配置应处于运行状况良好的状态。请参见 <block ref="14c0e32a98a31f9fd4a16b635b2f7ebd" category="inline-link-macro-rx"></block>。</block>
  <block id="cc3fae395501f043309fdf0319483db7" category="paragraph">在 MetroCluster 节点 node3 上重新配置集群间 LIF ，并检查集群对等关系以恢复 MetroCluster 节点之间的通信，然后再继续执行步骤 6 。</block>
  <block id="ab20c270d222c6ce93913a4b4444628f" category="list-text">恢复控制器更换操作：</block>
  <block id="4ab15a5901ac29ba8b22502370d01f1b" category="section-title">还原 node3 上的网络配置</block>
  <block id="50aa547709666157235d709c3c40d254" category="paragraph">确认 node3 处于仲裁状态并可与 node2 通信后，请确认 node3 上显示了 node1 的 VLAN ，接口组和广播域。此外，验证是否已在其正确的广播域中配置所有 node3 网络端口。</block>
  <block id="503c8b965e105d62de14a258e8389adc" category="list-text">【第 1 步】列出已升级的 node1 （称为 node3 ）上的所有物理端口：</block>
  <block id="8e80c0200aab07655785cb1bec3cc1b7" category="paragraph">`network port show -node node3`</block>
  <block id="7d18d6d6569ac51a685a80b4877c4f98" category="paragraph">此时将显示节点上的所有物理网络端口， VLAN 端口和接口组端口。在此输出中，您可以看到 ONTAP 已将任何物理端口移至 `集群` 广播域。您可以使用此输出来帮助确定应将哪些端口用作接口组成员端口， VLAN 基本端口或独立物理端口来托管 LIF 。</block>
  <block id="49b3d94638f7775922691a946dbeed08" category="list-text">【第 2 步】列出集群上的广播域：</block>
  <block id="a4780c06a89c299119583f29f32ac093" category="paragraph">您应看到类似于以下示例的输出：</block>
  <block id="e940af53f7d36aaa1ead918494c5c508" category="paragraph">在上面的示例中， node1_node3 是在更换控制器后刚刚启动的。某些端口无法访问其预期广播域，必须进行修复。</block>
  <block id="d640102c0f1d010e832d7ab6c998976d" category="list-text">【 auto_verify_3_step4]] 修复 node3 上每个端口的可访问性状态不是 `ok` 的可访问性。首先对任何物理端口运行以下命令，然后对任何 VLAN 端口运行以下命令，一次运行一个：</block>
  <block id="5b3590915b0de4e44a7e6eecff6a5a24" category="paragraph">您应看到类似于以下示例的输出：</block>
  <block id="926bbd76240f31054ef4744babd679da" category="paragraph">对于可访问性状态可能与当前所在广播域的可访问性状态不同的端口，应显示一条警告消息，如上所示。根据需要查看端口和问题解答 `y` 或 `n` 的连接。</block>
  <block id="475bdd7eeca873ac007d2e8d1ed1d0d7" category="list-text">【第 5 步】如果接口组配置与新控制器物理端口布局不匹配，请使用以下步骤进行修改。</block>
  <block id="a7f60658094ae5cd0040096989b61fd4" category="paragraph">`network port broadcast-domain remove-ports -broadcast-domain &lt;broadcast-domain_name&gt; -ports &lt;node_name ： port_name&gt;`</block>
  <block id="cb5bf72c08bc8139f3d3b440a9e7819b" category="list-text">通过执行以下步骤，将适当的物理端口分配给 `集群` 广播域：</block>
  <block id="c1c14675eda4b09d8745d772c971a760" category="list-text">确定哪些端口可访问 `集群` 广播域：</block>
  <block id="1a385242d9fb60423161c8ec41af6b34" category="list-text">【第 7 步】使用以下命令之一将其余物理端口移动到其正确的广播域中：</block>
  <block id="652d99b8bb896eacc70cc28d4cea6df9" category="list-text">【第 8 步】使用以下步骤还原可能已被替换的任何 VLAN ：</block>
  <block id="25b072f1ccd78f519330142d52dcdabc" category="paragraph">`displaced VLAN show`</block>
  <block id="525a1c0d24b5d4c8e9116b07730aee42" category="paragraph">`displaced VLAN restore`</block>
  <block id="40ce515ca09862da0a063e257c689c4b" category="paragraph">以下示例显示了将已从接口组 a0a 中移出的 VLAN 还原到同一接口组的过程：</block>
  <block id="4f9ba38af17871a0e83fa239a6bccc71" category="paragraph">以下是将端口 "e0e" 上的已替换 VLAN 还原到 e0h 的示例：</block>
  <block id="0d659399d58c646652e9fc4a4b40b32f" category="list-text">根据需要为不在 `displaced - vlan show` 输出中，但应在其他物理端口上配置的 VLAN 端口创建新的 VLAN 端口。</block>
  <block id="a14b1937d7549cfe6656638825e7aa1a" category="list-text">【第 9 步】完成所有端口修复后，删除任何空广播域：</block>
  <block id="5831ae6a2541ef3e48c73d2d25573b1f" category="list-text">【第 10 步】验证端口可访问性：</block>
  <block id="94e75d181c02739e78c94503deab7a67" category="paragraph">如果所有端口均已正确配置并添加到正确的广播域中，则 `network port reachability show` 命令应将所有已连接端口的可访问性状态报告为 `ok` ，对于无物理连接的端口，此状态报告为 `no-reachability` 。如果任何端口报告的状态不是这两个端口，请按照中的说明执行可访问性修复并在其广播域中添加或删除端口 <block ref="647eca8a7ea8d4d8434879df3c364180" category="inline-xref-macro-rx"></block>。</block>
  <block id="bf3f92b1cc4c69581f2185ebf4603ed4" category="list-text">使用以下步骤还原 LIF 主端口，指定需要还原的 Vserver 和 LIF 主端口（如果有）：</block>
  <block id="5103bf442db985e287322952e9087bad" category="list-text">还原 LIF 主节点和主端口：</block>
  <block id="942a2e20bfd5086873f5ad24de65d688" category="paragraph">`displaced interface restore-home-node -node &lt;node_name&gt; -vserver &lt;vserver_name&gt; - lif-name &lt;LIF_name&gt;`</block>
  <block id="46834fba6defd2be4821b9da772dd301" category="summary">您必须在机架中安装 node4 ，将 node2 的连接传输到 node4 ，启动 node4 并安装 ONTAP 。</block>
  <block id="5e026294e07b11e29fcf1170b1f74470" category="paragraph">重新定位操作在此阶段开始时暂停。此过程大部分是自动完成的；操作将暂停，以便您可以检查其状态。您必须手动恢复此操作。此外，您还必须验证 NAS 数据 LIF 是否已成功移至 node4 。</block>
  <block id="4a8c92edcf5608186b4e424977f98a73" category="cell">在启动环境提示符处输入以下命令，以自动配置连接： `ifconfig e0M -auto`</block>
  <block id="518ef7aea7bc08d1f210a055e236783e" category="cell">在启动环境提示符处输入以下命令以手动配置连接： `ifconfig e0M -addr=&lt;filer_addr&gt; -mask=&lt;netmask&gt; -gw=&lt;gateway&gt; -dns=&lt;dns_addr&gt; domain=&lt;dns_domain&gt;` ` &lt;filer_addr&gt;` 是存储系统的 IP 地址。` &lt; 网络掩码 &gt;` 是存储系统的网络掩码。` &lt; 网关 &gt;` 是存储系统的网关。` &lt;dns_addr&gt;` 是网络上名称服务器的 IP 地址。` &lt;dns_domain&gt;` 是域名服务（ DNS ）域名。如果使用此可选参数，则无需在网络启动服务器 URL 中使用完全限定域名；您只需要服务器的主机名。* 注： * 您的接口可能需要其他参数。有关详细信息，请在固件提示符处输入 `help ifconfig` 。</block>
  <block id="732b920f8c31e81584bfe00d62cf46b6" category="paragraph">如果需要，请参考将板载端口修改为启动程序 <block ref="1d789633b45165b05bf13f9838060fe6" category="inline-link-macro-rx"></block>。有关分区的详细说明，请参见存储阵列和分区文档。</block>
  <block id="d3feb03e5c47d69a9cd8b610c3e8e8ce" category="list-text">【第 29 步】有关 MetroCluster 配置， V 系列系统以及将 FlexArray 虚拟化软件连接到存储阵列的系统，请转至 <block ref="65c4c751ac1fc661b74f2a8dfa84d816" category="inline-link-macro-rx"></block>。</block>
  <block id="c6b27d17660b728cdd893a08876f2da9" category="summary">验证 node4 安装后，在将聚合从 node3 重新定位到 node4 之前，请移动属于 node2 的 NAS 数据 LIF 。</block>
  <block id="a3e75c2a01a7c61a023e487467fd7a4a" category="paragraph">在验证 node4 安装并将聚合从 node3 重新定位到 node4 之前，您需要将当前位于 node3 上的 node2 的 NAS 数据 LIF 从 node3 移动到 node4 。您还需要验证 node4 上是否存在 SAN LIF 。</block>
  <block id="b24179e00e90966dedcd7ebbac3c3c96" category="list-text">手动验证是否已正确配置网络以及所有 VLAN ，接口组和广播域。</block>
  <block id="35c143d9885250e0128441d72be169dd" category="list-text">输入 `y` 以继续。</block>
  <block id="0fe1ab232beb36c111a482c1e5418bbf" category="paragraph">执行这些检查后，系统会将 node2 拥有的非根聚合和 NAS 数据 LIF 重新定位到新控制器 node4 。资源重新定位完成后，系统将暂停。</block>
  <block id="ec0abf2d5a391631e61dd4509cb00ed5" category="list-text">手动验证非根聚合和 NAS 数据 LIF 是否已成功重新定位到 node4 。</block>
  <block id="947b05812612f9bdff090f2792520d01" category="paragraph">如果任何聚合无法重新定位或被否决，您必须手动重新定位聚合，或者在必要时覆盖否决或目标检查。请参见一节 <block ref="f9a42009c629603217595f3693c67911" category="inline-link-macro-rx"></block> 有关详细信息 ...</block>
  <block id="cce8a84ff4a03ab6c70c73692fd3aebb" category="list-text">通过完成以下子步骤，确保 SAN LIF 位于 node4 上的正确端口上：</block>
  <block id="5f1a63352c537579794f3a3c507ca8fb" category="list-text">输入以下命令并检查其输出：</block>
  <block id="8d0b6c4adc8652a4d393f803e2e37cff" category="paragraph">`network interface show -data-protocol iscsi_FCP -home-node &lt;node4&gt;`</block>
  <block id="fd9ca0bcb22fd53f185265e5000e6dfc" category="paragraph">系统将返回类似于以下示例的输出：</block>
  <block id="700025ddacc1b1f21775237f69db717d" category="list-text">如果 node4 中的任何 SAN LIF 或 SAN LIF 组位于 node2 上不存在的端口上，或者需要映射到其他端口，请通过完成以下子步骤将其移动到 node4 上的相应端口：</block>
  <block id="628e610b0dbac7c06fd03cc48e401fac" category="list-text">输入以下命令，将 LIF 状态设置为 down ：</block>
  <block id="faa2ac3f77b838a1d072635dac66a426" category="paragraph">`network interface modify -vserver &lt;vserver_name&gt; -lif &lt;lif_name&gt; -status-admin down`</block>
  <block id="c9ac8fe8e0b43e6046de0567dc54775e" category="list-text">从端口集中删除 LIF ：</block>
  <block id="d69d2bd9d3262a8ab5d370d315213f33" category="paragraph">`portset remove -vserver &lt;vserver_name&gt; -portset &lt;portset_name&gt; -port-name &lt;port_name&gt;`</block>
  <block id="d21772becf211f27205d2c80c2749c12" category="list-text">输入以下命令之一：</block>
  <block id="912ec22b1107a17c22a0c63f0644a0d3" category="list-text">输入以下命令以移动单个 LIF ：</block>
  <block id="07763b6c5df84704dcdc1db91c615af1" category="paragraph">`network interface modify -vserver &lt;vserver_name&gt; -lif &lt;LIF_name&gt; -home-port &lt;new_home_port&gt;`</block>
  <block id="f037b701218bf1cc451615cabf0cca09" category="list-text">输入以下命令，将一个不存在或不正确的端口上的所有 LIF 移动到新端口：</block>
  <block id="7066be16c0309959c4b2035bead5b139" category="paragraph">`network interface modify ｛ -home-port &lt;port_on_node1&gt; -home-node &lt;node1&gt; -role data ｝ -home-port &lt;new_home_port_on_node3 &gt;`</block>
  <block id="0a3646df26d19fcc6a0ee6929a6ea7be" category="list-text">将 LIF 重新添加到端口集：</block>
  <block id="6427a184f2e8fa2884ff0d3eebe006ce" category="paragraph">`portset add -vserver &lt;vserver_name&gt; -portset &lt;portset_name&gt; -port-name &lt;port_name&gt;`</block>
  <block id="d78bc2532b76c692bc747f0206ce2369" category="admonition">您需要确保将 SAN LIF 移动到与原始端口具有相同链路速度的端口。</block>
  <block id="2e3c23cf91c21a249f56ef996f27a61a" category="list-text">输入以下命令，将所有 LIF 的状态修改为 `up` ，以便 LIF 可以在节点上接受和发送流量：</block>
  <block id="e2f0d11e53277157c5556e3648b425c0" category="paragraph">`network interface modify -home-port &lt;port_name&gt; -home-node &lt;node4&gt;-lif data -statusadmin up`</block>
  <block id="970d4e34765aa0832a9175b5e001ed85" category="list-text">输入以下命令并检查其输出，以验证 LIF 是否已移至正确的端口，以及 LIF 的状态是否为 `up` ，具体方法是在任一节点上输入以下命令并检查输出：</block>
  <block id="8c094e66fbad29785444d71fd6c0dcac" category="paragraph">`network interface show -home-node &lt;node4&gt; -role data`</block>
  <block id="9b18a03ff7c916731423d488104e8994" category="list-text">如果任何 LIF 已关闭，请通过为每个 LIF 输入以下命令将 LIF 的管理状态设置为 up ：</block>
  <block id="ebb0dbe9b70bf46780fd67ec02dcb63a" category="paragraph">`network interface modify -vserver &lt;vserver_name&gt; -lif &lt;lif_name&gt; -status-admin up`</block>
  <block id="b0fb437b1b12d53611752705f75b4488" category="summary">验证 node3 安装后，在将聚合从 node2 重新定位到 node3 之前，您需要移动 NAS 数据 LIF 。</block>
  <block id="f3fe3982bfd6155c0411e1975be731c8" category="paragraph">在验证 node3 安装并将聚合从 node2 重新定位到 node3 之前，您需要将当前位于 node2 上的 node1 的 NAS 数据 LIF 从 node2 移动到 node3 。您还需要验证 node3 上是否存在 SAN LIF 。</block>
  <block id="086b8cee848b6ff9a25adc1f6ed791c8" category="paragraph">执行这些检查后，系统会将 node1 拥有的非根聚合和 NAS 数据 LIF 重新定位到新控制器 node3 。资源重新定位完成后，系统将暂停。</block>
  <block id="ad7a81d24d4defe671e7bcfbac5dce2c" category="list-text">验证非根聚合和 NAS 数据 LIF 是否已成功重新定位到 node3 。</block>
  <block id="efd16d4be5b2e2f326b572d6729c7b2c" category="paragraph">如果任何聚合无法重新定位或被否决，您必须手动重新定位聚合，或者根据需要覆盖否决或目标检查。请参见 <block ref="f9a42009c629603217595f3693c67911" category="inline-link-macro-rx"></block> 有关详细信息 ...</block>
  <block id="d8c338ec7a5289c51f0e3bb79890e813" category="list-text">通过完成以下子步骤，验证 SAN LIF 是否位于 node3 上的正确端口上：</block>
  <block id="1d80da3c4e116b5ab208f9a0645788c1" category="paragraph">`network interface show -data-protocol iscsi_FCP -home-node &lt;node3&gt;`</block>
  <block id="c54266e61fa0c81baa92579805dc7963" category="list-text">如果 node3 中的任何 SAN LIF 或 SAN LIF 组位于 node1 上不存在的端口上，或者需要映射到其他端口，请通过完成以下子步骤将其移动到 node3 上的相应端口：</block>
  <block id="2fbcca46574c079f4fb5aa457abc282e" category="list-text">将 LIF 状态设置为 down ：</block>
  <block id="8257e4bb3f26fa12d44dc5d212e8d86e" category="paragraph">`network interface modify -vserver &lt;vserver_name&gt; -lif &lt;LIF_name&gt; -status-admin down`</block>
  <block id="88b5416dcfc37572857d79e1fc361d66" category="paragraph">`portset remove -vserver &lt;vserver_name&gt; -portset &lt;portset_name&gt; -port-name &lt;port_name&gt;`</block>
  <block id="fd8145a34775436c1a5fe969965d449f" category="list-text">移动单个 LIF ：</block>
  <block id="4cfef2e0c0a444f2377573428305479e" category="paragraph">`network interface modify -vserver &lt;vserver_name&gt; -lif &lt;LIF_name&gt; -home-port &lt;new_home_port&gt;`</block>
  <block id="30f710fc2b8d913378fc91684f0863fd" category="list-text">将一个不存在或不正确的端口上的所有 LIF 移动到新端口：</block>
  <block id="e6bab71051b8b426353c26c5eece5fda" category="paragraph">`portset add -vserver &lt;vserver_name&gt; -portset &lt;portset_name&gt; -port-name &lt;port_name&gt;`</block>
  <block id="3920c87ab45883a20b7f4aff2eb8f6f9" category="list-text">将所有 LIF 的状态修改为 "up" ，以便 LIF 可以在节点上接受和发送流量：</block>
  <block id="72d3a397738e225f08e034078d433645" category="paragraph">`network interface modify -home-port &lt;port_name&gt; -home-node &lt;node3&gt;-lif data -status-admin up`</block>
  <block id="b5fdeb64f12933be51c64181c2145b75" category="list-text">在任一节点上输入以下命令并检查其输出，以验证 LIF 是否已移至正确的端口，以及 LIF 的状态是否为 `up` ：</block>
  <block id="fb56fd816b904059bf738c97552e7950" category="paragraph">`network interface show -home-node &lt;node3&gt; -role data`</block>
  <block id="f70b18bc9d56cbb566a64828fa672913" category="list-text">如果任何 LIF 已关闭，请为每个 LIF 输入以下命令，将 LIF 的管理状态设置为 `up` ：</block>
  <block id="3e03a1050e8880cab61b7eac81bb41e6" category="summary">确认 node3 处于仲裁状态并可与 node2 通信后，您必须在 node3 上重新创建 node1 的 VLAN ，接口组和广播域。</block>
  <block id="a9ed443016f95a1edf1f75d02a400ef4" category="doc">在 node3 上重新创建 VLAN ，接口组和广播域</block>
  <block id="38f0774e23dfcfc33d0c71a95a9ec915" category="paragraph">确认 node3 处于仲裁状态并可与 node2 通信后，您必须在 node3 上重新创建 node1 的 VLAN ，接口组和广播域。您还必须将 node3 端口添加到新重新创建的广播域中。</block>
  <block id="75500a9c555091ca84661935a854fadd" category="list-text">使用中记录的 node1 信息在 node3 上重新创建 VLAN <block ref="9fd31f02e13c9f75db388cfb74e0acc1" category="inline-link-macro-rx"></block> 部分。</block>
  <block id="9ce19aa6c138af6345ba1f5dfeeff679" category="paragraph">`network port vlan create -node &lt;node_name&gt; -vlan &lt;vlan-name&gt;`</block>
  <block id="f45acda1c521e41b3ce8a3679b6215ab" category="list-text">使用中记录的 node1 信息在 node3 上重新创建接口组 <block ref="9fd31f02e13c9f75db388cfb74e0acc1" category="inline-link-macro-rx"></block> 部分。</block>
  <block id="30f6694fbccf53f98ec474104aa8001d" category="paragraph">`network port ifgrp create -node &lt;node_name&gt; -ifgrp &lt;port_ifgrp_name&gt;-cluster-func`</block>
  <block id="f66463ad689a1b6a786f9d835f140a4a" category="list-text">使用中记录的 node1 信息在 node3 上重新创建广播域 <block ref="9fd31f02e13c9f75db388cfb74e0acc1" category="inline-link-macro-rx"></block> 部分。</block>
  <block id="0693f087526b2a5629e587e3d4eaabe6" category="paragraph">`network port broadcast-domain create -ipspace default -broadcast-domain &lt;broadcast_domain_name&gt; -mtu &lt;mt_size&gt; -ports &lt;node_name ： port_name ， node_name ： port_name&gt;`</block>
  <block id="64c5cc9b78a53e4aac350b1dbb4401d0" category="list-text">将 node3 端口添加到新重新创建的广播域：</block>
  <block id="66443904f877ffe72fecceb90e2f3887" category="paragraph">`network port broadcast-domain add-ports -broadcast-domain &lt;broadcast_domain_name&gt; -ports &lt;node_name ： port_name ， node_name ： port_name&gt;`</block>
  <block id="e76c8362140cc7ad8308b1fc046a1979" category="summary">验证 node1 上的物理端口是否正确映射到 node3 上的物理端口</block>
  <block id="9bced622fe4463826e54e9d72ffb3105" category="doc">将端口从 node1 映射到 node3</block>
  <block id="35fa788a2c1b033fc9d672031d207c8f" category="paragraph">您必须验证 node1 上的物理端口是否正确映射到 node3 上的物理端口，从而使 node3 能够在升级后与集群中的其他节点以及网络进行通信。</block>
  <block id="44471d5aafdc0c157c500d2d6a23a19e" category="paragraph">端口设置可能因节点型号而异。您必须使原始节点上的端口和 LIF 配置与新节点的计划使用和配置兼容。这是因为新节点在启动时会重放相同的配置，这意味着在启动 node3 时， ONTAP 将尝试在 node1 上使用的相同端口上托管 LIF 。</block>
  <block id="0e17cd2a380c7aee928d55a629e1247a" category="paragraph">因此，如果 node1 上的物理端口不直接映射到 node3 上的物理端口，则需要更改软件配置，才能在启动后还原集群，管理和网络连接。此外，如果 node1 上的集群端口未直接映射到 node3 上的集群端口，则在重新启动时 node3 可能无法自动重新加入仲裁，除非您更改软件配置，将集群 LIF 托管在正确的物理端口上。</block>
  <block id="8ecfd3d07d0b566573970e006b263355" category="list-text">将 node1 ，端口，广播域和 IP 空间的所有 node1 布线信息记录在表中：</block>
  <block id="95416f2c916dabe21f738406546ebc53" category="cell">LIF</block>
  <block id="7c58d4376f3e9edee5dddea0cb60174b" category="cell">Node1 端口</block>
  <block id="c9545236c254e502f1fd332fd827bb30" category="cell">节点 1 IP 空间</block>
  <block id="d097d9fa6c24ef764e863334502d7e44" category="cell">节点 1 广播域</block>
  <block id="a3af08ec17eafe7fd9b8af3ac85cd551" category="cell">Node3 端口</block>
  <block id="d7dbdebdabf907055e9f9b1ad790cd2f" category="cell">Node3 IP 空间</block>
  <block id="da3249c2580cf367f00b7be2fbbbe3fa" category="cell">node3 广播域</block>
  <block id="ad6dcf374ab3aa82295dfd9f05c5321a" category="cell">集群 1</block>
  <block id="1254eb728cd3888ab12378466d7acf61" category="cell">集群 2.</block>
  <block id="ab9ecc9d421fd8c94654e9f43686ba1a" category="cell">集群 3.</block>
  <block id="bf1b6535047986fddc090d91db2256c5" category="cell">集群 4.</block>
  <block id="3c8ea2e650fa77bf321eab55f3572403" category="cell">节点管理</block>
  <block id="1eb5ae63609e68a11106494d272615bf" category="cell">集群管理</block>
  <block id="1fffe5dec3e7cf3665b3f3d7f9f46a13" category="cell">数据 1.</block>
  <block id="1ae886c83bb2b57062f09c9ab93869df" category="cell">数据 2.</block>
  <block id="49995b31307a5ab11f30d0cfc964294f" category="cell">数据 3.</block>
  <block id="4006ebc8b1e151da2d8e1860f1657adc" category="cell">数据 4.</block>
  <block id="62a0282d39568be094470486eaf70c4f" category="cell">SAN</block>
  <block id="9e825d496d7663757ece1259e7a96304" category="cell">集群间端口</block>
  <block id="a954ed2f319ed904377b750e964bbd3b" category="list-text">将 node3 ，端口，广播域和 IP 空间的所有布线信息记录在表中。</block>
  <block id="15395d832f02a01663100fa8cdcdbe72" category="list-text">按照以下步骤验证设置是否为双节点无交换机集群：</block>
  <block id="b5c6fde8816eb583a49b6c0314b82928" category="list-text">将权限级别设置为高级：</block>
  <block id="07d5ca0790a321e18a18d766e2a4dc46" category="paragraph">`cluster ：：： &gt; set -privilege advanced`</block>
  <block id="02447279c68e4d1b8321c16d451e2f25" category="list-text">验证设置是否为双节点无交换机集群：</block>
  <block id="1754e82bbc644d474d95cae66bc6dae3" category="paragraph">`cluster ：：： &gt; network options switchless-cluster show`</block>
  <block id="5fc571537471df3ed57f747d12b1f82f" category="paragraph">此命令输出的值必须与系统的物理状态匹配。</block>
  <block id="0a33c5a38d244a756240abb6427cac6d" category="list-text">返回到管理权限级别：</block>
  <block id="ca9ef37ccec1afc84a708333d3584ceb" category="list-text">按照以下步骤将 node3 置于仲裁状态：</block>
  <block id="1d15788f6c2c92d9fd9ae80b762e2b98" category="list-text">启动节点 3.请参见 <block ref="b27daeccf5fbd8a2e88a3636ee615b74" category="inline-link-macro-rx"></block> 以启动节点（如果尚未启动）。</block>
  <block id="e250afe1d6acb2cedbe5164cfe15e160" category="list-text">验证新集群端口是否位于集群广播域中：</block>
  <block id="45bdedd97f645f88d9bfa1f19569d6fb" category="paragraph">`network port show -node &lt;node&gt; -port &lt;port&gt; -fields broadcast-domain`</block>
  <block id="d5a848f4f51e9593f468d025887aa790" category="paragraph">以下示例显示端口 "e0a" 位于 node3 上的集群域中：</block>
  <block id="3b95836e337e89d8b015f844a70e27c5" category="list-text">如果集群端口不在集群广播域中，请使用以下命令添加它们：</block>
  <block id="014374cd732266cf6e691494322909cd" category="paragraph">`broadcast-domain add-ports -ipspace cluster -broadcast-domain cluster -ports &lt;node ： port&gt;`</block>
  <block id="0d5ac86deac51d611e624857bd351157" category="paragraph">此示例将在 node3 上添加集群端口 "e1b" ：</block>
  <block id="f82bb6762cd68512cb29bd2a7f8ae49b" category="list-text">将正确的端口添加到集群广播域：</block>
  <block id="a45073b4c9b4451293184e2e132d0416" category="paragraph">`network port modify -node -port -ipspace cluster -mtu 9000`</block>
  <block id="6a5060000cc7ede4725a843f1b406b97" category="paragraph">此示例将在 node4 上添加集群端口 "e1b" ：</block>
  <block id="79498ed93931f11551ee000416c681ad" category="list-text">将每个 LIF 的集群 LIF 迁移到新端口一次：</block>
  <block id="92c809f55a598a0ca7fb03d213160bb8" category="paragraph">`network interface migrate -vserver cluster -lif &lt;lif_name&gt; -source-node &lt;node3&gt; -destination-node &lt;node3&gt; -destination-port &lt;port_name&gt;`</block>
  <block id="19822d45a3cb02a6f584bb24bcaa5b08" category="list-text">修改集群 LIF 的主端口：</block>
  <block id="1b6d049a657d9e689d309f1a122a3da4" category="paragraph">`network interface modify -vserver cluster -lif &lt;lif_name&gt; – home-port &lt;port_name&gt;`</block>
  <block id="85530f2f9f1c84469942b904bd0afd80" category="list-text">从集群广播域中删除旧端口：</block>
  <block id="02a331c3e689130522f148a92e794698" category="paragraph">以下命令将删除 node3 上的端口 "e0d" ：</block>
  <block id="453a5afbc81eb04f9be87066e772f47c" category="paragraph">`network port broadcast-domain remove-ports -ipspace cluster -broadcast-domain cluster ‑ports node3 ： e0d`</block>
  <block id="73a476e3954651a03a873f15c78fb2cf" category="list-text">验证 node3 是否已重新加入仲裁：</block>
  <block id="95cab25438aec857407b017a973e5c22" category="list-text">【 auto_map_3_step5]] 调整托管集群 LIF 和节点管理 /clustermanagement LIF 的广播域。确保每个广播域包含正确的端口。如果某个端口托管 LIF 或位于 LIF 的主目录中，则无法在广播域之间移动该端口，因此您可能需要按如下所示迁移和修改 LIF ：</block>
  <block id="4076f0d6df989532aff6382687e9888e" category="list-text">显示 LIF 的主端口：</block>
  <block id="b2dc601f3d617280e54bd9153ba2aa9a" category="paragraph">`network interface show -fields home-node ， home-port`</block>
  <block id="151015f4cf01b0b6b0ba1839b9b1bd6a" category="list-text">显示包含此端口的广播域：</block>
  <block id="14d0632dc405425758df978f31e10665" category="paragraph">`network port broadcast-domain show -ports &lt;node_name ： port_name&gt;`</block>
  <block id="c65a432daff80bb22606190592ba03a1" category="list-text">在广播域中添加或删除端口：</block>
  <block id="8f822f2d07295ece2b3ed7d8bc0255ff" category="paragraph">`网络端口 broadcast-domain add-ports`</block>
  <block id="f6f7703e9fef5152575d8f4d7f724839" category="list-text">修改 LIF 的主端口：</block>
  <block id="697b823c909ba4b90b7cc8afe77b46d3" category="paragraph">`network interface modify -vserver vserver -lif &lt;lif_name&gt; – home-port &lt;port_name&gt;`</block>
  <block id="721f2cf56861c6620ae10af678a11201" category="list-text">使用中所示的相同命令调整用于集群间 LIF 的网络端口的广播域成员资格 <block ref="fea3b13a0d2ee88cc51adec05dc6a35c" category="inline-xref-macro-rx"></block>。</block>
  <block id="ef347e13fc7ddb5d862f419e62a1814c" category="list-text">如有必要，请使用中所示的相同命令调整任何其他广播域并迁移数据 LIF <block ref="fea3b13a0d2ee88cc51adec05dc6a35c" category="inline-xref-macro-rx"></block>。</block>
  <block id="ebde3c7ee6d00f9081b9e50638aee5c0" category="list-text">如果 node1 上有任何端口不再位于 node3 上，请按照以下步骤删除它们：</block>
  <block id="f2797e57746a2e92ae2db208aa4ca684" category="list-text">访问任一节点上的高级权限级别：</block>
  <block id="848d81ec28722b1c7b9863d586ec791b" category="list-text">要删除端口，请执行以下操作：</block>
  <block id="5175d0f510ad3fc3bfd43ed48a78795e" category="paragraph">`network port delete -node &lt;node_name&gt; -port &lt;port_name&gt;`</block>
  <block id="e292843f0f8aa27c8a0485033bbc83a8" category="list-text">调整所有 LIF 故障转移组：</block>
  <block id="dbd4d3f45762468dfc2874dcea08634e" category="paragraph">`network interface modify -failover-group &lt;failover_group&gt; -failover-policy &lt;failover_policy&gt;`</block>
  <block id="7a0381687cdc9de622bbd1da886f7a53" category="paragraph">以下命令会将故障转移策略设置为 `broadcast-domain-wide` ，并使用故障转移组 "fg1" 中的端口作为 node3 上 LIF"data1" 的故障转移目标：</block>
  <block id="cb78b2e3deaeee9f6221f0adf18ae798" category="paragraph">`network interface modify -vserver node3 -lif data1 failover-policy broadcast-domainwide -failover-group fg1`</block>
  <block id="b5c60a344329e79b3bc3ea4e338dec46" category="list-text">验证 node3 上的更改：</block>
  <block id="ba52c8419c9419dca65682ae8a86c813" category="summary">您必须准备好要升级的节点。</block>
  <block id="28ec7b443f6b601682eab0dfce57d80c" category="list-text">network interface show -curr-node &lt;nodename&gt; -role cluster ， intercluster ， node-mgmt ， clustermgmt ， data</block>
  <block id="b5f4513909cb412a69e57db23895130f" category="list-text">network port show -node &lt;nodename&gt; -type physical</block>
  <block id="7e487668bc88674f5d71e47878b4625d" category="list-text">network port vlan show</block>
  <block id="14f16046a1210e91f4f20f76ac09d53a" category="list-text">system node show -instance -node &lt;nodename&gt;</block>
  <block id="3b2a92c3256f8b90003a7b94b0dad7ff" category="list-text">storage aggregate show -node &lt;nodename</block>
  <block id="85c304b273ca65bcc95857b6ca27151b" category="list-text">network interface failover-groups show</block>
  <block id="e6d3edc8d8c0e062d80c969f5da151ed" category="admonition">如果正在使用板载密钥管理器进行 NetApp 卷加密，请准备好密钥管理器密码短语，以便稍后在操作步骤中完成密钥管理器重新同步。</block>
  <block id="db8f22918d14ae383a626495295e95e8" category="summary">确认 node4 处于仲裁状态并可与 node3 通信后，您必须在 node4 上重新创建 node2 的 VLAN ，接口组和广播域。</block>
  <block id="ca6c97b959d192578a21a39e5daa0dcb" category="doc">在 node4 上重新创建 VLAN ，接口组和广播域</block>
  <block id="06531598d2f1f8cb4d0e1748bdd53cb1" category="paragraph">确认 node4 处于仲裁状态并可与 node3 通信后，您必须在 node4 上重新创建 node2 的 VLAN ，接口组和广播域。您还必须将 node3 端口添加到新重新创建的广播域中。</block>
  <block id="f510fd869131d6e75b451f4d5143753d" category="list-text">使用中记录的 node2 信息在 node4 上重新创建 VLAN <block ref="f7f70c2c98be066b2a9d668ac7d63467" category="inline-link-macro-rx"></block> 部分。</block>
  <block id="f94cc72e2545c321248727577ec6f136" category="paragraph">`network port vlan create -node &lt;node4&gt; -vlan &lt;vlan-name&gt;`</block>
  <block id="90f14f8b8c696d6b840bbeaafeef318b" category="list-text">使用中记录的 node2 信息在 node4 上重新创建接口组 <block ref="f7f70c2c98be066b2a9d668ac7d63467" category="inline-link-macro-rx"></block> 部分。</block>
  <block id="801e3eaaad9c1e7e56360a0d5a4eba35" category="paragraph">`network port ifgrp create -node &lt;node4&gt;-ifgrp &lt;port_ifgrp_names&gt;-cluster-func`</block>
  <block id="080ec370c2d913fcb5020dced626cc50" category="list-text">使用中记录的 node2 信息在 node4 上重新创建广播域 <block ref="f7f70c2c98be066b2a9d668ac7d63467" category="inline-link-macro-rx"></block> 部分。</block>
  <block id="f10d0345f9a30980e7c9be821215c028" category="list-text">将 node4 端口添加到新重新创建的广播域：</block>
  <block id="bd7c8ec5f0f0b7d2149b61fcaa1ebe7d" category="summary">要使 NetApp 卷加密（ NVE ）对要升级的系统上的卷进行加密，必须将加密配置同步到新节点。</block>
  <block id="28ee1efc4e85d8c498824b6d179e810b" category="list-text">要同步板载密钥管理器的加密配置，请在集群提示符处运行以下命令：</block>
  <block id="261226346341bab3c9b8e706c0ad80c1" category="cell">对于此 ONTAP 版本…</block>
  <block id="6307f29fb047a8637ca6f025a1dec02d" category="cell">ONTAP 9.6 或 9.7</block>
  <block id="1fd11ad9c6fc9e17e9729cd939a2b47b" category="cell">安全密钥管理器板载同步</block>
  <block id="0fcf2ee62acd9eae83b609a0e7ecaa72" category="cell">ONTAP 9.5</block>
  <block id="732cd8784d263d714e9f6a4a76be6c6c" category="cell">security key-manager setup -node &lt;node_name&gt;</block>
  <block id="3554bd6dca965e0e8bcb314a54ef655c" category="list-text">输入板载密钥管理器的集群范围密码短语。</block>
  <block id="04e69ed9c039a8d1bc156ec97e69f0d2" category="inline-link-macro">将端口从 node2 映射到 node4</block>
  <block id="77a9ad04a0d2efb7c2993685c68b4955" category="admonition">如果 node4 没有板载 FC 端口，板载 UTA/UTA2 端口或 UTA/UTA2 卡，并且您要升级具有存储磁盘的系统，则可以跳至 <block ref="fface1ac702bde6d72ceb6e55eb8b2b6" category="inline-link-macro-rx"></block> 部分。但是，如果您使用的是 V 系列系统或 FlexArray 虚拟化软件并已连接到存储阵列，并且 node4 没有板载 FC 端口，板载 UTA/UTA2 端口或 UTA/UTA2 卡，则必须返回 _Install and boot node4_ 部分并继续执行 <block ref="1a99f6ce933cd745b2b02e54c9272506" category="inline-link-macro-rx"></block>。确保 node4 具有足够的机架空间。如果 node4 与 node2 位于不同的机箱中，则可以将 node4 与 node3 放在同一位置。如果 node2 和 node4 位于同一机箱中，则 node4 已位于其相应的机架位置。</block>
  <block id="8c212e8d716365fe78b3dc05e538816b" category="list-text">跳过此部分并转到 <block ref="fface1ac702bde6d72ceb6e55eb8b2b6" category="inline-link-macro-rx"></block> 如果 node4 没有 UTA/UTA2 卡或 UTA/UTA2 板载端口。</block>
  <block id="8791ac28601fdc37abff08e6c499f508" category="list-text">转至 <block ref="15e1611f6cc2b64b7163cc152446c8c0" category="inline-link-macro-rx"></block> 如果 node4 具有 UTA/UTA2 卡或 UTA/UTA2 板载端口。</block>
  <block id="d99c8ba9d658d3212fddc2b03d46d17d" category="cell">转到部分 <block ref="fface1ac702bde6d72ceb6e55eb8b2b6" category="inline-link-macro-rx"></block>。</block>
  <block id="9cf4d14086ce4d21dc41a4190205b5f9" category="paragraph">如果要升级到 A800 ，请转至 <block ref="1917bbf2d6d289423b4a495f5ba4fcca" category="inline-xref-macro-rx"></block>。</block>
  <block id="2df4aaf5859b7013b08c777b75de1736" category="list-text">【 auto_check_4_step15]] 在 node4 上，转到启动菜单，然后使用 22/7 选择隐藏选项 `boot_after_controller_replacement` 。在提示符处，输入 node2 以将 node2 的磁盘重新分配给 node4 ，如以下示例所示。</block>
  <block id="ad5f4bb6f9161068112afc76d5e212f4" category="list-text">如果系统进入重新启动循环并显示消息 `no disks found` ，这是因为它已将端口重置回目标模式，因此无法看到任何磁盘。继续 <block ref="d55e3a0f9758a99c055e4411cec66cde" category="inline-xref-macro-rx"></block> 到 <block ref="1abe7aef97cf6f4670adea7171f10403" category="inline-xref-macro-rx"></block> 以解决此问题。</block>
  <block id="c96220c50aab2a4ab570c1cab76c079a" category="paragraph">在第 5 阶段，您将安装并启动 node4 ，将集群和节点管理端口从 node2 映射到 node4 ，并验证 node4 安装。您还可以将 node2 拥有的 NAS 数据 LIF 从 node3 移动到 node4 ，并将 node2 的聚合从 node3 重新定位到 node4 。</block>
  <block id="fface1ac702bde6d72ceb6e55eb8b2b6" category="list-text"><block ref="fface1ac702bde6d72ceb6e55eb8b2b6" category="inline-link-macro-rx"></block></block>
  <block id="38c5d8cbf396fa8049b864a52905989e" category="inline-link-macro">当节点具有一组不同的网络端口时加入仲裁</block>
  <block id="f0b0c29d9be806c3fb8f84d804659749" category="list-text"><block ref="f0b0c29d9be806c3fb8f84d804659749" category="inline-link-macro-rx"></block></block>
  <block id="ce760f3f52d1d023d6d316ce6636d981" category="summary">您需要升级节点对。</block>
  <block id="67e9019cd579cec7a9dc84892184061b" category="summary">验证 MetroCluster 配置的切换，修复和切回操作。</block>
  <block id="ac84c36cb19187c1b40f86ec36101a01" category="summary">配置存储加密并建立集群范围的身份验证密钥以替换先前的节点级别身份验证密钥</block>
  <block id="9645dac7a86b8b52dafb1d2bce8d2cbc" category="paragraph">在 ONTAP 9.5 到 9.7 中，您可以使用密钥管理互操作性协议（ Key Management Interoperability Protocol ， KMIP ）服务器管理身份验证密钥。</block>
  <block id="474e079e3a7a9eaeb2bb65154064db9e" category="summary">将一对运行 ONTAP 9.5 的控制器升级到 ONTAP 9.7 取决于原始控制器和替代控制器的平台和配置。</block>
  <block id="40f491be1da04740c193fe7b8e4df207" category="paragraph">要了解是否可以使用聚合重新定位（ Aggregate Relocation ， ARL ）将一对运行 ONTAP 9.5 的控制器升级到 ONTAP 9.7 ，取决于原始控制器和更换控制器的平台和配置。</block>
  <block id="58753da369714fb951c22c96476b373b" category="paragraph">在使用适用于 ONTAP 9.5 的 ARL 操作步骤将一对节点升级到 ONTAP 9.7 时，您必须验证是否可以对原始控制器和替代控制器执行 ARL 。</block>
  <block id="92d7a6cff22927442a55701963967daa" category="paragraph">您应检查所有已定义聚合的大小以及原始系统支持的磁盘数。然后，您必须将支持的聚合大小和磁盘数量与新系统支持的聚合大小和磁盘数量进行比较。请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到可 Hardware Universe 提供此信息的 _SIL_ 。新系统支持的聚合大小和磁盘数必须等于或大于原始系统支持的聚合大小和磁盘数。</block>
  <block id="49b8e12e4922dd11255eee6c82462eae" category="paragraph">您应在集群混用规则中验证在更换原始控制器后，新节点是否可以成为现有节点集群的一部分。有关集群混合规则的详细信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _SIL_ Hardware Universe 。</block>
  <block id="e20e9ea1f6702a02cf275f42f38fd063" category="admonition">在执行 AFF 系统升级之前，您必须将 ONTAP 升级到版本 9.5P1 或更高版本。要成功升级，需要这些版本级别。</block>
  <block id="e13ef1734f457a6634d02e817f76fb23" category="paragraph">配置了 SnapLock 企业版和 SnapLock 合规性卷的系统支持使用 ARL 升级控制器。</block>
  <block id="bab80fb4460dcd700341b404b35095c5" category="summary">在升级期间，聚合重新定位可能会在不同点失败。</block>
  <block id="7e4c3807e46f1f800d0e720965a7fe3a" category="paragraph">有关 `storage aggregate relocation start` ， `override-vetoes` 和 `override-destination-checks` 选项的详细信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _Microsoft ONTAP 9 命令：手册页参考 _ 。</block>
  <block id="d3b61d7be5bcbe73888c2e4f54185ed6" category="summary">检查 MetroCluster 配置的运行状况以验证是否正常运行。</block>
  <block id="a7dda6b844f93c6f7aaba278089fae33" category="summary">在机架中安装 node3 ，将 node1 的连接传输到 node3 ，启动 node3 并安装 ONTAP 。</block>
  <block id="38cf27caef6776abd0225a54be1e9972" category="list-text">[autos9597_istall3_step6]] 通过选择以下操作之一配置网络启动连接。</block>
  <block id="1e1bab3dc1010e23c8cb467fc3006ae4" category="list-text">[auto9597_istall3_step29]] 对于 MetroCluster 配置， V 系列系统以及将 FlexArray 虚拟化软件连接到存储阵列的系统，请转至 <block ref="197bcdf5306898ec17e6022b26568f43" category="inline-link-macro-rx"></block>。</block>
  <block id="2dc628959227b30796539097566ced4e" category="list-text">在两个节点上使用以下命令配置 SP ：</block>
  <block id="cffe1635d7e645065b5457e425a54cdd" category="paragraph">请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 ONTAP `s管理参考 _ 以了解 SP 的相关信息，以及 _SP 9 命令：手册页参考 _ 以了解有关 system` service-processor network modify 命令的详细信息。</block>
  <block id="17acc08dd9b9cc179eb2c71ee42f1438" category="paragraph">在此信息中，原始节点称为 "node1" 和 "node2" ，新节点称为 "node3" 和 "node4" 。在所述的操作步骤期间， "node1" 将替换为 "node3" ， "node2" 将替换为 "node4" 。</block>
  <block id="87955a4e69dc9556a2a78cd5f057d2f3" category="paragraph">术语 "node1" ， "node2" ， "node3" 和 "node4" 仅用于区分原始节点和新节点。在操作步骤之后，必须替换原始节点和新节点的实际名称。但是，实际上，节点名称不会更改： "node3" 与 "node1" 同名， "node4" 与 "node2" 同名。升级控制器硬件后， "node4" 与 "node2" 同名。</block>
  <block id="9ee11f9a38856219378f2fad2bbd65c5" category="list-text">此操作步骤非常复杂，假定您具备高级 ONTAP 管理技能。您还应阅读并了解 <block ref="4839d43871fe29773e86f5cefcab0e32" category="inline-link-macro-rx"></block> 和 <block ref="57e14e08755134bb6fef9ad899bb58ee" category="inline-link-macro-rx"></block> 开始升级之前。</block>
  <block id="48d957729e77cbd1ec1cf772f951270a" category="list-text">此操作步骤假定更换用的控制器硬件是新的，尚未使用。使用 `wipeconfig` 命令准备已用控制器所需的步骤不在此操作步骤中。如果先前使用的是替代控制器硬件，则必须联系技术支持，尤其是在控制器以 7- 模式运行 Data ONTAP 时。</block>
  <block id="e5e0e33438e3e93b68faec10a86b2f1c" category="list-text">您可以使用此操作步骤升级具有两个以上节点的集群中的控制器硬件；但是，您需要为集群中的每个 HA 对单独执行操作步骤。</block>
  <block id="8aa258d7d2576cff89b65debb971736d" category="list-text">此操作步骤适用场景 FAS 系统， V 系列系统， AFF 系统以及安装了 FlexArray 虚拟化软件的系统。如果安装了所需的许可证，则在 ONTAP 9.5 之后发布的 FAS 系统可以连接到存储阵列。ONTAP 9.5 支持现有 V 系列系统。有关存储阵列和 V 系列型号的详细信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 要链接到 _V Hardware Universe 系列支持表，请访问 V 系列支持表。</block>
  <block id="01cc348d995c86d2845e5e78e5e9c63a" category="list-text">从 ONTAP 9.6 开始，此操作步骤适用场景系统运行的是 4 节点 MetroCluster 配置或更高版本。由于 MetroCluster 配置站点可能位于两个物理位置不同的位置，因此对于 HA 对，必须在每个 MetroCluster 站点上单独执行控制器自动升级。</block>
  <block id="1a446ed6f6f5d451622f381088c9d634" category="summary">在第 6 阶段，确保正确设置了新节点。</block>
  <block id="aeeef62c5133714906c67f69ce2b1ace" category="paragraph">在第 3 阶段，您将安装并启动 node3 ，将集群和节点管理端口从 node1 映射到 node3 ，并验证 node3 安装。属于 node1 的非 SAN 数据 LIF 和非根聚合将从 node2 移动到 node3 。</block>
  <block id="3b6c063a8efbc88c969c7838f0611434" category="list-text"><block ref="3b6c063a8efbc88c969c7838f0611434" category="inline-link-macro-rx"></block></block>
  <block id="2bef9a25a25f8408b93c008177e86cf5" category="inline-link-macro">当节点具有一组不同的网络端口时加入仲裁</block>
  <block id="881027673002730ac21d11ed07a40569" category="list-text"><block ref="881027673002730ac21d11ed07a40569" category="inline-link-macro-rx"></block></block>
  <block id="307639a03c0baad18a78770a19967fb8" category="list-text"><block ref="307639a03c0baad18a78770a19967fb8" category="inline-link-macro-rx"></block></block>
  <block id="9fd31f02e13c9f75db388cfb74e0acc1" category="list-text"><block ref="9fd31f02e13c9f75db388cfb74e0acc1" category="inline-link-macro-rx"></block></block>
  <block id="f9a42009c629603217595f3693c67911" category="list-text"><block ref="f9a42009c629603217595f3693c67911" category="inline-link-macro-rx"></block></block>
  <block id="d96315657b83074fe065878add3854f9" category="summary">使用 Config Advisor 工具检查常见配置错误。</block>
  <block id="59a8f1e3a6265ee89ea88dc90c416d7d" category="summary">验证 node4 是否安装正确。</block>
  <block id="cd1408e068b531b7382c4e61b1fb334a" category="paragraph">安装并启动 node4 后，您需要验证它是否已正确安装，是否属于集群，以及是否可以与 node3 通信。</block>
  <block id="5606085c29237d873046f0814d8b70b0" category="list-text">输入以下命令，验证 node4 是否与 node3 属于同一集群且运行状况良好：</block>
  <block id="7f1799dcf19180943a8e7e660bf6a3dd" category="list-text">检查操作状态，并验证 node4 的配置信息是否与 node2 相同：</block>
  <block id="a10c88f3a400c8c2aa654ddd4a616518" category="paragraph">如果 node4 的配置不同，则稍后可能会在操作步骤中发生系统中断。</block>
  <block id="838d8de52d85e0b64e9643b598ef2b7e" category="list-text">检查更换的控制器是否已正确配置 MetroCluster 配置，而不是处于切换模式。</block>
  <block id="c7bfe1826ae50dfa18e857462ed5be48" category="admonition">* 注意： * 在此阶段， MetroCluster 配置将不会处于正常状态，您可能会遇到需要解决的错误。请参见 <block ref="14c0e32a98a31f9fd4a16b635b2f7ebd" category="inline-link-macro-rx"></block>。</block>
  <block id="bb197bcd8b7816b74ae21bd6c2906919" category="summary">如果更换的控制器或新控制器的 HA 配对项使用存储加密，则必须配置新控制器模块</block>
  <block id="166eaaeaf7115a8ef8bd93d89dc98893" category="summary">在将 node2 替换为 node4 之前，必须将 node2 所拥有的非根聚合重新定位到 node3 。</block>
  <block id="5b64f041f55ca32411dcf1520bfc1cda" category="doc">将节点 1 拥有的非根聚合和 NAS 数据 LIF 重新定位到节点 2</block>
  <block id="d214189b511a4dddc29ca037a9c05cc4" category="paragraph">在升级操作步骤期间，远程 LIF 处理 SAN LUN 的流量。升级期间，集群或服务运行状况无需移动 SAN LIF 。使 node3 联机后，您必须验证 LIF 是否运行正常并位于相应的端口上。</block>
  <block id="b003ff957beed57b873253f1e4cd0441" category="list-text">【第 5 步】如果新硬件上不存在当前托管数据 LIF 的端口，请将其从广播域中删除：</block>
  <block id="87766a1a73ec698f3b4753312d4d3b4f" category="paragraph">`network interface modify -vserver &lt;vserver_name&gt; -lif &lt;LIF_name&gt;-home-node &lt;nodename&gt; -status-admin up`</block>
  <block id="45560e4a070877091866d34d12016154" category="list-text">如果配置了接口组或 VLAN ，请完成以下子步骤：</block>
  <block id="8e2087071d353c6f56da3d27b7a84dfc" category="list-text">从接口组中删除 VLAN ：</block>
  <block id="973a9f75fd7ee6700a6f9b372ce8f863" category="paragraph">`network port vlan delete -node &lt;nodename &gt; -port &lt;ifgrp&gt; -vlan-id &lt;vlan_ID&gt;`</block>
  <block id="3f3edadf07afca334ee7f44554a2b78f" category="admonition">按照更正操作解决 vlan delete 命令建议的任何错误。</block>
  <block id="f4d11d72b637e9ed5ccd913b9007a29e" category="list-text">输入以下命令并检查其输出，以查看节点上是否配置了任何接口组：</block>
  <block id="cc0c9adfd17d4df3e534cfcc4593c082" category="paragraph">`network port ifgrp show -node &lt;nodename &gt; -ifgrp &lt;ifgrp_name&gt; -instance`</block>
  <block id="04e176453ee24840739bd91255d982c4" category="paragraph">系统将显示节点的接口组信息，如以下示例所示：</block>
  <block id="e477f90becbcba9c7c9b92ec022ad754" category="list-text">如果节点上配置了任何接口组，请记录这些组的名称以及分配给它们的端口，然后输入以下命令删除这些端口，每个端口输入一次：</block>
  <block id="a29b28a9bfbd05c839e9894c81c44cc0" category="paragraph">`network port ifgrp remove-port -node &lt;nodename &gt; -ifgrp &lt;ifgrp_name&gt; -port &lt;netport&gt;`</block>
  <block id="c1e5c7576460bdde0a488bc293007a13" category="summary">将非根聚合和 NAS 数据 LIF 从 node1 移动到 node2</block>
  <block id="358f52f6680f0f2b534acb9ac77674d2" category="list-text">如果任何 LIF 已关闭，请通过为每个 LIF 输入以下命令将 LIF 的管理状态设置为 "up" ：</block>
  <block id="44d2fdf7ea40f3d7321cb94a4051b609" category="paragraph">`network interface modify -vserver _vserver_name -lif _LIF_name_` ` -home-node _nodename_ -status-admin up`</block>
  <block id="65dafd80488559eb25b9b16c7ae60e27" category="list-text">输入以下命令，从接口组中删除 VLAN ：</block>
  <block id="38c250e3cea10de8e69a05edc403fb4f" category="paragraph">`network port vlan delete -node _nodename_ -port _ifgrp_ -vlan-id _vlan_ID_`</block>
  <block id="11c404f7c79ae3005a460cd2d80c457a" category="paragraph">`network port ifgrp show -node _nodename_ -ifgrp _ifgrp_name_ -instance`</block>
  <block id="d72c3f2754ea2c427cb4caa21b66f58a" category="paragraph">`network port ifgrp remove-port -node _nodename_ -ifgrp _ifgrp_name_ -port _netport_`</block>
  <block id="6694385292a5e940b67087561676a6aa" category="list-text">您正在升级运行 ONTAP 9.5 ， 9.6 或 9.7 的 NetApp 控制器。本文档不适用于升级到 ONTAP 9.8 的情况。</block>
  <block id="9ac1bc9aa08a3adb056bbe14e9db22f9" category="list-text">如果要升级 MetroCluster 配置，则此配置为 4 节点或更高版本的 FC 配置，并且所有节点均运行 ONTAP 9.6 或 9.7 。</block>
  <block id="0d74b20ac8b9962af3f313acb5efcf95" category="paragraph">下表显示了控制器升级支持的型号列表。</block>
  <block id="b20b578c387911a06f818e60f8b42fc9" category="cell">AFF A300 ， AFF A400 ， AFF A700^1^ ， AFF A800^2^</block>
  <block id="08b8b3c8e271efd7690222a017e7f380" category="cell">FAS8700 ， FAS9000 ， FAS8300^4^^ ，^ ^5^</block>
  <block id="da8b8662f7c1d5fff02df5d395e1d253" category="cell">AFF A700^1^ ， AFF A800^2^^ ，^ ^3^ ， AFF A400^4^^ ，^ ^5^</block>
  <block id="e51c635d01c8dc3e816e9f14ad0767cf" category="paragraph">^1^ONTAP 9.7P2 支持 AFF A700 系统的 ARL 自动升级。</block>
  <block id="1ab9ac762ff98f776b6d5cfddf56bf6f" category="inline-link-macro">检查并配置 node3 步骤 14 上的 UTA/UTA2 端口</block>
  <block id="d16c604a3cddc9316d5dfc1514c5da11" category="inline-link-macro">检查并配置 node4 上的 UTA/UTA2 端口，步骤 14</block>
  <block id="854e3fd862be50a0cf7e5d697506a33c" category="paragraph">^2^如果要更新到 AFF A800 或支持内部和外部磁盘的系统，则必须按照内部 NVMe 磁盘上根聚合的特定说明进行操作。请参见 <block ref="983c366997f9ae38fb70a96bf899b5fb" category="inline-link-macro-rx"></block> 和 <block ref="c637ff237000263c980a88d3850be72b" category="inline-link-macro-rx"></block>。</block>
  <block id="cc31b65361b7c697a4d3c0f75b928baf" category="paragraph">^3^ONTAP 9.7P5 支持 ARL 自动从 AFF A300 升级到 AFF A800 系统。</block>
  <block id="2e2d0e127c8eb55e752ddae9109b7b26" category="paragraph">^4^ONTAP 9.7P8 支持从 AFF A300 自动升级到 AFF A400 ， FAS8200 自动升级到 FAS8300 系统。</block>
  <block id="0d17b2b0ee5853657bc79eefe010abec" category="paragraph">^5^如果要在双节点无交换机集群配置中从 AFF A300 升级到 AFF A400 或 FAS8200 到 FAS8300 系统，则必须选择临时集群端口进行控制器升级。AFF A400 和 FAS8300 系统采用两种配置：一种是以太网捆绑包，夹层卡端口为以太网类型；另一种是 FC 捆绑包，夹层端口为 FC 类型。</block>
  <block id="f955c2aa7355bfa46e658748f5cf357e" category="summary">要停用 node1 ，您需要正确关闭 node1 并将其从机架或机箱中卸下。</block>
  <block id="677d00db9337ffe0ff96eb465e769343" category="summary">为 NVE 配置新控制器模块。</block>
  <block id="173783cbe092db6a29468de90fe438e4" category="paragraph">如果更换的控制器或新控制器的 HA 配对项使用 NetApp 卷加密，则必须为新控制器模块配置 NetApp 卷加密。</block>
  <block id="03b11da9f8060b934f9b3411198fea29" category="list-text">对列出的每个密钥管理服务器重复上述步骤。</block>
  <block id="c61ecb9aacaa88894fa1697ec209966a" category="paragraph">您最多可以链接四个密钥管理服务器。</block>
  <block id="db109f602a3b7cebd1a7f99683224535" category="list-text">将所有链接的密钥管理服务器中的身份验证密钥还原到新节点：</block>
  <block id="d2b3e4b0ae30abdd31414891613ecac2" category="list-text">还原外部密钥管理器的身份验证：</block>
  <block id="74c90316d25b4cdc5c8e524af066a5a0" category="paragraph">`s安全密钥管理器外部还原`</block>
  <block id="eed577fe70cdcd6a422d81d49e0f94ca" category="paragraph">此命令需要板载密钥管理器（ OKM ）密码短语。</block>
  <block id="57bd5edad2e4a85125aa9528f6fa4cea" category="list-text">还原 OKM 的身份验证：</block>
  <block id="0710333d98c8cf9c9613b4b9c4e15e64" category="cell">`security key-manager setup -node &lt;node_name&gt;`</block>
  <block id="0b1682f87011162faab1af2fa8ad8f59" category="summary">c 在完成其余操作步骤之前配置端口和卡设置。</block>
  <block id="e163b825512519a699383447144a9f8c" category="list-text">如果 node3 没有板载 FC 端口，板载 UTA/UTA2 端口或 UTA/UTA2 卡，并且您要升级具有存储磁盘的系统，则可以跳至 <block ref="3b6c063a8efbc88c969c7838f0611434" category="inline-link-macro-rx"></block> 部分。</block>
  <block id="7d0739079baed100420d18c056ca0deb" category="list-text">但是，如果您使用的是 V 系列系统或安装了 FlexArray 虚拟化软件和存储阵列的系统，并且 node3 没有板载 FC 端口，板载 UTA/UTA 端口或 UTA/UTA2 卡，请返回到 _Install and boot node3_ 部分并继续执行 <block ref="279060155dcadaa13689560d46e381cb" category="inline-link-macro-rx"></block>。</block>
  <block id="81fed3b8a4c90b1e08e96db4e364a264" category="list-text">如果 node3 没有 UTA/UTA2 卡或 UTA/UTA2 板载端口，请跳过部分 <block ref="574c49ad3466f1bed21aff7050a30e36" category="inline-xref-macro-rx"></block>。然后转到部分 <block ref="3b6c063a8efbc88c969c7838f0611434" category="inline-link-macro-rx"></block>。</block>
  <block id="192b140d95aa5779e6ddd34b883a91bb" category="list-text">如果 node3 没有 UTA/UTA2 卡或 UTA/UTA2 板载端口，请跳过部分 <block ref="574c49ad3466f1bed21aff7050a30e36" category="inline-xref-macro-rx"></block> 并返回到恢复时的 _Install and boot node3_ 部分 <block ref="279060155dcadaa13689560d46e381cb" category="inline-link-macro-rx"></block>。</block>
  <block id="a69c4b39f212e41199201fde407c6c9e" category="cell">转至 <block ref="3b6c063a8efbc88c969c7838f0611434" category="inline-link-macro-rx"></block></block>
  <block id="5bb1d2d89905f521825083d671817bcb" category="cell">是 V 系列系统或具有 FlexArray 虚拟化软件并连接到存储阵列</block>
  <block id="06ebdeec742f5f261b968dabee7ce4bc" category="cell">返回到 _Install and boot node3_ 并继续中的部分 <block ref="279060155dcadaa13689560d46e381cb" category="inline-link-macro-rx"></block>。</block>
  <block id="98df3e165a2b52781e38f636917b8597" category="list-text">【第 16 步】如果系统进入重新启动循环并显示消息 `未找到磁盘` ，这是因为它已将端口重置回目标模式，因此无法看到任何磁盘。继续 <block ref="cc511b4dbeed99af4a19f83ac3e97f04" category="inline-xref-macro-rx"></block> to <block ref="8dac798a0974640f6cae187a1dbe2d57" category="inline-xref-macro-rx"></block> 以解决此问题。</block>
  <block id="0aa7eed219d80f1d3e8d2545e4b710c9" category="summary">如果新节点具有一组不同的网络端口，则必须确保该节点成功加入仲裁。</block>
  <block id="4a186232ad8f3f81c70414871d7267f9" category="paragraph">使用新控制器的节点首先会启动并自动尝试加入集群；但是，如果新节点具有一组不同的网络端口，则必须执行以下步骤以确保该节点成功加入仲裁。</block>
  <block id="224e96d1485db2dffbe7521db5e3b8db" category="paragraph">您可以对任何相关节点使用这些说明。node3 在以下样本中使用。</block>
  <block id="fb2ae3407dbb65ffe5f8f2ab09ba07d0" category="list-text">输入以下命令并检查其输出，以验证新集群端口是否位于集群广播域中：</block>
  <block id="3cb8659a043650dc7ac58ea24d685632" category="paragraph">`network port show -node -port port -fields broadcast-domain`</block>
  <block id="31ee4113a91e33fbefc812b660a4b1ed" category="paragraph">以下示例显示端口 "e1a" 位于 node3 上的集群域中：</block>
  <block id="5196f85280b4d8f2fde41a628b5ed883" category="list-text">输入以下命令并检查其输出，将正确的端口添加到集群广播域：</block>
  <block id="3c5acee2cec17679c5be3b6cbcdd5c0d" category="list-text">使用以下命令将每个 LIF 的集群 LIF 迁移到新端口一次：</block>
  <block id="ddfb11e04a10f57aca782a9cbca9dc5f" category="paragraph">`network interface migrate -vserver cluster -lif &lt;lif_name&gt; -source-node node3 - destination-node node3 -destination-port &lt;port_name&gt;`</block>
  <block id="2bb80bd4ebcf6539543d74e66779c6af" category="list-text">如果集群端口不在集群广播域中，请使用以下命令添加它们：</block>
  <block id="039efdbf627e2714bf4ae20682788b00" category="paragraph">`network port broadcast-domain add-ports -ipspace cluster -broadcastdomain cluster - ports node ： port`</block>
  <block id="251908cb596e6149cba77f2cb7558b73" category="list-text">从集群广播域中删除旧端口。您可以对任何相关节点使用。以下命令将删除 node3 上的端口 "e0d" ：</block>
  <block id="3a77dcc8c0ced4edb3012a4377887fef" category="paragraph">`network port broadcast-domain remove-ports network port broadcast-domain remove-ports ipspace cluster -broadcast-domain cluster ‑ports node3 ： e0d`</block>
  <block id="94633ca5c1dd75af12a1c5cf6f093384" category="list-text">验证节点是否已重新加入仲裁：</block>
  <block id="af6cb4674b921de300bcb5bdea383996" category="list-text">调整托管集群 LIF 和节点管理 / 集群管理 LIF 的广播域。确保每个广播域包含正确的端口。如果某个端口托管 LIF 或位于 LIF 的主目录中，则无法在广播域之间移动该端口，因此您可能需要按如下所示迁移和修改 LIF ：</block>
  <block id="cd44bb6e4bc3e07a88dbfa652b3b8611" category="list-text">在广播域中添加或删除端口： `network port broadcast-domain add-ports network port broadcast-domain remove-port`</block>
  <block id="1042ef89ad8bb9047b18d18768633b0c" category="list-text">修改 LIF 的主端口： `network interface modify -vserver vserver -lif &lt;lif_name&gt; – home-port &lt;port_name&gt;` 根据需要调整集群间广播域并迁移集群间 LIF 。数据 LIF 保持不变。</block>
  <block id="00c3120a80791aefa9122b20e592078e" category="summary">您必须验证 node2 上的物理端口是否正确映射到 node4 上的物理端口。</block>
  <block id="3d0dd85a75a5d4402e67907aad60c4bf" category="paragraph">您必须验证 node2 上的物理端口是否正确映射到 node4 上的物理端口，从而使 node4 能够在升级后与集群中的其他节点以及网络进行通信。</block>
  <block id="1f689cbf21b231665fddfb1e6d536c70" category="paragraph">node4 的软件配置必须与 node4 的物理连接匹配，并且必须先还原 IP 连接，然后才能继续升级。</block>
  <block id="bf8b9055a5342a7293763811a06a8608" category="paragraph">端口设置可能因节点型号而异。您必须使原始节点的端口和 LIF 配置与新节点的配置计划兼容。这是因为新节点在启动时会重播相同的配置，也就是说，当您启动 node4 时， Data ONTAP 将尝试在 node2 上使用的相同端口上托管 LIF 。</block>
  <block id="fbec007548b328ac0c95f6da4a3baeae" category="paragraph">因此，如果 node2 上的物理端口不直接映射到 node4 上的物理端口，则需要更改软件配置，才能在启动后还原集群，管理和网络连接。此外，如果 node2 上的集群端口未直接映射到 node4 上的集群端口，则在重新启动仲裁时， node4 可能无法自动重新加入仲裁，直到对软件配置进行更改，以便将集群 LIF 托管在正确的物理端口上为止。</block>
  <block id="bad707bf91a771b52edba306ada6de3a" category="list-text">将 node2 ，端口，广播域和 IP 空间的所有 node2 布线信息记录在表中：</block>
  <block id="7d59f6e2a8043f873c459c922f1be4ac" category="cell">Node2 端口</block>
  <block id="45b46ba4750e074aa4e7304855388746" category="cell">节点 2 IP 空间</block>
  <block id="7774466fbe6f6785b221d88e974172bf" category="cell">节点 2 广播域</block>
  <block id="b820c2559c77f1207711b13680c2cd4b" category="cell">Node4 端口</block>
  <block id="db2291ca53692966923fd04da1d08262" category="cell">节点 4 IP 空间</block>
  <block id="29ed689e40f8d5b58cdea33f9a18e301" category="cell">Node4 广播域</block>
  <block id="e0b5ca8e30da43caab0dc808ecb2fd97" category="list-text">将 node4 ，端口，广播域和 IP 空间的所有布线信息记录在表中。</block>
  <block id="0906da04c2f71c2ff6e8d8aa1a0b62e6" category="paragraph">此命令的值必须与系统的物理状态匹配。</block>
  <block id="c3e082d7583cd2ead0dcc409f5542b21" category="list-text">按照以下步骤将 node4 置于仲裁状态：</block>
  <block id="db937998c9896c71a694ce3ace71be28" category="list-text">启动节点 4.请参见 <block ref="f326c815b47f4f2909494bae5cd735d5" category="inline-link-macro-rx"></block> 以启动节点（如果尚未启动）。</block>
  <block id="9721a97ccd9a5f90e5dbf3fc6d7d79e8" category="paragraph">以下示例显示端口 "e0a" 位于 node4 上的集群域中：</block>
  <block id="97b7450d8bd85e6393b74d4dbf4450d0" category="paragraph">`network port modify -node node4 -port e1b -ipspace cluster -mtu 9000`</block>
  <block id="b65837675f757fb8cbeadd63c9cd73ba" category="paragraph">`network interface migrate -vserver cluster -lif &lt;lif_name&gt; -source-node node4 destination-node node4 -destination-port &lt;port_name&gt;`</block>
  <block id="69b32f8a94b6832dc6d48eee17de9eb8" category="paragraph">此命令将删除 node4 上的端口 "e0d" ：</block>
  <block id="b99a704778802fd3eec12de47c8eef3e" category="paragraph">`network port broadcast-domain remove-ports -ipspace cluster -broadcast-domain cluster ‑ports node4 ： e0d`</block>
  <block id="046f5601edc5838681a4341447d07a3c" category="list-text">验证 node4 是否已重新加入仲裁：</block>
  <block id="72b363c4e1bc7c833058a354c35ccc13" category="list-text">【 auto_map_4_Step5]] 调整托管集群 LIF 和节点管理 / 集群管理 LIF 的广播域。确保每个广播域包含正确的端口。如果某个端口托管 LIF 或位于 LIF 的主目录中，则无法在广播域之间移动该端口，因此您可能需要迁移和修改 LIF ，如以下步骤所示：</block>
  <block id="6780452e8545385148d380db905f436b" category="paragraph">`network port broadcast-domain add-ports` `network port broadcast-domain remove-ports`</block>
  <block id="bcce02a72b0cedac49d7cddd94899e2b" category="paragraph">`network interface modify -vserver &lt;vserver&gt; -lif &lt;lif_name&gt; – home-port &lt;port_name&gt;`</block>
  <block id="9cad7d7bd6306823f6764eed03150b40" category="list-text">如有必要，请使用中所示的相同命令调整集群间广播域并迁移集群间 LIF <block ref="c86367403222084077e79731124e45bf" category="inline-xref-macro-rx"></block>。</block>
  <block id="85668f79ccc0a9c2b457eb839ed11619" category="list-text">如有必要，请使用中所示的相同命令调整任何其他广播域并迁移数据 LIF <block ref="c86367403222084077e79731124e45bf" category="inline-xref-macro-rx"></block>。</block>
  <block id="df67040888f09ede9f57e8123e071106" category="list-text">如果 node2 上有任何端口在 node4 上不再存在，请按照以下步骤将其删除：</block>
  <block id="5a2881d4439f8933c1dc179fb49a9495" category="paragraph">以下命令会将故障转移策略设置为 `broadcast-domain-wide` ，并使用故障转移组 `fg1` 中的端口作为 LIF `data1` on `node4` 的故障转移目标：</block>
  <block id="c85edd1a59a6da53fbfe967ef36e8db3" category="paragraph">`network interface modify -vserver node4 -lif data1 failover-policy broadcast-domainwide -failover-group fg1`</block>
  <block id="197cf83159625e94e69b0fc1efa0e824" category="list-text">验证 node4 上的更改：</block>
  <block id="37df1e4edda8a9bce8aa91096f265331" category="list-text">【第 5 步】输入以下命令并检查输出，验证 node2 上是否没有剩余数据 LIF ：</block>
  <block id="738cc83e33e6f068712b1528860c1691" category="paragraph">`network interface show - curr-node &lt;node2&gt;-role data`</block>
  <block id="c76c038ef9582123a69154e143b5e63f" category="list-text">输入以下命令并检查其输出，以检查节点上是否配置了任何接口组：</block>
  <block id="e0d9b9a8ceb38f16ee39f9732b0b1c59" category="paragraph">`network port ifgrp show -node &lt;node2&gt;-ifgrp &lt;ifgrp_name&gt; -instance`</block>
  <block id="42610df90a5616a22b3f0c895971522b" category="summary">您必须确保节点成功加入仲裁。</block>
  <block id="83d7d02690134c88d040a5e6d81a981b" category="paragraph">您可以对任何相关节点使用这些说明。node3 在以下样本中使用。</block>
  <block id="aa38e04ca4c35fceef45210d8b6a003a" category="list-text">输入以下命令并检查输出，以验证新集群端口是否位于集群广播域中：</block>
  <block id="9c334e7e4defdbeb8571e0c5e2a8abf3" category="list-text">输入以下命令并检查输出，将正确的端口添加到集群广播域：</block>
  <block id="d56cf77a0ff93267197cac68675e86ba" category="paragraph">`network interface migrate -vserver cluster -lif &lt;lif_name&gt; -source-node node3 destination-node node3 -destination-port &lt;port_name&gt;`</block>
  <block id="03631f9ee15255f006df50849cffb9de" category="list-text">按如下所示修改集群 LIF 的主端口：</block>
  <block id="929697b9e81ed66dcaa4410aa1b6eea4" category="paragraph">`network port broadcast-domain add-ports -ipspace cluster -broadcasastdomain 集群端口节点： port`</block>
  <block id="440a119559739fb047b33344e93fc5ac" category="list-text">按照以下步骤验证节点是否已重新加入仲裁：</block>
  <block id="ca5fc614df4c9dce6d5728a3a2c40003" category="paragraph">`network port broadcast-domain add-ports network port broadcast-domain remove-port`</block>
  <block id="deb6dba98f2d5d5a1fde945303708e5d" category="list-text">修改 LIF 的主端口：</block>
  <block id="59453ab85ab73f877db83a711238b646" category="paragraph">`network interface modify -vserver &lt;vserver-name&gt; -lif &lt;lif_name&gt; – home-port &lt;port_name&gt;`</block>
  <block id="764f98dfaba7470447914335050a58df" category="paragraph">调整集群间广播域，并根据需要迁移集群间 LIF 。数据 LIF 保持不变。</block>
  <block id="e408c072357fac994037ece79ff21e68" category="summary">如果任何聚合无法重新定位或被否决，您必须手动重新定位这些聚合。</block>
  <block id="b42a4717030452cc205d4d9947f80c7b" category="paragraph">如果任何聚合无法重新定位或被否决，您必须手动重新定位聚合，或者在必要时覆盖否决或目标检查。</block>
  <block id="70ab34491b1c348e1a029bf39dad5d2c" category="list-text">检查 EMS 日志以确定聚合无法重新定位或被否决的原因。</block>
  <block id="fda7b29c76219f4ea7f3c24b3ed9b721" category="paragraph">`storage aggregate relocation start -node &lt;node1&gt; -destination &lt;node2&gt; aggregate-list * -ndocontroller-upgrade true`</block>
  <block id="cc9d127dc39047b3e73421f03d8d0026" category="cell">输入以下内容： `storage aggregate relocation start -override-vetoes * -ndocontroller-upgrade true`</block>
  <block id="6067a4436975e19e7c76700ceeabd5c2" category="cell">输入以下内容： `storage aggregate relocation start -overridedestination-checks * -no-controllerupgrade true`</block>
  <block id="5d31fed055d0ffaa300ac7d383fea64c" category="summary">如果要使用 NVE 对要升级的系统上的卷进行加密，则必须将加密配置同步到新节点。</block>
  <block id="7fc7a7a8a49bc61025e4ea8aebd0839f" category="summary">在物理将节点装入机架后，您可能需要通过网络启动它们。</block>
  <block id="83e3abbe2d4f63155eff798e62e1a616" category="inline-link-macro">第 3 阶段安装和启动节点 3.</block>
  <block id="bb9252c2a7cbae6e0a2014a53400a55c" category="paragraph">但是，如果控制器上安装的 ONTAP 9 版本与原始控制器上安装的版本相同，则无需通过网络启动控制器。如果是，您可以跳过此部分并继续 <block ref="a3940c661e200ff7ee0136ca0ef37651" category="inline-link-macro-rx"></block></block>
  <block id="47d2d2bfe5e2f318b6d816e5adc3929d" category="paragraph">如果节点 3 在此阶段崩溃，则不会发生接管，因为 HA 已被禁用。</block>
  <block id="f361f80547aae98b60e1c7ecc861a027" category="paragraph">非根聚合发生中断，这些聚合已重新定位，直到 node3 重新启动。</block>
  <block id="07c1aaa58cd1a9ed9a8f92aecfc26662" category="paragraph">在 node3 启动期间，所有聚合都会发生客户端中断。</block>
  <block id="c0292f7525a7863a4df334fb2426ba92" category="summary">在控制器升级期间，此控制器将被替换为另一个运行更新或功能更强大的平台的控制器。</block>
  <block id="3ffee04e4bb020103f1bece18c2ac58e" category="doc">自动执行控制器升级过程</block>
  <block id="de8c3311256a86cce047cb3a63efa71a" category="paragraph">在控制器升级期间，此控制器将被替换为另一个运行更新或功能更强大的平台的控制器。</block>
  <block id="e49fc42bb044e22524046235b0ccbd4c" category="summary">在使用 ARL 升级节点之前，您应了解操作步骤的工作原理分为多个阶段。</block>
  <block id="0a00cf76c766f3c9437fe3941fdf22c4" category="cell">第 1 阶段。准备升级。</block>
  <block id="a6366d7a1348b24e3fdee3eff8dea3c6" category="list-text">将非根聚合从 node1 移动到 node2 。</block>
  <block id="949747e4d3329e8b9a9e7ab4a5c5cb71" category="list-text">将节点 1 拥有的非 SAN 数据 LIF 移动到节点 2 。</block>
  <block id="bc8f48f93dda6e3952b34dfbe1025b15" category="list-text">设置 FC 或 CNA 配置。</block>
  <block id="3f5c1bacca95dbafb20a5f179a1942a1" category="list-text">将端口从 node1 映射到 node3</block>
  <block id="54a39699f4ada20f9a2f7d43ba99505c" category="list-text">将 node1 拥有的非 SAN 数据 LIF 从 node2 移动到 node3 。</block>
  <block id="91e22d907fccb4bca308f7b5eda21afe" category="list-text">将节点 2 拥有的非 SAN 数据 LIF 移动到节点 3 。</block>
  <block id="3fdf70ee47a45b22517705d18baeebc9" category="list-text">将端口从 node2 映射到 node4</block>
  <block id="d27f63bee356811b88d04e4d588f22db" category="list-text">验证 node4 安装</block>
  <block id="0895162788980393fe5dfd2240f70f94" category="list-text">根据需要恢复 SnapMirror 操作。</block>
  <block id="1c35d7a8e952b00e97b01d6d33eedd5e" category="summary">安装并启动 node3 后，您需要验证是否已正确安装它。</block>
  <block id="7d3380555ca7efd6a1fad31091de1dd7" category="paragraph">安装并启动 node3 后，您需要验证是否已正确安装它。您必须等待 node3 加入仲裁，然后恢复重新定位操作。</block>
  <block id="2fa5c37305bc33a6ae27bb983656d1e3" category="list-text">检查操作状态，并验证 node3 的配置信息是否与 node1 相同：</block>
  <block id="7ae288e57d9c04f2d5a1b7ff338ee758" category="paragraph">如果 node3 的配置不同，则稍后可能会在操作步骤中发生系统中断。</block>
  <block id="d845d17a5ef5b3ab80e9280a67c911e8" category="list-text">检查更换的控制器是否已针对 MetroCluster 配置正确配置， MetroCluster 配置应处于运行状况良好，而不是切换模式。请参见 <block ref="14c0e32a98a31f9fd4a16b635b2f7ebd" category="inline-link-macro-rx"></block>。</block>
  <block id="3c18bf7f079d36181ad6878ed8071663" category="summary">您必须将配置信息从根卷还原到启动设备。</block>
  <block id="bc40b2f6345ce25ab7662ef954f79eac" category="doc">还原根卷配置</block>
  <block id="e1658469b860d365597876856e38950a" category="paragraph">您需要在 node3 和 node4 上执行这些步骤，在一个节点上依次完成每个步骤和另一个节点上的步骤，然后再继续执行下一步。</block>
  <block id="8025560869bc5bb571a283b93eb36c25" category="list-text">从 LOADER 提示符访问启动菜单：</block>
  <block id="3b30581e1dcf21fb5bc10ab7b7b14ebc" category="list-text">从启动菜单中，选择 ` （ 6 ） Update flash from backup config` ，并在系统提示您继续时输入 `y` 。请选择以下选项之一：</block>
  <block id="e568219783dc2975662f32e6665b9312" category="paragraph">更新闪存过程运行几分钟，然后系统重新启动。</block>
  <block id="64c7b7b950f686aaa9399673582360b1" category="list-text">当系统提示您确认系统 ID 不匹配时，输入 `y` 。</block>
  <block id="e4c1c828d40a575431492bab6401d8ae" category="paragraph">启动顺序正常进行。</block>
  <block id="f068cb7de6bc557a6102cbb510f726f0" category="summary">您必须安装新节点并将其加入集群，以便可以从原始节点移动卷。</block>
  <block id="0a89217206ded71020fde70b9be96510" category="doc">安装新节点并将其加入集群</block>
  <block id="b241ff4d47149b1cfcc3bff8ac743191" category="paragraph">通过移动卷升级控制器硬件时，原始节点和新节点必须位于同一集群中。</block>
  <block id="48c7c41b72e1d678923ce3571aa65b2d" category="list-title">步骤</block>
  <block id="c73b08eed72ad3afd194519ddb22ebc4" category="list-text">安装新节点并将其加入集群：</block>
  <block id="5da3c5c759e159e1aab297e687e23060" category="cell">如果集群正在运行 ...</block>
  <block id="b7c4538baf1def6c115b8c9ce3581612" category="cell">按照中的说明进行操作 ...</block>
  <block id="a0783764f121d0362f984f57649b230b" category="paragraph">ONTAP 9.0 或更高版本</block>
  <block id="ed3f2da4177cc35b1433eccf1a2e9b37" category="paragraph">ONTAP 9.0 之前的版本</block>
  <block id="8f2f5cebfa6b4e869a159dbf3cedb773" category="inline-link">查找适用于您的 Data ONTAP 8 版本的《集群扩展快速指南》</block>
  <block id="2f22c527d871517945ac34102d2f6931" category="summary">要通过移动存储来完成操作步骤升级，您需要从新节点中删除所有未使用的端口和 LIF ，重新启用存储故障转移或高可用性，配置服务处理器 \ （ SP\ ），安装新许可证并设置 AutoSupport 。您可能还需要设置存储或卷加密并配置 FC 或 CNA 端口。</block>
  <block id="5112ce36807c8e031c9ab063bc28ce71" category="doc">在 ONTAP 9.7 或更早版本中执行最终升级步骤</block>
  <block id="c4d0156d9500edcd23bba4f179a52fa7" category="paragraph">要通过移动存储来完成操作步骤升级，您需要从新节点中删除所有未使用的端口和 LIF ，重新启用存储故障转移或高可用性，配置服务处理器（ SP ），安装新许可证以及设置 AutoSupport 。您可能还需要设置存储或卷加密并配置 FC 或 CNA 端口。</block>
  <block id="6afad8777741cb158249cdcde37c14fe" category="inline-xref-macro">在 ONTAP 9.8 中执行最终升级步骤</block>
  <block id="253783c6125a504d15d61a091415d8d8" category="paragraph">这些步骤适用于运行 ONTAP 9.7 或更早版本的系统。如果您运行的是 ONTAP 9.8 ，则必须在中使用操作步骤 <block ref="b47981dbddf657334d68e85ddce9d886" category="inline-xref-macro-rx"></block>。</block>
  <block id="38e9bf55ae23722d14604ba35ee5bcd1" category="inline-xref-macro">在 ONTAP 9.8 中执行最终升级步骤</block>
  <block id="50aee2f4fc79ea5e0b4ababa4a4889b1" category="list-text">如果系统运行的是 ONTAP 9.8 ，请执行 * 停止 * 。您必须在中使用操作步骤 <block ref="362f5b69398efdd58c711f175ac3611b" category="inline-xref-macro-rx"></block>。</block>
  <block id="83e8f1a7c1a2c10d90059989f69becc7" category="list-text">在存储系统提示符处，显示有关 LIF 的信息：</block>
  <block id="de11c3d9da699c5b0528297ad39e25cb" category="list-text">从新节点中删除任何未使用的端口（高级权限级别）：</block>
  <block id="1edc30c9cec2665a01f0a9cc7910d9fc" category="paragraph">`网络端口删除`</block>
  <block id="89bd08809cd5f941c4bb2cc6687fe212" category="list-text">如果您使用的是 SAN 环境，请从端口集中删除未使用的 LIF ，以便可以将其删除：</block>
  <block id="76cde272010074b17076f956bb6d89f8" category="list-text">显示端口集列表：</block>
  <block id="18ecf1639f5534ac5a785a3b8e1d413f" category="paragraph">`lun portset show`</block>
  <block id="c9afae54fd0724e5cf3fea1615684aa8" category="list-text">从端口集中删除所有未使用的 LIF ：</block>
  <block id="2585d1a54081f67afe396a9a7f2d20fc" category="paragraph">`lun portset remove`</block>
  <block id="c0535f3650a99508f47cb0b1cc1a34ac" category="list-text">从新节点中删除每个未使用的 LIF ：</block>
  <block id="ab316765db1b6096837da27d30f7afbd" category="paragraph">`网络接口删除`</block>
  <block id="eb300e9e31367fa48035e27472f75b6f" category="list-text">根据需要在新节点对上重新启用存储故障转移或高可用性：</block>
  <block id="e8599f3c8ef213317efbf60b0379685c" category="cell">如果您有 ...</block>
  <block id="73b5646d22daa7a0c1b15cb75822045d" category="cell">双节点集群</block>
  <block id="7315714b19f21e9ad91dfa8b10b194f9" category="cell">重新启用高可用性： `cluster ha modify -configured true`</block>
  <block id="1ec03101c59723f4e07d47729c2bb2c0" category="cell">包含两个以上节点的集群</block>
  <block id="35dece72c7fa8f55fa95338ea53d5bb8" category="cell">重新启用存储故障转移： `storage failover modify -node node_name -enabled true`</block>
  <block id="8f581810d42d6aab9a995890e97f0a55" category="list-text">根据需要在新节点上配置 SP ：</block>
  <block id="ac1f1418c4fb176ba9565108305de59a" category="paragraph">`ssystem service-processor network modify`</block>
  <block id="7e8a470724bdedbac7acdf0c919a8f0d" category="list-text">根据需要在新节点上安装新许可证：</block>
  <block id="5da2b156280daaa1fc2fe1cb2772416f" category="paragraph">`s系统许可证添加`</block>
  <block id="3d0e110b052ddfe7c5e1d2238e076ff2" category="list-text">在新节点上设置 AutoSupport ：</block>
  <block id="844ad6e55c95a4328e37b5e065b5ff4a" category="paragraph">`s系统节点 AutoSupport modify`</block>
  <block id="e31a23cd4ecc24fce8358862c8b9bae7" category="list-text">从每个新节点上，向技术支持发送升级后 AutoSupport 消息：</block>
  <block id="39f6fe42807470e793eabaa7b4decf63" category="paragraph">`ssystem node AutoSupport invoke -node node_name -type all -message "MAINT=end node_name successfully uped" from platform_old to platform_new"`</block>
  <block id="e68c8836280fba147b04a2b14b196600" category="paragraph">根据您使用的是板载密钥管理还是外部密钥管理，请执行以下过程之一：</block>
  <block id="0ba3cc03b09a456d5100379e45dfaaba" category="list-text">"`还原板载密钥管理加密密钥` "</block>
  <block id="a96d0d7d353c649cc2f1612f3100f861" category="list-text">"`还原外部密钥管理加密密钥` "</block>
  <block id="ef613ca6be844d20a9465aad12778acf" category="list-text">如果新节点具有 FC 端口（板载或 FC 适配器上的），板载 CNA 端口或 CNA 卡，请在存储系统提示符处输入以下命令来配置 FC 或 CNA 端口：</block>
  <block id="7334dc04c7292582343d824254e622ce" category="paragraph">`ssystem node hardware unified-connect modify -node node-name -adapter adapter-name -mode ｛ fc_CNA ｝ -type ｛ target_initiator ｝`</block>
  <block id="b50a05f2d30350b2ea8e112696c796d0" category="paragraph">只有当 CNA 适配器脱机时，才能修改 CNA 配置。</block>
  <block id="55c24359193cebab5cdb49b7cf7d04b5" category="list-text">如有必要，在新节点上设置无交换机集群。</block>
  <block id="a4fda524e3ce1bcbcd36efab17cd9e24" category="inline-link">迁移到使用 Cisco 集群交换机的双节点交换集群</block>
  <block id="0e15b03083512d986709666b0825a949" category="inline-link">迁移到使用 NetApp CN1610 集群交换机的双节点交换集群</block>
  <block id="caa541c368ed2e96d996d661d22bc171" category="list-text">根据需要，通过 NetApp 支持站点停用原始系统，以通知 NetApp 这些系统不再运行，可以从支持数据库中删除：</block>
  <block id="09ea0908fbfc4cde85bf416e35dc55c8" category="inline-link">NetApp 支持</block>
  <block id="5f76ca3d5838bbe4e3afe662f3e0e008" category="list-text">单击链接 * 我已安装的系统 * 。</block>
  <block id="b64b23511c1735fad8c07cd83da6444e" category="list-text">在 Installed Systems 页面上，以格式输入旧系统的序列号，然后单击 * 执行！ *</block>
  <block id="6bdb588e04554302f22e13e36fc8cfcd" category="list-text">在 " 弃用表单 " 页面上，填写表单并单击 * 提交 * 。</block>
  <block id="a6544f7c3c36002518f645319241e489" category="paragraph">您已完成升级操作步骤。</block>
  <block id="589fe3c8d827ae39970fa59898cfc3ee" category="summary">通常，控制器硬件的升级方式取决于原始节点的平台型号。您可以通过移动存储 \ （中断操作步骤 \ ）或移动卷 \ （无中断操作步骤 \ ）进行升级。</block>
  <block id="5b0415c2846efde1fb66c48433f25633" category="doc">选择升级控制器硬件的方法</block>
  <block id="39b87627b0135db0ab3ea0a8e2f859bd" category="paragraph">通常，控制器硬件的升级方式取决于原始节点的平台型号。您可以通过移动存储（中断操作步骤）或移动卷（无中断操作步骤）来升级。</block>
  <block id="e8617aabffae0af74d02587319a2e105" category="image-alt">升级控制器硬件的方法</block>
  <block id="dc49ed6b9d1ec56bf48eacc8c90c1a11" category="admonition">使用内部驱动器的型号包括： FAS2220 ， FAS2240-2 ， FAS2240-4 ， FAS2520 ， FAS2552 ， FAS2554 ， FAS2620 ， FAS2650 ， FAS2720 ， FAS2750 ， AFF A200 ， AFF A220 ， AFF A700s ， AFF A800 ， AFF A250 。</block>
  <block id="e5e09031843479ef9ef8cbbd4c2f404c" category="inline-link">NetApp Hardware Universe</block>
  <block id="d33f2a600ba4fe43084a26e95e4908c0" category="paragraph">* 相关信息 *</block>
  <block id="dafbb22fd53a8bbbcd7e0e587f256606" category="inline-link-macro">通过移动存储进行升级的工作流</block>
  <block id="268c885d4c1c9189f00bfa017a5b9d17" category="paragraph"><block ref="268c885d4c1c9189f00bfa017a5b9d17" category="inline-link-macro-rx"></block></block>
  <block id="7d466f4faaea4136b0f35ee3a444b2ee" category="inline-link-macro">通过移动卷进行升级的工作流</block>
  <block id="c8b09d07f5441b617dbdf76973a08943" category="paragraph"><block ref="c8b09d07f5441b617dbdf76973a08943" category="inline-link-macro-rx"></block></block>
  <block id="ae2a729cf8a689b034991414ae49b1fb" category="summary">通过移动存储进行升级时，首先要安装 node3 和 node4 ，并将电源，控制台和网络连接连接连接到新节点。</block>
  <block id="6659a60f476a4bc6bb0fb4f4102757a3" category="doc">安装新节点</block>
  <block id="7bee235304d66460f5514bec30b84491" category="list-text">按照平台的 _Installation and Setup Instructions_安装 新节点。</block>
  <block id="d3bce5b47df40dd2fa2c5263447f1fef" category="paragraph">此时，请勿将磁盘架从原始节点连接到新节点。</block>
  <block id="eee400f6654fba9ea347faff838af3e5" category="list-text">按照平台的 _Installation and Setup Instructions_将 电源和控制台连接连接到 node3/node4 HA 对。</block>
  <block id="24d72d714e0459bffa2dc49d7ff220e1" category="list-text">连接网络缆线。</block>
  <block id="9d50d3e8c7d08c93404d2be2587afc66" category="list-text">将除存储架缆线外的所有剩余缆线分别从 node1/node2 HA 对传输到 node3/node4 上的相应端口。</block>
  <block id="5a8dfa3943e8e71201fd576d26e40b9d" category="paragraph">这包括不用于连接存储架的光纤通道和以太网缆线。</block>
  <block id="9cd94a0a224271a5cd21acb271cdd506" category="summary">您至少要在每个新节点上创建一个聚合，以存储要从原始节点移动的卷。您必须为每个卷标识一个聚合，并单独移动每个卷。</block>
  <block id="3085ebd8810ece8cd93e0024bdb65eb1" category="doc">创建聚合并将卷移动到新节点</block>
  <block id="b256175cc88e3f891053e44ca8855b5d" category="paragraph">必须先初始化数据保护镜像关系，然后才能移动卷。</block>
  <block id="4cbaf693faaaa40a1e90a2e2918ba582" category="list-text">在每个新节点上至少创建一个聚合：</block>
  <block id="8766dbee0d34b7a34ce6553a78a69b85" category="paragraph">`storage aggregate create -aggregate aggr_name -node new_node_name -diskcount integer`</block>
  <block id="3cc74cedbe563be5c2d81867ccbfb198" category="list-text">将新聚合添加到要从中移动卷的原始节点上与聚合相同的 SVM 中：</block>
  <block id="fe82c8b7274d1544ce545c5b1bb60481" category="paragraph">`Vserver add-aggregates`</block>
  <block id="39e7eb0e1fd08f1ba6fea6e4df4f0d50" category="paragraph">要从中移动卷的新聚合和旧聚合必须位于同一个 SVM 中。</block>
  <block id="65c0e65d7f3d4f9b7e59695a5beed439" category="list-text">验证新聚合现在是否已分配给与原始节点上的聚合相同的 SVM ：</block>
  <block id="d144782c7f277a43532b9873909babed" category="paragraph">`vserver show -vserversvm_name`</block>
  <block id="60ffd94dccfc67beb8507929d59460e3" category="list-text">显示要从原始节点移至新节点的卷的信息：</block>
  <block id="c9a520bfa2f4bc1f1f220656e029f2e0" category="paragraph">`volume show -vserver svm_name -node original_node_name`</block>
  <block id="045e4ac6df29d2cafc7b15a9d2d9e81e" category="paragraph">您应保留命令输出以供日后参考。</block>
  <block id="291a171e8b949620eda68d899d2e3e06" category="paragraph">以下示例显示了 "VS1" SVM 和 "node0" 节点上的卷：</block>
  <block id="383baa78f8d3606514a0526bf7b76432" category="list-text">确定可将给定卷移动到的聚合：</block>
  <block id="943dcca1dc057f958ae14268bc8da20e" category="paragraph">`volume move target-aggr show -vserver svm_name -volume vol_name`</block>
  <block id="2ed27953e3f00d2cb31db4ae51e73953" category="paragraph">以下示例显示，可以将 "VS2" SVM 上的 "user_max_" 卷移动到列出的任何聚合：</block>
  <block id="275730138630968709a9e2b4981691e3" category="list-text">对要移动的每个卷运行验证检查，以验证是否可以将其移动到指定聚合：</block>
  <block id="dccace5c37975b5248e28fc505f29272" category="paragraph">`volume move start -vserver svm_name -volume volume_name -destination-aggregate destination_aggregate_name -perform-validation-only true`</block>
  <block id="de2d56bd81b546dcca46b829e3e1e6f1" category="list-text">一次移动一个卷（高级权限级别）：</block>
  <block id="c938c86730d29da993231313b0f49c52" category="paragraph">`volume move start -vserver svm_name -volume vol_name -destination-aggregate destination_aggr_name -cutover-window integer`</block>
  <block id="5b41753377d891121fddc57b374ecd0c" category="paragraph">您不能移动节点根卷（ vol0 ）。可以移动其他卷，包括 SVM 根卷。</block>
  <block id="b9a2da3111645d69717822ff4c8d43bc" category="list-text">显示 `volume move` 操作的结果，以验证卷是否已成功移动：</block>
  <block id="eeb9bfe54f212bc92f6dfd9bfd696f57" category="paragraph">`volume move show -vserver svm_name -volume vol_name`</block>
  <block id="ef14daf085f4427e7af6d6339e2a9dd6" category="list-text">如果多次尝试后， `volume move` 操作未完成最后阶段，请强制完成移动：</block>
  <block id="af35cc4c8d875f01b72ac1b9bb33aa01" category="paragraph">`volume move trigger-cutover -vserver svm_name -volume vol_name -force true`</block>
  <block id="faadc653b9d5250917700d625763b5cc" category="paragraph">强制卷移动操作完成可能会中断客户端对要移动的卷的访问。</block>
  <block id="c127e808b121ddcc589e1612e8629e3d" category="list-text">验证卷是否已成功移至指定的 SVM 并位于正确的聚合中：</block>
  <block id="9366aa36db246276006f86c846f493d4" category="paragraph">`volume show -vserver svm_name`</block>
  <block id="308dc930942875f893b863a55b973e8a" category="summary">按照以下步骤在 ONTAP 9.8 中完成升级。</block>
  <block id="f2190862dcb9dfdb205bb24e6c66cace" category="doc">在 ONTAP 9.8 中完成升级</block>
  <block id="f88d69698129a6371fe8a552c1380b8a" category="paragraph">按照以下步骤在 ONTAP 9.8 中完成升级：</block>
  <block id="88b8cfb0eb0372af5622adb072f8536f" category="inline-link-macro">使用 ONTAP 9.8 映射网络端口</block>
  <block id="3ffb7b6a90c761ac843e42b770d3b80c" category="list-text"><block ref="3ffb7b6a90c761ac843e42b770d3b80c" category="inline-link-macro-rx"></block></block>
  <block id="9f17fc6c1046f4722f2d0dff8c12c850" category="list-text"><block ref="9f17fc6c1046f4722f2d0dff8c12c850" category="inline-link-macro-rx"></block></block>
  <block id="1c83ee60998c00cf537e241e2bd00614" category="summary">如果原始节点是支持的型号之一，则可以在通过移动存储进行升级期间将其内部 SATA 驱动器或 SSD 移动到连接到新节点的驱动器架。您还可以将系统转换为驱动器架并将其连接到新节点。</block>
  <block id="0f25f34bbc6624def56436f34d66a8ca" category="doc">可选：移动内部存储或将系统转换为驱动器架</block>
  <block id="dd49867a2bdd430ef0f1501edf2afc71" category="paragraph">您只能在同一集群中移动驱动器或驱动器架。</block>
  <block id="5445f44c8361f04d7db7417496478290" category="inline-link-macro">从原始节点移动内部驱动器</block>
  <block id="8aeeee2821310e6e14e76fc1d344c892" category="list-text"><block ref="8aeeee2821310e6e14e76fc1d344c892" category="inline-link-macro-rx"></block></block>
  <block id="f7ccfa056b989c8b002a462176655b42" category="paragraph">如果原始节点是支持的型号之一，则在通过移动存储进行升级的过程中，您可以将节点的内部 SATA 驱动器或 SSD 移动到连接到同一集群中新节点的驱动器架。您不能将 SAS 驱动器传输到连接到新节点的驱动器架。</block>
  <block id="32bdc1101e093c57bf74fbd9789794c2" category="inline-link-macro">将原始节点转换为驱动器架</block>
  <block id="f27c828441c4bcde6d66323e36803847" category="list-text"><block ref="f27c828441c4bcde6d66323e36803847" category="inline-link-macro-rx"></block></block>
  <block id="3fae42f30ee83a6721eb3d8ce8dc8e9e" category="paragraph">如果原始节点是支持的型号之一，则在通过移动存储进行升级的过程中，您可以将节点转换为驱动器架，然后将其连接到同一集群中的新节点。</block>
  <block id="f78094c2959388f67bc989ba1cae66f1" category="summary">如果原始节点是支持的型号之一，则在通过移动存储进行升级的过程中，您可以将节点的内部 SATA 驱动器或 SSD 移动到连接到同一集群中新节点的驱动器架。您不能将 SAS 驱动器传输到连接到新节点的驱动器架。</block>
  <block id="2bfab688f89dc9f9721b34f9cf812b87" category="paragraph">如果原始节点是支持的型号之一，则在通过移动存储进行升级的过程中，您可以将节点的内部 SATA 驱动器或 SSD 移动到连接到同一集群中新节点的驱动器架。您不能将 SAS 驱动器传输到连接到新节点的驱动器架。</block>
  <block id="afe97a2560f5930aa2a5c5663fce5add" category="inline-link-macro">升级控制器硬件的注意事项</block>
  <block id="9c1c26d841e3b1333623432d7f59b92c" category="paragraph">如果您需要特定于您的配置的指导，应联系技术支持。</block>
  <block id="48b8c1b9a7f4340b2c4a53567867ba1c" category="list-text">原始节点中的 SATA 或 SSD 驱动器托架必须与新驱动器架兼容。</block>
  <block id="84dc193ac12ec0c17e52a119451eb5ee" category="list-text">新节点必须已连接兼容的驱动器架。</block>
  <block id="5936d4e5bf9684df84f3298fd69c5ff7" category="list-text">驱动器架必须具有足够的可用托架，以容纳原始节点上的 SATA 或 SSD 驱动器托架。</block>
  <block id="14118424a52e5faf27de83ea1ae0b462" category="list-text">从系统正面轻轻卸下挡板。</block>
  <block id="1009ece53b201ef044edbb499bcabdd6" category="list-text">[[move_int_drive_2]] 按驱动器托架左侧的释放按钮。</block>
  <block id="addb5ded0310559ea0a26d75615eeff4" category="paragraph">托架上的凸轮把手部分弹开，托架从中板上松开。</block>
  <block id="b74ab52594e3216640ae873b11d66486" category="list-text">将凸轮把手拉至完全打开位置，以使托架从中板中取出，然后将托架轻轻滑出驱动器架。</block>
  <block id="7e66410308ed9486077135ccddda4a00" category="admonition">在拆卸，安装或搬运驱动器时，请始终用双手。但是，请勿将手放在托架下侧暴露的驱动器板上。</block>
  <block id="14d43cc881a50f3a6183180fefe24888" category="list-text">在凸轮把手处于打开位置的情况下，将托架插入新驱动器架的插槽中，用力推动，直到托架停止。</block>
  <block id="84292dc65a5d7c537ea712d040de613a" category="admonition">插入托架时，请用双手。</block>
  <block id="1c21d383507612a44944a4ef460798a2" category="list-text">[[move_int_drive_5]] 关闭凸轮把手，使托架完全固定在中板中，并且把手卡入到位。</block>
  <block id="a89fc3e880df1938acf478cdd327af0b" category="paragraph">您应慢慢关闭手柄，使其与托架的正面正确对齐。</block>
  <block id="e31ad1284b7618a9c10777ed99b12e64" category="inline-xref">第 2 步</block>
  <block id="4d388dae867b0a86458ede8119b8865e" category="list-text">重复 <block ref="267cbc67ee851d16fc5833a2bb2eacbb" category="inline-xref-macro-rx"></block> 到 <block ref="07cb79f26065ce7eb3e55fb46a8c9f8b" category="inline-xref-macro-rx"></block> 要移至新系统的所有驱动器。</block>
  <block id="145abeddb6e0efab15a65e9dfc45e5f7" category="summary">按照以下步骤在 ONTAP 9.7 或更早版本中完成升级。</block>
  <block id="0c297b93e672c9bc05e823d846073d38" category="doc">在 ONTAP 9.7 或更早版本中完成升级</block>
  <block id="4ace04205abb0a1ff190b1a1f3e3cf03" category="paragraph">按照以下步骤在 ONTAP 9.7 或更早版本中完成升级：</block>
  <block id="e2235c37305cb98ad3fd9aa58c7fad4b" category="inline-link-macro">使用 ONTAP 9.7 或更早版本映射网络端口</block>
  <block id="df92ac10eb53320f3aee49e68f1573a2" category="list-text"><block ref="df92ac10eb53320f3aee49e68f1573a2" category="inline-link-macro-rx"></block></block>
  <block id="6b0020689d6a1c40c97b6df1736d8e38" category="inline-link-macro">在 ONTAP 9.7 或更早版本中执行最终升级步骤</block>
  <block id="00ba9232a950e876c165749336dea823" category="list-text"><block ref="00ba9232a950e876c165749336dea823" category="inline-link-macro-rx"></block></block>
  <block id="9dd804cbb0c89e2e63928e7cedd0c88f" category="summary">要规划升级，您应熟悉一般升级注意事项。如有必要，请联系技术支持，以获取有关集群配置的建议和指导。</block>
  <block id="a3cb839890daad4f93490c8dec227de5" category="paragraph">要求和限制</block>
  <block id="c9c36eddecbac88c824f0418b523c991" category="list-text">用于通过移动存储进行升级的操作步骤会造成系统中断。用于通过移动卷进行升级的操作步骤无中断。</block>
  <block id="b3dfab8a2046154178dd80b47499ce0c" category="list-text">新节点必须支持与原始节点相同的软件版本。</block>
  <block id="93f3fcba35aec9c0367976a9197bb132" category="list-text">您必须遵守最大集群大小。</block>
  <block id="6db613ee4df75882b92832a41f2f3f2e" category="paragraph">通过移动卷进行升级时，在删除原始节点之前，新节点将加入集群。确保集群中的控制器数量在操作步骤期间不超过支持的最大集群大小。</block>
  <block id="ebba69766eb24e95a1284fdab64d1a66" category="list-text">在集群中组合使用不同型号的控制器平台时，必须遵循存储平台混用规则。</block>
  <block id="ec124c8a7a4170436f2890610e4aa1c9" category="list-text">新节点必须具有足够的存储空间来容纳与原始节点关联的存储。</block>
  <block id="f1f5f029bf97e95c9c37ecdaf7cf4e93" category="list-text">新系统支持的根聚合大小和磁盘数必须等于或大于原始系统支持的大小和磁盘数。</block>
  <block id="98f3e4c18f21b25897315931895d5cd5" category="list-text">HA 对中的控制器必须为两个 AFF 型号或两个 FAS 型号。</block>
  <block id="fe2b4e59713b2c74efcd804489cd6316" category="list-text">如果节点位于同一集群中，则可以通过将卷或物理存储从一个 FAS2xxx 移动到更高的 FAS2xxx 来进行升级。例如，您可以将卷或物理存储从 FAS2552 移动到 FAS2750 。</block>
  <block id="301e2a674920a7bb1b220a6ccd88ce36" category="inline-link">选择升级或刷新方法</block>
  <block id="f2c81e3dbd5898a4f589948eb2c23e36" category="paragraph">具有内部存储的系统</block>
  <block id="da7e3567682b36e70ff65421081173d5" category="admonition">以下系统具有内部存储： FAS2220 ， FAS2240-2 ， FAS2240-4 ， FAS2520 ， FAS2552 ， FAS2554 ， FAS2620 ， FAS2650 ， FAS2720 ， FAS2750 ， AFF A200 ， AFF A220 ， AFF A700s ， AFF A800 ， AFF A250 。</block>
  <block id="2c422b7143016a62faa144bc1c6e89e1" category="list-text">如果您的系统具有内部存储，建议的升级方法是通过移动卷进行升级。</block>
  <block id="7ed352a3d30fd06459f6bd682d94f397" category="list-text">如果您的系统具有内部存储，则可以将系统转换为驱动器架并将其连接到同一集群中的新节点。FAS2220 和 FAS2520 控制器无法转换为驱动器架。</block>
  <block id="f4f3c3690b3eac7a8c0dd6678b738164" category="paragraph">在通过移动存储进行升级的工作流中，将 FAS2240 或 FAS255x 系统转换为驱动器架是一项可选任务。</block>
  <block id="b96d37f28c3d7d06841f391d5e809dbd" category="list-text">如果您的系统具有内部存储，或者系统中的卷或聚合位于内部 SATA 驱动器或 SSD 上，则可以通过将内部存储传输到连接到同一集群中新节点的驱动器架来进行升级。</block>
  <block id="3c62ff9b7896a5eed67cfbeb8bc9bfdf" category="paragraph">在通过移动存储进行升级的工作流中，传输内部存储是一项可选任务。</block>
  <block id="ae966ba3c2ce03e0c6c49d4dfc8f5702" category="paragraph">可能需要执行其他步骤的情况</block>
  <block id="4bbc849fe45c68c7c28841fb794547a0" category="list-text">如果新系统的插槽数少于原始系统，或者端口类型更少或不同，则可能需要向新系统添加适配器。</block>
  <block id="667fc202a8b204ff5a82b8390500a41b" category="list-text">如果原始节点或新节点使用 FlexArray 虚拟化软件。</block>
  <block id="4a93c6361efc1101e7ca8ee6327b63ec" category="inline-link">NetApp 知识库文章： FlexArray for NetApp 控制器升级和更换涉及哪些具体步骤</block>
  <block id="7a3f3e085939e759393b43bef32cbc95" category="list-text">如果集群具有 SAN 主机，则可能需要采取步骤来解决 LUN 序列号更改问题。</block>
  <block id="31e9ea6f4ed38186085bf9a52128a461" category="inline-link">如何使用 iSCSI 和 FCP 解决存储控制器主板更换和机头升级期间的问题</block>
  <block id="6125b5468b29015c919d2eaf565415e6" category="list-text">如果您的系统使用带外 ACP ，则可能需要从带外 ACP 迁移到带内 ACP 。</block>
  <block id="c0ae7629e7bfcf00be0d40631578d6f7" category="inline-link">NetApp 知识库文章 1029778 ： In-Band ACP Setup and Support</block>
  <block id="41e8d90d580396f4d1d06d6dcc1e6ff7" category="paragraph"><block ref="41e8d90d580396f4d1d06d6dcc1e6ff7" category="inline-xref-macro-rx"></block></block>
  <block id="b578e0f4f47404bddfc292477bc08776" category="inline-xref-macro">通过移动存储升级控制器硬件</block>
  <block id="dbef6fd254e4765e61a6f3112a900a32" category="paragraph"><block ref="dbef6fd254e4765e61a6f3112a900a32" category="inline-xref-macro-rx"></block></block>
  <block id="9932dd20d13ac6c57fa0b56b3ed1e4a0" category="inline-xref-macro">通过移动卷升级控制器硬件</block>
  <block id="cbcda6d2b36f65f36ae58e3c1d7065e5" category="paragraph"><block ref="cbcda6d2b36f65f36ae58e3c1d7065e5" category="inline-xref-macro-rx"></block></block>
  <block id="e062efd67a70d34c188657c2ffafc80e" category="summary">您必须将属于 node1 和 node2 的磁盘分别重新分配给 node3 和 node4 。</block>
  <block id="43b6e140cee78de5a68c093867c65596" category="doc">连接存储架并重新分配磁盘所有权</block>
  <block id="507efb4e488acd48724d3f1c3d4b184d" category="paragraph">您可以对 node3 和 node4 执行本节中的步骤，依次完成 node3 和 node4 上的每个步骤，然后再继续下一步。</block>
  <block id="3a1ea4eb792e23021a7c1dcb702a9545" category="list-text">将存储架缆线从 node1/node2 连接到 node3/node4 。验证电源和磁盘架的物理连接。</block>
  <block id="6617e295325d64b4136755492970fe4c" category="list-text">从 node3 LOADER 提示符处，启动到维护模式：</block>
  <block id="533823574e82f810ad592fb31173b543" category="list-text">显示 node3 的系统 ID ：</block>
  <block id="9d0e35f7d62f6d238b5cb5794b6d495c" category="paragraph">`disk show -v`</block>
  <block id="01c50956963e384ca8ffd4c7db35055b" category="paragraph">记下 node3 的系统 ID ，以便在下面的步骤 4 中使用。</block>
  <block id="8796eefce7338c136136dae2ceb1ae48" category="list-text">重新分配节点 1 的备用磁盘，属于根聚合的磁盘以及任何数据聚合：</block>
  <block id="35698942e3e79abf6ab8cd4cb3593dc3" category="paragraph">`dreassign -s _node1_sysid_ -d _node3_sysid_ -p _node2_sysID_`</block>
  <block id="ae448c109542203d3a3cde5363cfccee" category="list-text">仅当存在共享磁盘时，才指定参数 ` _-p partner_sysID_` 。</block>
  <block id="a6ac6e206a687fa5e638aeb5a2505e40" category="paragraph">重新分配 node2 的备用磁盘，属于根聚合的磁盘以及任何数据聚合时，命令为：</block>
  <block id="2e4156d3cca76c6a7c2a2eb02d8fcbd2" category="paragraph">`dreassign -s node2_sysid -d node4_sysid -p node3_sysID`</block>
  <block id="7f616e8c743e57f3b11fac3e3bd7ffb1" category="paragraph">系统将显示类似于以下内容的消息：</block>
  <block id="09d5d1bd789f2ac3b2b1c70591a93da1" category="list-text">确保在选项字段中将 node1 的根聚合设置为 `root` ，并且其他聚合处于联机状态：</block>
  <block id="d0848afd8553c34945705222a97a4553" category="paragraph">您应看到类似于以下内容的输出：</block>
  <block id="e931682ac0f69e4f23e778b87a1949e7" category="summary">在通过移动存储进行升级的过程中，打开 node3 和 node4 的电源，启动软件映像并配置节点。</block>
  <block id="b1fa2ac0707a8d8f4408434b0191d0fe" category="doc">设置新节点</block>
  <block id="cc32105596984688d6ab5fee199bc645" category="list-text">打开 node3 的电源，然后立即在控制台终端上按 Ctrl-C 以访问 LOADER 提示符。</block>
  <block id="25870cbb4fe9afef5797b531420b7012" category="paragraph">如果 node3 和 node4 位于同一机箱中，请转至步骤 2 。如果没有，请转至步骤 3 。</block>
  <block id="6c43e0670806fec2f9b82e002c3d44d5" category="list-text">如果 node3 和 node4 采用单机箱配置（控制器位于同一机箱中）：</block>
  <block id="d486515e741f0bde35c2fd426a867b3d" category="list-text">将串行控制台连接到 node4 。</block>
  <block id="bab144c0a8977d9f14b3ec5a34769bb7" category="list-text">打开 node4 的电源（如果尚未打开），然后在控制台终端按 Ctrl-C 以访问加载程序提示符，从而中断启动过程。</block>
  <block id="7f3fbfaad92df530efc5e2c935feab6d" category="paragraph">如果两个控制器位于同一机箱中，则应已打开电源。</block>
  <block id="02dcb64a1d27e1eeab5837de925863e2" category="paragraph">在 LOADER 提示符处保留 node4 ；返回到此操作步骤，并在安装 node3 后重复这些步骤。</block>
  <block id="e0c72359a74d5f255e008145ee1a65aa" category="list-text">在 LOADER 提示符处，输入以下命令：</block>
  <block id="70dbb49a6cbad96a6befa2a87cf2c5ce" category="paragraph">`set-defaults`</block>
  <block id="f1115a4ee76c827e3baf90e4fccb2989" category="list-text">在 LOADER 提示符处，为管理 LIF 配置网络启动连接：</block>
  <block id="d28de6877e1c71b43aa9dbe62d9bc5a1" category="cell">IP 地址</block>
  <block id="54201c55d2bdc7a9e19d9e032d8c0ede" category="cell">DHCP</block>
  <block id="ae5171433beb404b3b19f1a8c6ab2aec" category="cell">配置自动连接： `ifconfig e0M -auto`</block>
  <block id="84a8921b25f505d0d2077aeb5db4bc16" category="cell">静态</block>
  <block id="6d762fbeecd3a906c826d40dcc3e0ec8" category="cell">配置手动连接： `ifconfig e0M -addr=ip_addr -mask=netmask -gw=gateway`</block>
  <block id="fc77134b1cf9bee36efeff8c4e7ff00d" category="list-text">在 LOADER 提示符处，对 node3 执行 netboot ：</block>
  <block id="792eb4d1b571ca19a55c8073d075e399" category="cell">FAS2200 ， FAS2500 ， FAS3200 ， FAS6200 ， FAS/AFF8000 系列系统</block>
  <block id="b684c44ca7e473a2454503d632a74387" category="cell">`netboot \http://web_server_ip/path_to_webaccessible_directory/netboot/kernel`</block>
  <block id="a0be7aade7801be3a4df66bacd6674d0" category="cell">`netboot \http://web_server_ip/path_to_webaccessible_directory/ontap_version_image.tgz`</block>
  <block id="e9df9be17a53094a5ff251f40e848216" category="paragraph">`path_to_the_web-accessible_directory` 是下载的 `ontap_version_image.tgz` 文件的位置。</block>
  <block id="a7cb2d731b29707bf9c40c8d88a0c732" category="admonition">如果无法通过网络启动新控制器，请联系技术支持。</block>
  <block id="9a8c20fab9267090fe0211c579b8d259" category="list-text">从启动菜单中，选择选项 * （ 7 ） Install new software first* ，将新软件映像下载并安装到启动设备。</block>
  <block id="53986d70143c63a3205b1deed773b405" category="paragraph">请忽略以下消息： ` "HA 对上的无中断升级不支持此操作步骤 "` 。IT 适用场景软件无中断升级，而不是控制器升级。</block>
  <block id="efb4ec8002f3f7ed99b1b4f92cbef052" category="list-text">如果系统提示您继续运行操作步骤，请输入 y ，然后在系统提示您输入软件包时，输入映像文件的 URL ：</block>
  <block id="3bb3e0dc251b6c719d9693145812f91b" category="paragraph">` http://web_server_ip/path_to_web-accessible_directory/ontap_version_image.tgz`</block>
  <block id="647f982b341b67a165ac63d735784a54" category="paragraph">如果适用，请输入用户名 / 密码，或者按 Enter 继续操作。</block>
  <block id="a01beec0f6ce0a2dd45c8f1d5aa3e76c" category="list-text">当您看到类似以下内容的提示时，输入 `n` 以跳过备份恢复：</block>
  <block id="4c311f4de89068c42d4731e90025eefc" category="list-text">当您看到类似以下内容的提示时，输入 `y` 以重新启动：</block>
  <block id="3772c3f3ea70d5c6527c33a07c35e34b" category="list-text">在系统提示时按 Ctrl-C 显示启动菜单，以中断重新启动过程。</block>
  <block id="6854e023bbdb323be06c87482d9b3a73" category="list-text">从启动菜单中，选择 * （ 5 ） Maintenance mode boot* 以访问维护模式。</block>
  <block id="2e17578ed57b4217f0fff6fb665fb7db" category="list-text">如有必要，更改节点上的 FC 或 CNA 端口，然后将节点重新启动至维护模式。</block>
  <block id="1d21eb3516c8380b94efe3f9e6d9c423" category="list-text">您应验证命令输出是否显示 `ha` ：</block>
  <block id="39b29886f880d41a4124d49c7d84425f" category="paragraph">系统会在 PROM 中记录它们是采用 HA 对还是独立配置。独立系统或 HA 对中的所有组件的状态都必须相同。</block>
  <block id="1c02d552a23cb0d5ccd392be156357f4" category="paragraph">`ha-config modify controller ha` 命令可为控制器设置配置 `ha` 。`ha-config modify chassis ha` 命令可为机箱设置配置 `ha` 。</block>
  <block id="168534119baada9aef15b0bbbe44b454" category="paragraph">系统将停留在 LOADER 提示符处。</block>
  <block id="928eff2006adc1184e5f768e70b85796" category="summary">如果原始节点是支持的型号之一，则在通过移动存储进行升级的过程中，您可以将节点转换为驱动器架，然后将其连接到同一集群中的新节点。</block>
  <block id="93ee61ace756458b9aac549506050c57" category="list-text">将要转换的节点中的控制器模块更换为相应的 IOM 模块。</block>
  <block id="e420822bb33a20469fdc3f065d3d63ca" category="list-text">设置驱动器架 ID 。</block>
  <block id="e3a1e42d336af98f7116d009f256cff5" category="paragraph">每个驱动器架（包括机箱）都需要一个唯一 ID 。</block>
  <block id="bf4f5599e53150e46e0e54293db42d76" category="list-text">根据需要重置其他驱动器架 ID 。</block>
  <block id="2b1d453e5c526d2daec5dda41e6bf086" category="list-text">关闭连接到新节点的所有驱动器架的电源，然后关闭新节点的电源。</block>
  <block id="3c3916219a878033fa2aaddd792ed605" category="list-text">将转换后的驱动器架连接到新系统上的 SAS 端口，如果使用带外 ACP 布线，则连接到新节点上的 ACP 端口。</block>
  <block id="28391dfe8511b351c91dba3094b1ba03" category="list-text">打开转换后的驱动器架以及连接到新节点的任何其他驱动器架的电源。</block>
  <block id="c2f0cd821e5ee148eb1900a96d516f19" category="list-text">打开新节点的电源，然后按 Ctrl-C 访问启动环境提示符，以中断每个节点上的启动过程。</block>
  <block id="1a364d01ffd247339721f8976186fb42" category="summary">如果要通过移动存储进行升级，请准备原始节点并设置新节点。某些平台型号支持将内部存储传输到新节点。您可以重新分配磁盘并将根卷配置还原到新节点，并配置网络端口。通过移动存储进行升级会造成操作步骤中断。</block>
  <block id="46ade9d238c9383a9fd555f9909703f2" category="image-alt">通过移动存储升级控制器硬件的工作流</block>
  <block id="4b52611cbeb99e3693b2989804997376" category="inline-xref-macro">移动存储时准备升级</block>
  <block id="9b9c1d93f638d2492d52c449af4a9f8e" category="list-text"><block ref="9b9c1d93f638d2492d52c449af4a9f8e" category="inline-xref-macro-rx"></block></block>
  <block id="c4612c419c5b77fdb1400d9db61d37d0" category="inline-xref-macro">关闭原始节点</block>
  <block id="fa92526c370e0e83caaa8ef73071e577" category="list-text"><block ref="fa92526c370e0e83caaa8ef73071e577" category="inline-xref-macro-rx"></block></block>
  <block id="761cd859f3a1152e9ed0b1bbb19f801e" category="inline-xref-macro">删除连接到新节点的磁盘的所有权</block>
  <block id="9208c7088ce84da232091879b3770a18" category="list-text"><block ref="9208c7088ce84da232091879b3770a18" category="inline-xref-macro-rx"></block></block>
  <block id="65e0e6759e9c5622cb5684aa9ab3918c" category="inline-xref-macro">重置新节点上的默认配置</block>
  <block id="f241fa08ba08580f443015464e8677f1" category="list-text"><block ref="f241fa08ba08580f443015464e8677f1" category="inline-xref-macro-rx"></block></block>
  <block id="f23e0348fed3fc9f91c4876ac685e8b2" category="list-text"><block ref="f23e0348fed3fc9f91c4876ac685e8b2" category="inline-xref-macro-rx"></block></block>
  <block id="74e73fdeb27abf5972d451e384c0b008" category="list-text"><block ref="74e73fdeb27abf5972d451e384c0b008" category="inline-xref-macro-rx"></block></block>
  <block id="95d2cfc09ea488ae65b24491b681ba10" category="list-text"><block ref="95d2cfc09ea488ae65b24491b681ba10" category="inline-xref-macro-rx"></block></block>
  <block id="406f6aaf2009833158ad659b727bd7bc" category="list-text"><block ref="406f6aaf2009833158ad659b727bd7bc" category="inline-xref-macro-rx"></block></block>
  <block id="a2e87312e255032446cf18ba0d44062f" category="list-text"><block ref="a2e87312e255032446cf18ba0d44062f" category="inline-xref-macro-rx"></block></block>
  <block id="2d425665af37b9989f89179649650990" category="inline-xref-macro">完成升级</block>
  <block id="42b305e24e95a29c3fcfe6708c1ae7a8" category="list-text"><block ref="42b305e24e95a29c3fcfe6708c1ae7a8" category="inline-xref-macro-rx"></block></block>
  <block id="1059655c106e5ea0199f3774e670962f" category="summary">在通过移动卷升级控制器硬件之前，您需要执行一些准备步骤。</block>
  <block id="65ef2ef8754850d3945f71f106c239bf" category="doc">移动卷时准备升级</block>
  <block id="e9adb27e90050d8289d9a9c063d397bc" category="list-text">显示原始节点上的卷：</block>
  <block id="448f48037793339f6909fa019ac572e8" category="paragraph">`volume show`</block>
  <block id="9a196f75795aecf7d88cba65270aa82d" category="paragraph">您可以使用命令输出准备要移至新节点的卷列表。</block>
  <block id="ca1e7d2036709df38bf67d5763ea1196" category="list-text">显示并记录原始节点中的许可证信息：</block>
  <block id="415a99ccf5f33b1917dc69dd5ae1cc49" category="list-text">如果在原始节点上使用存储加密，并且新节点具有已启用加密的磁盘，请确保原始节点的磁盘已正确设置密钥：</block>
  <block id="8a27eb0213ced2501be4946695cfd6de" category="list-text">显示有关自加密磁盘（ SED ）的信息：</block>
  <block id="af11fb45c89d3718886f151c8a08d22c" category="paragraph">`s存储加密磁盘 show`</block>
  <block id="21673b2e55b47fc43d8ff1f5ae5ace2d" category="list-text">如果任何磁盘与非制造安全 ID （非 MSID ）密钥关联，请将其重新密钥为 MSID 密钥：</block>
  <block id="6532a36b400d423741e990e7bfb3a4f9" category="paragraph">`s存储加密磁盘修改`</block>
  <block id="e7a03543f0b46d4d160d9cb6f548c923" category="list-text">如果集群当前采用双节点无交换机配置，请使用您首选的交换机类型将集群迁移到双节点有交换机集群。</block>
  <block id="a20d9980e43b578ea10896a930345b17" category="list-text">从每个原始节点发送一条 AutoSupport 消息，以通知技术支持升级：</block>
  <block id="db67b68ad4cbb959401716c41ae8b8e0" category="paragraph">`ssystem node AutoSupport invoke -node node_name -type all -message "upgrading node_name from platform_original to platform_new"`</block>
  <block id="4d3a4f006fa6b11c769a39a41cac5793" category="summary">要通过移动存储来完成操作步骤升级，您必须从新节点中删除所有未使用的端口和 LIF ，重新启用存储故障转移或高可用性，配置服务处理器 \ （ SP\ ），安装新许可证并设置 AutoSupport 。您可能还需要设置存储或卷加密并配置 FC 或 CNA 端口。</block>
  <block id="de87a7c00dcfcf1112ca50efd583f924" category="paragraph">要通过移动存储来完成操作步骤升级，您必须从新节点中删除所有未使用的端口和 LIF ，重新启用存储故障转移或高可用性，配置服务处理器（ SP ），安装新许可证以及设置 AutoSupport 。您可能还需要设置存储或卷加密并配置 FC 或 CNA 端口。</block>
  <block id="0bde8f7cae6f7006cf8059b9d923c0a4" category="inline-xref-macro">在 ONTAP 9.7 或更早版本中执行最终升级步骤</block>
  <block id="3891cdc6868c6f151d43254aeaf389d9" category="paragraph">这些步骤适用于运行 ONTAP 9.8 的系统。如果您运行的是 ONTAP 9.7 或更早版本，则必须在中使用操作步骤 <block ref="91f2c94dbfb488703dd443559499d8cb" category="inline-xref-macro-rx"></block>。</block>
  <block id="a1aef6bc19056065e0e5c87b39d71b96" category="list-text">如果系统运行的是 ONTAP 9.7 或更早版本，请执行 * 停止 * 。您必须在中使用操作步骤 <block ref="91f2c94dbfb488703dd443559499d8cb" category="inline-xref-macro-rx"></block>。</block>
  <block id="602dfb74c3c65622a6e81f6da6da5716" category="paragraph">重新启用高可用性： `cluster ha modify -configured true`</block>
  <block id="68e75079cb8b3e7a53d47ecb9c69a59e" category="paragraph">重新启用存储故障转移： `storage failover modify -node node_name -enabled true`</block>
  <block id="07bcd7f493b550a7d6a23f2400273a8b" category="summary">在通过移动存储进行升级之前，您必须从原始节点收集许可证信息，规划网络配置，记录系统 ID 并准备网络启动所需的文件。</block>
  <block id="8f173fba352550b4b824b719504591e0" category="list-text">显示并记录原始节点 node1 和 node2 中的许可证信息：</block>
  <block id="d49b56a3426b3aa04db4098a00a258f3" category="list-text">如果在 node1/node2 HA 对上使用存储加密，并且新节点具有已启用加密的磁盘，请确保原始节点的磁盘已正确设置密钥：</block>
  <block id="f86586d6856ab5f19b8787f7761d1c45" category="list-text">显示有关自加密磁盘（ SED ）的信息</block>
  <block id="2ca3f33b8690b8bfadc126b4fa162fd8" category="list-text">如果任何磁盘与非制造安全 ID （非 MSID ）密钥关联，请将其重新密钥到 MSID 密钥</block>
  <block id="f4b5604db85f1d0c81857a7ac77548c5" category="list-text">【预备移动存储区】记录 node1/node2 HA 对上的端口和 LIF 配置信息：</block>
  <block id="4d4e0186fe4a6767fbe04fce3b401b3a" category="cell">要显示有关以下内容的信息 ...</block>
  <block id="79bd216cbc0f386a597365eaa04f09ac" category="cell">输入 ...</block>
  <block id="9e3848dac335cb237199f520c6525242" category="paragraph">磁盘架，每个磁盘架中的磁盘数，闪存存储详细信息，内存， NVRAM 和网卡</block>
  <block id="95fa957773275d4c19cc254de4f5e040" category="paragraph">`ssystem node run -node node_name sysconfig`</block>
  <block id="654e1d01ab7f77e6f39636c95aa8c372" category="paragraph">集群网络和节点管理 LIF</block>
  <block id="b789920aa34a06ff52a0a140eb8211ba" category="paragraph">`network interface show -role cluster ， node-mgmt`</block>
  <block id="1edb05285bdfcd8326cc54455703d7ec" category="paragraph">物理端口</block>
  <block id="91fc6bc3bb3d5233e07a5711c347aacc" category="paragraph">`network port show -node node_name -type physical`</block>
  <block id="bcc0e5a3e08cd34e80692195d056b06d" category="paragraph">故障转移组</block>
  <block id="a0b03d7d484126d483bd43f4e0a24360" category="paragraph">`network interface failover-groups show -vserver vserver_name`</block>
  <block id="b8b0fe3149c819fa21f2a86823ef8abc" category="paragraph">记录集群范围之外的故障转移组的名称和端口。</block>
  <block id="e7462d2e6e123bc7d973071af507af96" category="paragraph">VLAN 配置</block>
  <block id="cd2907c0af6cc6fce6a7f22620877696" category="paragraph">`network port vlan show -node node_name`</block>
  <block id="e8b11d1241a22730e9b7b2847fce1105" category="paragraph">记录每个网络端口和 VLAN ID 配对。</block>
  <block id="7313f6357960954d1290c9360512a59f" category="paragraph">接口组配置</block>
  <block id="7005721f9e503dcf5e499db791fb72eb" category="paragraph">`network port ifgrp show -node node_name -instance`</block>
  <block id="61d37f34e493a0639bf5de53ed879037" category="paragraph">记录接口组的名称以及分配给这些接口组的端口。</block>
  <block id="e4fba9d169fb5edb171e52cb71d98ff6" category="paragraph">广播域</block>
  <block id="4c9d53b2ac777e0e1e7588f7fa1bc00c" category="paragraph">IPspace 信息</block>
  <block id="f4e3ea14a86c053c771cffad27e184f6" category="paragraph">`network IPspace show`</block>
  <block id="2bba24b2641704be8251f30dd5d16c63" category="paragraph">安装新节点后，您可能需要通过网络启动来确保新节点运行的 ONTAP 版本与原始节点相同。术语 netboot 表示从远程服务器上存储的 ONTAP 映像启动。在准备网络启动时，您必须将 ONTAP 9 启动映像的副本放在系统可以访问的 Web 服务器上。</block>
  <block id="a6d12afddb580faaf04d9a073325f914" category="paragraph">* FAS2200 ， FAS2500 ， FAS3200 ， FAS6200 ， FAS/AFF8000 系列系统 *</block>
  <block id="724182e8d5c3b1bb2c819f46951a63be" category="paragraph">将 `ontap_version_image.tgz` 文件的内容提取到目标目录： `tar -zxvf ontap_version_image.tgz`</block>
  <block id="6495df55b307404a4ea0b4f64a7ae26a" category="paragraph">* 注： * 如果要在 Windows 上提取内容，请使用 7-Zip 或 WinRAR 提取网络启动映像。</block>
  <block id="da18433407867d03800be7785b789106" category="paragraph">您的目录列表应包含一个包含内核文件的 netboot 文件夹： `netboot/kernel`</block>
  <block id="339dbbf2e3919abe2381758c4b54e24c" category="paragraph">* 所有其他系统 *</block>
  <block id="21694d70fa63b61a0a68e7a39cc96e19" category="paragraph">您的目录列表应包含以下文件：</block>
  <block id="00296cd0500c321060de54661554739a" category="paragraph">`ontap_version_image.tgz`</block>
  <block id="0caecd7c9276edc19599cb97a20eac4d" category="admonition">您不需要提取 `ontap_version_image.tgz` 文件的内容。</block>
  <block id="c9b87fd8826330d02eb0f7e03c49023c" category="summary">要通过移动卷完成操作步骤升级，您需要配置服务处理器 \ （ SP\ ），安装新许可证并设置 AutoSupport 。您可能还需要设置存储或卷加密并配置 FC 或 NCA 端口。</block>
  <block id="dcb35290a699d5cd152b36befe0de1e2" category="paragraph">要通过移动卷完成操作步骤升级，您需要配置服务处理器（ SP ），安装新许可证并设置 AutoSupport 。您可能还需要设置存储或卷加密并配置 FC 或 NCA 端口。</block>
  <block id="d01decedde31fd5fc9aee34a816e3a84" category="paragraph">`ssystem node AutoSupport invoke -node node_name -type all -message "node_name successfully up级 从 platform_old 升级到 platform_new"`</block>
  <block id="12ab5d791aa13f19bff0271520c8fa20" category="list-text">如果新节点具有 FC 端口（板载或 FC 适配器上的），板载 CNA 端口或 CNA 卡，请配置 FC 或 CNA 端口，然后在存储系统提示符处输入以下命令：</block>
  <block id="533d1f26c154725c9c91afdd1b89aaa4" category="list-text">在 * 已安装系统 * 页面上，以格式输入旧系统的序列号，然后单击 * 执行！ *</block>
  <block id="44e9f0c666ea054f51421040e37dee98" category="summary">从原始节点移动卷后，您需要将非 SAN 数据 LIF 和集群管理 LIF 从原始节点迁移到新节点。</block>
  <block id="7d0330f92f5b6340af08f88bf712e687" category="doc">将非 SAN 数据 LIF 和集群管理 LIF 移动到新节点</block>
  <block id="87375b5769d5bc8e37ee39d964c25804" category="paragraph">您不能使用 VMware vStorage APIs for Array Integration （ VAAI ）迁移用于副本卸载操作的 LIF 。</block>
  <block id="d079690ef04f3c3ab2f4e91b5f28e90b" category="list-text">从托管集群 LIF 的节点中，将非 SAN 数据 LIF 的主端口从原始节点更改为新节点：</block>
  <block id="935107dfae7ac4e8d9197920bf55aa6d" category="paragraph">`network interface modify -vserver vserver_name -lif lif_name -home-node new_node_name -home-port ｛ netport_ifgrp ｝`</block>
  <block id="fc522dd9612f86c0ea7c802be05de893" category="cell">要迁移的对象</block>
  <block id="1d073f20d5a5045e1aa3afacf792bf7c" category="cell">然后输入 ...</block>
  <block id="0a4bc8aea04444e0f2b960facbd686f4" category="paragraph">特定 LIF</block>
  <block id="115f35dfeb3630ff6188ad99e42fbf65" category="paragraph">`network interface migrate -vserver vserver_name -lif lif_name -source-node source_node_name -destination-node dest_node_name -destination-port dest_port_name`</block>
  <block id="fb465127c12aa152a3a6787bc1358040" category="paragraph">所有非 SAN 数据 LIF 和集群管理 LIF</block>
  <block id="876f08ee829457fe6846a465734bf3aa" category="paragraph">`network interface migrate-all -node node_name`</block>
  <block id="8d4031ef52b7ff00f19077a56df4c26e" category="paragraph">以下命令会将 SVM"vs0" 上名为 datalif1 的 LIF 迁移到 "node0b" 上的端口 "e0d" ：</block>
  <block id="44807f621f3e0960500d7db205f07c8e" category="paragraph">以下命令将从当前（本地）节点迁移所有数据和集群管理 LIF ：</block>
  <block id="08784f3476a94c005c9ffbca34e62ce0" category="list-text">检查集群管理 LIF 的主节点是否位于原始节点之一： `network interface show -lif cluster_mgmt -fields home-node`</block>
  <block id="68c8a99bc9172a87f6301c02d55008f8" category="list-text">如果集群管理 LIF 的主节点位于某个原始节点上，请完成以下步骤：</block>
  <block id="a7d2bd92477c7708999d89fc281f2cfb" category="list-text">将集群管理 LIF 的主节点切换到一个新节点：</block>
  <block id="0f5b106232b99d6e1bf60ad478b86d61" category="paragraph">`network interface modify -vserver cluster_name -lif cluster_mgmt -home-node new_node_name -home-port ｛ netport_ifgrp ｝`</block>
  <block id="038faacffbd9c39ca68e42dccdbe915f" category="list-text">将集群管理 LIF 迁移到一个新节点：</block>
  <block id="34a6e43af56bb7aa0811ccb6d4459705" category="paragraph">`network interface migrate -vserver vserver_name -lif cluster-mgmt -destination-node new_node_name -destination-port ｛ netport_ifgrp ｝`</block>
  <block id="f6feea768bbf907f8918a30130dc7d38" category="summary">运行诊断程序后，您必须重新对控制器模块的存储和网络连接进行布线。</block>
  <block id="ea122bb8fa70f0ea4b180db441cf1abd" category="doc">重新为系统布线</block>
  <block id="3c0c8efee11cd7a51266228208ce0a13" category="paragraph">运行诊断程序后，您必须重新对控制器模块的存储和网络连接进行布线。</block>
  <block id="d0b16eb1b162f9fb3ef65f59b13902e7" category="list-text">重新对系统进行布线。</block>
  <block id="4ba20dd7668682720b8eed837f2ea1a8" category="list-text">使用 Config Advisor 验证布线是否正确。</block>
  <block id="eea0c04ed0e3acb7893e5192e1e8223d" category="list-text">从 NetApp 支持站点下载并安装 Config Advisor 。</block>
  <block id="0373910e51252c7b97dcbea9f4942604" category="inline-link">mysupport.netapp.com</block>
  <block id="31509d9d2ecd7357c2d79b6100170edf" category="paragraph"><block ref="31509d9d2ecd7357c2d79b6100170edf" category="inline-link-rx"></block></block>
  <block id="d1bb82954c2ac129418d4ca65eb100d5" category="list-text">输入目标系统的信息，然后单击 * 收集数据 * 。</block>
  <block id="6361d7cb04e4c3f294b622b2cc3e87a0" category="list-text">单击 * 布线 * 选项卡，然后检查输出。</block>
  <block id="e322e9be3fd030740b4239a7bfbeed70" category="paragraph">确保显示所有磁盘架且所有磁盘均显示在输出中，以更正您发现的任何布线问题。</block>
  <block id="2d46bc00fe1306e504816e238db01e8e" category="list-text">单击相应的选项卡，然后检查 Config Advisor 的输出，以检查其他布线。</block>
  <block id="28b82aeb57b341ad6d877342a1ec8842" category="summary">要使 node3 和 node4 能够在升级后在集群中彼此通信并与网络通信，您必须确保已为物理端口正确配置了用于预期用途的设置，例如集群，数据等。</block>
  <block id="acf19a04295768ba1ad8e06c738b60d8" category="paragraph">这些步骤适用于运行 ONTAP 9.8 的系统。如果您运行的是 ONTAP 9.7 或更早版本，则必须在中使用操作步骤 <block ref="02cafea91ec73e57361f0e2559069996" category="inline-xref-macro-rx"></block>。</block>
  <block id="1e9be7aa46166eca7db0fc1c4e7a887b" category="paragraph">您必须对 node3 和 node4 执行这些步骤。</block>
  <block id="7f0307060728fe46960f5901c576848b" category="admonition">以下命令示例引用 "node1" ，因为在操作步骤的此阶段，替代节点 "node3" 和 "node4" 实际上分别命名为 "node1" 和 "node2" 。</block>
  <block id="49b95b3a1c8fd0bd354de5fc2ec2b96e" category="list-text">如果系统运行的是 ONTAP 9.7 或更早版本，请执行 * 停止 * 。您必须在中使用操作步骤 <block ref="02cafea91ec73e57361f0e2559069996" category="inline-xref-macro-rx"></block>。</block>
  <block id="4fb89fe4ba344b621e7afe206f6a8a4e" category="list-text">进行以下更改：</block>
  <block id="757ee83d9d913287174eb13a32791a9a" category="list-text">启动并登录到 node3 和 node4 （如果尚未登录）。</block>
  <block id="488704cff7055e0adb667e6434ad04b5" category="list-text">修改将属于集群广播域的端口：</block>
  <block id="6c8d313b9f71a389b310905d743ac361" category="paragraph">`network port modify -node node_name -port port_name -mtu 9000 -ipspace cluster`</block>
  <block id="1d79ea5a41dff0854a82efdbcdb2f72d" category="paragraph">此示例将在 "node1" 上添加 `Cluster` 端口 e1b ：</block>
  <block id="44cfd5499c1c5e138a09d952646d13a0" category="paragraph">`network port modify -node node1 -port e1b -ipspace cluster -mtu 9000`</block>
  <block id="f198623bbbfb26015c225cb6096c73c3" category="paragraph">`network interface migrate -vserver vserver_name -lif lif_name -source-node node1 -destination-node node1 -destination-port port_name`</block>
  <block id="112d21318dcb3758e7fe3f932ebc36f5" category="paragraph">迁移所有集群 LIF 并建立集群通信后，集群应达到仲裁状态。</block>
  <block id="f8c4e1930d2ec49e8149c2e48e43d636" category="list-text">修改集群 LIF 的主端口：</block>
  <block id="1e746213020788bee82da3b663d9a8c9" category="list-text">从 `集群` 广播域中删除旧端口：</block>
  <block id="988d353a5890265e706d9480b10346b6" category="paragraph">`network port broadcast-domain remove-ports -ipspace cluster -broadcast-domain cluster -ports node1 ： port`</block>
  <block id="c59ee067f1e2a7f5c083dccd15039be2" category="list-text">显示 node3 和 node4 的运行状况：</block>
  <block id="0a8d783192936e1058966919330dd365" category="paragraph">`cluster show -node node1 -fields health`</block>
  <block id="2e2786810124b219ec88817aab856aed" category="list-text">列出所有端口的可访问性状态：</block>
  <block id="339d7d0493d7df43c35e2a1d483c9cba" category="list-text">通过在每个端口上运行以下命令，修复物理端口以及 VLAN 端口的可访问性，一次运行一个端口：</block>
  <block id="797d1f20eca89a6bb30538beeb3f1339" category="paragraph">`re可访问性修复 -node node_name -port port_name`</block>
  <block id="8c40a77b34a5d773edb70494e7f10d84" category="paragraph">此时将显示类似以下内容的警告。查看并根据需要输入 `y` 或 `n` ：</block>
  <block id="55e9c04f0dbe507ee727eac56cf6f595" category="list-text">要使 ONTAP 完成修复，请在最后一个端口上运行 `reachability repair` 命令后等待大约一分钟。</block>
  <block id="1708f24291e02d5444d943fd9a4a384c" category="list-text">列出集群上的所有广播域：</block>
  <block id="7b4ead482f6c92170f4c6bef96fe284b" category="list-text">在执行可访问性修复时， ONTAP 会尝试将端口放置在正确的广播域中。但是，如果无法确定某个端口的可访问性，并且该端口与任何现有广播域不对应，则 ONTAP 将为这些端口创建新的广播域。如果新创建的广播域的所有成员端口都将成为接口组的成员端口，则可以根据需要删除这些成员端口。删除广播域</block>
  <block id="3e691ff973e406b5150b59cc09fa52d2" category="paragraph">`broadcast-domain delete -broadcast-domain broadcast_domain`</block>
  <block id="991ac44bc0f4b09cc233a9a79f867f55" category="list-text">查看接口组配置，并根据需要添加或删除成员端口。将成员端口添加到接口组端口：</block>
  <block id="32b3250c7b168c19e1bf43908f61263b" category="paragraph">`ifgrp add-port -node node_name -ifgrp ifgrp_port -port port_name`</block>
  <block id="6d260ed9cb63935d4eff6ef0cbc812bc" category="paragraph">从接口组端口删除成员端口：</block>
  <block id="48fa48ac8516af170899b1c93d4735a5" category="paragraph">`ifgrp remove-port -node node_name -ifgrp ifgrp_port -port port_name`</block>
  <block id="c99cfb03dbd1f20e150b31f5f9c7e297" category="list-text">根据需要删除并重新创建 VLAN 端口。删除 VLAN 端口：</block>
  <block id="f9f6195601c8767deb1901ff17a1c56b" category="paragraph">`vlan delete -node node_name -vlan-name vlan_port`</block>
  <block id="77fd7c219c7b6d2330906a24cbb05d97" category="paragraph">创建 VLAN 端口：</block>
  <block id="3b63e3692e903dab9ed8411538298a7f" category="paragraph">`vlan create -node node_name -vlan-name vlan_port`</block>
  <block id="244220515525d7bbce7364431256c704" category="admonition">根据要升级的系统的网络配置的复杂性，可能需要重复步骤 5 子步骤（ a ）到（ g ），直到所有端口都在需要时正确放置。</block>
  <block id="ea655de7a1937b3e3b33b8a800b7cb49" category="list-text">显示已替换的 VLAN ：</block>
  <block id="472aa5d8ae9d1d5726cc523100b48335" category="list-text">将已替换的 VLAN 还原到所需的目标端口：</block>
  <block id="cd7cf9673585176e1ac4e4ad6be4ce76" category="paragraph">`displaced -vVLAN restore -node node_name -port port_name -destination-port destination_port`</block>
  <block id="0bb998238231c13a494cdbd3689c6d25" category="list-text">验证所有已替换的 VLAN 是否已还原：</block>
  <block id="47520b16706f00daa0983c140c0ad715" category="list-text">VLAN 会在创建后大约一分钟自动放置到相应的广播域中。验证已还原的 VLAN 是否已放置在相应的广播域中：</block>
  <block id="5f8dfcaae8cea23af1ab8bab1c7c23ad" category="list-text">显示主端口可能已移至另一个节点或不再存在的 LIF ：</block>
  <block id="5f6447c81c91c2a68fcce7c90bfd253a" category="list-text">还原每个 LIF 的主端口：</block>
  <block id="1570c3884951eaf71e4f61aedf14d4d7" category="paragraph">`displaced interface restore -vserver vserver_name -lif-name lif_name`</block>
  <block id="25d37c99a98fed25bef30e1dc9dfbbc2" category="list-text">验证是否已还原所有 LIF 主端口：</block>
  <block id="db548c254460f5243399043fe56f9785" category="list-text">验证属于正确广播域的端口上的所有 LIF 是否均以管理员方式启动。</block>
  <block id="60b2815df1dfab3c2fb93c656ce873c2" category="list-text">检查是否存在任何已被管理员关闭的 LIF ：</block>
  <block id="8e99d7adf8359f30524f68140147352a" category="paragraph">`network interface show -vserver vserver_name -status-admin down`</block>
  <block id="cb85064e4ff7f8868d9276fd36dc5500" category="list-text">检查是否存在任何已关闭运行的 LIF ：``network interface show -vserver vserver_name -status-oper down``</block>
  <block id="c4610b7b449885970b4973ca609dd9dd" category="list-text">修改任何需要修改的 LIF ，使其具有不同的主端口：</block>
  <block id="7944e2738dd38d26f79904c254a07a8a" category="paragraph">`network interface modify -vserver vserver_name -lif lif -home-port home_port`</block>
  <block id="0f5308f3f4f3c464e7f648069ec71c80" category="admonition">对于 iSCSI LIF ，修改主端口需要以管理员方式关闭 LIF 。</block>
  <block id="7960433234d5162e1055d53630a352f5" category="list-text">还原不在其各自主端口主端口的 LIF ：</block>
  <block id="50314d4f124e0153ee89d1686a2bc452" category="paragraph">`网络接口还原 *`</block>
  <block id="e5d91a7fa665e8fe97e2979e274c9883" category="paragraph">您已完成物理端口映射。要完成升级，请转至 <block ref="362f5b69398efdd58c711f175ac3611b" category="inline-xref-macro-rx"></block>。</block>
  <block id="029d23f0db183aa13dd611784328ec8c" category="admonition">ONTAP 9.8 简化了硬件升级过程，引入了自动端口放置功能。</block>
  <block id="797fc5bb1530b93a4d119b95138dc85d" category="list-text">原始节点与新节点兼容并受支持。</block>
  <block id="e047dcc5ff8dd437e2b3a8e513bf32f3" category="list-text">您要将一对运行 ONTAP 9.0 或更高版本的节点升级到一对运行同一版本的新节点。</block>
  <block id="afcdd6a539b6392327d97fd8eb2cd065" category="list-text">您正在重新使用新节点上原始节点的 IP 地址，网络掩码和网关。</block>
  <block id="4fd09292f1a407286c9372555595d59c" category="list-text">您计划通过移动存储或移动卷来升级控制器硬件。</block>
  <block id="4836c86a753695232f6579b2d1e052e6" category="list-text">如果您要通过移动存储进行升级，则可以执行中断操作步骤。</block>
  <block id="8cdba56188d6642a771d0c327a72af57" category="paragraph">通过移动卷进行升级不会造成中断。</block>
  <block id="56089842bd614396cfba7cdf9bb6601f" category="list-text">您计划将受支持型号的节点转换为磁盘架，然后将其连接到新节点。</block>
  <block id="aff7a731f5229621d23c4c3e8021e92e" category="paragraph">如果要更换单个组件，请参见该组件的现场可更换单元（ Field Replaceable Unit ， FRU ）宣传单。</block>
  <block id="3d9010fa119828bc81f438c75af15b63" category="paragraph">在通过移动存储升级控制器硬件的步骤中，原始节点称为 node1 和 node2 ，新节点称为 node3 和 node4 。在所述的操作步骤期间， node1 将替换为 node3 ， node2 将替换为 node4 。</block>
  <block id="e338e550ae3c8accad87f4fd0e1f2380" category="image-alt">原始节点到新节点</block>
  <block id="f6fd8a1858185111bbea4bb0f44e07f6" category="paragraph">术语 node1 ， node2 ， node3 和 node4 仅用于区分原始节点和新节点。在操作步骤之后，必须替换原始节点和新节点的实际名称。但是，实际上，节点名称不会更改：在升级控制器硬件后， node3 的名称为 node1 ， node4 的名称为 node2 。</block>
  <block id="13157ca9b210750790526c100cf951d7" category="paragraph"><block ref="13157ca9b210750790526c100cf951d7" category="inline-xref-macro-rx"></block></block>
  <block id="5b3de670b2de55fec257c6f89ab421bc" category="summary">如果要通过移动卷进行升级，请准备原始节点并将新节点加入集群。您可以将卷移动到新节点，配置 LIF 并将原始节点从集群中取消加入。通过移动卷进行升级是一种无中断的操作步骤。</block>
  <block id="876fbfc42051162ba587b0a0690449f5" category="image-alt">通过移动卷升级控制器硬件的工作流</block>
  <block id="dee313fe9eeb0dec5f1340bd0e818631" category="list-text"><block ref="dee313fe9eeb0dec5f1340bd0e818631" category="inline-xref-macro-rx"></block></block>
  <block id="c90fa15ea4f7f1e277e469d1d20e9188" category="list-text"><block ref="c90fa15ea4f7f1e277e469d1d20e9188" category="inline-xref-macro-rx"></block></block>
  <block id="5000633fe0b5f0aa09b151f9fed8c9f2" category="list-text"><block ref="5000633fe0b5f0aa09b151f9fed8c9f2" category="inline-xref-macro-rx"></block></block>
  <block id="8829820fd8a035233c013956f191d0e7" category="list-text"><block ref="8829820fd8a035233c013956f191d0e7" category="inline-xref-macro-rx"></block></block>
  <block id="cf9dafa4aad7081e3241e5bc4acb350f" category="inline-xref-macro">从集群中取消原始节点的加入</block>
  <block id="ce218642d156a102e02a50d62a3bf028" category="list-text"><block ref="ce218642d156a102e02a50d62a3bf028" category="inline-xref-macro-rx"></block></block>
  <block id="58c6b3bbc2bbb34b0e96a9731bc9133c" category="list-text"><block ref="58c6b3bbc2bbb34b0e96a9731bc9133c" category="inline-xref-macro-rx"></block></block>
  <block id="bb0c96213a94c4304b5c450772cc0659" category="summary">在 ONTAP 9.8 ， ONTAP 9.7 或更早版本中完成升级。</block>
  <block id="f5b49dd631a7fa0c45fc2aea8bcfa384" category="paragraph">您必须对您的 ONTAP 版本使用操作步骤。</block>
  <block id="e2be5a85f52a3a5f613d4aadf4e57e2f" category="list-text">要在 ONTAP 9.8 中完成升级，请转至 <block ref="92fec23dfa4ff2645c1b7d56969a9e86" category="inline-xref-macro-rx"></block>。</block>
  <block id="188912cb793d3e0c2cd2b15edb10057a" category="list-text">要在 ONTAP 9.7 或更早版本中完成升级，请转至 <block ref="a6085d08f51c0f7b45dd12344b481637" category="inline-xref-macro-rx"></block>。</block>
  <block id="51bea01f527b8a0a7714408789058c6b" category="summary">关闭并删除原始节点时，您必须发送有关升级的 AutoSupport 消息，销毁邮箱，关闭节点电源并卸下机箱。</block>
  <block id="0b5874c3f69c1393f6461a11d78dfa9c" category="list-text">从 node1 和 node2 发送 AutoSupport 消息，以通知技术支持升级：</block>
  <block id="e24fe2559739c9d0df4d61d338bf6f3a" category="paragraph">`ssystem node AutoSupport invoke -node node_name -type all -message "MAINT=2h upgrading node_name from platform_original to platform_new"`</block>
  <block id="3173ac672a7cdfb43fd506ad10daef11" category="list-text">在 node1 和 node2 上禁用高可用性或存储故障转移：</block>
  <block id="d875f9fec183da794cd6d6245ef00d1d" category="list-text">`cluster ha modify -configured false`</block>
  <block id="a0973bd66886f30eb8852a9c09e0fde9" category="list-text">`storage failover modify -node node_name -enabled false`</block>
  <block id="bbe624d4e7e26aa8777e96c55a0041f3" category="paragraph">包含两个以上节点的集群</block>
  <block id="d74abfb55f46e179952b0f9d29ab5c58" category="list-text">暂停节点：</block>
  <block id="40c6d113c18e6ee3b0a3f18e79d64c69" category="paragraph">`ssystem node halt -node node_name`</block>
  <block id="aa20c612e4b09a19b572b1a0ae5851b5" category="paragraph">您可以使用 ` -ignore-quorum-warnings` 选项在重新启动过程中禁止仲裁检查。</block>
  <block id="226315aae314cba9cb4dbd9f5cb26ca0" category="list-text">如果尚未连接，请连接到串行控制台。节点应位于 LOADER 提示符处。使用 `boot_ontap maint` 命令启动至维护模式。</block>
  <block id="0baf8ff8af6c860472922730efb58928" category="paragraph">此时可能会显示一条消息，要求您确保配对节点已关闭或手动禁用配对节点上的接管。您可以输入 `yes` 继续。</block>
  <block id="ef081f0763db1e61273c7141947a007f" category="list-text">[[shutdown_node_step5]] 记录每个原始节点的系统 ID ，该 ID 可通过维护模式下的磁盘所有权信息获取：</block>
  <block id="7692418b27cf02fad97f4990a434658d" category="paragraph">在将磁盘从原始节点分配给新节点时，您需要系统 ID 。</block>
  <block id="6ad89260dedeef1270be905e718e6682" category="list-text">如果您使用的是 FC 或 CNA 端口配置，请在维护模式下显示此配置：</block>
  <block id="84886c64e807dd28c16702155c350818" category="paragraph">您应记录命令输出以供日后参考。</block>
  <block id="03553d2c07377e5ca57428fcbaa05159" category="list-text">在维护模式下，销毁此节点 1 和节点 2 邮箱： +</block>
  <block id="7f7deb46e1585e846e2fd054b1b2af5a" category="paragraph">`m邮箱销毁本地`</block>
  <block id="280e883e4dc586328892b13e3a6a5f9d" category="paragraph">控制台将显示一条类似于以下内容的消息：</block>
  <block id="36e3bf7b64851aa82d534b6219858a39" category="list-text">当您看到类似以下内容的提示时，输入 `y` 以销毁邮箱：</block>
  <block id="e3c00d0f293a58871853ed866dc020a2" category="list-text">关闭 node1 和 node2 的电源，然后拔下它们的电源插头。</block>
  <block id="250a399ca40ceae22935ccb2c65facb5" category="list-text">标记并拔下节点 1 和节点 2 上的所有缆线。</block>
  <block id="ee6adde8f8004d94fe449a931d889e98" category="list-text">卸下包含 node1 和 node2 的机箱。</block>
  <block id="112d12268c7f4b3d566746465f42201d" category="summary">要使 node3 和 node4 能够在升级后在集群中彼此通信并与网络通信，您需要确保物理端口已正确配置了用于预期用途的设置，例如集群，数据等。</block>
  <block id="7e00c0ffb3f4f8002976d8431b57d3f0" category="paragraph">这些步骤适用于运行 ONTAP 9.7 或更早版本的系统。如果您运行的是 ONTAP 9.8 ，则必须在中使用操作步骤 <block ref="7523ee9f03a6fb590a93b67219c26179" category="inline-xref-macro-rx"></block>。</block>
  <block id="336c3aa98e52c1939e4ad18b02d8dc0c" category="paragraph">您需要对 node3 和 node4 执行这些步骤。</block>
  <block id="348d1bc957542f25e2e2871b40cfd26f" category="list-text">如果系统运行的是 ONTAP 9.8 ，请执行 * 停止 * 。您必须在中使用操作步骤 <block ref="7523ee9f03a6fb590a93b67219c26179" category="inline-xref-macro-rx"></block>。</block>
  <block id="1a8639e4c8ee9656522efd4a2b9f58d0" category="list-text">如果尚未将 node3 和 node4 启动到集群提示符，请执行此操作。</block>
  <block id="4a95a6730ba2310bfeb433fbf30d8aab" category="list-text">将正确的端口添加到 `集群` 广播域：</block>
  <block id="48965dff18dc1b1a8625e27956a0c97b" category="paragraph">此示例在 "`node1` " 上添加了 `Cluster` 端口 e1b ：</block>
  <block id="0e515e9baf5c9c8904811cad4ca86f4a" category="list-text">将每个 LIF 的 LIF 迁移到新端口一次：</block>
  <block id="81a582aafef39a5c34471a2df478041e" category="paragraph">SAN 数据 LIF 只能在脱机时进行迁移。</block>
  <block id="acb31929dc066067c0841bfad48a777b" category="list-text">修改 VLAN 和 `ifgrp config` 以匹配新的控制器物理端口布局。</block>
  <block id="159c3e7b0c178674563a1589bc1f32e3" category="list-text">删除 node3 和 node4 上不再存在的 node1 和 node2 端口（高级权限级别）：</block>
  <block id="3a0ccaa3e1aaf9b336c9c6ed7408a7de" category="paragraph">`network port delete -node node1 -port port_name`</block>
  <block id="82e992dffa9a18c86087b3d3c3489290" category="list-text">显示包含端口的广播域：</block>
  <block id="df8657642711d6967d7e6acd72cc9e97" category="list-text">根据需要在广播域中添加或删除端口：</block>
  <block id="4b84dfb5a597238ada9ab2341f5ec5c9" category="list-text">根据需要修改 LIF 的主端口：</block>
  <block id="2a86af9883b70079b249be537c9e3a70" category="paragraph">`network interface modify -vserver vserver_name -lif lif_name – home-port port_name`</block>
  <block id="c625e6bca32182b354cc2e2ecdbbf7ec" category="paragraph">以下命令会将故障转移策略设置为广播域范围，并使用故障转移组 "fg1" 中的端口作为 "node1" 上 LIF"data1" 的故障转移目标：</block>
  <block id="f0307b0ba42c934e076f749d65448b21" category="paragraph">`network interface modify -vserver node1 -lif data1 -failover-policy broadcast-domain-wide -failover-group fg1`</block>
  <block id="baec9716e3c721b8360a740bf6d657ec" category="list-text">显示 node3 和 node4 的网络端口属性：</block>
  <block id="286fbbe010dacee8143fe129c976e8b1" category="paragraph">`network port show -node node1`</block>
  <block id="2055508ed7949fd5d7f5059c98af8f4f" category="paragraph">您已完成物理端口映射。要完成升级，请转至 <block ref="f1628fd5567e155c657c0c615c63b8cf" category="inline-xref-macro-rx"></block>。</block>
  <block id="144a4e175b7dfbdd7e17107831244a5a" category="summary">要确保启动介质上的配置信息不会影响控制器升级，您需要将 node3 和 node4 的配置重置为默认配置设置。</block>
  <block id="9b5792ba6ab03ff6d98279b0ab5ed392" category="paragraph">您需要对 node3 和 node4 执行以下步骤。您可以在每个节点上并行执行这些步骤。</block>
  <block id="161c64322f806c6fa66fcfcc4f963ca2" category="list-text">将节点启动至启动菜单：</block>
  <block id="17137d920db60e7b0b7bfb0be3579b56" category="list-text">在启动菜单提示符处，键入 `wipeconfig` ，然后按 Enter 键。</block>
  <block id="b14047e1956c68f095842760b1beaea2" category="paragraph">以下屏幕将显示启动菜单提示符：</block>
  <block id="d4041bfba261eda3180ae9fbf6285d95" category="list-text">当您看到类似以下内容的提示时，输入 `yes` ：</block>
  <block id="8b8e41e588d3f28837be58712aeec25a" category="paragraph">系统将启动 `wipeconfig` 操作步骤并重新启动。操作步骤完成后，系统将返回到启动菜单。</block>
  <block id="450526ff97e4fb534c60e357bc3b52a0" category="list-text">在启动菜单中，输入 8 以重新启动节点，并在自动启动期间按 * Ctrl-C * 以在 LOADER 提示符处停止节点。</block>
  <block id="be560856af220999f45b0e64a842465a" category="summary">将卷移至新节点后，您将从集群中取消原始节点的加入。取消加入某个节点后，该节点的配置将被擦除，并且所有磁盘都将初始化。</block>
  <block id="f61d9690213fcb44fc551adab505eb85" category="paragraph">将卷移至新节点后，您将从集群中取消原始节点的加入。取消加入某个节点后，该节点的配置将被擦除，并且所有磁盘都会初始化。</block>
  <block id="b942ce9023accae17c7f936a0227b40e" category="list-text">在原始节点上禁用高可用性配置： `storage failover modify -node original_node_name -enabled false`</block>
  <block id="72992cc1c16f1dbbbcb7cc77a55977d9" category="list-text">访问高级权限级别：</block>
  <block id="dc4a67b269dfaba9479198e3f11a2a68" category="list-text">确定具有 epsilon 的节点：</block>
  <block id="9f964a34bab4b3112781e0b28258f5bb" category="paragraph">在以下示例中， "node0" 当前持有 epsilon ：</block>
  <block id="c66d0d8c1fe1605513edaaeec7a73d16" category="list-text">如果原始节点之一持有 epsilon ，请将 epsilon 移动到其他节点：</block>
  <block id="cca74cfa14d67666375d63c5d109d39c" category="list-text">从原始节点中删除 epsilon ： + `cluster modify -node original_node_name -epsilon false`</block>
  <block id="76b412290ecb092e2d154f8ccbb88a86" category="list-text">将 epsilon 分配给其他节点： + `cluster modify -node new_node_name -epsilon true`</block>
  <block id="91ab806eca55f1234d360a9bf96615a0" category="list-text">从将保留在集群中的节点中，取消每个原始节点与集群的连接（高级权限级别）：</block>
  <block id="51a51858dd44ce1a914d46a2bd250c26" category="paragraph">`cluster unjoin -node original_node_name`</block>
  <block id="a38cfcfcdebdf9c05a1cd632c11918b8" category="paragraph">未加入的节点将自动重新启动并停留在启动菜单处。</block>
  <block id="7ab0d0bb58501cb25dab62cdcffddfb5" category="list-text">从未加入的节点的启动菜单中，选择选项 * （ 4 ） Clean configuration and initialize all disks* 以擦除节点的配置并初始化所有磁盘。</block>
  <block id="35c0226d4e8a9cad1a873c648504d626" category="list-text">在两个提示符处输入 `y` 。</block>
  <block id="7f1e916ec0aa6a4296149be58ba61a1b" category="list-text">如果集群只剩下两个节点，请为双节点集群配置高可用性：</block>
  <block id="c1f192f6d626bc5f27fc74b0848a1250" category="paragraph">`cluster ha modify -configured true`</block>
  <block id="3f1179e7186b307a8709f115c39b6447" category="summary">在将替代节点恢复使用之前，您应验证 LIF 是否位于其主端口上，如果启用了 AutoSupport ，则注册替代节点的序列号，并重置自动交还。</block>
  <block id="628b47858489e93aecb44f24bebc9752" category="doc">验证 LIF 并注册序列号</block>
  <block id="462ec873925d8409f9ead354ff424e1b" category="list-text">验证逻辑接口是否正在向其主服务器和端口报告： `network interface show -is-home false`</block>
  <block id="d1197fe9a52f419575a145acccb941a2" category="paragraph">如果任何 LIF 列为 false ，请将其还原到其主端口： `network interface revert *`</block>
  <block id="bfe787834fd9e46156b1d62f2f5029f8" category="list-text">向 NetApp 支持部门注册系统序列号。</block>
  <block id="bfa9de45095a3a90ebc55708a5ee6dd2" category="cell">条件</block>
  <block id="f5090af0ae9521298aea8ea3cd0e570f" category="paragraph">AutoSupport 已启用</block>
  <block id="494f202ae3a9c9ea2b452b55743f4c56" category="paragraph">发送 AutoSupport 消息以注册序列号。</block>
  <block id="f08f2281e0941651d12c9d63e01b3a7e" category="paragraph">未启用 AutoSupport</block>
  <block id="8ba4d456a3db9d62662e21be8c9d6a65" category="paragraph">请致电 NetApp 支持部门以注册序列号。</block>
  <block id="073b364a34edc88074c1df13d44748dc" category="list-text">如果已禁用自动交还，请重新启用它： `storage failover modify -node local -auto-giveback true`</block>
  <block id="cfc31108ced0d656186982f19a21b817" category="summary">如果新节点已将内部磁盘或附加磁盘架连接到系统，这些磁盘或附加磁盘架可能会干扰控制器升级。按照以下步骤删除 node3/node4 附带的任何新磁盘的所有权。</block>
  <block id="0384bfe1408e63aec8306b1fb36df994" category="paragraph">这些步骤会依次对 node3 和 node4 执行。节点顺序无关紧要。</block>
  <block id="12750846be9d21d5385ed58a60cddf27" category="list-text">在此阶段， node1 和 node2 中的磁盘架不会物理连接到 node3 和 node4 。</block>
  <block id="db39a0ef5bc94a0b575d978a8f76229a" category="list-text">对于新控制器附带的磁盘和磁盘架，您只需要删除其磁盘所有权。</block>
  <block id="9ec9f63f098d105f79f28fc374c9efa9" category="list-text">如果要升级硬件，您无需删除磁盘所有权，只需在内部驱动器平台上将旧控制器更换为新控制器，同时保留旧控制器的机箱和磁盘即可。</block>
  <block id="eece111dbeb75d75a9174395ce77bfe2" category="paragraph">例如，如果要将系统从 A200 升级到 A220 ，只需将旧的 A200 控制器模块更换为新的 A220 控制器模块，同时保持旧 A200 的机箱和磁盘就位， 您不会按照本节 " 删除连接到新节点的磁盘的所有权 " 中所述删除新 A220 控制器模块的磁盘所有权。</block>
  <block id="70cb24dc68388db99857a34f097c9997" category="paragraph">如果您对在控制器升级期间删除磁盘所有权有任何疑问，请联系 NetApp 技术支持。</block>
  <block id="2b9741a797759c9ecbbb675ca7437fbd" category="paragraph">下面列出了具有内部存储的系统： FAS2220 ， FAS2240-2 ， FAS2240-4 ， FAS2520 ， FAS2552 ， FAS2554 ， FAS2620 ， FAS2650 ， FAS2720 ， FAS2750 ， AFF A200 ， AFF A220 ， AFF A700s ， AFF A800 ， AFF A250 。</block>
  <block id="bd6c6f37524ad70ce38bbd0fcea22fe4" category="list-text">在节点的 LOADER 提示符处，输入命令：</block>
  <block id="1d16d3ddc3b796c6db7da6cbb645757e" category="list-text">在启动菜单提示符处，输入 `9a` ，然后按 Enter 键。</block>
  <block id="8b33e54d0bef1c80ef3462386d101928" category="paragraph">以下屏幕将显示启动菜单提示符：</block>
  <block id="543ee8d410a9846b897a6a8491f4e3b9" category="list-text">出现类似以下内容的提示时，输入 `y` 以删除磁盘所有权：</block>
  <block id="d9eb47ff217ad0469ac1858d577a0cfb" category="paragraph">系统将删除磁盘所有权并返回到启动菜单。</block>
  <block id="cfd1f1b088da29d35da848a99036f2c2" category="list-text">在启动菜单中，输入 `5` 以转到维护模式。</block>
  <block id="c256ea1e274adba11cfac708ac1ca615" category="list-text">在维护模式下，运行 `disk show` 命令。</block>
  <block id="07073a18c7281a79e3145d79b79ade85" category="paragraph">不应列出任何磁盘。</block>
  <block id="549400d83d5a33165c1b78f09eaa13cd" category="list-text">运行命令： `</block>
  <block id="b42167fc8c56e26bc5bde99cbcb98104" category="paragraph">`d` 展示 -A</block>
  <block id="5057bd67c1c2576016193c2f0d132b9e" category="paragraph">应取消分配列出的所有磁盘。</block>
  <block id="dd6fe690111683fcc32f39f51ca30885" category="summary">如果集群位于 SAN 环境中，则必须先从原始节点中删除所有 SAN LIF ，然后才能从集群中取消原始节点的加入。</block>
  <block id="94a76ebba8e86706797afe6001140741" category="list-text">如果您有 iSCSI 启动程序，请完成以下步骤：</block>
  <block id="a5395c57c84d5445d3bc183d43971c84" category="list-text">显示当前连接到原始节点上 SVM 的活动启动程序列表，对于每个旧 LIF ，请执行一次： + `iscsi connection show -vserver vserver_name -lif old_lif`</block>
  <block id="9882b7407728c4a51f28a203651b752e" category="paragraph">以下示例显示了一个活动启动程序连接到 SVM vs1 的命令输出：</block>
  <block id="2a81dce4a4ecbdb4f7260dfa1838dac6" category="list-text">如果任何启动程序仍登录到原始节点，请从主机计算机注销会话。</block>
  <block id="493c466bbc1a048411e1332636aef467" category="list-text">显示端口集列表以确定原始节点上的任何 iSCSI 或 FC LIF 是否属于端口集：</block>
  <block id="5972ec667e5c2e5cbe773b47e490a953" category="paragraph">以下示例显示了 `lun portset show` 命令的输出：</block>
  <block id="d69982078792402e28116b8f58d9d635" category="list-text">如果原始节点上的任何 iSCSi 或 FC LIF 是端口集的成员，请将其从端口集中删除：</block>
  <block id="7f4d8047dc2bcd79aa48d9d7fa9e6135" category="paragraph">`lun portset remove -vserver vserver_name -portset portset_name -port-name lif_name`</block>
  <block id="49804bf53ebb394c1046383af76de316" category="list-text">删除原始节点上的 LIF ：</block>
  <block id="d468339ef0e97aa25dd22b526e2b4655" category="paragraph">`network interface delete -vserver vserver_name -lif lif_name`</block>
  <block id="b1a0d07fe29de61a8daf2f40dc030fa0" category="summary">如果您使用的是双节点集群，请将 node1 拥有的 NAS 数据 LIF 移动到 node2 ；如果您的集群具有两个以上的节点，请将其移动到第三个节点。</block>
  <block id="58822be5f616d4235e991fbe0296fada" category="doc">将 node1 拥有的 NAS 数据 LIF 移动到 node2</block>
  <block id="d677e75ccf45beeb5b21f833de6355ae" category="paragraph">在将 node1 替换为 node3 之前，如果您使用的是双节点集群，则需要将 node1 拥有的 NAS 数据 LIF 移动到 node2 ；如果您的集群具有两个以上的节点，则需要将此数据 LIF 移动到第三个节点。您使用的方法取决于集群是为 NAS 配置还是为 SAN 配置的。</block>
  <block id="79fcafddf2ef06a07412a35db15035c1" category="list-text">输入以下命令并捕获输出，列出 node1 上托管的所有 NAS 数据 LIF ：</block>
  <block id="7c35bd185f1677a1529aeccf6330a868" category="paragraph">`network interface show -data-protocol nfs|cifs -curr-node node1`</block>
  <block id="612e04a0c9957c7f74e9d436ac270501" category="paragraph">系统将在 node1 上显示 NAS 数据 LIF ，如以下示例所示：</block>
  <block id="423e99aaa66fb1d5698571ceb7787197" category="cell">如果 node1...</block>
  <block id="9f5a5f99675a7cf2f4c0f632bd521264" category="cell">已配置 VLAN 的接口组</block>
  <block id="3fbab376baacaf9d09315af900da3f6a" category="cell">转至 <block ref="73988682af36d698a9ae8b48b9a2737d" category="inline-xref-macro-rx"></block>。</block>
  <block id="e47ea6851b10e922828b9e5bacc36c92" category="cell">未配置接口组或 VLAN</block>
  <block id="8a083d04d78f8fe76f58b24395ba2022" category="cell">跳过步骤 3 ，然后转到 <block ref="beab2fdc7da05fb5989bf509ea2daea5" category="inline-xref-macro-rx"></block>。</block>
  <block id="4712f9e61b86338570c118282bc641ed" category="paragraph">使用 `network port vlan show` 命令显示连接到 VLAN 的网络端口的信息，并使用 `network port ifgrp show` 命令显示有关端口接口组的信息。</block>
  <block id="6528b79560f5ae1516e9968be210a07d" category="list-text">[[man_move_lif_1_2_step3]] 执行以下步骤以迁移节点 1 上接口组和 VLAN 上托管的任何 NAS 数据 LIF ：</block>
  <block id="8bd077e3dce2f8f220ab19459980af51" category="list-text">[[man_move_lif_1_2_substepa]] 通过为每个 LIF 输入以下命令，将任何接口组上托管的 LIF 以及 node1 上的 VLAN 迁移到 node2 上能够在与接口组相同的网络上托管 LIF 的端口：</block>
  <block id="532386a943dfd95190455b990ba6c18e" category="paragraph">`network interface migrate -vserver vserver_name -lif LIF_name -destination-node node2 – destination-port netport_ifgrp`</block>
  <block id="d280fa5d8e575828d8f638790f296c00" category="inline-xref">子步骤 A</block>
  <block id="1628d2e876b9a7ece7457b58b454f0f8" category="list-text">在中修改 LIF 和 VLAN 的主端口和主节点 <block ref="b068a71282806dafa110a592d499562a" category="inline-xref-macro-rx"></block> 输入以下命令，将 LIF 设置为当前托管 LIF 的端口和节点，每个 LIF 设置为一次：</block>
  <block id="6ce648ecb031d76708d572641357072b" category="paragraph">`network interface modify -vserver vserver_name -lif LIF_name -home-node node2 - home-port netport_ifgrp`</block>
  <block id="086b32c6a9769e491af04f596b7bfca4" category="list-text">[[man_move_lif_1_2_step4]] 执行以下操作之一：</block>
  <block id="9b9179b830c575fb1e672a3bed56f248" category="cell">如果集群配置为 ...</block>
  <block id="c07ee5debf5f3a3fef16c1ee5e8e4942" category="cell">NAS</block>
  <block id="9db3a11cc23080bb3486b4959df93f89" category="cell">完成 <block ref="6be540ebb4740a88748088c797e28dfb" category="inline-xref-macro-rx"></block> 到 <block ref="8c4818d75222cc6bc9243f323ca4103f" category="inline-xref-macro-rx"></block>。</block>
  <block id="8fe56b720dacf5911cddd3cd028caa0d" category="cell">禁用节点上的所有 SAN LIF 以将其关闭以进行升级： `network interface modify -vserver vserver-name -lif LIF_name -home-node node_to_upgrade -home-port netports|ifgrp -status-admin down`</block>
  <block id="edb9ff92dd35aa076c32a5b0487cf528" category="list-text">【 man_move_lif_1_2_step5]] 通过输入以下命令将 NAS 数据 LIF 从 node1 迁移到 node2 ，每个数据 LIF 输入一次：</block>
  <block id="60ab3764be803e289fc1c9e1f4becf78" category="paragraph">`network interface migrate -vserver vserver-name -lif LIF_name -destination-node node2 -destination-port data_port`</block>
  <block id="011613a251d2244827057c36e226c438" category="list-text">【第 6 步】输入以下命令并检查其输出，通过在任一节点上输入以下命令并检查输出来验证 LIF 是否已移至正确的端口以及 LIF 的状态是否为 up ：</block>
  <block id="82ff09e405e4a0601bb2e3bf3447aa66" category="paragraph">`network interface show -curr-node node2 -data-protocol nfs|cifs`</block>
  <block id="0ca2ea33efb8a577e5384d4a18adcffd" category="list-text">【第 7 步】输入以下命令，修改已迁移 LIF 的主节点：</block>
  <block id="af72da249f9d9dcc1ab3aa8e8e1bf3d5" category="paragraph">`network interface modify -vserver vserver-name -lif LIF_name -home-node node2 -home-port port_name`</block>
  <block id="54c8107ec5763757535759e84fcccba4" category="inline-xref">第 9 步</block>
  <block id="24a01d225f607904f05ab3a7a5eff1be" category="list-text">[[man_move_lif_1_2_step8]] 验证 LIF 是否正在使用此端口作为其主端口或当前端口。如果端口不是主端口或当前端口，请转到 <block ref="ba7153f88da2aa27ea58156672491fe1" category="inline-xref-macro-rx"></block>：</block>
  <block id="20650cdc9d03cca94955f9aa1aebaa3e" category="paragraph">`network interface show -home-node node2 -home-port port_name`</block>
  <block id="68c591205ff442d6a2dfcdff815a70e8" category="paragraph">`network interface show -curr-node node_name -curr-port port_name`</block>
  <block id="2a1a5d0b34f7d2f4f340e16e5ed9d90a" category="list-text">【 ｛ man_move_lif_1_2_step9]] 如果 LIF 使用此端口作为主端口或当前端口，请修改此 LIF 以使用其他端口：</block>
  <block id="1e12aee2135a80ed21e36af7e0f7a929" category="paragraph">`network interface migrate -vserver vserver-name -lif LIF_name -destination – node node_name -destination-port port_name`</block>
  <block id="5c1f3d117b4e7944d0f28ba574029f1b" category="paragraph">`network interface modify -vserver vserver-name -lif LIF_name -home – node node_name -home-port port_name`</block>
  <block id="cdae0f8302333cbd9fe195bb2499a162" category="list-text">【第 10 步】如果新硬件上不存在当前托管数据 LIF 的端口，请立即将其从广播域中删除：</block>
  <block id="194bb2205f1a9c8bff448caa87b83499" category="paragraph">`network port broadcast-domain remove-ports -ipspace default -broadcast-domain default -ports node ： port`</block>
  <block id="6632ea124419e4975a848a28ab279bcc" category="list-text">【第 11 步】如果任何 LIF 已关闭，请输入以下命令，将 LIF 的管理状态设置为 "up" ，每个 LIF 一次：</block>
  <block id="b430ff8ef5da076ed58bd889aff4151e" category="paragraph">`network interface modify -vserver vserver-name -lif LIF_name -home-node nodename -status-admin up`</block>
  <block id="ce270ee93c1ab9bf63347bb904931cc7" category="admonition">对于 MetroCluster 配置，您可能无法更改端口的广播域，因为它与托管目标 Storage Virtual Machine （ SVM ） LIF 的端口相关联。从远程站点上对应的源 SVM 输入以下命令，将目标 LIF 重新分配到相应的端口： `MetroCluster vserver resync -vserver vserver_name`</block>
  <block id="1f6fa329d299f0b4d14f73ea128a6b26" category="list-text">【第 12 步】输入以下命令并检查其输出，以验证 node1 上是否没有剩余数据 LIF ：</block>
  <block id="05a146ab756c5e6ffc41a488060cdde2" category="paragraph">`network interface show -curr-node node1 -role data`</block>
  <block id="317d3198e2e906761f5856d7e9ba7889" category="list-text">【第 13 步】如果配置了接口组或 VLAN ，请完成以下子步骤：</block>
  <block id="1c16a793ae4cde12aba8cd19ca0ab9cf" category="paragraph">`network port vlan delete -node nodename -port ifgrp_name -vlan-id vlan_ID`</block>
  <block id="ee6b2de39fcb27b4025f1b287639db82" category="summary">您需要在机架中安装 node4 ，将 node2 连接传输到 node4 以及启动 node4 。</block>
  <block id="a55f4c112389aef5c1095610759695f4" category="paragraph">您需要在机架中安装 node4 ，将 node2 连接传输到 node4 以及启动 node4 。此外，还必须重新分配任何 node2 备用磁盘，属于 root 的任何磁盘以及先前未重新定位到 node3 的任何非根聚合。</block>
  <block id="46bf31662c49b18f28ea137563eae20a" category="paragraph">如果 node4 的 ONTAP 9 版本与 node2 上安装的版本不同，则需要对其进行网络启动。安装 node4 后，从 Web 服务器上存储的 ONTAP 9 映像启动它。然后，您可以按照中的说明将正确的文件下载到启动介质设备，以供后续系统启动 <block ref="4815c2d091d790c1d3bab94177b38eaf" category="inline-link-macro-rx"></block></block>
  <block id="7450170c152f247fc2c9a5ece1d25571" category="paragraph">但是，如果 node4 安装的 Data ONTAP 9 版本与 node2 上安装的版本相同或更高，则不需要对其执行网络启动。</block>
  <block id="02a3537f6e96697842c87c410e1169a9" category="paragraph">* 重要 * ：</block>
  <block id="44a1dd334ad3ac6220ea0adf17519961" category="list-text">如果要升级连接到存储阵列的 V 系列系统或使用 FlexArray 虚拟化软件的系统，则需要完成 <block ref="a48f24f7fd083b3ec1c1fb7f5bee1e25" category="inline-xref-macro-rx"></block> 到 <block ref="23a128901edc6abd74721071977e73e9" category="inline-xref-macro-rx"></block>，请将此部分保留在 <block ref="4b3dcb4f5ad67f2f001c91135169a837" category="inline-xref-macro-rx"></block> 并按照中的说明进行操作 <block ref="488c6e462745f03d8c1dfb3ba61f7258" category="inline-link-macro-rx"></block> 根据需要在维护模式下输入命令。然后，您需要返回到此部分并通过恢复操作步骤 <block ref="9b924d5c1ba14dd46bf7c40da5a15e7c" category="inline-xref-macro-rx"></block>。</block>
  <block id="78b1d5bad885b3107f106e5d1a9b18ec" category="list-text">但是，如果要升级具有存储磁盘的系统，则需要完成整个部分，然后继续执行部分 <block ref="488c6e462745f03d8c1dfb3ba61f7258" category="inline-link-macro-rx"></block>，在集群提示符处输入命令。</block>
  <block id="bdb96da2d8e74dfce89eef174e77991a" category="list-text">[[man_install4_Step1]] 执行以下操作之一：</block>
  <block id="668ee630125cb736935532180dec5496" category="cell">如果 node4 将位于 ...</block>
  <block id="162e71035e50cc882a8bc6f9ff5b49f2" category="cell">与 node3 不同的机箱</block>
  <block id="fd915b6d9d7d8df5863bf1a398fcf38a" category="cell">转至 <block ref="5da993404245519b124ccd5cfdc8f96e" category="inline-xref-macro-rx"></block>。</block>
  <block id="517089a54c66f01f0ee8cb8683dad1ec" category="cell">具有 node3 的同一机箱</block>
  <block id="9a56a499535dc46c81b504689b6f1584" category="cell">跳过步骤 2 和 3 ，然后转到 <block ref="d70dd93eaf2d4e4f4bee874c28b01d22" category="inline-xref-macro-rx"></block>。</block>
  <block id="409539264ec665ff1676a423db4f5983" category="list-text">[[man_install4_Step2]] 确保 node4 具有足够的机架空间。</block>
  <block id="b8b0bf4a502958083dc62a5c96442944" category="paragraph">如果 node4 与 node3 位于不同的机箱中，则可以将 node4 与 node2 放在同一位置。如果 node3 和 node4 位于同一机箱中，则 node4 已位于其相应的机架位置。</block>
  <block id="b2a26edcdea9e0bc9d1a1f149aaa56af" category="list-text">【 man_install4_Step4]] 为节点 4 布线，将连接从节点 2 移动到节点 4 。</block>
  <block id="9f13bb9f267a0b057f115598b95b4a04" category="paragraph">以下参考资料可帮助您正确进行缆线连接。转至 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 以链接到它们。</block>
  <block id="19c5c8c6d8397114c1994a6c3eb88f1f" category="paragraph">使用缆线连接以下连接：</block>
  <block id="6b3c36f97ba6ae6e5b790f8c06f76595" category="admonition">您无需将互连卡 /FC_VI 卡或互连 /FC_VI 缆线连接从 node2 移至 node4 ，因为大多数平台型号都具有唯一的互连卡型号。</block>
  <block id="7c6dcbfbd814e3914af912fc227236db" category="cell">如果 node4 位于 ...</block>
  <block id="0eac7849b27808b92dfd85fd93d5adf9" category="cell">与 node3 相同的机箱</block>
  <block id="ebfef1d5b820c6361e45e99afc605aff" category="cell">转至 <block ref="4b3dcb4f5ad67f2f001c91135169a837" category="inline-xref-macro-rx"></block>。</block>
  <block id="23651fb868295760fbf6e0040b0debb0" category="cell">转至 <block ref="38932d9b2776291a7bec718b723ae495" category="inline-xref-macro-rx"></block>。</block>
  <block id="84857d961b292bb9faee31d20a2e4320" category="list-text">【 man_install4_Step6]] 打开 node4 的电源，然后按 `Ctrl-C` 以访问启动环境提示符来中断启动。</block>
  <block id="2533698a45ba6cab05df3bd9337b544f" category="admonition">启动 node4 时，您可能会看到以下消息：</block>
  <block id="6904f97422da010c9982167637cc6d56" category="list-text">【 ｛ man_install4_Step7]] 如果您在步骤 6 中看到警告消息，请执行以下操作：</block>
  <block id="abb5e8621f032d746c9aa9b35f472595" category="list-text">检查是否存在任何可能指示 NVRAM 电池电量低以外问题的控制台消息，如有必要，请采取任何必要的更正措施。</block>
  <block id="8ece0169cd074b513037985b1656b1cd" category="list-text">让电池充电并完成启动过程。</block>
  <block id="30567eb6dc573926907b3bb63db7137a" category="admonition">* 警告：不要覆盖此延迟。如果不允许电池充电，可能会导致数据丢失。 *</block>
  <block id="945c73c9ea193c92dd8b512126669f13" category="list-text">[[man_install4_Step8]] 执行以下操作之一：</block>
  <block id="fb89a7ef586904dc37e09f10f3f0ec64" category="inline-xref">第 15 步</block>
  <block id="a2a7998a5450e891bb5464c1204815d8" category="cell">跳过第 9 步到第 14 步，然后转到 <block ref="5c1f19cc6cb716956fba505fb903a21f" category="inline-xref-macro-rx"></block>。</block>
  <block id="0366496afb0bd008f8fb19b74f53ec71" category="inline-link-macro">在节点 4 上配置 FC 端口</block>
  <block id="7973536954a566dd7a59dc4fa1580481" category="list-text">转至 _set the FC or UTA/UTA2 configuration on node4_ 一节并完成各节 <block ref="5dc4a26bdcd4279b0919835bab13d0db" category="inline-link-macro-rx"></block> 和 <block ref="b0f6547feb9924da912bf4fa3357e2fc" category="inline-link-macro-rx"></block>，根据您的系统情况而定。</block>
  <block id="f01b0d07fd3bcdce42fd5cf6a8f46551" category="list-text">返回到此部分，完成从开始的其余步骤 <block ref="9b924d5c1ba14dd46bf7c40da5a15e7c" category="inline-xref-macro-rx"></block>。</block>
  <block id="0ecbf7c74e381542280cb5ae382623c0" category="paragraph">* 重要信息 * ：在 V 系列系统上启动 Data ONTAP 之前，您必须重新配置 FC 板载端口， UTA/UTA2 板载端口和 UTA/UTA2 卡。</block>
  <block id="562a6369849944020611b8a9540b9c5c" category="list-text">【 man_install4_Step9]] 将新节点的 FC 启动程序端口添加到交换机分区。</block>
  <block id="a68de9b3c6fcb14f9c96b6e558ca71f8" category="list-text">修改与存储阵列上的阵列 LUN 关联的主机或卷组中的全球通用端口名称（ WWPN ）值。</block>
  <block id="1ad5461b16a79391d48cbca2383e0c9e" category="list-text">输入以下命令并检查其输出，以验证阵列 LUN 现在是否对 node4 可见：</block>
  <block id="6b3585cc5d8743bbae5204f3097641c4" category="paragraph">`ssysconfig -v`</block>
  <block id="134f75a624b82855271656ebc0cf2d5f" category="paragraph">系统将显示每个 FC 启动程序端口可见的所有阵列 LUN 。如果阵列 LUN 不可见，则您不能在本节稍后将磁盘从 node2 重新分配到 node4 。</block>
  <block id="05ecdb384acc604bb6388efe9a979597" category="list-text">按 `Ctrl-C` 以显示启动菜单，然后选择维护模式。</block>
  <block id="a2835e58397213dc9bedb9afe05d29d2" category="list-text">在维护模式提示符处，输入以下命令：</block>
  <block id="2f31b93de57cc6e92ee38aaed9b49765" category="paragraph">系统将在启动环境提示符处停止。</block>
  <block id="9b30a77b62fcc76d557f789dd6ce3167" category="list-text">为 ONTAP 配置 node4 ：</block>
  <block id="70fa8a94fae594e32ef99991313ee137" category="list-text">如果在此配置中使用 FDE ，则必须将 `setenv bootarg.storageencryption.support` 变量设置为 `true` ，并将 `kmip.init.maxwait` 变量设置为 `off` ，以避免在加载 node2 配置后出现启动环路：</block>
  <block id="c769624c49a19cf249ae2dabe50fafd5" category="list-text">如果 node4 上安装的 ONTAP 版本与 node2 上安装的 ONTAP 9 版本相同或更高，请输入以下命令：</block>
  <block id="648ad8a1b1818127b7b933420429d236" category="cell">如果要升级的系统 ...</block>
  <block id="bd525e59dc1c481092f22bdaeff4a9cb" category="cell">node4 上的 ONTAP 版本不正确或当前不正确</block>
  <block id="d4d1f4ca7806007366aa98184f062124" category="inline-xref">第 20 步</block>
  <block id="642ae729bd75051692412fd6ebaf2526" category="cell">转至 <block ref="1fde564298826640b3bacb4260e3eaea" category="inline-xref-macro-rx"></block>。</block>
  <block id="9b66895c756fece1df6c42e12763649b" category="cell">node4 上的 ONTAP 版本正确或最新</block>
  <block id="7769822edfc550f3ba37429715882554" category="inline-xref">第 25 步</block>
  <block id="107c908e64ebe1cdac15562994203122" category="cell">转至 <block ref="aadd3e12a76cc16c765ef6c4ab9ed890" category="inline-xref-macro-rx"></block>。</block>
  <block id="76b2a354a862c0069407c912fb51ee50" category="list-text">【 man_install4_Step20]] 通过选择以下操作之一来配置网络启动连接。</block>
  <block id="819576ac2beda71a5f64c74e58833045" category="admonition">您应使用管理端口和 IP 地址作为网络启动连接。请勿使用数据 LIF IP 地址，否则在执行升级期间可能会发生数据中断。</block>
  <block id="6b3f72590e2ba575765b270b75ec3265" category="cell">在启动环境提示符处输入以下命令，以手动配置连接： `ifconfig e0M -addr=filer_addr mask=netmask -gw=gateway dns_addr domain=dns_domain` `filer_addr` 是存储系统的 IP 地址。`netmask` 是存储系统的网络掩码。`gateway` 是存储系统的网关。`dns_addr` 是网络上名称服务器的 IP 地址。`dns_domain` 是域名服务（ DNS ）域名。如果使用此可选参数，则无需在网络启动服务器 URL 中使用完全限定域名；您只需要服务器的主机名。* 注 * ：接口可能需要其他参数。有关详细信息，请在固件提示符处输入 `help ifconfig` 。</block>
  <block id="a1e9c2458084c8aed432506005e0789e" category="cell">`netboot \http://web_server_ip/path_to_webaccessible_directory/netboot/kernel`</block>
  <block id="7e0c898eb7a2157f9a4fe767ff353ea1" category="cell">`netboot \http://web_server_ip/path_to_webaccessible_directory/ontap_version_image.tgz`</block>
  <block id="feed6e71880a4cdb6f484b72b59ad1c7" category="paragraph">`path_to_the_web-accessible_directory` 应指向下载 `ontap_version_image.tgz` 的位置 <block ref="d7ca8bd1bdacba48998a89c59527e756" category="inline-link-macro-rx"></block> 在 _prepare for netboot_ 一节中。</block>
  <block id="309791cba48d347af2b367032b3dd97b" category="list-text">从启动菜单中，选择 `option （ 7 ） Install new software first` 。</block>
  <block id="0b2229e3a518ca5320ae9e1f22775ad9" category="paragraph">此菜单选项可下载新的 Data ONTAP 映像并将其安装到启动设备中。</block>
  <block id="c0c1ca8a9ddeae72e1e2be38243a2522" category="paragraph">请忽略以下消息：</block>
  <block id="af7a0d97078a38e1bd7d89c61066724a" category="paragraph">` " 此操作步骤不支持在 HA 对上进行无中断升级 "`</block>
  <block id="52e732ba64db04aee6e7ad74ff701940" category="paragraph">注意适用场景可无中断升级 Data ONTAP ，而不是升级控制器。</block>
  <block id="3649c3b28305249c1b3207c6087eaedc" category="list-text">【 ｛ man_install4_step23]] 如果系统提示您继续运行操作步骤，请输入 y ，当系统提示您输入软件包时，请输入 URL ：</block>
  <block id="ad4f522a516d9a5742a3b1abdd5d7e77" category="paragraph">` http://web_server_ip/path_to_web-accessible_directory/ontap_version_image.tgz`</block>
  <block id="3678fe02acf5ec3ff8f4fbebc3fd7a4d" category="list-text">完成以下子步骤：</block>
  <block id="037fcad07615e2da823be3a48a35cfb8" category="paragraph">控制器模块重新启动，但停留在启动菜单处，因为启动设备已重新格式化，需要还原配置数据。</block>
  <block id="212239c0a7a5196ffbd8cc3895cfce05" category="list-text">【 man_install4_Step25]] 从启动菜单中选择维护模式 `5` ，并在系统提示您继续启动时输入 `y` 。</block>
  <block id="88dd4b794782fce5edb7683e13199311" category="list-text">在继续操作之前，请转到 <block ref="488c6e462745f03d8c1dfb3ba61f7258" category="inline-link-macro-rx"></block> 对节点上的 FC 或 UTA/UTA2 端口进行任何必要的更改。执行这些部分中建议的更改，重新启动节点并进入维护模式。</block>
  <block id="7e3544f15733cd05bc2830419b4be7f9" category="list-text">输入以下命令并检查输出以查找 node4 的系统 ID ：</block>
  <block id="4e974a66c77c6d900d32abc8f0338440" category="paragraph">系统将显示节点的系统 ID 及其磁盘信息，如以下示例所示：</block>
  <block id="fae986fa29654ebe6966932d05eb132d" category="inline-link-macro">将非根聚合从 node2 重新定位到 node3</block>
  <block id="6ebd270373edc34882879e2c2ed9e67b" category="list-text">重新分配 node2 的备用磁盘，属于根的磁盘以及第节前面未重新定位到 node3 的任何非根聚合 <block ref="2eb3ddacc3cdbca929068de80db9b0b7" category="inline-link-macro-rx"></block>：</block>
  <block id="f6083059f6516202ed7ac1092bed861b" category="cell">Disk type</block>
  <block id="65f83791dfc3308f8c98325d44977d10" category="cell">运行命令 ...</block>
  <block id="8e209d660098d73b07642a1950888f1d" category="cell">共享磁盘</block>
  <block id="a3432db44a757895f3eb3a1c9f4d3cea" category="cell">`dreassign` `node2_sysid -d node4_sysid -p node3_sysid`</block>
  <block id="567c7db5eb132ed0419b894d763f1872" category="cell">无共享</block>
  <block id="cb3bccddce7862ce1908af49d7e9df63" category="cell">`disks disk reassign -s` `node2_sysid -d node4_sysid`</block>
  <block id="b95982609bcaa66a9948629f87fe8589" category="inline-link-macro">第 10 步</block>
  <block id="7f9877f92749af42ef730feeda0dba70" category="paragraph">对于 `node2_sysid` 值，请使用中捕获的信息 <block ref="09a261426dbc4b06f375c3dc720b5b79" category="inline-link-macro-rx"></block> 记录 node2 信息 _ 部分的。对于 `node4_sysid` ，请使用中捕获的信息 <block ref="9c7125eb7b33f2cb03297a560d0660b0" category="inline-xref-macro-rx"></block>。</block>
  <block id="2e55dc5dee1972467c8f86adee9b26a8" category="admonition">只有当存在共享磁盘时，才需要在维护模式下使用 ` -p` 选项。</block>
  <block id="423897eae7d5975e08caad3349a2ff49" category="paragraph">使用 `disk reassign` 命令将仅重新分配 `node2_sysid` 是当前所有者的磁盘。</block>
  <block id="6a76a1a5611a7cd78d175bb62eecc5c0" category="paragraph">系统将显示以下消息：</block>
  <block id="685b8dfe5883c0cc4f183236c52e6cdd" category="paragraph">当系统要求中止磁盘重新分配时，输入 `n` 。</block>
  <block id="c8baecc7560f46020b0d73d658566eab" category="paragraph">当系统要求您中止磁盘重新分配时，您必须按照以下步骤所示问题解答一系列提示：</block>
  <block id="906012ab50dee220a65fb1458eb58128" category="list-text">输入 `y` 以允许更新磁盘所有权。</block>
  <block id="0bcba60a38db3b0f12b08821c6ae56fc" category="list-text">如果要从具有外部磁盘的系统升级到支持内部和外部磁盘的系统（例如， A800 系统），请将 node4 设置为 root ，以确保它从 node2 的根聚合启动。</block>
  <block id="81d274af1a54983c64b259dfc78b1c9f" category="admonition">* 警告：必须按所示的确切顺序执行以下子步骤；否则可能发生原因会导致中断甚至数据丢失。 *</block>
  <block id="1ca7ffcdba47b0e1e7fe67ed3e918c17" category="list-text">检查 node2 聚合的整体状态：</block>
  <block id="9cf332fc3e49cdbc8c4e5181c30ae161" category="list-text">输入以下命令并观察输出，以验证控制器和机箱是否配置为 `ha` ：</block>
  <block id="af2a502808ef81f73370e9e64784659d" category="paragraph">系统会在 PROM 中记录它们是采用 HA 对还是独立配置。独立系统或 HA 对中的所有组件的状态都必须相同。</block>
  <block id="92435116502eec5121875eb86e01c666" category="paragraph">如果控制器和机箱未配置为 `ha` ，请使用以下命令更正配置：</block>
  <block id="2e89fd69efdc517bb6463b3444e009df" category="paragraph">`ha-config modify chassis ha` 。</block>
  <block id="efa973aed3146abf01226e85a9e5f816" category="paragraph">如果您使用的是 MetroCluster 配置，请使用以下命令更正此配置：</block>
  <block id="27dae2ee8e632216c89579f651774f45" category="paragraph">`ha-config modify chassis mcc`</block>
  <block id="79d038b849b0e37c67ee77c0b56d066f" category="list-text">销毁 node4 上的邮箱：</block>
  <block id="953d8f613cc775b0d7904f99aec7a052" category="list-text">在 node3 上，检查系统日期，时间和时区：</block>
  <block id="e3f03a007dc36d2b8067017bfe222275" category="list-text">在 node4 上，在启动环境提示符处检查日期：</block>
  <block id="02bb70865b20c57eb319b73c84b5fd7f" category="list-text">在 node4 上，在启动环境提示符处检查时间：</block>
  <block id="6f690bd73c9853fafd7c1e4456ccea21" category="inline-xref">第 26 步</block>
  <block id="c73ed66a3414025099d74b00d7536036" category="list-text">验证配对系统 ID 是否设置正确，如中所述 <block ref="6f4b83e10b4758eab71105c01c130b34" category="inline-xref-macro-rx"></block> 在选项下。</block>
  <block id="eb91daa92a7cd6e3d0f28a92df381e46" category="paragraph">`setenv partner-sysid node3_sysid`</block>
  <block id="0f463f9540d67b2794aa78893f83b8aa" category="list-text">在启动环境提示符处输入启动菜单：</block>
  <block id="ca0b24352c36c0cc73393a18e38ead22" category="list-text">在启动菜单中，在提示符处输入 `6` ，选择选项 * （ 6 ） Update flash from backup config* 。</block>
  <block id="23fc33b520f7242c5f2fb610689e9e8c" category="list-text">在提示符处输入 `y` 。</block>
  <block id="d9f991b0b3aa3c03080efb5d84a35c57" category="paragraph">启动正常进行，系统会提示您确认系统 ID 不匹配。</block>
  <block id="88d91937c0736919ae3483a3cb1e1f7e" category="admonition">系统可能会重新启动两次，然后才会显示不匹配警告。</block>
  <block id="c3a51f505b0a44650db3707558ddeefc" category="list-text">确认不匹配。节点可能会在正常启动之前完成一轮重新启动。</block>
  <block id="cc7dd78f409b3f942015e8a65f2c11e8" category="list-text">登录到 node4 。</block>
  <block id="530a7a6682d1262288d095a4aa2ae42b" category="summary">ARL 升级工作流</block>
  <block id="1952abc535fabeeeed9743b9b39b5e18" category="paragraph">下图显示了操作步骤的各个阶段。浅灰色厚箭头表示聚合的重新定位和 LIF 的移动，而较细的黑色箭头表示原始节点的删除。较小的控制器映像代表原始节点，较大的控制器映像代表新节点。</block>
  <block id="5191d5caf73991c5e6249017d138d1c4" category="inline-image-macro">图中显示了 ARL 操作步骤的各个阶段</block>
  <block id="259768fa3d43366eeb4e13b056365613" category="paragraph"><block ref="259768fa3d43366eeb4e13b056365613" category="inline-image-macro-rx" type="image"></block></block>
  <block id="7b943baeaf962c0831949aad447620ea" category="paragraph">下表介绍了您在每个阶段执行的高级任务以及此阶段结束时的聚合所有权状态。操作步骤稍后将提供详细步骤：</block>
  <block id="b72f5020c23dbd9ffc6d4450f84ec5f3" category="cell">第 1 阶段：准备升级</block>
  <block id="7b1dd5a3f8b0bae20a552b311225dba7" category="list-text">确定控制器是否在内部磁盘驱动器上具有聚合。</block>
  <block id="7900c602172467ea3a308b146a26fd96" category="paragraph">只有在从具有内部磁盘驱动器的控制器升级时，才需要执行此步骤。</block>
  <block id="cb803e52742ed5e4978708eccc6cb93b" category="list-text">准备要升级的节点</block>
  <block id="4332ef4b7343cbc2aa782fcc72f7400b" category="list-text">为磁盘重新设置密钥以进行存储加密。</block>
  <block id="fe99905f8dac011506ff45806fa2b7f6" category="paragraph">只有在从具有自加密驱动器的系统升级时，才需要执行此任务。</block>
  <block id="9b89f1152071bd0dce572ec16a5f194a" category="list-text">验证集群上的 SnapMirror 关系状态，并暂停集群之间的所有关系。</block>
  <block id="83195eca433f1852d7fdec8d69917eef" category="list-text">准备网络启动</block>
  <block id="c315bb47606529cfc4eee6fee9473961" category="cell">第 2 阶段：停用 node1</block>
  <block id="f1e761bb0f9664397f31df3ed161b2f4" category="list-text">将节点 1 拥有的非 SAN 数据 LIF 移动到节点 2 。</block>
  <block id="b40e8e8044c2bbad167e86406f314b1f" category="list-text">记录 node1 信息</block>
  <block id="131c1215f55f2db7a9cee6671cd5a15c" category="list-text">node1 是 node1 聚合的主所有者。</block>
  <block id="34c13ce480fd28c643a03477e436ea69" category="cell">第 3 阶段：安装并启动节点 3.</block>
  <block id="9831ac08d1511b2493ac2b60bb2c8719" category="list-text">在 node3 上设置 UTA/UTA2 配置。</block>
  <block id="0ecfaa523b3b44d06f14bc6b97a490f1" category="list-text">验证 node3 安装</block>
  <block id="d6836a12958b1cab97098bd6a3acd9e1" category="list-text">将节点 1 所拥有的非 SAN 数据 LIF 从 node2 移动到 node3 ，并验证 node3 上的 SNA LIF 。</block>
  <block id="eb20f04ed8fd91952c34e1e4620e246e" category="list-text">将节点 2 拥有的非 SAN 数据 LIF 移动到节点 3 。</block>
  <block id="6bcc99fe1628db9ec14216040c21696b" category="list-text">node2 是 node2 聚合的主所有者，但不是当前所有者。</block>
  <block id="96823812e251fed8294451535c6f95b0" category="list-text">node3 是最初属于 node1 的聚合的主所有者和当前所有者。</block>
  <block id="118095c680df28bffff023170d56342d" category="list-text">node2 是属于 node2 的聚合的主所有者和当前所有者，但不是主所有者。</block>
  <block id="b38e1811a17ec144866f464ed239210b" category="cell">第 4 阶段：停用 node2</block>
  <block id="0c678e7eb165a44e0fa670534f43a3ba" category="list-text">记录 node2 信息。</block>
  <block id="fade32ca4e9efe2a0861758d027705e9" category="paragraph">聚合所有权不会发生任何更改。</block>
  <block id="6c02f76a0894d55a982cb5450ab57f22" category="cell">第 5 阶段：安装并启动节点 4</block>
  <block id="f1319a732e9819f3889538b72ca2ff56" category="list-text">在 node4 上设置 UTA/UTA2 配置。</block>
  <block id="449b1acde3df0e5a046e1afce6b44aae" category="list-text">将 node2 拥有的非 SAN 数据 LIF 从 node3 移动到 node4 ，并验证 node4 上的 SNA-LIF 。</block>
  <block id="0a4083f32412bbedecaf3bd562092328" category="list-text">将 node2 的非根聚合从 node3 重新定位到 node4 。</block>
  <block id="f76e06dd184bc4ee38bfcca355bec6fd" category="cell">第 6 阶段：完成升级</block>
  <block id="02b8f1a43f7d2b0d1db8d82eef35a726" category="list-text">确保新控制器设置正确。</block>
  <block id="1f217a2fe2189d3272829abcb2364054" category="list-text">在新节点上设置存储加密。</block>
  <block id="c255a487d24bfde2537fdfb9e8b930d9" category="paragraph">只有在升级到具有自加密驱动器的系统时，才需要执行此任务。</block>
  <block id="f43f15dbbdb3cd5d6676ac4622a50449" category="list-text">恢复 NetApp SnapMirror 关系。</block>
  <block id="b0cf9590917d959debfd8231d8efa2c7" category="paragraph">* 注意： * Storage Virtual Machine （ SVM ）灾难恢复更新不会按照分配的计划中断。</block>
  <block id="22cbc441beb824687fff4489b675b3e7" category="paragraph">要停用 node2 ，您需要正确关闭 node2 并将其从机架或机箱中卸下。如果集群位于 SAN 环境中，则还需要删除 SAN LIF 。</block>
  <block id="ac9d5901ac51a7a9e98d7f8c6c0740f1" category="cell">如果集群 ...</block>
  <block id="318bbb9db21483c1e16d2e2dbe7f1651" category="cell">双节点集群</block>
  <block id="34d4031d3d37d8d9b80a5f9b450de553" category="cell">转至 <block ref="1cb6f5a9f7eef3599c4443318664abfe" category="inline-xref-macro-rx"></block>。</block>
  <block id="5e674106f615dae34230d16b22371cb8" category="cell">转至 <block ref="0bbd9dc76625f42ec6de8739e60cb44f" category="inline-xref-macro-rx"></block>。</block>
  <block id="b2af6e76142ed067163cd5edf51978b0" category="list-text">【 man_REALET_2_Step2]] 在任一节点上输入以下命令，以访问高级权限级别：</block>
  <block id="1626aa8f9ba900c076affceeaaad8930" category="list-text">输入以下命令并检查其输出，以验证是否已禁用集群 HA ：</block>
  <block id="485e8bd9380904feaa09d87fa46616ff" category="paragraph">`cluster ha show`</block>
  <block id="35df860936da8d9b2d5477ee7413fdee" category="list-text">输入以下命令并检查其输出，以检查 node2 当前是否持有 epsilon ：</block>
  <block id="7d25068d39532ede875f6fae939c62aa" category="paragraph">以下示例显示 node2 持有 epsilon ：</block>
  <block id="7b8424ae8ebc04e308b8d348d8d07edf" category="list-text">如果 node2 持有 epsilon ，请在节点上将 epsilon 标记为 `false` ，以便可以将其传输到 node3 ：</block>
  <block id="932227bf3dc2956702a635e8f4cd18a1" category="paragraph">`cluster modify -node &lt;node2&gt; -epsilon false`</block>
  <block id="9b3ca02a7473e1db3c0c57693a01aabe" category="list-text">将 epsilon `true` 标记为 node3 ，将 epsilon 传输到 node3 ：</block>
  <block id="4c3c404ced021bba5536c6b573cad272" category="paragraph">`cluster modify -node &lt;node3&gt; -epsilon true`</block>
  <block id="0bd1c8991d4969dac07a0c2f2dde50b5" category="paragraph">`network options switchless-cluster show`</block>
  <block id="b7a9c811aab8e6da8894f06c47eec709" category="list-text">[[man_REALET_2_Step9]] 返回到管理员级别：</block>
  <block id="bac8149e88ecf5bf2c4de5cf6b1ac1b2" category="list-text">在任一控制器上输入以下命令以暂停 node2 ： `ssystem node halt -node node2`</block>
  <block id="befba560e8eaef2f66cac914b95edc61" category="list-text">node2 完全关闭后，将其从机箱或机架中卸下。升级完成后，您可以停用 node2 。请参见 <block ref="6e48b929ca0767f00c15eeb6d7e78755" category="inline-link-macro-rx"></block>。</block>
  <block id="604a0586a0e63a1c0e20f96866cde2d7" category="summary">第 1 阶段，准备升级。</block>
  <block id="1a378d96df8037e2d0440e83a971d50b" category="inline-link-macro">确定控制器是否在内部磁盘驱动器上具有聚合</block>
  <block id="cfcebfe478d3e9036c8e1fcabaf35bc2" category="list-text"><block ref="cfcebfe478d3e9036c8e1fcabaf35bc2" category="inline-link-macro-rx"></block></block>
  <block id="49eb2b56a9faaf3a2fdf34442f534221" category="list-text"><block ref="49eb2b56a9faaf3a2fdf34442f534221" category="inline-link-macro-rx"></block></block>
  <block id="6c578312e5e7bc9eb1a3d443b1c52f2a" category="list-text"><block ref="6c578312e5e7bc9eb1a3d443b1c52f2a" category="inline-link-macro-rx"></block></block>
  <block id="b907c9020348bd4847d9c48ddd2d737f" category="inline-link-macro">使用板载密钥管理器管理身份验证</block>
  <block id="c950fa333894cbc66c157fc73dec920c" category="list-text"><block ref="c950fa333894cbc66c157fc73dec920c" category="inline-link-macro-rx"></block></block>
  <block id="5bfe738b0f48a11f74df0b195987ecb0" category="inline-link-macro">暂停 SnapMirror 关系</block>
  <block id="511de0365473e7cc1fc52adf09368d53" category="list-text"><block ref="511de0365473e7cc1fc52adf09368d53" category="inline-link-macro-rx"></block></block>
  <block id="c25935ce11d9d76fca75e6795d090984" category="list-text">您的系统使用运行 ONTAP 9.5 或更早版本的 Fabric MetroCluster 4 节点和 8 节点配置。</block>
  <block id="d3706af871b05283f2f32296d2d599f7" category="summary">要成功升级原始节点，您必须收集某些信息。</block>
  <block id="0b3c02891d31cade1d32eec570356892" category="doc">工作表：在控制器升级之前和期间收集的信息</block>
  <block id="c71d4a6ce9505934716badc679c9844b" category="paragraph">要成功升级原始节点，您必须收集某些信息。此信息包括节点 ID ，端口和 LIF 详细信息，许可密钥和 IP 地址。</block>
  <block id="af9089739f1912cd99f3158a51191bfa" category="paragraph">您可以使用以下工作表记录信息，以供日后在操作步骤中使用：</block>
  <block id="9d5a474aaa552210ff0298949aeb6c0a" category="cell">所需信息</block>
  <block id="7fe24adf461d2bb8561714f2d23dc1a8" category="cell">收集时</block>
  <block id="6eb41a5158360001c1c3220e5b835719" category="cell">使用时</block>
  <block id="46f0a08ed8c916f4c012866457f2c3c5" category="cell">收集的信息</block>
  <block id="58e005b13052724c67a7a029375b81e6" category="cell">原始节点的型号，系统 ID 和序列号</block>
  <block id="98de75a555a47984f815060d1cb202f6" category="cell">第 1 阶段： _Prepare the nodes for the upgrad_</block>
  <block id="96a7b0dc109f4a220518540bd844100f" category="cell">第 3 阶段： _Install and boot node3_ Stage 5 ： _Install and boot node4_ Stage 6 ： _Decommission the old system_</block>
  <block id="53e14d7212592e557eb0045b4f222c00" category="cell">原始节点上的磁盘架和磁盘信息，闪存存储详细信息，内存， NVRAM 和适配器卡</block>
  <block id="6b13a963976d4b8d2fbc2b61b03cb419" category="cell">第 1 阶段： _Preparing the nodes for the upgrad_</block>
  <block id="9c17c7bcbc4a33e8adf5afdd66b5ddfc" category="cell">在整个操作步骤中</block>
  <block id="81c61f27d311b6c30ec668cf353ea1de" category="cell">使原始节点上的聚合和卷联机</block>
  <block id="94359ed6e12b4ed191d93ab756e3edc7" category="cell">在整个操作步骤中验证聚合和卷是否保持联机，但在短暂重新定位期间除外</block>
  <block id="7fe437ad7bf96c159fda41c06deb8257" category="cell">命令输出 `network port vlan show` 和 `network port ifgrp show`</block>
  <block id="6df8f51a4f207a8aec19520cbafdafd9" category="cell">第 3 阶段： _Map ports from node1 to node3_ 第 5 阶段： _Map ports from node2 to node4_</block>
  <block id="0cefe51dc41d2718e2eb5823909bbc12" category="cell">（仅限 SAN 环境） FC 端口的默认配置</block>
  <block id="f7a78d2e3df99d48acd611b5ebd92bff" category="cell">在新节点上配置 FC 端口时</block>
  <block id="98577d60c614df3fef5fca33b637ac23" category="cell">（仅限使用 FlexArray 虚拟化软件的 V 系列系统或系统）适用于使用 FlexArray 虚拟化软件的 V 系列系统或系统的拓扑</block>
  <block id="7cfd4d042bb6ab02bc385b9c06501763" category="cell">第 3 阶段： _Install and boot node3_ 第 5 阶段： _Install and boot node4_</block>
  <block id="72a91a015e8c747a5a63794308310840" category="cell">SP 的 IP 地址</block>
  <block id="f16cc8c7d7c195a507efbfa7ccc55727" category="cell">第 6 阶段： _ensure that the new controllers are set up correctly _</block>
  <block id="e3d8433cfe5569460492707086339074" category="cell">许可证密钥</block>
  <block id="bb2a59fbd20fec79ac114c7a9f22ead2" category="cell">外部密钥管理服务器的 IP 地址</block>
  <block id="234cfc2e3636ba2a3e5d47da84d5bd32" category="cell">第 1 阶段： _Rekey disks for Storage Encryption"</block>
  <block id="a6bab46fa807f06174c4873c5331a9b2" category="cell">第 6 阶段： _set up Storage Encryption on the new nodes_</block>
  <block id="09c90f884edd2efc00874f9fc863daeb" category="cell">可通过 Web 访问的目录的名称和路径，您可以在此目录中下载文件以通过网络启动节点</block>
  <block id="8d880de8591f29262b623575d315d6f9" category="cell">第 1 阶段： _prepare to netboot_</block>
  <block id="8308cf8c26a7dcc26ef279edbb2465b2" category="cell">第 3 阶段： _Install and boot node3_ 第 5 阶段： _Install and boot node4_</block>
  <block id="55b2136ebb20d11fca61578e034c0825" category="cell">节点 1 拥有的非 SAN 数据 LIF</block>
  <block id="36f18a42c47c1ba2b97c49f28fb8814c" category="cell">第 2 阶段： _move node1 拥有的 nonsan 数据 LIF 到 node2_</block>
  <block id="ffab931268e5c5e23eb65969fdc5d778" category="cell">将在本节后面介绍</block>
  <block id="baac9a78080d05f11c33a3240628d4f8" category="cell">集群，集群间，节点管理，集群管理和物理端口</block>
  <block id="bd1e8b7ddd738e8d113d4887d3f4bba6" category="cell">第 2 阶段： _Record node1 information_</block>
  <block id="5f7558f445c484b7024a112b18c200a6" category="cell">第 3 阶段： _Install and boot node3_ 第 3 阶段： _Map ports from node1 to node3_</block>
  <block id="7712e1e9d181323ad2123bf3c1218513" category="cell">新节点上的端口</block>
  <block id="dcfac71d6abccba3c94c782790822f55" category="cell">第 3 阶段： _Map 端口从 node1 映射到 node3_</block>
  <block id="1f2d038d966e575c88681d78a0b7e550" category="cell">后面的部分和 _Map ports from node2 to node4_ 一节</block>
  <block id="968d71039e6cb3f4f7f4aa7223382c8f" category="cell">node3 上的可用端口和广播域</block>
  <block id="621f6a9e04692c2889f288c336e29c97" category="cell">非 SAN 数据 LIF 不属于 node2</block>
  <block id="8600c3328f8a228f306c6d5830a2576c" category="cell">将属于 node1 的非 SAN 数据 LIF 从 node2 移动到 node3 并验证 node3_ 上的 SAN LIF</block>
  <block id="5da569cf0c9cfab6143aa1456b0d2b27" category="cell">节点 2 拥有的非 SAN 数据 LIF</block>
  <block id="792578ec3edacbf85c56d7d346753a2f" category="cell">第 3 阶段： _move node2 拥有的 nonsan 数据 LIF 到 node3_</block>
  <block id="53c29bbede61f5ab1245941503af76c4" category="cell">第 4 阶段： _Record node2 information_</block>
  <block id="979b8628aef26052c5b8843be52e1fa9" category="cell">第 5 阶段： _Install and booting node4_ Stage 5 ： _ 将端口从 node2 映射到 node4_</block>
  <block id="a992103a413243514b1fe86c6db582f6" category="cell">节点上的集群网络端口 4.</block>
  <block id="f2805ed5889ac7ba2f7220a38fc00350" category="cell">第 5 阶段： _Map 端口从 node2 映射到 node4_</block>
  <block id="ba9d984599b9d029b2fc827939de2324" category="cell">节点上的可用端口和广播域 4.</block>
  <block id="9b978a712974278ab5f3f7e894871a48" category="cell">存储系统的私有和公有 SSL 证书以及每个密钥管理服务器的私有 SSL 证书</block>
  <block id="a2be0d0cd45844d2f39d08838f9c179b" category="paragraph">您需要确保 node1 上的物理端口正确映射到 node3 上的物理端口，从而使 node3 能够在升级后与集群中的其他节点以及网络进行通信。</block>
  <block id="d22f146c49d95d305653bf62234fdbc9" category="paragraph">您必须已从 _Node_ 获得有关新节点上端口的信息 Hardware Universe 。转至 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _SIL_ Hardware Universe ）。您可以使用本节后面和中的信息 <block ref="fface1ac702bde6d72ceb6e55eb8b2b6" category="inline-link-macro-rx"></block>。</block>
  <block id="770687a6c0857c42712724895dde4f94" category="paragraph">node3 的软件配置必须与 node3 的物理连接匹配，并且必须先还原 IP 连接，然后才能继续升级。</block>
  <block id="342fe6b9a6a951b4d371cda9aec84c5f" category="paragraph">端口设置可能因节点型号而异。您必须使原始节点的端口和 LIF 配置与新节点的配置计划兼容。这是因为新节点在启动时会重放相同的配置，这意味着在启动 node3 时， ONTAP 将尝试在 node1 上使用的相同端口上托管 LIF 。</block>
  <block id="a7e55a2eda4d6d9856ad9438d37fbed0" category="paragraph">因此，如果 node1 上的物理端口不直接映射到 node3 上的物理端口，则需要更改软件配置，才能在启动后还原集群，管理和网络连接。此外，如果 node1 上的集群端口未直接映射到 node3 上的集群端口，则在重新启动时， node3 可能无法自动重新加入仲裁，直到对软件配置进行更改，以便将集群 LIF 托管在正确的物理端口上为止。</block>
  <block id="cbf79efe25579eb8669620f8a705d90c" category="list-text">【第 1 步】将 node1 ，端口，广播域和 IP 空间的所有 node1 布线信息记录在下表中：</block>
  <block id="2a04e456c6cc4811fe58e125c72d102f" category="cell">Node1 广播域</block>
  <block id="a73f157295775ec357e4cbb83394837d" category="cell">集群 5</block>
  <block id="f8b0e66f09382485306db5e1ba20e4fc" category="cell">集群 6</block>
  <block id="8ebc8c8801836bd409313dd264bebb92" category="inline-link-macro">记录 node1 信息</block>
  <block id="032db7a5ba2209ef2a98f177b97ef9c0" category="paragraph">请参见 <block ref="111c70a978efb37ba3bd0ea564da1d79" category="inline-link-macro-rx"></block> 获取此信息的步骤。</block>
  <block id="d6fd23476a280d6343ba76f013c499fd" category="list-text">【第 2 步】使用中的相同操作步骤在上表中记录节点 3 ，端口，广播域和 IP 空间的所有布线信息 <block ref="111c70a978efb37ba3bd0ea564da1d79" category="inline-link-macro-rx"></block>。</block>
  <block id="db8e77631790a3f2f7e9e65f99e95d55" category="list-text">【第 3 步】按照以下步骤验证设置是否为双节点无交换机集群：</block>
  <block id="64544217a0060d8a47ba296eaa9eda15" category="list-text">通过执行以下步骤，使 node3 进入仲裁状态：</block>
  <block id="915e652f4479fd46dc91c70db0e241ac" category="paragraph">`network port show -node node-name -port port-name -fields broadcast-domain`</block>
  <block id="e20f03b7201e18349c5baa3209b997a6" category="paragraph">以下示例显示端口 "e0a" 位于 node3 上的 "Cluster" 域中：</block>
  <block id="23c08f03059c2e662513cbaa4ca31c04" category="paragraph">`network port modify -node node-name -port port-name -ipspace cluster -mtu 9000`</block>
  <block id="8d39e79fe126ab08c8533329b616fed4" category="admonition">对于 MetroCluster 配置，您可能无法更改某个端口的广播域，因为该端口与托管 sync-destination SVM 的 LIF 的端口相关联，并会看到类似于但不限于以下消息的错误` ：</block>
  <block id="8b3323601551341609485df18e91de19" category="paragraph">在远程站点上对应的 sync-source SVM 中输入以下命令，将 sync-destination LIF 重新分配到相应的端口：</block>
  <block id="a7e5ede23e9abe28c2e83408db9129c7" category="paragraph">`MetroCluster SVM resync -vserver vserver-name`</block>
  <block id="cb8885c065cc8b4444ec326cbc63995a" category="paragraph">`network interface migrate -vserver cluster -lif LIF-name -source-node node3 -destination-node node3 -destination-port port-name`</block>
  <block id="a0ab65e69e2ad009bcc7428e18446ac3" category="paragraph">`network interface modify -vserver cluster -lif LIF-name – home-port port-name`</block>
  <block id="3db1cb9c339f5db3439420bdee3c086f" category="list-text">如果集群端口不在集群广播域中，请添加它们：</block>
  <block id="c78bf93e2079a992cf4c19d12618dbe8" category="paragraph">`network port broadcast-domain add-ports -ipspace cluster -broadcast-domain Cluster -ports node ： port`</block>
  <block id="7da7933fdddd6ba0e6adfac1eb9d1672" category="paragraph">以下示例将删除 node3 上的端口 "e0d" ：</block>
  <block id="faa18fff9afe976096fc81be55fab832" category="paragraph">`cluster show -node node3 -fields health`</block>
  <block id="204da7ccb61d29bd71f42848dbdfbc2a" category="list-text">[[man_map_1_step5]] 调整托管集群 LIF 以及节点管理和 / 或集群管理 LIF 的广播域。确保每个广播域包含正确的端口。如果某个端口托管 LIF 或位于 LIF 的主目录中，则无法在广播域之间移动该端口，因此您可能需要按如下所示迁移和修改 LIF ：</block>
  <block id="5dd2c837e11a289fa3af34aca2a1ab86" category="paragraph">`network interface show -fields home-node ， home-port`</block>
  <block id="a935ed36345935d035e5cbe86cb3a35d" category="paragraph">`network interface modify -vserver vserver-name -lif LIF-name – home-port port-name`</block>
  <block id="a84cdc90d98c6148502139e8da567ade" category="list-text">【 man_map_1_step6]] 调整集群间广播域，并根据需要使用中所示的相同命令迁移集群间 LIF <block ref="4c0abef6869b6cad04a71c175246f8ab" category="inline-xref-macro-rx"></block>。</block>
  <block id="15d8a3fb33ef05850a50f8685a3b3c02" category="list-text">【第 7 步】调整任何其他广播域，并在必要时使用中所示的相同命令迁移数据 LIF <block ref="4c0abef6869b6cad04a71c175246f8ab" category="inline-xref-macro-rx"></block>。</block>
  <block id="3eed5b0c094ac012f4929ba5382bf4dd" category="list-text">【第 8 步】如果 node1 上有任何端口不再位于 node3 上，请按照以下步骤将其删除：</block>
  <block id="5eb3a6c1204974756e1a1ba11f2ec598" category="list-text">删除端口：</block>
  <block id="44c3f6f89bd851c5548e7c2c13839a55" category="paragraph">`network port delete -node node-name -port port-name`</block>
  <block id="f063d629ff68f957f5da6e6d4a1024c5" category="list-text">【第 9 步】调整所有 LIF 故障转移组：</block>
  <block id="ed3037abec4b50b866ad4bfdc6817933" category="paragraph">`network interface modify -failover-group failover-group -failover-policy failover-policy`</block>
  <block id="b9ce0c55aad8eead03f3c1634c34732f" category="paragraph">以下示例将故障转移策略设置为 " 广播域范围 " ，并使用故障转移组 "fg1" 中的端口作为 "node3" 上 LIF"data1" 的故障转移目标：</block>
  <block id="a0d0e1bbddc9c85ea92c47a58b414ea1" category="summary">在关闭并停用 node2 之前，您需要记录有关 node2 的信息。</block>
  <block id="cb01034aedc70b6d88070cceb3ec5fd6" category="doc">记录 node2 信息</block>
  <block id="4de30509db28d6f26dbb6eb1fa0448e9" category="paragraph">在关闭并停用 node2 之前，您需要记录有关其集群网络，管理和 FC 端口以及 NVRAM 系统 ID 的信息。稍后将 node2 映射到 node4 并重新分配磁盘时，您需要在操作步骤中提供此信息。</block>
  <block id="06482362cad7119c97decfadddef47d1" category="list-text">在 node2 上查找集群网络，节点管理，集群间和集群管理端口：</block>
  <block id="1fcb48e8a1ae19116b9bf2f39685db30" category="paragraph">`network interface show -curr-node &lt;node_name&gt; -role cluster ， intercluster ， nodemgmt ， cluster-mgmt`</block>
  <block id="9581ef2fce7ca5bef124feac72dd7c62" category="paragraph">系统将显示该节点以及集群中其他节点的 LIF ，如以下示例所示：</block>
  <block id="66df24136907c6cba70f63950b15a0d8" category="admonition">您的系统可能没有集群间 LIF 。您只能在一个节点对的一个节点上使用集群管理 LIF 。的示例输出显示了集群管理 LIF <block ref="4d0816bae74d8d665981da69c5c8d7a9" category="inline-link-macro-rx"></block> 在 _Record node1 port information_.</block>
  <block id="db388cc11af248e636d23a7634f79da1" category="list-text">捕获输出中的信息以在部分中使用 <block ref="fface1ac702bde6d72ceb6e55eb8b2b6" category="inline-link-macro-rx"></block>。</block>
  <block id="d852fb2583585e10c3885982eaf29670" category="paragraph">要将新控制器端口映射到旧控制器端口，需要提供输出信息。</block>
  <block id="b226d44baee1fdcf5f175befc4240f79" category="list-text">确定节点 2 上的物理端口：</block>
  <block id="0ce26da6eb15f1794580d79135daecea" category="paragraph">`network port show -node &lt;node_name&gt; -type physical` +</block>
  <block id="3aba4579adf045f7017d47291de9ae6e" category="paragraph">`node_name` 是要迁移的节点。</block>
  <block id="a36b8ceea3403515d94e1d9ad1d33833" category="paragraph">系统将显示 node2 上的物理端口，如以下示例所示：</block>
  <block id="e39f84c1a169d8d90af9c95f44865bc0" category="list-text">记录端口及其广播域。</block>
  <block id="1a494d33f95411ce2d7f871e87234bb6" category="paragraph">稍后，需要在操作步骤中将广播域映射到新控制器上的端口。</block>
  <block id="36d2ce7941b2c78c3d67d83e5bab95ab" category="list-text">确定 node2 上的 FC 端口：</block>
  <block id="922cfc273cc764471719b8a70b2bd795" category="paragraph">`network fcp adapter show`</block>
  <block id="e2ce1c0ee0599997916e05613833e82e" category="paragraph">系统将显示 node2 上的 FC 端口，如以下示例所示：</block>
  <block id="f33b448fa0bb738f614e66795ee372d4" category="list-text">记录端口。</block>
  <block id="183e98aa2a84c4dee16223d4c260f2ce" category="paragraph">稍后在操作步骤中映射新控制器上的新 FC 端口需要输出信息。</block>
  <block id="f30296e85c9b7a573f431b89a15b6b93" category="list-text">如果您之前没有这样做，请检查 node2 上是否配置了接口组或 VLAN ：</block>
  <block id="9e650495d6414abbc47ea05fdc36dd7e" category="paragraph">`ifgrp show`</block>
  <block id="35803428da21a4a214ff09f1442e2f58" category="paragraph">`VLAN show`</block>
  <block id="15fb68f8a892a3ed6a57c8b5eca53ec5" category="paragraph">您将使用部分中的信息 <block ref="fface1ac702bde6d72ceb6e55eb8b2b6" category="inline-link-macro-rx"></block>。</block>
  <block id="61a6d655671eebbd633c1d84fae09e17" category="cell">如果您 ...</block>
  <block id="1f7052fd85a8ced9cd9c65f079fcb154" category="cell">已在中记录 NVRAM 系统 ID 编号 <block ref="cd8ad1809865824065fe011b80800cd6" category="inline-link-macro-rx"></block></block>
  <block id="65e4801fe9cb3563a071b657463a3c1c" category="cell">转至 <block ref="610cb2d6e87c5e838ceef8f48f57b082" category="inline-link-macro-rx"></block>。</block>
  <block id="30183fbd349bcd94fdabd371e0fdc8d9" category="cell">未在中记录 NVRAM 系统 ID 编号 <block ref="cd8ad1809865824065fe011b80800cd6" category="inline-link-macro-rx"></block></block>
  <block id="b31b744fd8c5cbe34c282a8e3311866b" category="cell">完成 <block ref="3ef612fafd35c4ea98dad97a133c5f3f" category="inline-xref-macro-rx"></block> 和 <block ref="a3461a8cfeac3856b6bf21e7388f2534" category="inline-xref-macro-rx"></block> 然后转到下一节， <block ref="610cb2d6e87c5e838ceef8f48f57b082" category="inline-link-macro-rx"></block>。</block>
  <block id="435d35070ba8894d910a50e35db1d4e2" category="list-text">【 man_record_2_step9]] 显示节点 2 的属性：</block>
  <block id="5d34eef64c7b53994a7dde374d44b94b" category="paragraph">`ssystem node show -instance -node node2`</block>
  <block id="bc110b3ccc057d2275d5e8ae87f525b0" category="list-text">【 man_record_2_step10]] 记录要在部分中使用的 NVRAM 系统 ID <block ref="f326c815b47f4f2909494bae5cd735d5" category="inline-link-macro-rx"></block>。</block>
  <block id="32cc04caeccfd27a6da569dca64fe8b9" category="paragraph">您应检查 MetroCluster 配置的运行状况以验证是否正常运行。</block>
  <block id="7314fe3b616597bb78463e3503d3cdea" category="paragraph">要了解是否可以使用聚合重新定位（ Aggregate Relocation ， ARL ）将一对运行 ONTAP 9.0 的控制器升级到 9.7 ，取决于原始控制器和更换控制器的平台和配置。</block>
  <block id="03a076130908bcb8ba3ef3e4a9879406" category="paragraph">在以下情况下，您可以使用 ARL 升级一对节点：</block>
  <block id="fef08cb6b104300c9963da8490224b47" category="list-text">在升级之前，原始控制器和替代控制器必须运行相同版本的 ONTAP 9.x 。</block>
  <block id="85bf786cb7564154a7193e9a32b9470f" category="list-text">替代控制器的容量必须等于或高于原始控制器。容量等于或更大是指 NVRAM 大小，卷， LUN 或聚合计数限制等属性；它也是指新节点的最大卷或聚合大小。</block>
  <block id="f8990401799da4daa91e6353e208a0ca" category="list-text">您可以升级以下类型的系统：</block>
  <block id="9fc712c36470ee134b5baf35a0628f67" category="list-text">FAS 系统到 FAS 系统。</block>
  <block id="c94314f263e01937a72e0a89c5a31d17" category="list-text">将 FAS 系统连接到 V 系列系统或使用 FlexArray 虚拟化软件的系统。</block>
  <block id="4f53eee63da949e06542638d2195a151" category="list-text">V 系列系统到 V 系列系统或使用 FlexArray 虚拟化软件的系统。</block>
  <block id="3cd85b184f5edd515a62b5c0162cca6d" category="list-text">将使用 FlexArray 虚拟化软件的 V 系列系统或系统连接到 FAS 系统，前提是使用 FlexArray 虚拟化软件的 V 系列系统或系统没有阵列 LUN 。</block>
  <block id="5759b3c09faaa5e5121a707b989bc410" category="list-text">AFF 系统到 AFF 系统。</block>
  <block id="b840d5771a2ef91436a0bedbee3a165d" category="admonition">在执行 AFF 系统升级之前，您必须将 ONTAP 升级到版本 9.3P12 ， 9.4P6 或 9.5P1 或更高版本。要成功升级，需要这些版本级别。</block>
  <block id="3900a5ea5c04533e4cf6dbe9c1b64f7e" category="list-text">对于某些 ARL 控制器升级，您可以使用替代控制器上的临时集群端口进行升级。例如，如果您从 AFF A300 升级到 AFF A400 系统，则根据 AFF A400 配置，您可以使用两个夹层端口中的任何一个，也可以添加一个四端口 10 GbE 网络接口卡来提供临时集群端口。使用临时集群端口完成控制器升级后，您可以无中断地将集群迁移到替代控制器上的 100 GbE 端口。</block>
  <block id="22b0f2676995b3d79ecefe6d9a50322a" category="paragraph">您应验证是否可以对原始控制器和更换控制器执行 ARL 。您应检查所有已定义聚合的大小以及原始系统支持的磁盘数。然后将其与新系统支持的聚合大小和磁盘数进行比较。要访问此信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _SIL_ Hardware Universe 。新系统支持的聚合大小和磁盘数必须等于或大于原始系统支持的聚合大小和磁盘数。</block>
  <block id="17d299f0ea21ebf5e64a916dc31f3150" category="admonition">这两个系统要么是高可用性（ HA ），要么是非 HA 。两个节点都必须启用或禁用此特性；您不能将启用了全闪存优化特性的节点与未在同一 HA 对中启用此特性的节点组合使用。如果个性化设置不同，请联系技术支持。</block>
  <block id="eb54474fb812ae2f0b8cbe44a679c0e9" category="admonition">如果新系统的插槽数少于原始系统，或者端口数较少或不同，则可能需要向新系统添加适配器。请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 Hardware Universe 支持站点上的 _NetApp 支持站点以了解有关特定平台的详细信息。</block>
  <block id="64958cd32ea9482fb68bd827389c4b5d" category="list-text">无法运行 ONTAP 版本的控制器从 ONTAP 9.0 到 ONTAP 9.7 。</block>
  <block id="fd753b120c7506bdd866bd69666299a0" category="paragraph">有关在 7- 模式下运行 Data ONTAP 的系统的控制器升级信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _NetApp 支持站点 _ 。</block>
  <block id="8d99b40dd6349fd6acdd377f1170526a" category="list-text">更换不支持与原始控制器相连的磁盘架的控制器</block>
  <block id="c2bba071fde6bd6aaadda02df6be1824" category="paragraph">有关磁盘支持信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _SIL_ Hardware Universe 。</block>
  <block id="0ed554de4f15b56b25624509bfd8b8e2" category="list-text">来自具有根聚合或内部驱动器上的数据聚合的控制器。</block>
  <block id="aa4444dc8b6bab3b2f6234aeca290090" category="section-title">假设和术语</block>
  <block id="c77e53bb71e6f82e9c063dc5e5174b70" category="paragraph">本文档的编写假设如下：</block>
  <block id="3eb93a8b34b97361565e1e43b5172c6c" category="list-text">替代控制器硬件是新的，尚未使用。</block>
  <block id="2c1539b425b852831dfd3949e3fa3f6e" category="admonition">* 注意 * ：由于此操作步骤假定更换用的控制器硬件是新的，尚未使用，因此使用 `wipeconfig` 命令准备已用控制器所需的步骤不会包含在此操作步骤中。如果先前使用的是替代控制器硬件，则必须联系技术支持，尤其是在控制器以 7- 模式运行 Data ONTAP 时。</block>
  <block id="813522154d0016da078c804c8b48926e" category="list-text">您已阅读并了解升级节点对的准则。</block>
  <block id="31536b7b125b53b91a4202e748df16c7" category="admonition">* 注意 * 请勿尝试清除 NVRAM 内容。如果需要清除 NVRAM 的内容，请联系 NetApp 技术支持。</block>
  <block id="4e2f57efeba52fa3484b04fa5b7501f6" category="list-text">您正在执行 `m修改` 命令前后的相应命令，并比较两个 `show` 命令的输出以验证 `m修改` 命令是否成功。</block>
  <block id="418bba28a84b33a46f081045deea4425" category="list-text">如果您具有 SAN 配置，则 HA 对上的每个 Storage Virtual Machine （ SVM ）都具有本地和配对 LIF 。如果每个 SVM 没有本地和配对 LIF ，则应在开始升级之前在该 SVM 的远程和本地节点上添加 SAN 数据 LIF 。</block>
  <block id="4deee541ccbe8bdf4518c19cd687519b" category="list-text">如果 SAN 配置中有端口集，则必须已验证每个绑定端口集是否至少包含 HA 对中每个节点的一个 LIF 。</block>
  <block id="1cb03b52ed6596c669089e6356a17e4c" category="paragraph">此操作步骤使用术语 _boot environment prompt_ 来表示节点上可从中执行某些任务的提示，例如重新启动节点以及打印或设置环境变量。此提示有时会非正式地称为 _boot loader prompts_ 。</block>
  <block id="f12c4790f612bd1e2efaede10265d567" category="paragraph">以下示例显示了启动环境提示符：</block>
  <block id="3f17352bf969c985d68f77c2833285c4" category="section-title">在 ONTAP 9.7 或更早版本中获得许可</block>
  <block id="9ee4145a4e9ccdd934db7e344edf43ab" category="paragraph">如果没有新的许可证密钥，则新控制器可以使用集群中当前已获得许可的功能，这些功能将继续正常工作。但是，在控制器上使用未经许可的功能可能会使您不符合您的许可协议，因此，您应在升级完成后为新控制器安装新的许可证密钥。</block>
  <block id="fa6e3787c7c887f4c69ddbc0dec0424e" category="paragraph">所有许可证密钥的长度均为 28 个大写字母字符。请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _NetApp 支持站点 _ ，在此可以获取 ONTAP 9.7 的 28 个字符的新许可证密钥。或更早版本。这些密钥位于 _Software licenses_ 下的 _My Support_ 部分中。如果此站点没有所需的许可证密钥，请联系您的 NetApp 销售代表。</block>
  <block id="4d832de97d9ead053e5d9f0ec85efced" category="paragraph">有关许可的详细信息，请访问 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到系统管理参考。</block>
  <block id="444b1cfaed2cd1215abe5706af9673cd" category="section-title">存储加密</block>
  <block id="9437e45ea84f2356122cf953a0645e49" category="paragraph">原始节点或新节点可能已启用存储加密。在这种情况下，您需要在此操作步骤中执行其他步骤，以验证是否已正确设置存储加密。</block>
  <block id="9519937cbd956cff6c45361bbdf5972a" category="paragraph">如果要使用存储加密，与节点关联的所有磁盘驱动器都必须具有自加密磁盘驱动器。</block>
  <block id="197b89f0e243e9def8dc0d01e39c6fe0" category="paragraph">此操作步骤包含故障排除建议。</block>
  <block id="91d88902ba3b6c6fcce59073d39627b4" category="summary">必须先准备好节点，然后才能进行升级。</block>
  <block id="826be71263f21097957d09d3f8ed668e" category="paragraph">在更换原始节点之前，您必须确保它们位于 HA 对中，没有缺失或故障磁盘，可以访问彼此的存储，并且不拥有分配给集群中其他节点的数据 LIF 。您还需要收集有关原始节点的信息，如果集群位于 SAN 环境中，请确保集群中的所有节点都处于仲裁状态。</block>
  <block id="e537424f11b8c436c4623dda13ea1af3" category="list-text">确保每个原始节点都有足够的资源，以便在接管模式期间为这两个节点的工作负载提供充分的支持。</block>
  <block id="f57ddae179006dfe93c570a9886b51b0" category="list-text">完成以下子步骤，为原始节点创建性能基线：</block>
  <block id="e2ce8b648cf2a8577d2ac0054c830df5" category="list-text">确保诊断用户帐户已解锁。</block>
  <block id="04b97d849898994879d3546a0da9f87a" category="paragraph">* 重要信息 * ：诊断用户帐户仅用于低级别诊断，只能在技术支持的指导下使用。</block>
  <block id="cb0649853a09056775436f53b7e99dc5" category="paragraph">* 重要信息 * ：有关解锁用户帐户的信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到系统管理参考。</block>
  <block id="8fafe7b0e88d09400ee18fcc9299185e" category="list-text">请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _NetApp 支持站点 _ 并下载性能和统计信息收集器（ Perfstat Converged ）。</block>
  <block id="061b69246434dcda481ca9452cf30635" category="paragraph">使用 perfstat Converged 工具，您可以建立性能基线，以便在升级后进行比较。</block>
  <block id="3e5ae45cd6aac12d01461471b0995845" category="list-text">按照 NetApp 支持站点上的说明创建性能基线。</block>
  <block id="7fcb92cfc1dea17cbdc84eda52cfac2b" category="list-text">请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _NetApp 支持站点 _ 并在 NetApp 支持站点上创建支持案例。</block>
  <block id="38fd59ef0181a70014c49f0cfdd6ed5d" category="paragraph">您可以使用案例报告升级期间可能出现的任何问题。</block>
  <block id="e7b328a01b5a6b8fffc172cfd9f564c0" category="list-text">验证 node3 和 node4 的 NVMEM 或 NVRAM 电池是否已充电，如果未充电，请为其充电。</block>
  <block id="2e283ebf1bea253f33a9e884fa598e1e" category="paragraph">您需要物理检查 node3 和 node4 以查看 NVMEM 或 NVRAM 电池是否已充电。有关 node3 和 node4 型号的 LED 的信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _SIL_ Hardware Universe 。</block>
  <block id="6ab3181b33a0075c13f2de4c0920deff" category="admonition">* 注意 * 请勿尝试清除 NVRAM 内容。如果需要清除 NVRAM 的内容，请联系 NetApp 技术支持。</block>
  <block id="051d9c31ffa2621a5e49ba9e6d76c916" category="list-text">检查 node3 和 node4 上的 ONTAP 版本。</block>
  <block id="53e359796554176ecef5639c8ed3ed05" category="paragraph">有关 node3 和 node4 上的 ONTAP 版本的信息应包含在装运箱中。节点启动时会显示 ONTAP 版本，您也可以将节点启动至维护模式并运行命令：</block>
  <block id="7877022c956918624cc0373ff564cad4" category="paragraph">`ve版本`</block>
  <block id="232ac82576b399b9dcdc3a264bb0c6ec" category="list-text">检查 node1 和节点 2 上是否有两个或四个集群 LIF ：</block>
  <block id="a2d27af8ce0592e36b8a208c0cb93d3e" category="paragraph">`network interface show -role cluster`</block>
  <block id="97946b80ce2a390dfbe694abb89b8da6" category="paragraph">系统将显示任何集群 LIF ，如以下示例所示：</block>
  <block id="b6f048f47d754b1245e072cf13364151" category="list-text">如果 node1 或 node2 上有两个或四个集群 LIF ，请通过完成以下子步骤确保您可以在所有可用路径上对两个集群 LIF 执行 ping 操作：</block>
  <block id="4ae0280fe3dd6476913cdfef9bf98f8f" category="list-text">输入高级权限级别：</block>
  <block id="88bdbe46ad1d0b5212db8d769f0d6c7c" category="list-text">输入 `y` 。</block>
  <block id="1be278766df14cf22410e71cf6d2cf07" category="list-text">对节点执行 Ping 操作并测试连接：</block>
  <block id="30533ddc427fb292c7d2a7a069e893e2" category="paragraph">`cluster ping-cluster -node node_name`</block>
  <block id="e2ef0e388993deb8d5ac2d2c4c589106" category="paragraph">系统将显示类似于以下示例的消息：</block>
  <block id="87d93b522596e870c62c871bdbe44c11" category="paragraph">如果节点使用两个集群端口，您应看到它能够在四个路径上进行通信，如示例所示。</block>
  <block id="063014cb1baf1ab4cfba01ed9c5cdcb1" category="list-text">返回到管理级别权限：</block>
  <block id="3e6f17c57130b6f779ec8a030abc6ae0" category="list-text">确保 node1 和 node2 位于 HA 对中，并验证节点是否彼此连接，以及是否可以进行接管：</block>
  <block id="7a309bb6c6af5ef06efe5f48e0c54074" category="paragraph">以下示例显示了节点彼此连接并可进行接管时的输出：</block>
  <block id="8ad3217d99ee19b408199ad575ffe3af" category="paragraph">两个节点均不应处于部分交还状态。以下示例显示 node1 处于部分交还状态：</block>
  <block id="e1b6253c9fd3e54d029ac4ea06c7ca29" category="list-text">【 man_prepare_nodes_step9]] 确保 node1 和 node2 均不拥有其当前所有者（而不是主所有者）的聚合：</block>
  <block id="af83575c95d637895459a44e86fa9e26" category="paragraph">`storage aggregate show -node &lt;node_name&gt; -is-home false -fields owner-name ， homename ， state`</block>
  <block id="e86a1d7ab77ef690a506c50aeb0e4407" category="paragraph">如果 node1 和 node2 都不拥有当前所有者（而不是主所有者）的聚合，则系统将返回类似于以下示例的消息：</block>
  <block id="b985e562bbb6750dd51f653600fe0a16" category="paragraph">以下示例显示了一个名为 node2 的节点的命令输出，该节点是四个聚合的主所有者，但不是当前所有者：</block>
  <block id="d2d09b67c3b189d4996ce96fdb6e7f46" category="cell">如果命令位于中 <block ref="f234334393599d38df4eb27863e3dcfa" category="inline-xref-macro-rx"></block>...</block>
  <block id="187bf5770ab4eb046ac279545d76a28d" category="cell">输出为空</block>
  <block id="618ca5b25d5cf4c26b7057f25a52023b" category="inline-xref">第 12 步</block>
  <block id="6cf9162d078961b85385ab5ffe206def" category="cell">跳过步骤 11 ，然后转到 <block ref="9e04aeb1482ff26e4ec2b4e66367360a" category="inline-xref-macro-rx"></block>。</block>
  <block id="4862cab8c196cf3e955c3421a6f0ab8b" category="cell">具有输出</block>
  <block id="5f97f3ee15cc9d2abee53d7af46e1799" category="inline-xref">第 11 步</block>
  <block id="009df4941179f7e77d7594ecfc0c10f7" category="cell">转至 <block ref="1fe89f878ebb086a789e2e41fed56343" category="inline-xref-macro-rx"></block>。</block>
  <block id="edc71aed1f3d88be9cfa9b3b3f030a94" category="list-text">[[man_prepare_nodes_step11]] 如果 node1 或 node2 拥有其当前所有者而非主所有者的聚合，请完成以下子步骤：</block>
  <block id="93b9f692990cbe40ba44ff8b66800ba1" category="paragraph">`storage failover giveback -ofnode home_node_name`</block>
  <block id="239ac3b08eb08347dc0ce94de0522c08" category="paragraph">`storage aggregate show -nodes &lt;node_name&gt; -is-home false -fields owner-name ， home-name ， state`</block>
  <block id="cdb18b743b776d3188bce1696bcee067" category="list-text">[[man_prepare_nodes_step12]] 确保 node1 和 node2 可以访问彼此的存储，并验证是否没有缺少磁盘：</block>
  <block id="d4a6afd0a40d578ef1c16c580930990a" category="paragraph">`storage failover show -fields local-missing-disks ， partner-missing-disks`</block>
  <block id="9351d7b864e0fec6d8e9ce484c7e1792" category="paragraph">以下示例显示了未缺少磁盘时的输出：</block>
  <block id="89b6ed3de0a424283818fdf7fccd43c6" category="list-text">确保 node1 和 node2 运行状况良好且有资格加入集群：</block>
  <block id="f1178fa107fef2eea6cd954e57dbda27" category="paragraph">以下示例显示了两个节点均符合条件且运行状况良好时的输出：</block>
  <block id="a28608e752cbbce9cbd1454dfca4e122" category="list-text">[[man_prepare_nodes_step15]] 确保 node1 和 node2 运行相同的 ONTAP 版本：</block>
  <block id="e5efd9c28238577691b2e984771aea4a" category="paragraph">`ssystem node image show -node &lt;node1 ， node2 &gt; -iscurrent true`</block>
  <block id="ee93f64f74bbb51a61f0871bf27e8d58" category="paragraph">以下示例显示了命令的输出：</block>
  <block id="39011a93d54cda514415ade9083fc4bd" category="list-text">验证 node1 和 node2 均不拥有属于集群中其他节点的任何数据 LIF ，并检查输出中的 `Current Node` 和 `is Home` 列：</block>
  <block id="7bba44cc0aa97ec42a95cacd643fa5f4" category="paragraph">`network interface show -role data -is-home false -curr-node node_name`</block>
  <block id="5ac0c9fe3d719e05a93a39b429e96f47" category="paragraph">以下示例显示了 node1 中没有归集群中其他节点所有的 LIF 时的输出：</block>
  <block id="c94a099e774b563198a3d0a4747eeeb1" category="paragraph">以下示例显示了 node1 拥有另一节点主拥有的数据 LIF 时的输出：</block>
  <block id="624ebabf7bed06677af18b73e9b75ed4" category="list-text">如果中的输出 <block ref="f85aebae90992a111c19def12492ab18" category="inline-xref-macro-rx"></block> 显示 node1 或 node2 拥有集群中其他节点拥有的任何数据 LIF ，请将这些数据 LIF 从 node1 或 node2 迁移出：</block>
  <block id="b4ebcf376ab05c920671af65b7daaf8c" category="paragraph">`network interface revert -vserver * -lif *`</block>
  <block id="90cb08ba1d76f3a3dfeee17c19be4d3e" category="paragraph">有关 `network interface revert` 命令的详细信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _Microsoft ONTAP 9 命令：手册页参考 _ 。</block>
  <block id="9aad19d5c9012d934daf081b9a8a5f8d" category="list-text">检查 node1 或 node2 是否拥有任何故障磁盘：</block>
  <block id="befc7c82e5a0017b377265524e554a72" category="paragraph">`storage disk show -nodelist &lt;node1 ， node2 &gt; -broken`</block>
  <block id="897a592bf71f640f9c341f736bc9ee4e" category="list-text">通过完成以下子步骤并记录每个命令的输出，收集有关 node1 和 node2 的信息：</block>
  <block id="76a16743e07ac3cea2f75990f2aad527" category="admonition">您稍后将在操作步骤中使用此信息。</block>
  <block id="86bd7b7efad49e1892e19e0073d55fb5" category="list-text">记录两个节点的型号，系统 ID 和序列号：</block>
  <block id="6954b4a189214669ac4df406940dd33e" category="paragraph">`ssystem node show -node &lt;node1 ， node2 &gt; -instance`</block>
  <block id="dfb5c700fcc3e30efac3db32160fbcf2" category="admonition">您将使用此信息重新分配磁盘并停用原始节点。</block>
  <block id="e09e773592434045763d0f91877696a1" category="list-text">在 node1 和 node2 上输入以下命令，并记录输出中有关磁盘架，每个磁盘架中的磁盘数，闪存存储详细信息，内存， NVRAM 和网卡的信息：</block>
  <block id="15b1cd8e0a84466d3709aaf6e05cddf0" category="paragraph">`运行 -node &lt;node_name&gt; sysconfig`</block>
  <block id="4f52adca7234907fc88d3196c013afca" category="admonition">您可以使用此信息确定可能要传输到 node3 或 node4 的部件或配件。如果您不知道节点是 V 系列系统还是具有 FlexArray 虚拟化软件，也可以从输出中了解到这一点。</block>
  <block id="183d8f9cbafac0e6a6d6ea1ecdc927af" category="list-text">在 node1 和 node2 上输入以下命令，并记录两个节点上处于联机状态的聚合：</block>
  <block id="c6cb2ac6573aa936dedbb241c7666136" category="paragraph">`storage aggregate show -node &lt;node_name&gt; -state online`</block>
  <block id="8e812627c78a44fd6a82255d855942ae" category="admonition">您可以使用此信息以及以下子步骤中的信息来验证聚合和卷在整个操作步骤中是否保持联机，但在重新定位期间处于脱机状态的短暂时间除外。</block>
  <block id="75cf5ffcfa777a87d0faf388944df0a1" category="list-text">【 man_prepare_nodes_step19]] 在 node1 和 node2 上输入以下命令，并记录两个节点上脱机的卷：</block>
  <block id="9725ef50c82a6779c393b0d1203f8040" category="paragraph">`volume show -node &lt;node_name&gt; -state offline`</block>
  <block id="649d1a5dd8b62184f1d84c77b9e0782d" category="admonition">升级后，您将再次运行命令并将此输出与此步骤中的输出进行比较，以查看是否有任何其他卷脱机。</block>
  <block id="f1914c021e0eba7910a7110848bb7b02" category="list-text">输入以下命令，查看 node1 或 node2 上是否配置了任何接口组或 VLAN ：</block>
  <block id="668c0014fabb7b9c53aeeddba81cd3f5" category="paragraph">`network port ifgrp show`</block>
  <block id="793d1d4f275c1119fa9ef4c6bdeb245e" category="paragraph">`network port vlan show`</block>
  <block id="f44fab1c935aab23f65aad42a018c6c3" category="paragraph">请注意接口组或 VLAN 是在 node1 还是 node2 上配置的；您需要在下一步以及后续步骤的操作步骤中提供这些信息。</block>
  <block id="6b6d8dc68906d8c318a7c2d09898cb94" category="list-text">在 node1 和 node2 上完成以下子步骤，以确保稍后可以在操作步骤中正确映射物理端口：</block>
  <block id="b84ea1287ec7320899965ee9778b33f8" category="list-text">输入以下命令以查看除 `clusterwide` 以外的节点上是否存在故障转移组：</block>
  <block id="b60d742c0bb409f0ebcb8588e87621e0" category="paragraph">`network interface failover-groups show`</block>
  <block id="091f947ae047399826a034c153b6f964" category="paragraph">故障转移组是系统上存在的一组网络端口。由于升级控制器硬件可能会更改物理端口的位置，因此在升级期间可能会无意中更改故障转移组。</block>
  <block id="8d9c45aa37c89a2c1648b1756ab487ea" category="paragraph">系统将在节点上显示故障转移组，如以下示例所示：</block>
  <block id="da98a346ceebae46d5f809b0a76fa466" category="list-text">如果存在非 `clusterwide` 的故障转移组，请记录故障转移组名称以及属于故障转移组的端口。</block>
  <block id="4284018d8ed5fd4750bbe54e42d5131e" category="list-text">输入以下命令以查看节点上是否配置了任何 VLAN ：</block>
  <block id="c4bc09685f2b51c989913c717d719690" category="paragraph">VLAN 通过物理端口进行配置。如果物理端口发生更改，则稍后需要在操作步骤中重新创建 VLAN 。</block>
  <block id="d12a9049e51fd6e424aa4359a72b4295" category="paragraph">系统将显示节点上配置的 VLAN ，如以下示例所示：</block>
  <block id="c14e11ebbdc4deecee898760f94845d8" category="list-text">如果节点上配置了 VLAN ，请记下每个网络端口和 VLAN ID 配对。</block>
  <block id="52be7caa23f8083514a04ae35866982c" category="cell">接口组或 VLAN</block>
  <block id="298af6f79d48efea731daf2a5fb8b16a" category="cell">在 node1 或 node2 上</block>
  <block id="4d65d20e483d642b29f52e830db50552" category="inline-xref">第 24 步</block>
  <block id="aa969b6a363de5881c89bb2473ec8437" category="cell">完成 <block ref="9b49efbf480dedd669e8261bbf55488f" category="inline-xref-macro-rx"></block> 和 <block ref="75c40b124b57824cd48270709549c07b" category="inline-xref-macro-rx"></block>。</block>
  <block id="6c2e7ce55ecae714a2208a38f28950b9" category="cell">不在 node1 或 node2 上</block>
  <block id="68eb39c6bade33093ea7116e69724b9d" category="cell">转至 <block ref="75c40b124b57824cd48270709549c07b" category="inline-xref-macro-rx"></block>。</block>
  <block id="371f291ab5b98703097ed6da7c8ed52f" category="list-text">[[man_prepare_nodes_step23]] 如果您不知道 node1 和 node2 是在 SAN 环境还是非 SAN 环境中，请输入以下命令并检查其输出：</block>
  <block id="088bfd1403b81327173d6033bdca4fa2" category="paragraph">`network interface show -vserver &lt;vserver_name&gt; -data-protocol iscsi_FCP`</block>
  <block id="acbfcb7305e244387e0051fa5f508401" category="paragraph">如果没有为 SVM 配置 iSCSI 或 FC ，则此命令将显示类似于以下示例的消息：</block>
  <block id="f5ec26fd612e05501dc188ab23c1e529" category="paragraph">您可以使用 `network interface show` 命令和 ` -data-protocol nfs|cifs` 参数确认节点位于 NAS 环境中。</block>
  <block id="94b030f9c4d0cf01d4214519980e06e7" category="paragraph">如果为 SVM 配置了 iSCSI 或 FC ，则该命令将显示类似于以下示例的消息：</block>
  <block id="6d0f0ab3ba176428ba45b4d0b08cb29a" category="list-text">[[man_prepare_nodes_step24]] 通过完成以下子步骤验证集群中的所有节点是否都处于仲裁状态：</block>
  <block id="41755192777732f571a4c320827bfc6d" category="list-text">验证内核中每个节点的集群服务状态一次：</block>
  <block id="998af7db71400f287ae13a492f9d193a" category="paragraph">`cluster kernel-service show`</block>
  <block id="a911ca42751cdd210f50c82f44049c10" category="paragraph">如果大多数节点运行状况良好，并且可以彼此通信，则集群中的节点将处于仲裁状态。有关详细信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到系统管理参考。</block>
  <block id="6c4e983088f8ed9f67246e1b17b638ca" category="list-text">返回到管理权限级别：</block>
  <block id="bd63b39861eaf09922b2f696e573be58" category="cell">如果集群 ...</block>
  <block id="cf72c95a9046542261893f709403a8d2" category="cell">已配置 SAN</block>
  <block id="a2ca851f93b3aab00f2a1a9d215797c0" category="cell">转至 <block ref="25d05608683c9030994c9dfb7a4f0a9b" category="inline-xref-macro-rx"></block>。</block>
  <block id="6f3802a8c39ecd17753209796818c9f5" category="cell">未配置 SAN</block>
  <block id="bb321334fcb278e04a88480d13054b7e" category="inline-xref">第 29 步</block>
  <block id="4bf8f638d47f6a7f9ed2b167e6c58b28" category="cell">转至 <block ref="423690fd8b3d3c5955a0b43d62ab9b67" category="inline-xref-macro-rx"></block>。</block>
  <block id="dca3bf352f9922771b35f1e03c591788" category="list-text">【 man_prepare_nodes_step26]] 输入以下命令并检查其输出，验证 node1 和 node2 上是否存在已启用 SAN iSCSI 或 FC 服务的每个 SVM 的 SAN LIF ：</block>
  <block id="d9a90656b27774b99262e8722363244c" category="paragraph">`network interface show -data-protocol iscsi_FCP -home-node node_name`</block>
  <block id="963e82614f757a8eee0259303f34527b" category="paragraph">命令可显示 node1 和 node2 的 SAN LIF 信息。以下示例将状态 Admin/Oper 列中的状态显示为 up/up ，表示 SAN iSCSI 和 FC 服务已启用：</block>
  <block id="8a70e662724b21080c560e6be7f2c5c4" category="paragraph">或者，您也可以输入以下命令来查看更详细的 LIF 信息：</block>
  <block id="d026c064778006f9c03fdbc86d65f2bb" category="paragraph">`network interface show -instance -data-protocol iscsi_FCP`</block>
  <block id="ff03f81e3805469dd3ca43d2811a614d" category="list-text">输入以下命令并记录系统的输出，以捕获原始节点上任何 FC 端口的默认配置：</block>
  <block id="3e2b2bdb70af85f67ec523ee76a4f03b" category="paragraph">命令显示集群中所有 FC 端口的相关信息，如以下示例所示：</block>
  <block id="b0465c9d2f8edb4e2978de4f3bb93497" category="paragraph">您可以在升级后使用此信息设置新节点上的 FC 端口配置。</block>
  <block id="1c805b4cc00ee084b0e3a5a9c212e9a2" category="list-text">如果要升级 V 系列系统或安装了 FlexArray 虚拟化软件的系统，请输入以下命令并记录输出，以捕获有关原始节点拓扑的信息：</block>
  <block id="1f21d3af1ebfd92fe19ca32d07d90016" category="paragraph">`storage array config show -switch`</block>
  <block id="c83875af1cfc44dcf937e003fd6ad9bf" category="paragraph">系统将显示拓扑信息，如以下示例所示：</block>
  <block id="1bd4ed27f87546af3edbba37df0590cf" category="list-text">[man_prepare_nodes_step29]] 完成以下子步骤：</block>
  <block id="fd24198d12e02d20f511f9c35f66ebb1" category="list-text">在一个原始节点上输入以下命令并记录输出：</block>
  <block id="7321ac6691d90f67ea8ea42f26847df8" category="paragraph">`sservice-processor show -node * -instance`</block>
  <block id="72dfb8d3e52e5d9045db9ad00960535b" category="paragraph">系统会显示两个节点上的 SP 的详细信息。</block>
  <block id="f1d0d797b1496a22b2143e972a97045a" category="list-text">确保 SP 状态为 `online` 。</block>
  <block id="9d69314bda1bdc408f81a03d72f99767" category="list-text">确保已配置 SP 网络。</block>
  <block id="7f4649d278edc769a0ec529585086778" category="list-text">记录 IP 地址和有关 SP 的其他信息。</block>
  <block id="2874b759bc0f9d6f832a84f482485f96" category="paragraph">您可能希望在新节点上重复使用原始系统中远程管理设备（此处为 SP ）的网络参数。有关 SP 的详细信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _System 管理参考 _ 和 _ONTAP 9 命令：手册页参考 _ 。</block>
  <block id="73e2f3b9e6d19fe1e2189067c752d909" category="list-text">【 man_prepare_nodes_step30]] 如果希望新节点与原始节点具有相同的许可功能，请输入以下命令以查看原始系统上的集群许可证：</block>
  <block id="57fb8c1782e77bfa17ea95c66f54a6dd" category="paragraph">`ssystem license show -owner *`</block>
  <block id="4f8f7baa705fb90b9c5bec95668e59f5" category="paragraph">以下示例显示了 cluster1 的站点许可证：</block>
  <block id="b83718d5186db84761322d32f4ea05ac" category="list-text">在 _NetApp 支持站点 _ 为新节点获取新许可证密钥。请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _NetApp 支持站点 _ 。</block>
  <block id="5bb4c97c29100d63e333b5886f7e88b0" category="paragraph">如果此站点没有所需的许可证密钥，请联系您的 NetApp 销售代表。</block>
  <block id="6e97d82c25e14f4edc2307703de3f74f" category="list-text">在每个节点上输入以下命令并检查其输出，以检查原始系统是否已启用 AutoSupport ：</block>
  <block id="6be10f97ff0bf527322d5fe2064f26ca" category="paragraph">`ssystem node AutoSupport show -node node1 ， node2`</block>
  <block id="28705e432bcaee564beb0750f6d4f55d" category="paragraph">命令输出显示是否已启用 AutoSupport ，如以下示例所示：</block>
  <block id="9d35920fb64314f04ebb4c503b9d4637" category="cell">如果原始系统 ...</block>
  <block id="82afadce5c137568366e29a810db005a" category="cell">已启用 AutoSupport ...</block>
  <block id="c732f1d7a89abd68a48f92313a9b4364" category="inline-xref">第 34 步</block>
  <block id="1ab718a04314b36269d3b2b096aac75a" category="list-text">转至 <block ref="395265ffe56efe9e97ae9cc3752b2f60" category="inline-xref-macro-rx"></block>。</block>
  <block id="e5358fe562a4d74ac4231d8e23d0b088" category="inline-link-macro">获取用于存储加密的外部密钥管理服务器的 IP 地址</block>
  <block id="e080d72a1a31976179b4632b6b55abc6" category="list-text">转到部分 <block ref="0427c7f36b4a2a717a929ec10534f5c0" category="inline-link-macro-rx"></block>。</block>
  <block id="9c13f9e2316ce6eb31c97c43c9f42070" category="cell">未启用 AutoSupport ...</block>
  <block id="6fcae9afe7013bc84597d8c4231312ba" category="list-text">按照 _System 管理参考 _ 中的说明启用 AutoSupport 。请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到系统管理参考。）</block>
  <block id="04f24e11b658105f38ef40a82c24839e" category="paragraph">* 注意： * 首次配置存储系统时，默认情况下会启用 AutoSupport 。尽管您可以随时禁用 AutoSupport ，但应保持启用状态。启用 AutoSupport 可以显著帮助您确定问题，并在存储系统出现问题时提供解决方案。</block>
  <block id="38380a05879fb0225ede644e75b655eb" category="list-text">转至 <block ref="0427c7f36b4a2a717a929ec10534f5c0" category="inline-link-macro-rx"></block> 部分。</block>
  <block id="4179c1d88c83e870ed525f69e82e0369" category="list-text">【 man_prepare_nodes_step34]] 在两个原始节点上输入以下命令并检查输出，以验证 AutoSupport 是否配置了正确的邮件主机详细信息和收件人电子邮件 ID ：</block>
  <block id="a8c3aac51d9227fa38d968e2651f9145" category="paragraph">`ssystem node AutoSupport show -node node_name -instance`</block>
  <block id="f9145af7d3453430abd5b300de96a961" category="paragraph">有关 AutoSupport 的详细信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _System 管理参考 _ 和 _ONTAP 9 命令：手册页参考 _ 。</block>
  <block id="1139339a9b05d9d73e22e4329260fdc9" category="list-text">[[man_prepare_nodes_step35 ，步骤 35]] 输入以下命令向 NetApp 发送 node1 的 AutoSupport 消息：</block>
  <block id="2dc3e53d8dbc94d5425e399af7be362e" category="paragraph">`ssystem node AutoSupport invoke -node node1 -type all -message "upgrading node1 from platform_old to platform_new"`</block>
  <block id="4086f5138ec309c4999cbff0dc76073d" category="admonition">此时，请勿向 NetApp 发送 node2 的 AutoSupport 消息；稍后可在操作步骤中执行此操作。</block>
  <block id="37fdb57fc31ec512b7d4dde37a7ab8d7" category="list-text">【 man_prepare_nodes_step36 ，步骤 36]] 输入以下命令并检查其输出，以验证是否已发送 AutoSupport 消息：</block>
  <block id="cccac064a74482bb09e58f71e14d1eb8" category="paragraph">`ssystem node AutoSupport show -node &lt;node1&gt; -instance`</block>
  <block id="28dd44ad0b0bcceee8ca8498734facba" category="paragraph">字段 `Last Subject Sent ：` 和 `Last Time Sent ：` 包含上次发送消息的消息标题以及消息发送时间。</block>
  <block id="ffb1c71dba6391f1528ffd2e0843841a" category="summary">必须先配置设置，然后才能完成升级。</block>
  <block id="fdeff716288a3bd8ca18c4ffee31f259" category="paragraph">您可能需要完成 <block ref="750d6dbe3bf1312d0d97a8f03a0d2304" category="inline-xref-macro-rx"></block>或 <block ref="574c49ad3466f1bed21aff7050a30e36" category="inline-xref-macro-rx"></block>或这两个部分。</block>
  <block id="5e8f88089134f38f7cf630a3a4ce36ff" category="admonition">NetApp 营销材料可能会使用术语 UTA2 来指代 CNA 适配器和端口。但是，命令行界面使用术语 "CNA" 。</block>
  <block id="0f7670789359a9e1e91e25e19d469dad" category="list-text">如果 node3 没有板载 FC 端口，板载 UTA/UTA2 端口或 UTA/UTA2 卡，并且您要升级具有存储磁盘的系统，则可以跳至 <block ref="3b6c063a8efbc88c969c7838f0611434" category="inline-link-macro-rx"></block>。</block>
  <block id="04bc530160a0c8cfe78397922bf1025e" category="list-text">但是，如果您使用的是 V 系列系统或安装了 FlexArray 虚拟化软件和存储阵列的系统，并且 node3 没有板载 FC 端口，板载 UTA/UTA 端口或 UTA/UTA2 卡，请返回 _Install and boot node3_ 并在中继续 <block ref="8334b800bcf351711ec77ec1fb7390b3" category="inline-link-macro-rx"></block>。</block>
  <block id="218c1c22487e3cea0e94aedcabb843e2" category="paragraph">您必须具有保存在中的 node1 中的 FC 端口设置值 <block ref="cd8ad1809865824065fe011b80800cd6" category="inline-link-macro-rx"></block>。</block>
  <block id="53d8e9a89e7df0f2e9d3d1647aa47fa3" category="admonition">* 重要信息 * ：如果您的系统具有存储磁盘，请在集群提示符处输入本节中的命令。如果您使用的是 V 系列系统或 FlexArray 虚拟化软件并连接到存储阵列，请在维护模式下在此部分中输入命令。</block>
  <block id="9dc09e5212ac728648450db66b8f3668" category="list-text">【第 1 步】执行以下操作之一：</block>
  <block id="fb0e67401f3473ee656312bb98935878" category="cell">转至 <block ref="4e8d6367d01e7a88b5b6b591ecf5d6db" category="inline-xref-macro-rx"></block></block>
  <block id="32781b45218385923d91bc21b08c6b68" category="cell">转至 <block ref="79ba4e2202506d0f17b14ab90d196879" category="inline-xref-macro-rx"></block></block>
  <block id="838b228ad3b40461ad1dc100f5671807" category="list-text">【 man_config_3_step2]] 启动 node3 和访问维护模式：</block>
  <block id="534ca774217e84be533a1aad9cf31936" category="cell">输入以下命令： `ssystem node hardware unified-connect show`</block>
  <block id="fe780061729afd0c0f2800209c7c7bf6" category="cell">是 V 系列系统或具有 FlexArray 虚拟化软件并连接到存储阵列。</block>
  <block id="b7911a4b9aaa4584cf3072f4df9d0033" category="cell">输入以下命令 `ucadmin show`</block>
  <block id="d0f2b99979906267ea4c720be3fdf8c1" category="list-text">【第 4 步】将 node3 的 FC 设置与先前从 node1 捕获的设置进行比较。</block>
  <block id="befe3449c034cb6f4631649c7a4ed066" category="list-text">[[man_config_3_step5]] 执行以下操作之一：</block>
  <block id="7f3a5152afa49c8421359b8761a9a8ad" category="cell">新节点上的默认 FC 设置</block>
  <block id="cb4a7a262c1057120daeee2df7839247" category="cell">与您在 node1 上捕获的相同</block>
  <block id="2b56e7490fdbb3cfe1904501429274b7" category="cell">转至 <block ref="c6c9a381b48f60f002c0199635146c23" category="inline-xref-macro-rx"></block>。</block>
  <block id="2cc211fd01662dba325fa6afb2cb24dc" category="cell">与您在 node1 上捕获的不同</block>
  <block id="3a3387d05eb4dc59724516e63ce89fe1" category="cell">转至 <block ref="cb1e6c315615cb7630d3b8a437827bc2" category="inline-xref-macro-rx"></block>。</block>
  <block id="8858cbf1016a885e6783f73cde18ddf4" category="list-text">【 man_config_3_step6]] 执行以下操作之一：</block>
  <block id="eef9069309a77ac006f5011dca4b9f9a" category="paragraph">根据需要输入以下命令之一，修改 node3 上的 FC 端口：</block>
  <block id="2ce4edae9e9c97b20fed47972e1d4caf" category="list-text">要对目标端口进行编程： `ssystem node hardware unified-connect modify -type | -t target -adapter port_name`</block>
  <block id="51587a6d058865620a3fb14c6d8c9d9a" category="list-text">要对启动程序端口进行编程： `ssystem node hardware unified-connect modify -type | -t initiator -adapter port_name`</block>
  <block id="f785fd1b7c2d6c5d48b8a31065275b2a" category="cell">根据需要输入以下命令，修改 node3 上的 FC 端口： `ucadmin modify -m fc -t initiator -f adapter_port_name` ` -t` 是 FC4 类型，目标或启动程序。* 注 * ：必须将 FC 端口编程为启动程序。</block>
  <block id="0f46f9b9f7235f322cd04b338ecda49c" category="list-text">【第 7 步】执行以下操作之一：</block>
  <block id="85a79ca9227090c23bb3d6d14dbbe0af" category="cell">输入以下命令并检查输出，以验证新设置： `ssystem node hardware unified-connect show`</block>
  <block id="ae1a6eb25c428a13de7c805301540516" category="cell">输入以下命令并检查输出，以验证新设置： `ucadmin show`</block>
  <block id="2c6e937b15ebe6468c586dd1b4eb466a" category="list-text">【第 8 步】输入以下命令退出维护模式：</block>
  <block id="b3a919f35f16fa3a39c85eac5d885d2f" category="list-text">【第 9 步】输入命令后，请等待系统在启动环境提示符处停止。</block>
  <block id="c62d6d151dbb06716a8276f4f8bb89e0" category="list-text">【第 10 步】执行以下操作之一：</block>
  <block id="8e49fbf8016e97e15077debef6c06b54" category="cell">是 V 系列系统或具有运行集群模式 Data ONTAP 8.3 的 FlexArray 虚拟化软件</block>
  <block id="51ae224ccdb747cc08ff98ed97fed51f" category="cell">在启动环境提示符处启动 node3 并访问维护： `boot_ontap maint`</block>
  <block id="8cf0032370f0f9233266234c2a7feab7" category="cell">不是 V 系列系统或没有 FlexArray 虚拟化软件</block>
  <block id="7e422d66a2b07e1e654868dee6aae687" category="cell">在启动环境提示符处启动 node3 ： `boot_ontap`</block>
  <block id="1509937ac092a7690a93d056a0c33d58" category="list-text">【 man_config_3_step11]] 执行以下操作之一：</block>
  <block id="3e5bf76136102b434c2a000604dc77c1" category="list-text">如果 node3 具有 UTA/UTA2 卡或 UTA/UTA2 板载端口，请转至 <block ref="574c49ad3466f1bed21aff7050a30e36" category="inline-xref-macro-rx"></block>。</block>
  <block id="306e854e226a650b7acec40ba5a0e249" category="list-text">如果 node3 没有 UTA/UTA2 卡或 UTA/UTA2 板载端口，请跳过 <block ref="574c49ad3466f1bed21aff7050a30e36" category="inline-xref-macro-rx"></block> 然后转到 <block ref="3b6c063a8efbc88c969c7838f0611434" category="inline-link-macro-rx"></block>。</block>
  <block id="6c804c4adac8740743dd6f41da471795" category="list-text">如果 node3 具有卡或板载端口，请转至 <block ref="574c49ad3466f1bed21aff7050a30e36" category="inline-xref-macro-rx"></block>。</block>
  <block id="49844625e7eb80b095f9d3c525f8cba6" category="list-text">如果 node3 没有卡或板载端口，请跳过 <block ref="574c49ad3466f1bed21aff7050a30e36" category="inline-xref-macro-rx"></block>，并返回到 _Install 和 boot node3_ ，然后在继续 <block ref="a4103675c41ea57f7287e0804dd0c9dd" category="inline-link-macro-rx"></block>。</block>
  <block id="f11bd0266651c774d488523db903a725" category="admonition">* 注意 * ：如果您的系统具有存储磁盘，除非指示您进入维护模式，否则您可以在集群提示符处输入本节中的命令。如果您使用的是 Vseries 系统或 FlexArray 虚拟化软件并连接到存储阵列，则可以在维护模式提示符处在此部分中输入命令。要配置 UTA/UTA2 端口，您必须处于维护模式。</block>
  <block id="d430acf9b1fab77a9b9905bbf1423c57" category="list-text">【第 1 步】在 node3 上输入以下命令，检查端口当前的配置方式：</block>
  <block id="1f81aa18292065e5242ce30775d96e2c" category="paragraph">系统将显示类似于以下示例的输出：</block>
  <block id="581e0d52eede5c7a9002197a5955188f" category="list-text">`s步骤 3]] 查看` system node hardware unified-connect show `或` ucadmin show 命令的输出，以确定 UTA/UTA2 端口是否具有所需的个性化设置。</block>
  <block id="39e1a687c8a1a3bb49c730ad7b98a3d5" category="cell">转至 <block ref="2fc3b3e515184c116c95342a9ca8cb9f" category="inline-xref-macro-rx"></block>。</block>
  <block id="aeeda50cd3cc8fa0b7819c50d25802cc" category="cell">跳过步骤 5 到步骤 12 ，然后转到 <block ref="e8dc02ba0ba84dfdb12d2955f04811ca" category="inline-xref-macro-rx"></block>。</block>
  <block id="8c1235ea1bd5309fe2724d440119a7bf" category="list-text">[[man_check_3_step5]] 执行以下操作之一：</block>
  <block id="702b58a3a2c0f7ca9c1ff79304cc3846" category="cell">具有存储磁盘，并且正在运行集群模式 Data ONTAP 8.3</block>
  <block id="177fe53a2ca3ad4477bf20631953c74e" category="cell">启动 node3 并进入维护模式： `boot_ontap maint`</block>
  <block id="9bc874604b7939971f9993fe8c042cc5" category="cell">转至 <block ref="f6d13a5ff9438ee0d4458e3f2ffb2fd3" category="inline-xref-macro-rx"></block>。您应已处于维护模式。</block>
  <block id="3b9a8502a8d7047daccb7dc1e076d1db" category="list-text">【 man_check_3_step6]] 执行以下操作之一：</block>
  <block id="1f14f34deb68e1ccfd51fd969391f85b" category="cell">转至 <block ref="e0afe2f8b687f2b937ad04447e0f4504" category="inline-xref-macro-rx"></block>。</block>
  <block id="fe13e7c4af341791013b658ec3446e14" category="cell">跳过第 7 步，转到 <block ref="21867c7d0c2b8bc3921bf40e9edec561" category="inline-xref-macro-rx"></block>。</block>
  <block id="5d8cdb858d03ccbaab4933257301ad1f" category="list-text">[[man_check_3_step7]] 如果适配器处于启动程序模式，并且 UTA/UTA2 端口联机，请使 UTA/UTA2 端口脱机：</block>
  <block id="de2f29988a1562cff5aece8243895ec3" category="paragraph">目标模式下的适配器会在维护模式下自动脱机。</block>
  <block id="f5127a07c0da9806f59a276c6a53e07b" category="list-text">[[man_check_3_step8]] 如果当前配置与所需用途不匹配，请根据需要更改配置：</block>
  <block id="20a6fed477bc68dded7a110a5998c20e" category="admonition">您需要对磁带驱动器， FlexArray 虚拟化系统和 MetroCluster 配置使用 FC 启动程序。您需要对 SAN 客户端使用 FC 目标。</block>
  <block id="87f04db4bf78b3f620b7363444f3162e" category="list-text">停止系统：</block>
  <block id="42a282655a6bcf78e540d618abe8f39f" category="cell">重新启动至维护模式： `boot_netapp maint`</block>
  <block id="4ccd0b13a5d5d3be43ff2600a91655cc" category="list-text">【第 11 步】验证设置：</block>
  <block id="f2cc2cb82b7d41d7e5604b8610c271a3" category="cell">是 V 系列或具有 FlexArray 虚拟化软件并连接到存储阵列</block>
  <block id="52b727613ccb81e1e924ffec991b2e74" category="paragraph">以下示例中的输出显示， FC4 类型的适配器 "1b" 更改为 `initiator` ，适配器 "2a" 和 "2b" 的模式更改为 `CNA` ：</block>
  <block id="fa05264b5c812e55c8ce27a16e3cb341" category="list-text">【第 12a 步】输入以下命令之一，使所有目标端口联机，每个端口输入一次：</block>
  <block id="7bf32aee58782ae16c1d768b4bf38822" category="list-text">【 man_check_3_step13]] 为端口布线。</block>
  <block id="ed79a6f393f23524ed190af7b250c69b" category="list-text">【第 14 步】执行以下操作之一：</block>
  <block id="eb62d15c59e51a7bf19844fae4092453" category="cell">转至 <block ref="3b6c063a8efbc88c969c7838f0611434" category="inline-link-macro-rx"></block>。</block>
  <block id="8ec15d413a08247a2b2856ae1be9d192" category="cell">返回到 _Install 和 boot node3_ 并在中继续 <block ref="a4103675c41ea57f7287e0804dd0c9dd" category="inline-link-macro-rx"></block>。</block>
  <block id="5b6cee1274271b21e1022c2cf2b85b5c" category="summary">在第 5 阶段，您将安装并启动 node4 ，将集群和节点管理端口从 node2 映射到 node4 ，并验证 node4 安装。</block>
  <block id="fe24254c1d8ef507a0bd18d59832f5a2" category="paragraph">在第 5 阶段，您将安装并启动 node4 ，将集群和节点管理端口从 node2 映射到 node4 ，并验证 node4 安装。您还可以将节点 2 拥有的数据 LIF 和 SAN LIF 从 node3 移动到 node4 ，并将节点 2 的聚合从 node3 重新定位到 node4 。</block>
  <block id="488c6e462745f03d8c1dfb3ba61f7258" category="list-text"><block ref="488c6e462745f03d8c1dfb3ba61f7258" category="inline-link-macro-rx"></block></block>
  <block id="a96ea627b3d5d65e112aacf5d7b2c1e1" category="inline-link-macro">将 node2 拥有的 NAS 数据 LIF 从 node3 移动到 node4 并验证 node4 上的 SAN LIF</block>
  <block id="433d8081a28a0d8c06bf54d23d4e1297" category="list-text"><block ref="433d8081a28a0d8c06bf54d23d4e1297" category="inline-link-macro-rx"></block></block>
  <block id="1d92796a70af1d22c31d2b64c9064278" category="inline-link-macro">将 node2 的非根聚合从 node3 重新定位到 node4</block>
  <block id="982c7512bced6482868d87520e4bfa82" category="list-text"><block ref="982c7512bced6482868d87520e4bfa82" category="inline-link-macro-rx"></block></block>
  <block id="1de54c7e3bdf046761fff5d36a52656c" category="summary">通过对原始节点和新节点执行任务，准备要升级的原始节点。</block>
  <block id="2f0c5661dcce8bdab7165128442db993" category="list-text"><block ref="2f0c5661dcce8bdab7165128442db993" category="inline-link-macro-rx"></block></block>
  <block id="2751979c348fa4496d4f5e77b42bd6f7" category="inline-link-macro">第 2 阶段：重新定位和停用节点 1</block>
  <block id="1c4bcac5938cde9a8029f70ed983f129" category="list-text"><block ref="1c4bcac5938cde9a8029f70ed983f129" category="inline-link-macro-rx"></block></block>
  <block id="2bff11e37a7944fe4126fc6d0031317c" category="list-text"><block ref="2bff11e37a7944fe4126fc6d0031317c" category="inline-link-macro-rx"></block></block>
  <block id="5031d6e060f03ca2e474f28550af0fd8" category="inline-link-macro">第 4 阶段：记录信息并停用节点 2</block>
  <block id="40e3db2ec211fe309d66e01bc6d6863f" category="list-text"><block ref="40e3db2ec211fe309d66e01bc6d6863f" category="inline-link-macro-rx"></block></block>
  <block id="a9e86788143677bb2fee738ac1306c36" category="list-text"><block ref="a9e86788143677bb2fee738ac1306c36" category="inline-link-macro-rx"></block></block>
  <block id="a8f4b0dd7dd43592ec02ea010ada1285" category="list-text"><block ref="a8f4b0dd7dd43592ec02ea010ada1285" category="inline-link-macro-rx"></block></block>
  <block id="874af5eaa64266f1977e5b0930fef688" category="summary">配置存储加密并建立客户端身份验证密钥。</block>
  <block id="860301dd0e6cb22e496abc5899c88116" category="summary">您需要将 node2 拥有的 NAS 数据 LIF 移动到 node3 。</block>
  <block id="8a934a6945c2524f52729212e6e676c1" category="doc">将 Node2 拥有的 NAS 数据 LIF 移动到 Node3</block>
  <block id="0798efe32af9ed8a849deddb03ef31cf" category="paragraph">将聚合从 node2 重新定位到 node3 后，您需要将 node2 拥有的 NAS 数据 LIF 移动到 node3 。</block>
  <block id="71f0ff9a99872664cb504bc17756a9a7" category="paragraph">在升级操作步骤期间，远程 LIF 处理 SAN LUN 的流量。升级期间，集群或服务运行状况无需移动 SAN LIF 。除非需要将 SAN LIF 映射到新端口，否则不会移动这些 LIF 。将 LIF 从 node3 移动到 node4 并使 node4 联机后，必须验证 LIF 是否运行正常并位于相应的端口上。</block>
  <block id="e2400a5784b6e69a68f8240fc8be98e0" category="list-text">【第 1 步】通过在任一节点上输入以下命令并捕获输出，列出 node2 拥有的所有 NAS 数据 LIF ：</block>
  <block id="83dae04d05ca0d2bbd524535d62e877e" category="paragraph">`network interface show -data-protocol nfs|cifs -home-node node2`</block>
  <block id="1dfd4aeb9eb2d67718bb179a87daccb5" category="paragraph">以下示例显示了 node2 的命令输出：</block>
  <block id="aa0c21cc929471b59f51bf7561edb3b2" category="cell">如果 node2...</block>
  <block id="141b9f4f51c5a1d44c0555e2cab43f56" category="cell">已配置接口组或 VLAN</block>
  <block id="0cce85d021e13ea0d84461759b2a3b08" category="cell">转至 <block ref="d5cd2572a667e81ae2cb0b0539de3785" category="inline-xref-macro-rx"></block>。</block>
  <block id="d7f8ef927cf7428c7625c268a1c951ef" category="cell">跳过步骤 3 ，然后转到 <block ref="2dd22df3b6260ee6ac1883b31af6d999" category="inline-xref-macro-rx"></block>。</block>
  <block id="6d3379271564572a595ab2fbc869131a" category="list-text">[[man_move_lif_2_3_step3]] 执行以下步骤以迁移节点 2 上接口组和 VLAN 上托管的 NAS 数据 LIF ：</block>
  <block id="daaee2c9342de97c2c423f905e0ea71f" category="list-text">[[man_move_lif_2_3_substepa]] 通过为每个 LIF 输入以下命令，将 node2 上接口组上托管的任何数据 LIF 迁移到 node3 上能够在同一网络上托管 LIF 的端口：</block>
  <block id="048f81150ce15262b658b7de15b84690" category="paragraph">`network interface migrate -vserver vserver_name -lif LIF_name -destination-node node3 – destination-port netport_ifgrp`</block>
  <block id="4fd830a8ef7653e7cc91a40076c34365" category="list-text">在中修改 LIF 的主端口和主节点 <block ref="6c89c517e670ac026543379bd9a9844e" category="inline-xref-macro-rx"></block> 通过输入以下命令将 LIF 连接到当前托管 LIF 的端口和节点，每个节点输入一次：</block>
  <block id="657b6a55549088546a48050df59aeff1" category="paragraph">`network interface modify -vserver vserver_name -lif LIF_name -home-node node3 -homport netports|ifgrp`</block>
  <block id="274dd4ace55dc7cc39f1a5eb3afbcbf1" category="list-text">【 man_move_lif_2_3_substepc]] 通过为每个 LIF 输入以下命令，将节点 2 上 VLAN 上托管的任何 LIF 迁移到节点 3 上能够在与 VLAN 相同的网络上托管 LIF 的端口：</block>
  <block id="9ad3609f9c94e5d3764345c4a95d6e85" category="inline-xref">子步骤 c</block>
  <block id="107232f6e653a89ac23c99590a7ea101" category="list-text">在中修改 LIF 的主端口和主节点 <block ref="e5ef0b90c6e2aafbe1f927b2cb6685c9" category="inline-xref-macro-rx"></block> 输入以下命令，将 LIF 设置为当前托管 LIF 的端口和节点，每个 LIF 设置为一次：</block>
  <block id="d113d66e692935f5a59a62900427b861" category="list-text">[[man_move_lif_2_3_step4]] 执行以下操作之一：</block>
  <block id="20cdfa79ed0499babc80c9a3f7d7297c" category="cell">完成 <block ref="2da0d67c04c83434137e9b301dfd86dd" category="inline-xref-macro-rx"></block> 到 <block ref="12556117786215462f4f983b89f009f9" category="inline-xref-macro-rx"></block>。</block>
  <block id="44f77dbcf99acc01b3bf655a89bfcc5e" category="cell">跳过步骤 5 到步骤 8 ，然后完成 <block ref="b80e3f5f2f06a1383cb71c69b52c021e" category="inline-xref-macro-rx"></block>。</block>
  <block id="7f84238811a0744aed44244f31a3bd53" category="cell">NAS 和 SAN</block>
  <block id="da070fa74bde99b92534bf987c65a7e1" category="cell">完成 <block ref="2da0d67c04c83434137e9b301dfd86dd" category="inline-xref-macro-rx"></block> 到 <block ref="ccd0910cd159fbfd70d254145a6c4d20" category="inline-xref-macro-rx"></block>。</block>
  <block id="1b8095077175bc0e7f7bb5fbb73e6504" category="list-text">[[man_move_lif_2_3_step5]] 如果平台上的数据端口不同，请将这些端口添加到广播域：</block>
  <block id="e8db799447d1b0c26463d2838519203a" category="paragraph">`network port broadcast-domain add-ports -ipspace ipspace_name -broadcast-domain mgmt -ports node ： port`</block>
  <block id="2f563bb65059883cdd406846273f0ca4" category="paragraph">以下示例将节点 "6280-1 " 上的端口 "e0a" 和节点 "8060-1 " 上的端口 "e0i" 添加到 IP 空间 "Default" 中的广播域 "mgmt" ：</block>
  <block id="1062bb6c92253a8c9b640ee692419b26" category="list-text">【第 6 步】输入以下命令，将每个 NAS 数据 LIF 迁移到 node3 ，每个 LIF 一次：</block>
  <block id="cf94c0385b5c2ed33b1d57956c4697d4" category="paragraph">`network interface migrate -vserver vserver_name -lif LIF_name -destination-node node3 -destination-port netport_ifgrp`</block>
  <block id="0049a5f9500f1de5ca8ef0f389c62f72" category="list-text">【第 7 步】在任一节点上输入以下命令并检查输出，以验证 NAS LIF 是否已移至正确的端口以及 LIF 的状态是否为 up ：</block>
  <block id="74736b1b1199beaea5593b316d8e4625" category="paragraph">`network interface show -curr-node &lt;node3&gt;-data-protocol cifs|nfs`</block>
  <block id="6f72830bc34189a08fe7627d74d89f3b" category="list-text">[[man_move_lif_2_3_step8]] 如果任何 LIF 已关闭，请通过输入以下命令将 LIF 的管理状态设置为 "up" ，每个 LIF 一次：</block>
  <block id="5ebc0a94cbbcb381cb1a98cffc3adac0" category="paragraph">`network interface modify -vserver &lt;vserver_name&gt; -lif &lt;LIF_name&gt; -status-admin up`</block>
  <block id="ba45f9f836b05d2d37a836a9ed696d6f" category="list-text">[[man_move_lif_2_3_step9]] 如果您配置了接口组或 VLAN ，请完成以下子步骤：</block>
  <block id="74189835f85e9e3f27da7d0ea64f8c56" category="paragraph">`network port vlan delete -node node_name -port ifgrp -vlan-id vlan_ID`</block>
  <block id="ef57ddf1d14f7687cdf12a4b023fe0ba" category="list-text">输入以下命令并检查其输出，以确定节点上是否配置了任何接口组：</block>
  <block id="d2cddb90501569c80df4ec0677bd9046" category="paragraph">`network port ifgrp show -node &lt;node_name&gt; -ifgrp &lt;ifgrp_name&gt; -instance`</block>
  <block id="32c2f2dc33f1ff3a5d165af69042d610" category="paragraph">系统将显示节点的接口组信息，如以下示例所示：</block>
  <block id="c02532d4249a0cf1658188c0c95a7129" category="list-text">如果节点上配置了任何接口组，请记录接口组的名称以及分配给这些接口组的端口，然后输入以下命令删除这些端口，每个端口输入一次：</block>
  <block id="a1858c4eb2fed033fc49b2a7a2049d7b" category="paragraph">`network port ifgrp remove-port -node node_name -ifgrp ifgrp_name -port port_name`</block>
  <block id="01db8001b2c207e7c8c82eff0b5717fe" category="summary">您需要将当前位于 node2 上的 node1 的 NAS 数据 LIF 从 node2 移动到 node3 。您还需要验证 node3 上的 SAN LIF 。</block>
  <block id="921eaa458ace17addc7c79b9466bf144" category="doc">将 node1 拥有的 NAS 数据 LIF 从 node2 移动到 node3 并验证 node3 上的 SAN LIF</block>
  <block id="57ee8bcad5023aa93029c15b1a6ae0a6" category="paragraph">在验证 node3 安装并将聚合从 node2 重新定位到 node3 之前，您需要将当前位于 node2 上的 node1 的 NAS 数据 LIF 从 node2 移动到 node3 。您还需要验证 node3 上的 SAN LIF 。</block>
  <block id="44bbe343e421273c157c5d1c833a433b" category="list-text">【第 1 步】通过在任一节点上输入以下命令并捕获输出，列出 node2 不拥有的所有 NAS 数据 LIF ：</block>
  <block id="690cd6839e2f529e9d1be34efa6f9791" category="paragraph">`network interface show -role data -curr-node node2 -is-home false -home-node node3`</block>
  <block id="4273a0997ee0d6df35945422d9f57ec6" category="cell">已配置接口组或 VLAN</block>
  <block id="05aa25da736018fa33e8cc8667b1e0f1" category="cell">转至 <block ref="fa7afcf3541ce640333b443234c694da" category="inline-xref-macro-rx"></block>。</block>
  <block id="31a8cab14d1d7febef6f8053dcd9552d" category="cell">未配置接口组或 VLAN</block>
  <block id="09b00a0d82c468f9038424665ba3a692" category="cell">跳过步骤 3 ，然后转到 <block ref="a5ee73999909412ce73c7e745a3cb5c2" category="inline-xref-macro-rx"></block>。</block>
  <block id="8c5ada6be3ca66f32616fd020694ec45" category="list-text">[[man_lif_verif_3_step3]] 执行以下子步骤，将最初位于 node1 上的接口组和 VLAN 上托管的任何 NAS 数据 LIF 从 node2 迁移到 node3 ：</block>
  <block id="fd8bd88e1dcef54d04236465f2b87693" category="list-text">【 man_lif_verif_3_substepa 】通过为每个 LIF 输入以下命令，将先前属于接口组中 node1 的 node2 上托管的任何数据 LIF 迁移到 node3 上能够在同一网络上托管 LIF 的端口：</block>
  <block id="494973c7f1f28c90b456a3998b09b84a" category="paragraph">`network interface migrate -vserver vserver_name -lif LIF_name -destination-node node3 – destination-port netport_ifgrp`</block>
  <block id="630798093592f408d28e43d1a5875c4f" category="list-text">在中修改 LIF 的主端口和主节点 <block ref="ffe3d697e3afcad8e9e0e14f978885cb" category="inline-xref-macro-rx"></block> 输入以下命令，将 LIF 设置为当前托管 LIF 的端口和节点，每个 LIF 设置为一次：</block>
  <block id="7c38b19f61b4cf300416bf64071c3a06" category="paragraph">`network interface modify -vserver vserver_name -lif LIF_name -home-node node3 -home-port netport_ifgrp`</block>
  <block id="569a27e0dcf14d4091837fcac510315b" category="list-text">【 man_lif_verif_3_substepc]] 通过为每个 LIF 输入以下命令，将先前属于 VLAN 端口上 node1 的 node2 上托管的任何数据 LIF 迁移到 node3 上能够在同一网络上托管 LIF 的端口：</block>
  <block id="acdda21dc8c7ea3a875f05cfa2d42fb8" category="list-text">在中修改 LIF 的主端口和主节点 <block ref="0ba0c3832c194a002bde244af82cc6e8" category="inline-xref-macro-rx"></block> 输入以下命令，将 LIF 设置为当前托管 LIF 的端口和节点，每个 LIF 设置为一次：</block>
  <block id="f0de8680ab31eb7304741a5d6c335bce" category="list-text">[[man_lif_verif_3_step4]] 执行以下操作之一：</block>
  <block id="a8737f289941aae34c7bdcaf30a6f49c" category="cell">完成 <block ref="5bf3f4cb83f848c38272cdda13b03424" category="inline-xref-macro-rx"></block> 和 <block ref="5afb3629d2897001a44bd62c86195932" category="inline-xref-macro-rx"></block>，跳过步骤 7 并完成 <block ref="6f2b0e2c7df1e7ce442716f4a9ac5045" category="inline-xref-macro-rx"></block> 到 <block ref="d664f7f06c19c1d6c4e1d7d9cba27620" category="inline-xref-macro-rx"></block>。</block>
  <block id="e7bc8e4a360dbc42e9759f708ed40f33" category="cell">禁用节点上的所有 SAN LIF 以将其关闭以进行升级： `network interface modify -vserver vserver_name -lif LIF_name -home-node node_to_upgrade -home-port netport_ifgrp -status-admin down`</block>
  <block id="99025819fe651e3a15c4cafd9ba07587" category="list-text">【 man_lif_verif_3_step5]] 如果平台上的数据端口不同，请将这些端口添加到广播域：</block>
  <block id="76b84f6ac9c180bd922bf1f7f126e4f3" category="list-text">【 man_lif_verif_3_step6]] 通过输入以下命令将每个 NAS 数据 LIF 迁移到 node3 ，每个 LIF 一次：</block>
  <block id="6c255263113a7719b1ecd239473107b4" category="paragraph">`network interface migrate -vserver vserver_name -lif LIF_name -destination-node node3 -destination-port netport_ifgrp`</block>
  <block id="2a315513f7616cc1af14936ea2d874e2" category="list-text">【 man_lif_verif_3_step7]] 确保数据迁移持久：</block>
  <block id="41decee97eaf6a02382e1043cd497047" category="paragraph">`network interface modify -vserver vserver_name -lif LIF_name-home-port netport_ifgrp -home-node node3`</block>
  <block id="a1bec963768ced37ff6941c78a44a2b2" category="list-text">【 man_lif_verif_3_step8]] 确保 SAN LIF 位于 node3 上的正确端口上：</block>
  <block id="585706a23104766700d11344f2e0ba1f" category="paragraph">`network interface show -data-protocol iscsi_FCP -home-node node3`</block>
  <block id="2a5c2b7daa59600bf737f8138fa7c5d8" category="list-text">将 LIF 状态设置为 "down" ：</block>
  <block id="c45d65e293bff08cd4322d40820fe3f2" category="paragraph">`network interface modify -vserver &lt;vserver_name&gt; -lif &lt;LIF_name&gt; -status-admin down`</block>
  <block id="e6002eba5d1a039b35fcb8536729f448" category="paragraph">`network interface modify -vserver vserver_name -lif LIF_name -home-port new_home_port`</block>
  <block id="18cd286e7e66b1d7cc6dd09759e173e8" category="paragraph">`network interface modify -home-port &lt;port_name&gt; -home-node &lt;node3&gt;-lif data -status-admin up`</block>
  <block id="95ecba7b6bea27535042e5096f91549c" category="list-text">在任一节点上输入以下命令并检查其输出，以验证 LIF 是否已移至正确的端口，以及 LIF 的状态是否为 "up" ，具体方法是在任一节点上输入以下命令并检查输出：</block>
  <block id="2e0b337c1378c2a234102f1198e8adba" category="list-text">[[man_lif_verif_3_step11]] 如果任何 LIF 已关闭，请通过为每个 LIF 输入以下命令将 LIF 的管理状态设置为 "up" ：</block>
  <block id="d69a84eb389c545291c152fff3de9999" category="paragraph">`network interface modify -vserver &lt;vserver_name&gt; -lif &lt;LIF_name&gt; -status-admin up`</block>
  <block id="78036b97ca6165fc32dd17167726e77f" category="list-text">向 NetApp 发送 node1 的升级后 AutoSupport 消息：</block>
  <block id="b430ac926445a5f58cb4f6464a0ee269" category="paragraph">`ssystem node AutoSupport invoke -node node3 -type all -message "node1 successfully up级 从 platform_old 升级到 platform_new"`</block>
  <block id="30c652bad12788fabddea0712def2e8e" category="doc">重新配置 ONTAP 9.1 或更高版本的 FC 交换机布局</block>
  <block id="d30f280fa32f9327e8485ff0aa1b5b70" category="paragraph">如果现有 FC 交换机布局是在 ONTAP 9.1 之前配置的，则必须重新配置端口布局并应用最新的参考配置文件（ Reference Configuration Files ， RCF ）。此操作步骤仅适用于 MetroCluster FC 配置。</block>
  <block id="37ce42e81f71d3eac5866566739a5a56" category="paragraph">您必须确定网络结构域中存在的 FC 交换机。</block>
  <block id="f2bd3f00211cc48acb66c611b574098b" category="paragraph">您需要管理员密码以及对 FTP 或 SCP 服务器的访问权限。</block>
  <block id="19c0b52227bc66456bf8c55fcff3eb89" category="paragraph">如果您的现有 FC 交换机布局是在 ONTAP 9.1 之前配置的，并且您要升级到 ONTAP 9.1 或更高版本支持的平台型号，则必须执行此任务。如果要从为 ONTAP 9.1 或更高版本配置的现有交换机布局进行升级，则需要 _not_ 。</block>
  <block id="27370eebc219409a38405d3941b09a1a" category="paragraph">此操作步骤不会造成系统中断，在磁盘置零后，大约需要 4 小时才能完成（不包括机架和堆栈）。</block>
  <block id="51c3ff1ea95b633c723b087fbf10b31f" category="inline-link-macro">在重新配置交换机之前发送自定义 AutoSupport 消息</block>
  <block id="cd7f6b17ef2ed204c4c6382062e38468" category="list-text"><block ref="cd7f6b17ef2ed204c4c6382062e38468" category="inline-link-macro-rx"></block></block>
  <block id="ef6f40d3ce7e7a9983b40931e61073f2" category="list-text"><block ref="ef6f40d3ce7e7a9983b40931e61073f2" category="inline-link-macro-rx"></block></block>
  <block id="3ff5cf5ad1c2c9c9e30693bbeb4d8306" category="list-text"><block ref="3ff5cf5ad1c2c9c9e30693bbeb4d8306" category="inline-link-macro-rx"></block></block>
  <block id="21a86fa1fb645db8452b527892434bd3" category="inline-link-macro">持久禁用交换机</block>
  <block id="a7cd0f7276da428232eaddd32f025cec" category="list-text"><block ref="a7cd0f7276da428232eaddd32f025cec" category="inline-link-macro-rx"></block></block>
  <block id="7fc77faa536c8e7ba6f065e5930679ee" category="inline-link-macro">确定新的布线布局</block>
  <block id="1e3a603a58f58380bbf882725903f11b" category="list-text"><block ref="1e3a603a58f58380bbf882725903f11b" category="inline-link-macro-rx"></block></block>
  <block id="d627b57cf15134483e5785196cf7030f" category="inline-link-macro">应用 RCF 文件并重新对交换机进行布线</block>
  <block id="d59f7f355b5fe1cff54983019e740407" category="list-text"><block ref="d59f7f355b5fe1cff54983019e740407" category="inline-link-macro-rx"></block></block>
  <block id="f3c7f494d0dbc1a358d6608915190a02" category="inline-link-macro">持久启用交换机</block>
  <block id="7fbb5636a5ddbbcf8eb4ac03b417349e" category="list-text"><block ref="7fbb5636a5ddbbcf8eb4ac03b417349e" category="inline-link-macro-rx"></block></block>
  <block id="0e8d966af50d635bc6072c43a2909953" category="list-text"><block ref="0e8d966af50d635bc6072c43a2909953" category="inline-link-macro-rx"></block></block>
  <block id="56b7bc3034bef19019ebfa88f6cac964" category="paragraph">有关 `storage aggregate relocation start` ， `override-vetoes` 和 `override-destination-checks` 选项的详细信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _Microsoft ONTAP 9 命令：手册页参考 _ 。</block>
  <block id="de10ab1a09136633c0a0d61641d1973a" category="list-text">【 man_aggr_fail_step1]] 输入以下命令以获取聚合列表：</block>
  <block id="d741a7f5a9101301995b152ddb32e5b0" category="list-text">【第 2 步】比较的输出 <block ref="fd60626f79429d907548fd26d9ef209a" category="inline-xref-macro-rx"></block> 以及您在部分中为 node1 捕获的输出 <block ref="cd8ad1809865824065fe011b80800cd6" category="inline-link-macro-rx"></block> 并记下未正确重新定位的所有聚合。</block>
  <block id="51cad6c5dffb7d53bbb0121b4ba9d369" category="list-text">【 man_aggr_fail_Step3]] 重新定位 node4 上遗留的聚合：</block>
  <block id="f51f0d388b73026dbf95e6d91f6386c1" category="list-text">输入以下命令以验证 node3 现在是否为聚合的主所有者：</block>
  <block id="5bf0f8993606c9f18dbf04cc257eab62" category="paragraph">如果聚合的主所有者不是 node3 ，则可以在中使用相同的重新定位命令将其重新定位到 node3 <block ref="d5a5e127c26ff67c138bce9a8ae2c1fa" category="inline-xref-macro-rx"></block>。</block>
  <block id="c2705b28ad093613f8695a94561aeb3e" category="summary">您需要在机架中安装 node3 ，将 node1 的连接传输到 node3 ，启动 node3 并安装 ONTAP 。</block>
  <block id="fbe97acb6a92a57289db38df1cbd3acc" category="paragraph">您需要在机架中安装 node3 ，将 node1 的连接传输到 node3 ，启动 node3 并安装 ONTAP 。然后，您需要重新分配 node1 的任何备用磁盘，属于根卷的任何磁盘以及先前未重新定位到 node2 的任何非根聚合。</block>
  <block id="57ed4780c0ea12318bd8f9bbfaddce0f" category="paragraph">如果 node3 与 node1 上安装的 ONTAP 9 版本不同，则需要对其进行网络启动。安装 node3 后，从 Web 服务器上存储的 ONTAP 9 映像启动它。然后，您可以将正确的文件下载到启动介质设备，以供后续系统启动。请参见 <block ref="4815c2d091d790c1d3bab94177b38eaf" category="inline-link-macro-rx"></block>。</block>
  <block id="0570d4a42e9be3c955a39beb93846d1e" category="paragraph">但是，如果 node3 安装的 ONTAP 9 版本与 node1 相同或更高，则不需要对其执行网络启动。</block>
  <block id="9811d17595c532c211fe17a338c29af7" category="admonition">* 重要信息 * ：如果要升级连接到存储阵列的 V 系列系统或使用连接到存储阵列的 FlexArray 虚拟化软件的系统，则需要完成升级 <block ref="533e5b5383ee7eeec7355f568e8aaf6b" category="inline-xref-macro-rx"></block> 到 <block ref="593996bb06ec10671cada9089fb35dd4" category="inline-xref-macro-rx"></block>，请将此部分保留在 <block ref="72140e6a9de023ebc205559b767779ea" category="inline-xref-macro-rx"></block> 并按照中的说明进行操作 <block ref="b874d68563e926f19d0f15015f15f190" category="inline-link-macro-rx"></block> 和 <block ref="a9e7644d0d01665bbdf613cdb831fa7f" category="inline-link-macro-rx"></block> 根据需要在维护模式下输入命令。然后，您必须返回到此部分并继续使用 <block ref="239474d202713b3a406727408fd68f72" category="inline-xref-macro-rx"></block>。但是，如果要升级具有存储磁盘的系统，则需要完成整个部分，然后转到 <block ref="b874d68563e926f19d0f15015f15f190" category="inline-link-macro-rx"></block> 和 <block ref="a9e7644d0d01665bbdf613cdb831fa7f" category="inline-link-macro-rx"></block>，在集群提示符处输入命令。</block>
  <block id="1b5474698e4bc6bfa928589ed23b1571" category="list-text">【 man_install3_step1]] 确保为 node3 预留机架空间。</block>
  <block id="773d119bfcf7806a94138f5cf32996fe" category="list-text">【第 2 步】按照适用于您的节点型号的 _Installation and Setup Instructions_ 在机架中安装 node3 。</block>
  <block id="5528857f98fded77afccd9d97a9a0711" category="list-text">【第 3 步】为节点 3 布线，将节点 1 的连接移至节点 3 。</block>
  <block id="e233e040e6ab1ade1870396947dd6b5a" category="admonition">您可能不需要将互连卡或集群互连缆线连接从 node1 移至 node3 ，因为大多数平台型号都具有唯一的互连卡型号。对于 MetroCluster 配置，您需要将 FC-VI 缆线连接从 node1 移至 node3 。如果新主机没有 FC-VI 卡，则可能需要移动 FC-VI 卡。</block>
  <block id="63cc66bd900313017fb0834b1cbbbc81" category="list-text">【 man_install3_step4]] 打开 node3 的电源，然后在控制台终端上按 Ctrl-C 以访问启动环境提示符，从而中断启动过程。</block>
  <block id="6c2cb2a49908831d5791f25bb5371a3d" category="list-text">如果您在中看到警告消息，则需要执行以下操作 <block ref="189d751c0d059b7e2fcaef080c81111f" category="inline-xref-macro-rx"></block>，执行以下操作：</block>
  <block id="7efd430adfeaf9ea4f3e48e21d2c4f96" category="admonition">* 注意 * ：请勿覆盖此延迟；如果不允许电池充电，可能会导致数据丢失。</block>
  <block id="5b8c681411bac96a813b6b62eba17d9c" category="list-text">【 man_install3_step6]] 执行以下操作之一：</block>
  <block id="ad9768b53d0a33cd1368bd0b1d373a3b" category="cell">跳过第 7 步到第 12 步，然后转到 <block ref="85131af613f0169831e213f11ca11041" category="inline-xref-macro-rx"></block>。</block>
  <block id="6dd9e2c232d9aa889adc2bdc1d259396" category="list-text">转至 <block ref="fae618cfa140cbca52d057afef5df1da" category="inline-link-macro-rx"></block> 并完成各小节 <block ref="b874d68563e926f19d0f15015f15f190" category="inline-link-macro-rx"></block> 和 <block ref="a9e7644d0d01665bbdf613cdb831fa7f" category="inline-link-macro-rx"></block>，根据您的系统情况而定。</block>
  <block id="66b6cfbf89b613b9a80d84ec1d7b5fa0" category="list-text">返回到此部分，完成从开始的其余步骤 <block ref="239474d202713b3a406727408fd68f72" category="inline-xref-macro-rx"></block>。</block>
  <block id="120d825f771126cb963c76c2ff005e6d" category="list-text">【 man_install3_step7]] 将新节点的 FC 启动程序端口添加到交换机分区。</block>
  <block id="12aae7624013a12c0ade8f6f2e309d62" category="paragraph">如果您的系统具有磁带 SAN ，则需要对启动程序进行分区。有关说明，请参见存储阵列和分区文档。</block>
  <block id="0dd10d8b45274d5c198af78bfab2e446" category="list-text">【 man_install3_step8]] 将 FC 启动程序端口作为新主机添加到存储阵列，将阵列 LUN 映射到新主机。</block>
  <block id="5cca5c853f000ca16ba17533a6116cd7" category="list-text">[[man_install3_step9]] 修改与存储阵列上的阵列 LUN 关联的主机或卷组中的全球通用端口名称（ WWPN ）值。</block>
  <block id="6a81c1ece5ddd721a1ff7521454f87c9" category="list-text">如果您的配置使用基于交换机的分区，请调整分区以反映新的 WWPN 值。</block>
  <block id="fa1040cb978ca2065cad32e28e6d9d58" category="list-text">[[man_install3_step11]] 验证阵列 LUN 现在是否对 node3 可见：</block>
  <block id="d8096974edc78f9fe2db726869876695" category="paragraph">系统将显示每个 FC 启动程序端口可见的所有阵列 LUN 。如果阵列 LUN 不可见，您将无法在本节稍后将磁盘从 node1 重新分配到 node3 。</block>
  <block id="b69192040391e08f61402b09c27822b8" category="list-text">【 man_install3_step12]] 按 Ctrl-C 显示启动菜单并选择维护模式。</block>
  <block id="fe85761838c7d215174afe4ace6c66f0" category="list-text">在维护模式提示符处，输入以下命令：</block>
  <block id="907c22891918b5b80e66731ae6eed77e" category="list-text">【 man_install3_step14]] 执行以下操作之一：</block>
  <block id="8b2f23f3c3f7445164b524932e61d65b" category="cell">如果要升级到的系统位于 ...</block>
  <block id="1f00007c6687ede4ed2d2b6e91ce451d" category="cell">双机箱配置（控制器位于不同机箱中）</block>
  <block id="1ec921c80439dda2ee883653fa1acb7b" category="cell">转至 <block ref="4332c8cc4c85f33bda2a347fe16e2dc6" category="inline-xref-macro-rx"></block>。</block>
  <block id="0471a95f16e566048e66f2d81f432967" category="cell">单机箱配置（控制器位于同一机箱中）</block>
  <block id="0aaa18e158b2b22ed630223549710480" category="list-text">将控制台缆线从 node3 切换到 node4 。</block>
  <block id="ffb09ffc35bea252e4e21d97d6400ddf" category="list-text">打开 node4 的电源，然后在控制台终端按 Ctrl-C 以访问启动环境提示符，从而中断启动过程。</block>
  <block id="85418bdb866bf209cc89fc9250fd0f04" category="paragraph">如果两个控制器位于同一机箱中，则应已打开电源。</block>
  <block id="0f26d4df0f59d99659fc6ffdd8539aff" category="paragraph">* 注 * ：在启动环境提示符处保留 node4 ；您将返回到中的 node4 <block ref="f326c815b47f4f2909494bae5cd735d5" category="inline-link-macro-rx"></block>。</block>
  <block id="620bed07fd84663ccd35004111b0a13c" category="list-text">如果您在中看到警告消息，请执行此操作 <block ref="189d751c0d059b7e2fcaef080c81111f" category="inline-xref-macro-rx"></block>，按照中的说明进行操作 <block ref="593996bb06ec10671cada9089fb35dd4" category="inline-xref-macro-rx"></block></block>
  <block id="a70d58ca96ede2bc6122de5eaba9afaf" category="list-text">将控制台缆线从 node4 切回到 node3 。</block>
  <block id="7c0d2cf152b2cde561a140a996176952" category="list-text">【 man_install3_step15]] 为 ONTAP 配置 node3 ：</block>
  <block id="7238df7481760a2449dc9206c452edfe" category="list-text">`s此配置正在使用 NetApp 存储加密（ NSE ），则必须将` etenv bootarg.storageencryption.support `命令设置为` true `，并将 kmip.init.maxwait` `变量设置为` off ，以避免在加载 node1 配置后出现启动环路：</block>
  <block id="0546806bd19b344e7d0ca13460d96992" category="list-text">【 ｛ man_install3_step17]] 如果 node3 上安装的 ONTAP 版本与 node1 上安装的 ONTAP 9 版本相同或更高，请列出磁盘并将其重新分配给新的 node3 ：</block>
  <block id="7ce11de7229520360ee33defaf28ec82" category="admonition">* 警告 * ：如果此新节点曾在任何其他集群或 HA 对中使用过，则必须运行 `wipeconfig` 才能继续。否则可能会导致服务中断或数据丢失。如果先前使用了替代控制器，请联系技术支持，尤其是在这些控制器运行的是在 7- 模式下运行的 ONTAP 时。</block>
  <block id="b04b66d312941ba2b1d5910ec5f5fb36" category="list-text">【 man_install3_step18]] 按 CTRL-C 显示启动菜单。</block>
  <block id="7be8c6136747afe24ab6f25f931c2451" category="list-text">[[man_install3_step19]] 执行以下操作之一：</block>
  <block id="b65dee077de24058e64aa96e60e2a56a" category="cell">node3 上的 ONTAP 版本是否正确或最新</block>
  <block id="a17dd4e0d7995e108ec012fad7f027d2" category="cell">转至 <block ref="f66707bf1ec53e37a427dd9510962619" category="inline-xref-macro-rx"></block>。</block>
  <block id="de22fad1fba6c28f624ef4e272674d1c" category="cell">node3 上的 ONTAP 版本正确或最新</block>
  <block id="46f709b9c191a3a487187b13c2365dfb" category="cell">转至 <block ref="c27981c94d7a26c42c925c89e96e7aa2" category="inline-xref-macro-rx"></block>。</block>
  <block id="fd96d8e5cccd1d83cf17d6327a03d1c6" category="list-text">【 man_install3_step20]] 通过选择以下操作之一来配置网络启动连接。</block>
  <block id="4c1c25953b4f042240caac106d2566d7" category="admonition">您应使用管理端口和 IP 作为网络启动连接。请勿使用数据 LIF IP ，否则在执行升级期间可能会发生数据中断。</block>
  <block id="5de475f75526f08af360b918b25d9c72" category="cell">在启动环境提示符处输入以下命令，以自动配置连接： `ifconfig e0M -auto`</block>
  <block id="8348f733ee288862d85696832806d154" category="cell">在启动环境提示符处输入以下命令以手动配置连接： `ifconfig e0M -addr=filer_addr -mask=netmask -gw=gateway -dns=dns_addr domain=dns_domain` `filer_addr` 是存储系统的 IP 地址。`netmask` 是存储系统的网络掩码。`gateway` 是存储系统的网关。`dns_addr` 是网络上名称服务器的 IP 地址。`dns_domain` 是域名服务（ DNS ）域名。如果使用此可选参数，则无需在网络启动服务器 URL 中使用完全限定域名；您只需要服务器的主机名。* 注 * ：接口可能需要其他参数。有关详细信息，请在固件提示符处输入 `help ifconfig` 。</block>
  <block id="c6515be7805d880dbdafbd44b289b127" category="list-text">【 man_install3_step21]] 对 node3 执行网络启动：</block>
  <block id="060bac7551430a178937e2648b5887ad" category="cell">`netboot \http://web_server_ip/path_to_webaccessible_directory/netboot/kernel`</block>
  <block id="00b4984c2d25fdcefc8d29921eef1f1e" category="cell">`netboot \http://web_server_ip/path_to_webaccessible_directory/ontap_version_image.tgz`</block>
  <block id="59dc84b79b5b387630517d0425882b8b" category="paragraph">`path_to_the_web-accessible_directory` 应指向下载 `ontap_version_image.tgz` 的位置 <block ref="d7ca8bd1bdacba48998a89c59527e756" category="inline-link-macro-rx"></block> 在 _prepare for netboot_ 一节中。</block>
  <block id="2fb52103bc9daf7b4aede017a96951c9" category="list-text">在启动菜单中，选择选项 * （ 7 ）首先安装新软件 * 。</block>
  <block id="69a0e067620a40fba4263752d3fe4568" category="paragraph">注意适用场景可无中断升级 ONTAP ，而不是升级控制器。</block>
  <block id="f830f5c2c7020add65334fcbe428e442" category="admonition">请始终使用 netboot 将新节点更新为所需映像。如果使用其他方法在新控制器上安装映像，则可能安装了错误的映像。此问题描述适用场景是 ONTAP 的所有版本。</block>
  <block id="04099f33ed449c6b9e9de3b50608f5b9" category="list-text">如果系统提示您继续运行操作步骤，请输入 `y` ，并在系统提示您输入软件包时输入以下 URL ：</block>
  <block id="3c0f763f2bc1dd7e6fadcfba8981f852" category="paragraph">` http://web_server_ip/path_to_web-accessible_directory/ontap_version_image.tgz`</block>
  <block id="2c7541d49584476284eeeb476f886996" category="list-text">[[man_install3_step24]] 完成以下子步骤：</block>
  <block id="f5344ffb10f5a3797c46c51d263a2247" category="list-text">【 man_install3_step25]] 输入 `5` 以选择 * （ 5 ）维护模式启动 * ，然后在系统提示您继续启动时输入 `y` 。</block>
  <block id="785f077ce03eca259bde1ebc98236191" category="list-text">【 man_install3_step26]] 继续操作前，请转到 <block ref="fae618cfa140cbca52d057afef5df1da" category="inline-link-macro-rx"></block> 对节点上的 FC 或 UTA/UTA2 端口进行任何必要的更改。</block>
  <block id="28d8bed0b221acc406520dd121da3607" category="paragraph">按照这些部分中的建议进行更改，重新启动节点并进入维护模式。</block>
  <block id="3c2b28e2fbf2a2223e837ab88d03f849" category="list-text">【 man_install3_step27]] 找到 node3 的系统 ID ：</block>
  <block id="5f2c6daaf0c238ad93e5125dbf2761ac" category="admonition">输入命令后，您可能会看到消息 `disk show ： no disks match option -a` 。此消息不是错误消息，因此您可以继续使用操作步骤。</block>
  <block id="11856588314d0c959b2b916a938edde8" category="inline-link-macro">将非根聚合从 node1 重新定位到 node2</block>
  <block id="5193fe09e1ceefb41d5d867b112b9d76" category="list-text">【 man_install3_step28]] 重新分配 node1 的备用磁盘，属于根的所有磁盘以及先前未重新定位到 node2 的任何非根聚合 <block ref="b90d8347ded957c31748eee44116abad" category="inline-link-macro-rx"></block>。</block>
  <block id="e58f70cf5e99e435b7646dac5761bf14" category="paragraph">根据您的系统是否具有共享磁盘，输入 `disk reassign` 命令的适当格式：</block>
  <block id="b7e4748ce69e686648ca756a108c4b9a" category="cell">磁盘类型</block>
  <block id="7dcd3c42056665a1fe2861837141a4ef" category="cell">然后运行命令 ...</block>
  <block id="0750281966aad85c85445c89d7c91b52" category="cell">`dreassign -s node1_sysid -d node3_sysid -p node2_sysid`</block>
  <block id="4f477aa8d74177d31f1821bc7c80ca24" category="cell">无共享磁盘</block>
  <block id="8afa8f9cacfed8bdd6f0488284dc4065" category="cell">`dreassign -s node1_sysid -d node3_sysid`</block>
  <block id="848124e1b504add6b8579f483956bfa5" category="paragraph">对于 `node1_sysid` 值，请使用中捕获的信息 <block ref="111c70a978efb37ba3bd0ea564da1d79" category="inline-link-macro-rx"></block>。要获取 `node3_sysid` 的值，请使用 `ssysconfig` 命令。</block>
  <block id="fa1b01822fe176dec2ddb8bb6b318a7d" category="paragraph">使用 `disk reassign` 命令仅重新分配 `node1_sysid` 为当前所有者的磁盘。</block>
  <block id="41ba4da5f40ea13d5dbc91aee57574fa" category="list-text">【 man_install3_step29]] 输入 `n` 。</block>
  <block id="fa85c8699d7f56dacbb4e8faea6f7ca9" category="list-text">【 man_install3_step30]] 输入 `y`</block>
  <block id="3048e99df5c1d939bc99597cf7c39563" category="list-text">【 man_install3_step31]] 输入 `y` 。</block>
  <block id="fae6f0fa0e0d1485407928519885a027" category="list-text">【 ｛ man_install3_step32]] 如果要从具有外部磁盘的系统升级到支持内部和外部磁盘的系统（例如， AFF A800 系统），请将 node1 聚合设置为 root ，以确保 node3 从 node1 的根聚合启动。</block>
  <block id="d3d32ef75ce9ff503846dd7cba71bf68" category="admonition">* 警告 * ：您必须按所示的确切顺序执行以下子步骤；否则可能发生原因会导致中断甚至数据丢失。</block>
  <block id="78eac47117b1548ba46bbe2c967c2d0e" category="list-text">如果需要，将 node1 聚合置于联机状态：</block>
  <block id="166de6b414dfe6910615ee231f5b5ac9" category="paragraph">`aggr_online root_aggr_from_node1`</block>
  <block id="ac66c3891b6bd6651ca36713f2cbc96d" category="list-text">阻止 node3 从其原始根聚合启动： `aggr offline root_aggr_on_node3`</block>
  <block id="4b869d3d95b4e6c45358c7bc8e4b934b" category="paragraph">`aggr options &lt;aggr_from_node1&gt; root`</block>
  <block id="b954307d2b22ae21f23dbb0d3021f158" category="list-text">【 man_install3_step33]] 验证控制器和机箱是否配置为 `ha` ：</block>
  <block id="87e6946315bfe910b90ed3288541cb11" category="paragraph">以下示例显示了 ha-config show 命令的输出：</block>
  <block id="9ed2f003b53007950b273f820637f2f3" category="paragraph">系统会在 PROM 中记录它们是采用 HA 对还是独立配置。独立系统或 HA 对中的所有组件的状态都必须相同。</block>
  <block id="915fe2ff566601b3b69119813a6a715c" category="paragraph">如果控制器和机箱未配置为 "ha" ，请使用以下命令更正配置：</block>
  <block id="43a7c5c250e7fdd6688e153749ea1e66" category="list-text">【 man_install3_step34]] 销毁 node3 上的邮箱：</block>
  <block id="8d299662551d8d2c41258f4f6d6c9a12" category="paragraph">控制台将显示以下消息：</block>
  <block id="675438e125383dfd4814c428aefc13d8" category="list-text">【 man_install3_step35]] 在提示符处输入 `y` 确认您要销毁本地邮箱。</block>
  <block id="0f364398a13cd3160c5a3eba4374e4ce" category="list-text">【 man_install3_step36]] 退出维护模式：</block>
  <block id="6c2cda43f17004428fa50b03b8e373c3" category="list-text">在 node2 上，检查系统日期，时间和时区：</block>
  <block id="dd26f958a5b55f32337b614d1f3ab0b4" category="list-text">【 ｛ man_install3_step38]] 在 node3 上，在启动环境提示符处检查日期：</block>
  <block id="0c06e4208a8e928e9b4bef1d6977045b" category="list-text">【 man_install3_step39]] 如有必要，请在 node3 上设置日期：</block>
  <block id="837e654f683f43c3c5fa5a8cbc3e1758" category="list-text">在 node3 上，在启动环境提示符处检查时间：</block>
  <block id="eddc7836dd13de8cd3248be302e5a1a2" category="list-text">【 man_install3_step41]] 如有必要，请在 node3 上设置时间：</block>
  <block id="39556538db3e5f05fbb53219f4983f96" category="inline-xref">第 28 步</block>
  <block id="7485a5597807044bfa9f5d885f51e65e" category="list-text">【 man_install3_step42]] 验证配对系统 ID 是否设置正确，如中所述 <block ref="a332b57e87c8a775e38e07b999240874" category="inline-xref-macro-rx"></block> 在 -p 开关下：</block>
  <block id="ec135f98d38764e511e3c524db87080e" category="list-text">如果需要，请在 node3 上设置配对系统 ID ：</block>
  <block id="7cab439150d9019f1bfd1705f608418d" category="list-text">【 man_install3_step44]] 在启动环境提示符处访问启动菜单：</block>
  <block id="09022876876a6198264f6a07698a4d4c" category="list-text">在启动菜单中，输入 `6` 以选择选项 * （ 6 ） Update flash from backup config* 。</block>
  <block id="e5dbae26747d85c8b1145f23fe152ba6" category="list-text">在提示符处输入 `y` 。</block>
  <block id="8a149c3025530503ca7711ed784cd091" category="paragraph">启动正常进行，然后系统会要求您确认系统 ID 不匹配。</block>
  <block id="c818f07a4851d5ab8b1a806cff312e25" category="list-text">[[man_install3_step47]] 确认不匹配，如以下示例所示：</block>
  <block id="fb74f9c51a3457e88ae16fbed6c6b978" category="paragraph">节点可能会经过一轮重新启动，然后才能正常启动。</block>
  <block id="f52332ab232b64dcde0ca0ea781c1755" category="list-text">【 man_install3_step48]] 登录到 node3 。</block>
  <block id="0d5eded42a5e8cbfa58553f5dd4cd263" category="summary">将 node2 的非根聚合重新定位到 node3 后，您现在必须将其从 node3 重新定位到 node4 。</block>
  <block id="e0aebc9247605127583b639cffd5f31e" category="doc">将 node2#8217 的非根聚合从 node3 重新定位到 node4</block>
  <block id="a6bef5c01b3429b867cf90c4a3de3fac" category="list-text">【 man_relocate_3_4_Step1]] 在任一控制器上输入以下命令，并检查输出以确定要重新定位的非根聚合：</block>
  <block id="086b43d0e04175cf8790abef24a23665" category="paragraph">`storage aggregate show -owner-name node3 -home-id node2_system_id`</block>
  <block id="d7a08960a9315fad49e6564d33d4cb9c" category="list-text">通过完成以下子步骤重新定位聚合：</block>
  <block id="8e8511da8932baf12f2a23e74d02e1c7" category="list-text">在任一节点上输入以下命令，以访问高级权限级别：</block>
  <block id="f30ab70d9dfcf364c12d5f98b0968ba7" category="paragraph">`s存储聚合重新定位 start -node node3 -destination node4 -aggregate-list aggr_name1 ， aggr_name2... -nt-controller-upgrade true`</block>
  <block id="1aa99f376709f3c0651ec2c29125ea92" category="paragraph">聚合列表是您在中获取的 node4 所拥有的聚合的列表 <block ref="ba9af23ac982f5cc7837b1ecc9c3cb47" category="inline-xref-macro-rx"></block>。</block>
  <block id="35b5d5d5526d39377fa3fde3fe0919cd" category="paragraph">重新定位在后台进行。重新定位聚合可能需要几秒到几分钟的时间。此时间既包括客户端中断，也包括非中断部分。此命令不会重新定位任何脱机或受限聚合。</block>
  <block id="edcc2ad4cfcd55c9715e9c9b93b871f5" category="list-text">【第 3 步】检查重新定位状态：</block>
  <block id="1f9c1a513cadbe90207536ee44ba50c9" category="paragraph">`storage aggregate relocation show -node node3`</block>
  <block id="435f14e8c9936aa21efde9eac795b40f" category="paragraph">重新定位聚合后，输出将显示该聚合的 `D1` 。</block>
  <block id="48cbb5f03f0f49e19a1fa9ce8f82961f" category="admonition">等待所有 node2 聚合重新定位到 node4 ，然后再继续下一步。</block>
  <block id="b81c90895c008292ba5de518bf5f82a3" category="cell">如果重新定位 ...</block>
  <block id="ffd498a9668905f8533b8e27b647969c" category="cell">所有聚合均已成功</block>
  <block id="80e9ee80960399cedd826a005aef0a59" category="cell">转至 <block ref="77e0750fdfbf6d57fd18f2bfe5d7ed8c" category="inline-xref-macro-rx"></block>。</block>
  <block id="773fa54d2a554dd5ed9a1437e409ed98" category="cell">任何聚合失败或被否决</block>
  <block id="2716a9803b0e07013e6cd314ef080ce2" category="list-text">检查 EMS 日志以了解更正操作。</block>
  <block id="434233acf6409db55ccbef4618a05f4c" category="list-text">执行更正操作。</block>
  <block id="8efb346b295cc43a0b01aa0890f6da31" category="paragraph">`s存储聚合重新定位 start -node node3 destination node4 -aggregate-list aggr_name1 ， aggr_name2... nt-controller-upgrade true`</block>
  <block id="32a147207e605041251ef80abd4e6acf" category="paragraph">聚合列表是失败或被否决的聚合的列表。</block>
  <block id="7b6a4090ff6553e6b643348d522b6560" category="list-text">输入以下命令，返回到管理员级别：</block>
  <block id="91fabe0a54e8933e0d8a78d90297363f" category="paragraph">如有必要，您可以使用以下方法之一强制执行重新定位：</block>
  <block id="fac06d8e56699ef41a841be6b176ebd7" category="list-text">覆盖否决检查：</block>
  <block id="2af820da1a1b18a7aaeb296667169248" category="paragraph">`s存储聚合重新定位 start -override-vetoes -no-controller-upgrade`</block>
  <block id="d43b683fda30183131790fb642203a1d" category="list-text">覆盖目标检查：</block>
  <block id="01c6e1a269dc83c83d6e3aa64688f33f" category="paragraph">`storage aggregate relocation start -override-destination-checks -ndocontroller-upgrade`</block>
  <block id="74e5caecf2b87f363c4a9dae7dca9c15" category="list-text">[[man_relocate_3_4_Step5]] 验证所有 node2 非根聚合是否已联机及其在 node4 上的状态：</block>
  <block id="28b5866cf6b60125947b501f1d057f36" category="paragraph">`storage aggregate show -node &lt;node4&gt; -state offline -root false`</block>
  <block id="ba83d23180997e074fb16dcfc2cd6da8" category="paragraph">node2 聚合在中的命令输出中列出 <block ref="ba9af23ac982f5cc7837b1ecc9c3cb47" category="inline-xref-macro-rx"></block>。</block>
  <block id="176e1e5a47c3db6bc56e4ccb10905065" category="list-text">如果任何聚合脱机或变为外部聚合，请对每个聚合使用以下命令将其联机：</block>
  <block id="00751ef0752943fad6f5c251990dbefb" category="list-text">验证 node2 聚合中的所有卷是否在 node4 上处于联机状态：</block>
  <block id="9fe3979261ad706bcee5b4c047e18834" category="list-text">如果 node4 上的任何卷脱机，请将其联机：</block>
  <block id="54ab7b4b354c31db3c1958974da7349a" category="list-text">向 NetApp 发送有关 node4 的升级后 AutoSupport 消息：</block>
  <block id="61be86123ac7716617c75c3d56ea68a9" category="paragraph">`ssystem node AutoSupport invoke -node node4 -type all -message "node2 successfully up级 从 platform_old 升级到 platform_new"`</block>
  <block id="9b06ee736f73d9cf0dfedcd1bbba712a" category="summary">操作步骤的多个阶段可能会出现问题。</block>
  <block id="01f65b0ce58a361a4bddaba0ba5ccd2c" category="summary">使用 Config Advisor 检查常见配置错误。</block>
  <block id="9fe5e1c0bb75be0e3f5f145103e72caa" category="cell">ONTAP 9.5 或更早版本</block>
  <block id="6bdf9080f49ca89e65220e312d51e688" category="list-text">使用以下命令添加密钥管理服务器：</block>
  <block id="0dd9d4ff0944e970430f96022e169191" category="list-text">使用以下命令验证是否已成功添加密钥管理服务器：</block>
  <block id="3bf7f9a82df0c130b46780052ca49e4c" category="list-text">使用以下命令在新节点上启动密钥管理服务器设置向导：</block>
  <block id="ce647643e8b085a9425f156173190659" category="list-text">还原外部密钥管理器（ EDD ）的身份验证：</block>
  <block id="a5e463e5138622ba8c2355b41f67a0ff" category="paragraph">此命令需要板载密钥管理器（ OKM ）密码短语</block>
  <block id="ce4c94d5e669859aacda58a7f2429ddf" category="cell">所有其他 ONTAP 版本</block>
  <block id="841196916665de2571df2fa230353881" category="paragraph">检查是否有任何卷因身份验证密钥不可用或无法访问外部密钥管理服务器而脱机。使用以下命令将这些卷恢复联机：</block>
  <block id="6d507e4601f1378ea8dbc7446cb265dd" category="paragraph">`卷联机`</block>
  <block id="445e5f2d7a321b9e55c018341b3460e3" category="summary">将节点 1 的资源移至节点 3 之前，请先将非根聚合从节点 1 移至节点 2 。</block>
  <block id="c8e5788139bcf856c78024561a09d301" category="paragraph">在将 node1 替换为 node3 之前，您需要先使用 storage aggregate relocation 命令将非根聚合从 node1 移动到 node2 ，然后再验证重新定位。</block>
  <block id="fedb2a32e0130d4ae814cd5cc418f72f" category="list-text">【第 1 步】通过完成以下子步骤重新定位非根聚合：</block>
  <block id="825e41d7fbc98709f251a794a6b6711e" category="paragraph">`storage aggregate relocation start -node &lt;node1&gt; -destination &lt;node2&gt;-aggregate-list * -no-controller-upgrade true`</block>
  <block id="9cac941a6d5ae11593b2f268722b37cf" category="paragraph">重新定位将在后台进行。重新定位聚合可能需要几秒到几分钟的时间。时间包括客户端中断和非中断部分。此命令不会重新定位任何脱机或受限聚合。</block>
  <block id="db3c32b2915aa7ffd2fcacb5e017dbc9" category="list-text">在 node1 上输入以下命令，以检查重新定位状态：</block>
  <block id="716079406663f621295f101d9a247a06" category="paragraph">`storage aggregate relocation show -node node1`</block>
  <block id="d550e31a6ccbb056c2d7ab1e68692363" category="admonition">等待 node1 拥有的所有非根聚合重新定位到 node2 ，然后再继续下一步。</block>
  <block id="b77ef5d765d72155b0da6da7cb47f0ed" category="cell">如果重新定位 ...</block>
  <block id="b15b9b498c001e92853f9fea21ef7ef8" category="cell">那么 ...</block>
  <block id="a0fba600b5c045fae79ae007d77c6f09" category="cell">所有聚合均已成功</block>
  <block id="2ac86beb93582e4754639412014b59eb" category="cell">转至 <block ref="449ef68af8e0094cdf2287c1416d1ff3" category="inline-xref-macro-rx"></block>。</block>
  <block id="1141d7067c13df20d6186fc00309e10b" category="cell">任何聚合出现故障或被否决</block>
  <block id="642f5c5e7ce4f58241664b57c66dae22" category="list-text">重新定位任何出现故障或被否决的聚合： `storage aggregate relocation start -node &lt;node1&gt; - destination &lt;node2&gt; -aggregate-list * -no-controller-upgrade true`</block>
  <block id="9eb367512ec712e8def159a017644487" category="list-text">返回到管理员级别： `set -privilege admin` 如有必要，您可以使用以下方法之一强制执行重新定位：</block>
  <block id="a927bee35dc67490b39aa8c4291ca745" category="list-text">覆盖否决检查： `s存储聚合重新定位 start -override-vetoes true -no-controller-upgrade`</block>
  <block id="592a7b363e77ec54f4a9454a15b2fa70" category="list-text">覆盖目标检查： `s存储聚合重新定位 start -override-destination-checks true -no-controller-upgrade`</block>
  <block id="dc1c151c89f0b15dbd97af39108f3403" category="list-text">[[man_relocate_1_2_step4]] 验证所有非根聚合是否均已联机及其在节点 2 上的状态：</block>
  <block id="5614977b273243c18da92e09a399f4ff" category="list-text">在 node2 上输入以下命令并检查其输出，以验证 node2 上的所有卷是否联机：</block>
  <block id="c5fde6e8a15ba7f224d13ea83e3c2c34" category="paragraph">可在上一个 `volume show` 命令的输出中找到与此命令结合使用的 `vserver-name` 。</block>
  <block id="9b65be5be5396e39e6973853034324bc" category="list-text">在 node2 上输入以下命令：</block>
  <block id="8976f4697be8e317a4fb1b4403b3fb59" category="paragraph">`storage failover show -node node2`</block>
  <block id="7fb67b5bff7cd5b5583c80436154eeca" category="paragraph">输出应显示以下消息：</block>
  <block id="bc50ecc4b8edbc1374bfa0e110d2cdf4" category="list-text">验证 node1 不拥有任何联机的非根聚合：</block>
  <block id="388b62ec918acf6b46e5c8dc7c42fc85" category="paragraph">`storage aggregate show -owner-name &lt;node1&gt; -ha-policy sfo -state online`</block>
  <block id="e68954fba0117f19310a10c0e5f075ec" category="paragraph">输出不应显示任何已重新定位到 node2 的联机非根聚合。</block>
  <block id="ba458deec9dfb2a7a6b805fd931809ec" category="summary">持久禁用网络结构中的交换机，以便修改其配置。</block>
  <block id="81a9550623341df13e0aba0c1ee5a8fb" category="doc">永久禁用交换机</block>
  <block id="54df0e073e21c236c69bb55be46a0eef" category="paragraph">您必须持久禁用网络结构中的交换机，以便修改其配置。</block>
  <block id="ede6141978802cdf393c52a40bfc7002" category="paragraph">您可以通过在交换机命令行上运行命令来禁用交换机；用于此操作的命令不是 ONTAP 命令。</block>
  <block id="f93acf16d7cf836bd48acbaead6bc9d8" category="paragraph">持久禁用交换机：</block>
  <block id="616a5e8ee58c5b9f34f27c22233e48ac" category="list-text">对于 Brocade 交换机，请使用 `sswitch/CfgPersistentDisable` 命令。</block>
  <block id="cc28c008eb62a2601a150836c9ef2378" category="list-text">对于 Cisco 交换机，请使用 `susPEND` 命令。</block>
  <block id="1e4597321089186160edaf9ec94c2070" category="paragraph">以下命令将持久禁用 Brocade 交换机：</block>
  <block id="b537a2a134134343c8340992032bb870" category="paragraph">以下命令将禁用 Cisco 交换机：</block>
  <block id="3ff86f1d489dba494d0e4fab1e944c41" category="summary">升级后，如果您使用的是 MetroCluster 配置，则 FC 逻辑接口（ LIF ）可能会留在不正确的端口上。</block>
  <block id="5558cf6a71b5cb1c7c5c61639dd48b9f" category="doc">升级后， LIF 位于无效端口上</block>
  <block id="5f1f479c27b40118bdce39d08fd87e39" category="paragraph">升级完成后，如果您使用的是 MetroCluster 配置，则 FC 逻辑接口（ LIF ）可能会留在不正确的端口上。您可以执行重新同步操作，将 LIF 重新分配给正确的端口。</block>
  <block id="c5f17233f63f2587b0691c2790a00316" category="list-text">输入 `MetroCluster vserver resync` 命令将 LIF 重新分配到正确的端口。</block>
  <block id="23db613fe78f6fba7d382ce732422d2c" category="paragraph">`MetroCluster vserver resync -vserver vserver_name fcp-mc.headupgrade.test.vs`</block>
  <block id="eacdded8804b215d1278d1f1517a38f0" category="paragraph">在第 6 阶段，您可以确保正确设置新节点。如果其中一个新节点具有统一目标适配器，则必须还原任何端口配置，并且可能需要更改适配器的个性化设置。如果新节点启用了加密，则还应设置存储加密。您还应停用旧节点。</block>
  <block id="032dca1d1948f05a9689c44bc451998e" category="list-text"><block ref="032dca1d1948f05a9689c44bc451998e" category="inline-link-macro-rx"></block></block>
  <block id="94c0a6a874300fcf012d00a23a1b673f" category="list-text"><block ref="94c0a6a874300fcf012d00a23a1b673f" category="inline-link-macro-rx"></block></block>
  <block id="99e7affbbaa2d2ad68e17e63cdb49fd8" category="list-text"><block ref="99e7affbbaa2d2ad68e17e63cdb49fd8" category="inline-link-macro-rx"></block></block>
  <block id="db8240142a1ffdbfbb676c4fa3739110" category="list-text"><block ref="db8240142a1ffdbfbb676c4fa3739110" category="inline-link-macro-rx"></block></block>
  <block id="2aa8840f67cce6d93538336610f05560" category="summary">安装并启动 node4 后，您需要验证是否已正确安装它</block>
  <block id="c1b0decfff03539572f29fa76c9fa6a8" category="list-text">在系统提示符处，登录到 node4 。</block>
  <block id="3be6725513a330b5d11f9b5f7999fb8b" category="list-text">验证 node4 是否与 node3 位于同一集群中且运行状况良好：</block>
  <block id="85d0ae2423c3b64edbdd304078db296d" category="list-text">验证 node4 是否可以与 node3 通信以及所有 LIF 是否均已启动：</block>
  <block id="c4a2e3badecabb56a51a541bd0b31167" category="paragraph">`network interface show -curr-node node4`</block>
  <block id="a977a3a71a2db8bc73e5bd38f68aa82d" category="cell">如果 node4 为 ...</block>
  <block id="4acd31ec7c5bc2e4aa0a25c4c79958d6" category="cell">位于与 node3 不同的机箱中</block>
  <block id="b5c12383845491dd07b053068802e47c" category="paragraph">通过完成以下步骤在节点之间连接 HA 互连：</block>
  <block id="64764fe30a19213c6eca8ee4dc0abe64" category="list-text">将 node3 的顶部互连端口连接到 node4 的顶部互连端口。</block>
  <block id="d32a43feea6183c721d8fb1e167ffba4" category="list-text">将 node3 的底部互连端口连接到 node4 的底部互连端口。</block>
  <block id="2b7d6e150b1ad9a7324920d58add53e8" category="list-text">转至 <block ref="41c022824608ca37267e3212853fde36" category="inline-xref-macro-rx"></block>。</block>
  <block id="02bbb5b96351de7fa7429d251ff6aa5a" category="cell">与 node3 位于同一机箱中</block>
  <block id="88365b6e3e2809b970dbfedc2b94e36f" category="cell">转至 <block ref="41c022824608ca37267e3212853fde36" category="inline-xref-macro-rx"></block>。您无需在节点之间手动连接 HA 互连；在同机箱配置中， HA 互连会通过背板自动连接。</block>
  <block id="30a868238f55d1d59e57331a33e79d19" category="list-text">【第 5 步】执行以下操作之一：</block>
  <block id="aa9eec4e05c527e3e3152695def83f22" category="cell">在 SAN 环境中</block>
  <block id="8c059d90c29a474c1e6a9e3012ec3908" category="cell">完成 <block ref="fd65cf600cef4b4bb6b03d85bec2cb92" category="inline-xref-macro-rx"></block> 然后转到部分 <block ref="433d8081a28a0d8c06bf54d23d4e1297" category="inline-link-macro-rx"></block>。</block>
  <block id="f85d6db9ec5b69c436957b687c13324c" category="cell">不在 SAN 环境中</block>
  <block id="3e86840ff7c230f787d687166a945ac9" category="cell">跳过步骤 6 转至部分 <block ref="433d8081a28a0d8c06bf54d23d4e1297" category="inline-link-macro-rx"></block>。</block>
  <block id="2e5d45b5b4c7ee72c9442a1c00ef4881" category="list-text">【第 6 步】在其中一个节点上输入以下命令，验证 node3 和 node4 是否都处于仲裁状态：</block>
  <block id="07794a041dac9632db557c4f4b050f28" category="paragraph">`event log show -messagename scsiblade.*`</block>
  <block id="340477541e5fdc93ffc7488a1377706f" category="paragraph">以下示例显示了集群中节点处于仲裁状态时的输出：</block>
  <block id="4885a30c7d2ead3e5bbc5a7722e06fbc" category="admonition">在本文档中，原始节点称为 _node1_ 和 _node2_ ，新节点称为 _node3_ 和 _node4_ 。在所述的操作步骤期间， node1 将替换为 node3 ， node2 将替换为 node4 。术语 _node1_ ， _node2_ ， _node3_ 和 _node4_ 仅用于区分原始节点和新节点。在操作步骤之后，必须替换原始节点和新节点的实际名称。但是，实际上，节点名称不会更改：在升级控制器硬件后， node3 的名称为 node1 ， node4 的名称为 node2 。本文档使用术语 _systems with FlexArray Virtualization Software_ 来指属于这些新平台的系统。它使用术语 _V 系列系统 _ 来表示可以连接到存储阵列的不同硬件系统</block>
  <block id="0bfa254225598fbe392b21d1c9315577" category="list-text">此操作步骤非常复杂，假定您具备高级 ONTAP 管理技能。您还应阅读并了解 <block ref="945806db9f0d500dce4d83fd47d362f0" category="inline-link-macro-rx"></block> 和 <block ref="25c64b56e1634b7195570b2ce4c1228b" category="inline-link-macro-rx"></block> 开始升级前的章节。</block>
  <block id="58d2951f9fe54692264bb8d42558291f" category="list-text">此操作步骤适用场景 FAS 系统， V 系列系统， AFF 系统以及安装了 FlexArray 虚拟化软件的系统。如果安装了所需的许可证，则在 ONTAP 9 之后发布的 FAS 系统可以连接到存储阵列。ONTAP 9 支持现有 V 系列系统。有关存储阵列和 V 系列型号的信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 要链接到 _V Hardware Universe 系列支持表 _ 并查看 _V 系列支持表 _ 。</block>
  <block id="e6063d0ab61b368bdfbca64be36dbd64" category="list-text">此操作步骤适用场景 MetroCluster 四节点和八节点配置运行 ONTAP 9.5 及更早版本。对于运行 ONTAP 9.6 及更高版本的 MetroCluster 配置，请转至 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到使用 " 系统控制器更换 " 命令将运行 ONTAP 9.5 的控制器硬件升级到 ONTAP 9.7_ 。</block>
  <block id="e39113763907d8d4fcba824237e156d6" category="summary">在通过网络启动系统之前，暂停所有 SnapMirror 关系。</block>
  <block id="efbf836cce2e15df96125c4c46c3e444" category="paragraph">在以网络方式启动系统之前，您必须确保所有 SnapMirror 关系均已暂停。暂停 SnapMirror 关系后，它会在重新启动和故障转移后保持静默状态。</block>
  <block id="297127a593f8f8ac2d848dfe59115f96" category="admonition">如果状态为 `transferring` ，则必须中止这些传输： `snapmirror abort -destination-vserver vserver name`</block>
  <block id="d5560010a4b579866a98e0b680b5c248" category="paragraph">如果 SnapMirror 关系未处于 `Transferring` 状态，则中止将失败。</block>
  <block id="314f1c01ca9edeb8d02ea1fa05ef2d12" category="paragraph">`snapmirror quiesce -destination-vserver vserver-name`</block>
  <block id="f412483899b7e1853a07057a10434cd1" category="summary">应用适当的 RCF 文件以重新配置交换机以容纳新节点。</block>
  <block id="240180de393c4a94b035628cb25892f2" category="paragraph">您必须应用适当的参考配置（ RCF ）文件来重新配置交换机以容纳新节点。应用 RCF 文件后，您可以对交换机进行重新布线。</block>
  <block id="6a82c384f85f037d7996beaa2d1d7d15" category="list-text">找到适用于您的配置的 RCF 文件。</block>
  <block id="220db66641d211d0d3595a586d08eda4" category="paragraph">您必须使用与您的交换机型号匹配的 RCF 文件。</block>
  <block id="5e99b4c17b283780f31b2094bd3e09d9" category="inline-link-macro">NetApp 下载：适用于 Brocade 交换机的 MetroCluster 配置文件</block>
  <block id="6b253b0e381bce06acae4fc0aba43a28" category="paragraph"><block ref="6b253b0e381bce06acae4fc0aba43a28" category="inline-link-macro-rx"></block></block>
  <block id="dfee04d58b6ccde432611ade9976f650" category="inline-link-macro">NetApp 下载：适用于 Cisco 交换机的 MetroCluster 配置文件</block>
  <block id="b48e3bcf35f27a7eb3b971e14c962a74" category="paragraph"><block ref="b48e3bcf35f27a7eb3b971e14c962a74" category="inline-link-macro-rx"></block></block>
  <block id="664250ffe3e2d310ccf75bacda9a568c" category="list-text">按照 * 下载 * 页面上的说明应用 RCF 文件，并根据需要调整 ISL 设置。</block>
  <block id="4799633d9eb6a31235d0102c0d2b1812" category="list-text">验证是否已保存交换机配置。</block>
  <block id="1dd8fdc75f0d1d8e00ce9ec094e07e48" category="list-text">按照您在中创建的布线布局，使用缆线将两个 FC-SAS 网桥连接到 FC 交换机 <block ref="1e3a603a58f58380bbf882725903f11b" category="inline-link-macro-rx"></block>。</block>
  <block id="31ff80cac58b75352ccd7cb184fd3f2f" category="list-text">验证端口是否联机：</block>
  <block id="9537b49cfa32d77c52482152d98a6cb7" category="list-text">对于 Brocade 交换机，请使用 `sswitchshow` 命令。</block>
  <block id="3f55318e22b0811a1f8462eb6d4db6a3" category="list-text">对于 Cisco 交换机，请使用 show `interface brief` 命令。</block>
  <block id="8a2a15ae261b57a2a7df03e71f7e6475" category="list-text">使用缆线将控制器中的 FC-VI 端口连接到交换机。</block>
  <block id="ca6b3b9d3521dc913cc6a3273b729760" category="list-text">从现有节点中，验证 FC-VI 端口是否联机：</block>
  <block id="823eab722f92d2115c2effb645f5bc93" category="paragraph">`MetroCluster 互连适配器 show`</block>
  <block id="39b8d1f1fde39b620b3646f81db31ad4" category="paragraph">`MetroCluster 互连镜像显示`</block>
  <block id="2b44c4a6e31759cd729ff715d14edea4" category="summary">在关闭并停用 node1 之前，您需要记录有关其集群网络，管理和 FC 端口以及 NVRAM 系统 ID 的信息。</block>
  <block id="efc5de9a5891b52ce2b37c9ed2854d5f" category="paragraph">在关闭并停用 node1 之前，您需要记录有关其集群网络，管理和 FC 端口以及 NVRAM 系统 ID 的信息。稍后将 node1 映射到 node3 并重新分配磁盘时，您需要在操作步骤中提供此信息。</block>
  <block id="b01288321618ebc4fb03d07a48ec080c" category="list-text">【第 1 步】输入以下命令并捕获其输出：</block>
  <block id="a9f729911b0af57b8d1d08f2584625b6" category="paragraph">`network route show`</block>
  <block id="db55c697ce008329c5b7d6628a252009" category="list-text">输入以下命令并捕获其输出：</block>
  <block id="743c43b069d893a88b2732926f57f5db" category="paragraph">`vserver services name-service dns show`</block>
  <block id="e06877d8614b07524debe1149bac1e78" category="list-text">[[man_record_node1_step3]] 在任一控制器上输入以下命令，以查找 node1 上的集群网络和节点管理端口：</block>
  <block id="ac1f4efe2cbbc63bd8c0842b84e1d3c8" category="paragraph">`network interface show -curr-node &lt;node1&gt; -role cluster ， intercluster ， node-mgmt ， cluster-mgmt`</block>
  <block id="2f163f9a8fcb45472b7c0a84f088f4de" category="paragraph">系统将显示集群中节点的集群，集群间，节点管理和集群管理 LIF ，如以下示例所示：</block>
  <block id="5feb72299c708ed8b5e527e5963476fe" category="admonition">您的系统可能没有集群间 LIF 。</block>
  <block id="8fac25219c50f2cc9f32de6a06dd0afa" category="list-text">捕获中命令输出中的信息 <block ref="63c89ae17921f4702dc8719a6b0480a8" category="inline-xref-macro-rx"></block> 以在部分中使用 <block ref="3b6c063a8efbc88c969c7838f0611434" category="inline-link-macro-rx"></block>。</block>
  <block id="4dea80d6ab207bc372820b8a74a583df" category="list-text">在 node1 上输入以下命令：</block>
  <block id="6516511e2cda8e73f01c2c8b9a2373b2" category="paragraph">`network port show -node &lt;node1&gt; -type physical`</block>
  <block id="c98e23a6f059dd6276dbffb11af4d53d" category="paragraph">系统将显示节点上的物理端口，如以下示例所示：</block>
  <block id="00e8b0b0df56090152aa5c1cb1bd4a45" category="paragraph">稍后，需要在操作步骤中将广播域映射到新控制器上的新端口。</block>
  <block id="5a88073443b3ca14db2fbd6903a55330" category="paragraph">`network fcp adapter show -node node1`</block>
  <block id="554c196eb9c5953b024f2cc2c07ba455" category="paragraph">系统将显示节点上的 FC 端口，如以下示例所示：</block>
  <block id="5d3cbeccba5dac0370b9c40f95d5d063" category="list-text">如果您之前没有这样做，请输入以下命令，检查 node1 上是否配置了接口组或 VLAN ：</block>
  <block id="f6f8a9635aff4aef3e52d34ba925926b" category="paragraph">您将使用部分中的信息 <block ref="3b6c063a8efbc88c969c7838f0611434" category="inline-link-macro-rx"></block>。</block>
  <block id="8c197b9ca5649983d88c28532ed4d151" category="inline-link-macro">准备要升级的节点</block>
  <block id="43ac883a14249b98283d8e22e6127ba8" category="cell">已在部分中记录 NVRAM 系统 ID 编号 <block ref="7eb7fb0c5f668aa416ee9ca8030df058" category="inline-link-macro-rx"></block>。</block>
  <block id="722b28462ad8b131d5cfd84a2c2f881a" category="cell">转到下一部分， <block ref="830cfeba72054433fc0dcccc19f6d055" category="inline-link-macro-rx"></block>。</block>
  <block id="105886469ee101bc5425140d42df484b" category="cell">未在部分中记录 NVRAM 系统 ID 编号 <block ref="7eb7fb0c5f668aa416ee9ca8030df058" category="inline-link-macro-rx"></block></block>
  <block id="1c5349057e46140156bc0d263443383c" category="cell">完成 <block ref="91d37fb83183cdc5da036c812dec4eb7" category="inline-xref-macro-rx"></block> 和 <block ref="2a3037c203afea4262e2cc05eb0708b3" category="inline-xref-macro-rx"></block> 然后继续 <block ref="830cfeba72054433fc0dcccc19f6d055" category="inline-link-macro-rx"></block>。</block>
  <block id="866ca6e46d7456a7c276afd3eb54db5d" category="list-text">【 man_record_node1_step11]] 在任一控制器上输入以下命令：</block>
  <block id="a68d4121a0f2927e059683a1133fbbe1" category="paragraph">`ssystem node show -instance -node node1`</block>
  <block id="9bcd562ef44a8e11e5fd0e0492ebe6c4" category="paragraph">系统将显示 node1 的相关信息，如以下示例所示：</block>
  <block id="5b9519c4c2b57166c18827dfa9f50f7c" category="list-text">[[man_record_node1_step12]] 记录要在部分中使用的 NVRAM 系统 ID 编号 <block ref="b27daeccf5fbd8a2e88a3636ee615b74" category="inline-link-macro-rx"></block>。</block>
  <block id="c82b6ec247fa6d7962d57a07b874b6fb" category="summary">如果 node4 具有板载 FC 端口，板载统一目标适配器（ UTA/UTA2 ）端口或 UTA/UTA2 卡。</block>
  <block id="a5eaebf8eb363498d59b7e808ae14a67" category="paragraph">您可能需要完成 <block ref="b22a2e603d310a795a7b59d2bdda39ee" category="inline-xref-macro-rx"></block>， <block ref="5752cac0a470e06ffceef40fba1931c1" category="inline-xref-macro-rx"></block>或这两个部分。</block>
  <block id="d3724945a8761461ffee756c3d88b5f7" category="paragraph">如果 node4 没有板载 FC 端口，板载 UTA/UTA2 端口或 UTA/UTA2 卡，并且您要升级具有存储磁盘的系统，则可以跳至 <block ref="fface1ac702bde6d72ceb6e55eb8b2b6" category="inline-link-macro-rx"></block>。</block>
  <block id="2f23b838fc1ce32542c8c66d9e287935" category="paragraph">但是，如果您使用的是 V 系列系统或 FlexArray 虚拟化软件并已连接到存储阵列，并且 node4 没有板载 FC 端口，板载 UTA/UTA2 端口或 UTA/UTA2 卡，则必须返回到 _Install and boot node4_ 部分并继续执行 <block ref="04be07c8b8cd85d6b2140c2bfb8113b6" category="inline-link-macro-rx"></block>。确保 node4 具有足够的机架空间。如果 node4 与 node2 位于不同的机箱中，则可以将 node4 与 node3 放在同一位置。如果 node2 和 node4 位于同一机箱中，则 node4 已位于其相应的机架位置。</block>
  <block id="3b2aededaf9eb7fa977a61a8bd235fc8" category="cell">转至 <block ref="6df4b9385815488582550ff3bec853dc" category="inline-xref-macro-rx"></block>。</block>
  <block id="d0eda6a9db5e17455c4a85cb11800962" category="cell">转至 <block ref="9afe493afbfd571f8e15cdbbaa7d8361" category="inline-xref-macro-rx"></block>。</block>
  <block id="52b26cd7e65738a95d72c027a1b843c2" category="list-text">【 man_config_4_Step2]] 访问维护模式：</block>
  <block id="bdb2780eb5f1795b94cdb7892cd5237b" category="list-text">将新节点上的 FC 设置与先前从原始节点捕获的设置进行比较。</block>
  <block id="605ac6e16f1de07910babd12f8cb0f9e" category="list-text">[[man_config_4_Step5]] 执行以下操作之一：</block>
  <block id="2f699cf77defdb8691038c3365c1e4cb" category="paragraph">`ssystem node hardware unified-connect modify -type | -t target -adapter port_name`</block>
  <block id="cf4bec74c9d6f95cb8085d8a4bfd855b" category="paragraph">`ssystem node unified-connect modify type | -t initiator -adapter port_name`</block>
  <block id="348795cf2ff362808ef4789bfce998c1" category="paragraph">` 类型` 是 FC4 类型，目标或启动程序。</block>
  <block id="2b06110f9a6a9bf3ece9e1df55274e79" category="cell">根据需要修改 node4 上的 FC 端口： `ucadmin modify -m fc -t initiator -f adapter_port_name` ` -t` 是 FC4 类型，目标或启动程序。* 注 * ：需要将 FC 端口编程为启动程序。</block>
  <block id="aa056114701909ed085099828ff012a9" category="cell">输入以下命令并检查输出，以验证新设置： `ssystem node unified-connect show`</block>
  <block id="e7df8bff382bf85b07ece9703c2f6808" category="cell">与在原始节点上捕获的相同</block>
  <block id="222214d2643fdfb746a901984df3eaaa" category="cell">转至 <block ref="313690309739126de0c32c721924102b" category="inline-xref-macro-rx"></block>。</block>
  <block id="7327bd79e6072c9ccdc2b478d3afacfb" category="cell">与您在原始节点上捕获的不同</block>
  <block id="2fe2c4e80b1376975584751f41c867c9" category="inline-xref">第 8 步</block>
  <block id="ebe743318b7324b4ebeb99a0a3c72423" category="cell">转至 <block ref="60c689da671dfc85fbc244a8ddc19d6a" category="inline-xref-macro-rx"></block>。</block>
  <block id="98570637b82059e5ffc8aa3289c7a48b" category="list-text">【 man_config_4_Step8]] 退出维护模式：</block>
  <block id="f93d9d44ef64b7bd548bb1548837f7c9" category="cell">是 V 系列系统或具有运行 Data ONTAP 8.3.0 或更高版本的 FlexArray 虚拟化软件</block>
  <block id="ae67b2e6adc83ff617429f7470e3fcf2" category="cell">在启动环境提示符处输入以下命令以访问维护模式： `boot_ontap maint`</block>
  <block id="a2aebe9559cbe6e73c0a0bf0d1bb9ef4" category="cell">不是 V 系列系统，也没有 FlexArray 虚拟化软件</block>
  <block id="1747e775d1492fb4a122964eb0ce6abd" category="cell">在启动环境提示符处输入以下命令，以启动 node4 ： `boot_ontap`</block>
  <block id="be71806e78200788394953879d8e5b6a" category="list-text">[[man_config_4_Step11]] 执行以下操作之一：</block>
  <block id="5f05ecbc9bc4d038e9ed396780511251" category="list-text">转至 <block ref="5752cac0a470e06ffceef40fba1931c1" category="inline-xref-macro-rx"></block> 如果 node4 具有 UTA/UTA2 卡或 UTA/UTA2 板载端口。</block>
  <block id="1e7bd254c963a338c489202373c4ab17" category="list-text">跳过此部分，然后转到 <block ref="fface1ac702bde6d72ceb6e55eb8b2b6" category="inline-link-macro-rx"></block> 如果 node4 没有 UTA/UTA2 卡或 UTA/UTA2 板载端口。</block>
  <block id="08b25b9ad88e79131839ab732517a679" category="list-text">转至 <block ref="5752cac0a470e06ffceef40fba1931c1" category="inline-xref-macro-rx"></block> 如果 node4 具有 UTA/ UTA2 卡或 UTA/UTA2 板载端口。</block>
  <block id="11b3cd1a1063bf814b7d2eeabae1825d" category="list-text">跳过 _Check and configure UTA/UTA2 ports on node4_ 如果 node4 没有 UTA/UTA2 卡或 UTA/UTA2 板载端口，请返回 _Install and boot node4_ 部分，然后继续执行中的部分 <block ref="04be07c8b8cd85d6b2140c2bfb8113b6" category="inline-link-macro-rx"></block>。</block>
  <block id="fe3a7dc1b68f02ec33d1b3d2d4f9bc56" category="list-text">检查 `ssystem node hardware unified-connect show` 或 `ucadmin show` 命令的输出，并确定 UTA/UTA2 端口是否具有所需的特性。</block>
  <block id="e48bdf2afbb963c9c495bf4f571895e3" category="cell">转至 <block ref="ffd96dfebf67595a1e4a6d625bee7496" category="inline-xref-macro-rx"></block>。</block>
  <block id="fa74cc012fef0feff6e924f8039749e1" category="cell">跳过步骤 5 到步骤 12 ，然后转到 <block ref="ff1d63240cee2bdc1933860b7f07a8df" category="inline-xref-macro-rx"></block>。</block>
  <block id="e6d6e537e4b0f2bf8e825c2e64f00645" category="list-text">[[man_check_4_Step5]] 执行以下操作之一：</block>
  <block id="37633c05750191dfa133d84e3b55c00e" category="cell">具有存储磁盘，并且正在运行 Data ONTAP 8.3</block>
  <block id="8445b1a045f75f905d430fc7d5f5e71c" category="cell">启动 node4 并进入维护模式： `boot_ontap maint`</block>
  <block id="6769a0fd294ca78345db234c229b8959" category="cell">转至 <block ref="2c3bbf8d53e9379a42c94980adfa90a7" category="inline-xref-macro-rx"></block>。您应已处于维护模式。</block>
  <block id="c61e8c3c627841f886b0a3031439d4ce" category="list-text">[[man_check_4_Step6]] 执行以下操作之一：</block>
  <block id="6515c49355bf1419526d1fd9c737ec8c" category="cell">UTA/UTA2 卡上的端口</block>
  <block id="eaff3678ecd6d545f7ac3a0842914aa5" category="cell">转至 <block ref="f4d4591f64bb8abe68f0b67355d1fe59" category="inline-xref-macro-rx"></block>。</block>
  <block id="4cb16c5207497dcfcaffd56afa4f1814" category="cell">跳过第 7 步，转到 <block ref="d63e67436ac7351debc07c052c32757d" category="inline-xref-macro-rx"></block>。</block>
  <block id="117986e3a34af461f5f6e6bb88045f84" category="list-text">【 man_check_4_Step7]] 如果适配器处于启动程序模式，并且 UTA/UTA2 端口处于联机状态，请使 UTA/UTA2 端口脱机：</block>
  <block id="286e43e6e6a24f0c4b7567121cef9f66" category="list-text">[[man_check_4_Step8]] 如果当前配置与所需用途不匹配，请输入以下命令根据需要更改配置：</block>
  <block id="36408e09de8feb146f54fe1e158d953d" category="list-text">` -m` 是特性模式： FC 或 10GbE UTA 。</block>
  <block id="2b96adc86d11d2a69afb2ec82da4f190" category="admonition">您需要对磁带驱动器和 FlexArray 虚拟化系统使用 FC 启动程序。您需要对 SAN 客户端使用 FC 目标。</block>
  <block id="0e0addb82f30f2aa03c68b146f054849" category="list-text">输入以下命令并检查其输出，以验证设置：</block>
  <block id="315359e3c6323d4eda359054319c0815" category="list-text">执行以下操作之一：</block>
  <block id="893a166b79c7215fddb938b9ba769f94" category="cell">是 V 系列系统或具有 FlexArray 虚拟化软件，并连接到存储阵列且运行 Data ONTAP 8.3</block>
  <block id="5ac574a53621b9436797f566cbab7941" category="cell">重新启动到维护模式： `boot_ontap maint`</block>
  <block id="5dd9d9d622ac506af56607785cc61574" category="cell">输入以下命令： `ucadmin show`</block>
  <block id="9b035cae403b89af2a989a976daad295" category="paragraph">以下示例中的输出显示， FC4 类型的适配器 "1b" 更改为 `initiator` ，适配器 "2a" 和 "2b" 的模式更改为 `CNA` 。</block>
  <block id="f8cd2564c015235fc797e229583e1023" category="list-text">【 man_check_4_Step13]] 连接端口。</block>
  <block id="439c508e4033b6c215e1a9262db35444" category="cell">转至 <block ref="fface1ac702bde6d72ceb6e55eb8b2b6" category="inline-link-macro-rx"></block>。</block>
  <block id="dbe83a6e258bdc99b8051f4d3cf01d67" category="cell">返回到 _Install and boot node4_ 部分，然后继续执行中的部分 <block ref="04be07c8b8cd85d6b2140c2bfb8113b6" category="inline-link-macro-rx"></block>。</block>
  <block id="ac9ca8960cea46ab4a0691aee572a185" category="summary">升级期间需要的工具和文档。</block>
  <block id="c3b94594408530dae098d84cd0931315" category="paragraph">要安装新硬件，您必须使用特定工具，并且在升级过程中需要参考其他文档。您还需要记录完成控制器升级所需的信息；系统会提供一个工作表来记录信息。</block>
  <block id="7fe6746d1ee4abaa26e54d04e8c73682" category="summary">使用 KMIP 服务器管理身份验证密钥。</block>
  <block id="4cd072d48be3e3705aa89a6c546ddb3c" category="paragraph">对于 ONTAP 9.5 及更高版本，您可以使用密钥管理互操作性协议（ KMIP ）服务器管理身份验证密钥。</block>
  <block id="ccf2760849fed4b6ab9ab9769103b271" category="summary">确定新控制器模块和任何新磁盘架与现有 FC 交换机之间的布线。</block>
  <block id="0d687993b6b67e20ff0472f32d9693b0" category="paragraph">您必须确定新控制器模块和任何新磁盘架到现有 FC 交换机的布线。</block>
  <block id="6485f9afbf9c5f34e988054e67e3b142" category="paragraph">必须在每个 MetroCluster 站点上执行此任务。</block>
  <block id="9abd645e397061a8e3dab1bb33124897" category="admonition">如果您的环境无法使用 RCF 进行布线，请联系技术支持。如果布线无法使用操作步骤，请勿使用此 RCF 。</block>
  <block id="35dc65c9d9d84e5e9a27d3c90d3f88d5" category="summary">在将 node2 聚合从 node3 重新定位到 node4 之前，请将 node3 上当前由 node2 拥有的 NAS 数据 LIF 从 node3 移动到 node4 ，并验证 node4 上的 SAN LIF 。</block>
  <block id="7fc2609042e15b4a3b401c8f6b7e24c1" category="paragraph">在验证 node4 安装并将 node2 聚合从 node3 重新定位到 node4 之前，您需要将 node3 上当前 node2 拥有的 NAS 数据 LIF 从 node3 移动到 node4 。您还需要验证 node4 上的 SAN LIF 。</block>
  <block id="8d20a51d0c0718e7e116461f15d49fb3" category="paragraph">在升级操作步骤期间，远程 LIF 处理 SAN LUN 的流量。升级期间，集群或服务运行状况无需移动 SAN LIF 。除非需要将 SAN LIF 映射到新端口，否则不会移动这些 LIF 。使 node4 联机后，您需要验证 LIF 是否运行正常并位于相应的端口上。</block>
  <block id="12720c14368020238cd7150824f980eb" category="list-text">通过在任一节点上输入以下命令并捕获输出，列出不属于 node3 的所有 NAS 数据 LIF ：</block>
  <block id="9482a7fa27802a7ab7e05f7ded4a42bd" category="paragraph">`network interface show -role data -curr-node node3 -is-home false`</block>
  <block id="f4f6617b632a0c1c2dc3fa9db1c234c1" category="cell">转至 <block ref="81b5453f8cd7e29a23486e4650786cf5" category="inline-xref-macro-rx"></block>。</block>
  <block id="2a0ce78ac6ca1adeedbcfa1fd0a257cc" category="cell">跳过步骤 3 ，然后转到 <block ref="945e0dec7328bd39afca611c47b45c97" category="inline-xref-macro-rx"></block>。</block>
  <block id="dac6519e0e0abeb2d86af52963ff687b" category="list-text">[[man_lif_verif_4_Step3]] 执行以下步骤，将最初位于 node2 上的接口组和 VLAN 上托管的任何 NAS 数据 LIF 从 node3 迁移到 node4 。</block>
  <block id="bea582814d8029e4e79ed1f1f67178fa" category="list-text">【 man_lif_verif_4_substepa 】通过为每个 LIF 输入以下命令，将先前属于接口组上 node2 的 node3 上托管的任何 LIF 迁移到 node4 上能够在同一网络上托管 LIF 的端口：</block>
  <block id="d78b67076b08536aa74614da580aa8e7" category="paragraph">`network interface migrate -vserver vserver_name -lif lif_name -destination-node node4 – destination-port netportsifgrp`</block>
  <block id="bb2b7d2b593abe391065563c1a991c60" category="list-text">在中修改 LIF 的主端口和主节点 <block ref="f2edbd3671dda6c8c6a0d5b9f5139a77" category="inline-xref-macro-rx"></block> 输入以下命令，将 LIF 设置为当前托管 LIF 的端口和节点，每个 LIF 设置为一次：</block>
  <block id="f3ab69d92a4ce66d6b40a6fc5ed64045" category="paragraph">`network interface modify -vserver vserver_name -lif datalif_name -home-node node4 home-port netport_ifgrp`</block>
  <block id="ca8c32ea8d9ad20129f9bd82dd476c20" category="list-text">【 man_lif_verif_4_substepc]] 通过为每个 LIF 输入以下命令，将先前属于 VLAN 端口上 node2 的 node3 上托管的任何 LIF 迁移到 node4 上能够在同一网络上托管 LIF 的端口：</block>
  <block id="ad068be6c9c7081a732def4a358736ad" category="paragraph">`network interface migrate -vserver vserver_name -lif datalif_name -destination-node node4 – destination-port netport_ifgrp`</block>
  <block id="b9698583aeb95570efa407aaaba06094" category="list-text">在中修改 LIF 的主端口和主节点 <block ref="239198568c8cd082441ca4901dc23f34" category="inline-xref-macro-rx"></block> 输入以下命令，将 LIF 设置为当前托管 LIF 的端口和节点，每个 LIF 设置为一次：</block>
  <block id="9b464868d559a5e4c0a4b39f6f928522" category="paragraph">`network interface modify -vserver vserver_name -lif datalif_name -home-node node4 home-port netport_ifgrp`</block>
  <block id="1ba9f89e7307ad05e44ad05bb958ca27" category="list-text">【 man_lif_verif_4_Step4]] 执行以下操作之一：</block>
  <block id="583ceb80a05614853a17d060bdc9978d" category="cell">完成 <block ref="24ba20dfe80c75ddf74b686c1f78edbe" category="inline-xref-macro-rx"></block> 到 <block ref="464cefb825ec041ae0f8085658a0717b" category="inline-xref-macro-rx"></block>，跳过步骤 9 并完成 <block ref="487182da65d4a8fd64dac32686f96826" category="inline-xref-macro-rx"></block> 到 <block ref="6d60445fd0a028ec8dafc7e8858e9dac" category="inline-xref-macro-rx"></block>。</block>
  <block id="407fbf8918b07e23f7ad6bd07a5d9cd9" category="cell">跳过步骤 5 到步骤 8 并完成 <block ref="95473255aa630f367ac347162090735e" category="inline-xref-macro-rx"></block> 到 <block ref="6d60445fd0a028ec8dafc7e8858e9dac" category="inline-xref-macro-rx"></block>。</block>
  <block id="b7cf099ecc920b7356c7938e36ead518" category="cell">完成 <block ref="24ba20dfe80c75ddf74b686c1f78edbe" category="inline-xref-macro-rx"></block> 到 <block ref="6d60445fd0a028ec8dafc7e8858e9dac" category="inline-xref-macro-rx"></block>。</block>
  <block id="486afcecd3768de955874ac9b04d982d" category="list-text">【 man_lif_verif_4_Step5]] 如果您的平台上的数据端口不同，请输入以下命令将这些端口添加到广播域：</block>
  <block id="0d0d30231651c6bea6f3a8ab9bef8b41" category="paragraph">`network port broadcast-domain add-ports -ipspace ipspace_name -broadcast-domain mgmt ports node ： port`</block>
  <block id="59770005b7a829dfa2de1246fe18d7ed" category="paragraph">以下示例将节点 "6280-1 " 上的端口 "e0a" 和节点 "8060-1 " 上的端口 "e0i" 添加到 IP 空间默认值中的广播域管理中：</block>
  <block id="271e5c91e502440a4641a9bc05a02df6" category="list-text">输入以下命令，将每个 NAS 数据 LIF 迁移到 node4 ，每个 LIF 一次：</block>
  <block id="159244917402d1438cdf46fe3aac9f6b" category="paragraph">`network interface migrate -vserver vserver-name -lif datalif-name -destination-node node4 -destination-port netport_ifgrp -home-node node4`</block>
  <block id="45c770ea39ce7a89e3fa87a10d51bc25" category="list-text">确保数据迁移持久：</block>
  <block id="d6454642fa6de121b504b22f0485cca0" category="paragraph">`network interface modify -vserver vserver_name -lif datalif_name -home-port netport_ifgrp`</block>
  <block id="8ad5a71314693935e3bce24596d44ef1" category="list-text">【 man_lif_verif_4_Step8]] 输入以下命令列出所有网络端口并检查其输出，以验证所有链路的状态是否为 `up` ：</block>
  <block id="2a2c5a2b5a3d8988556727450e1a29e2" category="paragraph">以下示例显示了 `network port show` 命令的输出，其中一些 LIF 已启动，另一些 LIF 已关闭：</block>
  <block id="ed11f195f4f8f4017e6e51d88466a5a2" category="list-text">【 man_lif_verif_4_Step9]] 如果 `network port show` 命令的输出显示了新节点中不可用且旧节点中存在的网络端口，请通过完成以下子步骤删除旧网络端口：</block>
  <block id="7d4a5f4bd766fdaca38d0e0f6141ee90" category="list-text">输入以下命令，输入高级权限级别：</block>
  <block id="c72099f9d20f92c2086837037b97fc90" category="list-text">为每个旧网络端口输入以下命令一次：</block>
  <block id="f624be69667373d41ab52d00b2f142d4" category="list-text">[[man_lif_verif_4_Step10]] 通过完成以下子步骤，确保 SAN LIF 位于 node4 上的正确端口上：</block>
  <block id="175804e163fef92888323305db0643d2" category="paragraph">`network interface show -data-protocol iscsi_FCP -home-node node4`</block>
  <block id="35ca9ca12f5a137b27b3f6675a68cbd9" category="list-text">如果 node4 中的任何 SAN LIF 或 SAN LIF 组位于 node2 上不存在的端口上，请输入以下命令之一将其移动到 node4 上的相应端口：</block>
  <block id="d760c0961d6b0dca026082038bc5020a" category="paragraph">`network interface modify -lif lif_name -home-port new_home_port`</block>
  <block id="8c0fbdd8434a31926cdab8193028a740" category="paragraph">`network interface modify ｛ -home-port port_on_node2 -home-node node2 -role data ｝ -home-port new_home_port_on_node4`</block>
  <block id="8bc5cf3f80ad8a49c6ada1790801222e" category="paragraph">`network interface modify -vserver vserver_name -home-port port_name -home-node node4 lif lif_name -status-admin up`</block>
  <block id="f1eab2abaeb4ee31499ddda2b6919c69" category="list-text">在任一节点上输入以下命令并检查输出，以验证是否已将任何 SAN LIF 移动到正确的端口，以及 LIF 的状态是否为 `up` ：</block>
  <block id="b0da7502535a227e64440d7a547ea6dd" category="list-text">[[man_lif_verif_4_Step13]] 如果任何 LIF 已关闭，请通过输入以下命令将 LIF 的管理状态设置为 `up` ，每个 LIF 一次：</block>
  <block id="f9758b6af31acb5b16f9295ac0f7c556" category="summary">要停用 node1 ，您需要禁用 node2 的 HA 对，正确关闭 node1 并将其从机架或机箱中卸下。</block>
  <block id="aa7894ff1a9d6e45a378e3bbe939cb80" category="list-text">验证集群中的节点数：</block>
  <block id="0520dd500d342650e01dc4a099a267bb" category="paragraph">系统将显示集群中的节点，如以下示例所示：</block>
  <block id="44fe06f5f571cfd547aa44853b8a4f9d" category="list-text">【 man_REALET_1_step2]] 根据需要禁用存储故障转移：</block>
  <block id="f4c0a7ed135e62d38e56c9a16bf13990" category="list-text">在任一节点上输入以下命令，以禁用集群高可用性：</block>
  <block id="27a8730bbe580dd65301349dcdc539f8" category="list-text">禁用存储故障转移：</block>
  <block id="1990cae950960555eed1d17b76599009" category="paragraph">`storage failover modify -node &lt;node1&gt; -enabled false`</block>
  <block id="0cf8f0e4fb23d1270d640c0a8e820f4b" category="cell">禁用存储故障转移： `storage failover modify -node &lt;node1&gt; -enabled false`</block>
  <block id="8048736d756a32521201f074d2730091" category="list-text">验证是否已禁用存储故障转移：</block>
  <block id="2adf18e995507a97d0d1e8af8c85e4f0" category="paragraph">以下示例显示了在为节点禁用存储故障转移后， `storage failover show` 命令的输出：</block>
  <block id="c4b530495164ce1eeaab4b08e9534859" category="list-text">验证数据 LIF 状态：</block>
  <block id="d95955bc6aa8350efd75d95d4bbee99b" category="paragraph">`network interface show -role data -curr-node node2 -home-node node1`</block>
  <block id="5fbed693cb6b31f11a703890fc87d45f" category="inline-link-macro">故障排除</block>
  <block id="1337205e844f111a9850e68ab7fe85fb" category="paragraph">查看 * 状态管理 /Oper* 列，查看是否有任何 LIF 已关闭。如果有任何 LIF 发生故障，请参见 <block ref="f37de8559f00b8ef58b12c6857d24513" category="inline-link-macro-rx"></block> 部分。</block>
  <block id="8405f8a611485472bfa1ab420a9a9a02" category="cell">转至 <block ref="caeb7d58e7293f2d87a762ba5d4df397" category="inline-xref-macro-rx"></block>。</block>
  <block id="a4749d514e1548558e90fda0a15746ff" category="cell">转至 <block ref="242f372e62d4ec9b0208b2bd3cc69817" category="inline-xref-macro-rx"></block>。</block>
  <block id="9cd28d632d37554bc6b8bc94ae2073e5" category="list-text">【 man_REALET_1_step6]] 访问任一节点上的高级权限级别：</block>
  <block id="fa3bee6ea4c5e23d15d4c301c3141248" category="list-text">【第 7 步】验证集群 HA 是否已禁用：</block>
  <block id="f113138c0fa8fa7f0032e6a3fdc72c0a" category="paragraph">如果尚未禁用集群 HA ，请重复此操作 <block ref="af42b54b31642eb564c9e40bb4e550a9" category="inline-xref-macro-rx"></block>。</block>
  <block id="a646d4448d74f354bb17f8dd1f3b7055" category="list-text">【 ｛ man_REALET_1_step8]] 检查 node1 当前是否持有 epsilon ：</block>
  <block id="c3eb5e5ac705b7d7ad0bcb8afd287152" category="paragraph">由于集群中的节点数可能为偶数，因此一个节点的表决权重会增加一个百分比，称为 epsilon 。请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 可链接到系统管理参考 _ 以了解详细信息。</block>
  <block id="1eca50be6c9670acdf0a0635f4b23d14" category="admonition">如果您使用的是四节点集群，则 Epsilon 可能位于集群中不同 HA 对中的节点上。</block>
  <block id="d582f21b8a69a6d942b9b1950f660f93" category="paragraph">以下示例显示 node1 持有 epsilon ：</block>
  <block id="56083d4ecb6381ba220374fe9dad2f3b" category="list-text">如果 node1 持有 epsilon ，则在节点上标记 epsilon `false` ，以便将其传输到 node2 ：</block>
  <block id="ce94642d2db6471658f082810ff26760" category="paragraph">`cluster modify -node &lt;node1&gt; -epsilon false`</block>
  <block id="c50c8db58d7cb6ecb263a833f1594cf2" category="list-text">将 epsilon `true` 标记为 node2 ，将 epsilon 传输到 node2 ：</block>
  <block id="132623365cd4f5bf09a28e344e0106d0" category="paragraph">`cluster modify -node &lt;node2&gt; -epsilon true`</block>
  <block id="6f223a55c3e4c37c6154b48d9ad6d103" category="list-text">验证是否已对 node2 进行更改：</block>
  <block id="0e3cd42cd6320745185eaab80053ad4a" category="paragraph">node2 的 epsilon 现在应为 true ， node1 的 epsilon 现在应为 false 。</block>
  <block id="f11c9613319f6e81aa0fa42fd830a1cb" category="list-text">验证设置是否为双节点无交换机集群：</block>
  <block id="f72b72c0926d6dd4d51ae53a658c3ab1" category="list-text">从 node1 提示符处暂停 node1 ：</block>
  <block id="f6c12efc36044a403873657724eb5a4a" category="paragraph">`ssystem node halt -node node1`</block>
  <block id="7d63f771d73dc7f75f06e358cd9a7510" category="admonition">* 注意 * ：如果 node1 与 node2 位于同一机箱中，请勿使用电源开关或拔下电源线来关闭机箱。如果这样做，正在提供数据的 node2 将关闭。</block>
  <block id="ecd3525fa194c253a8cabf432a4a5041" category="list-text">当系统提示您确认是否要暂停系统时，输入 `y` 。</block>
  <block id="4554f5f9818af46c131a159c2ec43887" category="paragraph">节点将停留在启动环境提示符处。</block>
  <block id="839c9527e6867357b4949b3cb19bd5a6" category="list-text">当 node1 显示启动环境提示符时，将其从机箱或机架中取出。</block>
  <block id="1ae386d38d4b2e016ff919c2da5eb601" category="list-text">如果端口的物理状态为 " 已关闭 " ，请检查网络缆线的物理连接。</block>
  <block id="f72304143acea17b5bb5c4f384fb8c44" category="paragraph">如果要升级具有内部磁盘驱动器的控制器，则需要完成多个命令并检查其输出，以确保任何内部磁盘驱动器都不包含根聚合或数据聚合。</block>
  <block id="58e9601fd22e1eb1174624568b62ceaf" category="paragraph">如果您不升级内部磁盘驱动器上具有聚合的控制器，请跳过本节并转到一节 <block ref="cd8ad1809865824065fe011b80800cd6" category="inline-link-macro-rx"></block>。</block>
  <block id="3553fa4aee6c92a690d8b3d2baf9f853" category="list-text">输入 nodeshell ，每个原始节点输入一次。</block>
  <block id="cd526e6ac745b3bc2d71e7b70ccbe24c" category="paragraph">`ssystem node run -node node_name`</block>
  <block id="4321f2c566f6fd9e0f937fb671257921" category="list-text">显示内部驱动器：</block>
  <block id="71d2d9e08815f28311d42e1fe65de729" category="paragraph">`ssysconfig -av`</block>
  <block id="1a1cbaa9026d328ea0e1db1e1d719d1e" category="paragraph">系统将显示有关节点配置的详细信息，包括存储，如以下示例所示的部分输出所示：</block>
  <block id="1cec74df52c25d24213897a006ddbc7e" category="list-text">检查 `ssysconfig -av` 命令的存储输出以确定内部磁盘驱动器，然后记录相关信息。</block>
  <block id="63590836c75e5189303be6a7e2f1c0d6" category="paragraph">内部驱动器的 ID 开头为 "00" 。"00" 表示内部磁盘架，小数点后的数字表示各个磁盘驱动器。</block>
  <block id="2581141629fb014ce68faf5b319c8a1e" category="list-text">【 man_aggr_step4]] 在两个控制器上输入以下命令：</block>
  <block id="5047ace67eeca6eaa0de7c2c565db85b" category="paragraph">系统将显示节点的聚合状态，如以下示例中的部分输出所示：</block>
  <block id="67e1c5578ec472925218b8535f73fd69" category="admonition">用于创建聚合的设备可能不是物理磁盘，而是分区。</block>
  <block id="ffdb41868fb358842d696b4ff8240d4e" category="list-text">检查 `aggr status -r` 命令的输出，以使用内部磁盘驱动器确定聚合，然后记录相关信息。</block>
  <block id="4da1edbdb956754e59f0224136b9f957" category="paragraph">在上一步的示例中， "aggr2" 使用内部驱动器，如磁盘架 ID "0" 所示。</block>
  <block id="a0baee3eabdee6658afa877291a41600" category="list-text">在两个控制器上输入以下命令：</block>
  <block id="259baa89207f2b2aded364ccd7acb88e" category="paragraph">`aggr status -y`</block>
  <block id="8248266e12181ad17765b9cf8ce40a99" category="paragraph">系统将显示聚合上卷的相关信息，如以下示例中的部分输出所示：</block>
  <block id="f8fee0808da945cb32ac4bfb7b116901" category="paragraph">根据中的输出 <block ref="fafa89bc8a6136079f9e2f0a2a127d07" category="inline-xref-macro-rx"></block> 第 6 步： aggr2 使用三个内部驱动器— "0a.00.1" ， "0a.00.3" 和 "0a.00.9" ， "aggr2" 上的卷分别为 "vol6" ， "vol5" 和 "vol14" 。此外，在步骤 6 的输出中， "aggr0" 的读数在聚合信息的开头包含 "root" 一词。这表示它包含根卷。</block>
  <block id="85eba1a1c40e954eefa7c966f21fa202" category="list-text">检查 `aggr status -v` 命令的输出，以确定属于内部驱动器上任何聚合的卷，以及这些卷中是否有任何卷包含根卷。</block>
  <block id="a0879940337c9b44fb9cad5bc9f2d541" category="list-text">在每个控制器上输入以下命令，以退出 nodeshell ：</block>
  <block id="d9f6eac526670fe9182f1a63d251a180" category="paragraph">`退出`</block>
  <block id="f5a25cddbc643e856eabde4c6ba4d2a8" category="cell">如果控制器 ...</block>
  <block id="087b658bc1f71a1f2cb5ec53fee94d23" category="cell">请勿在内部磁盘驱动器上包含任何聚合</block>
  <block id="6a58d5f6ed9134ff245eb1172f368af9" category="cell">继续执行此操作步骤。</block>
  <block id="979cce52ff595ac16546680501986d88" category="cell">包含聚合，但内部磁盘驱动器上没有卷</block>
  <block id="0b63c25d5be0c7543233464f799ff9f8" category="cell">在内部驱动器上包含非根卷</block>
  <block id="1547c14e8c3676ab43b1f9bc7b69d98d" category="cell">包含内部驱动器上的根卷</block>
  <block id="cf992e4682189e679999df1f59ac6447" category="cell">请勿继续使用此操作步骤。您可以参考来升级控制器 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _NetApp 支持站点 _ 并使用操作步骤 _ 通过移动卷 _ 在运行集群模式 Data ONTAP 的一对节点上升级控制器硬件。</block>
  <block id="dec8ae2cc1cff82c9a15f47488d0827b" category="cell">在内部驱动器上包含非根卷，您不能将这些卷移动到外部存储</block>
  <block id="823ba7326edea0fb085b50c3aab24f80" category="cell">请勿继续使用此操作步骤。您可以使用操作步骤升级运行集群模式 Data ONTAP 的一对节点上的控制器硬件并移动 volumes_ 来升级控制器。请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _NetApp 支持站点 _ ，您可以在其中访问此操作步骤。</block>
  <block id="c6b975088fd57ec819cfb2bc75820bfe" category="summary">验证切换，修复和切回操作。</block>
  <block id="b6f0d4a86d2f3bdfeeb3c7670ef7d969" category="summary">验证 node2 上的物理端口是否正确映射到 node4 上的物理端口。</block>
  <block id="632008a98e715bee32a4df8fc72ff280" category="paragraph">您需要确保 node2 上的物理端口正确映射到 node4 上的物理端口，从而使 node4 能够在升级后与集群中的其他节点以及网络进行通信。</block>
  <block id="5fca7ca4e218be9851d30cba0f329262" category="paragraph">您必须已了解有关新节点上端口的信息，要访问此信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _SIL_ Hardware Universe 。您可以使用本节后面的信息。</block>
  <block id="8897c39b9e3259e6b8f69dc05949b6b0" category="paragraph">node4 的软件配置必须与 node4 的物理连接匹配，并且必须先还原 IP 连接，然后才能继续升级。</block>
  <block id="1b10a983f98ed23432fa58568f54f671" category="paragraph">因此，如果 node2 上的物理端口不直接映射到 node4 上的物理端口，则需要更改软件配置，才能在启动后还原集群，管理和网络连接。此外，如果 node2 上的集群端口未直接映射到 node4 上的集群端口，则在重新启动时， node4 可能无法自动重新加入仲裁，直到对软件配置进行更改，以便将集群 LIF 托管在正确的物理端口上为止。</block>
  <block id="529041da4d36160525aac5502b5d8ff7" category="list-text">将 node2 ，端口，广播域和 IP 空间的所有 node2 布线信息记录在此表中：</block>
  <block id="24738875225e89a3fe6b531d598a45f9" category="paragraph">有关获取此信息的步骤，请参见 " 录制节点 2 信息 " 一节。</block>
  <block id="7974b2ee243c61270cbc49955821fd33" category="list-text">使用上表中相同的操作步骤记录节点 4 ，端口，广播域和 IP 空间的所有布线信息 <block ref="bf281b48b35a7cc176890f2be65ca906" category="inline-link-macro-rx"></block> 第节介绍了获取此信息的步骤。</block>
  <block id="4a4552a72df2a500f815fd3a0166db9c" category="list-text">通过执行以下步骤将 node4 置于仲裁状态：</block>
  <block id="3117fde9d13ce2738e8565c02388235e" category="inline-link-macro">安装并启动节点 4.</block>
  <block id="6a3f0aa15ae6d8d1023d18e294158b6d" category="list-text">启动节点 4.请参见 <block ref="2f432fc28ce55bdf3f9384f7801ca745" category="inline-link-macro-rx"></block> 以启动节点（如果尚未启动）。</block>
  <block id="8a624db640009bfcd8e57f0c71e33d5a" category="paragraph">`network port show -node -port port -fields broadcast-domain` 以下示例显示端口 "e0a" 位于 node4 上的集群域中：</block>
  <block id="8ce18e9d769ff67698580bd546d1e73d" category="admonition">对于 MetroCluster 配置，您可能无法更改某个端口的广播域，因为该端口与托管 sync-destination SVM 的 LIF 的端口相关联，并且会看到类似于但不限于以下内容的错误：</block>
  <block id="1e73d25bc38bc6b9d12b63ae78620236" category="paragraph">`MetroCluster SVM resync -vserver vserver_name`</block>
  <block id="f7a4ad3a6f0336f093379bc2fd91976c" category="paragraph">`network interface migrate -vserver cluster -lif lif_name -source-node node4 - destination-node node4 -destination-port port_name`</block>
  <block id="9d5b8b168e2bd5a1bd98e2db65454236" category="paragraph">此命令删除 node4 上的端口 "e0d" ： `network port broadcast-domain remove-ports -ipspace cluster -broadcast-domain cluster ‑ports node4 ： e0d`</block>
  <block id="fe5e57fb0ea47a7c91c6af703c5ac090" category="list-text">【 man_map_2_step5]] 调整托管集群 LIF 和节点管理 / 集群管理 LIF 的广播域。确保每个广播域包含正确的端口。如果某个端口托管 LIF 或位于 LIF 的主目录中，则无法在广播域之间移动该端口，因此您可能需要迁移和修改 LIF ，如以下步骤所示：</block>
  <block id="979cd06d4d4cd640769d9da9d1735ead" category="list-text">如有必要，请使用中所示的相同命令调整集群间广播域并迁移集群间 LIF <block ref="8ca8005a6030839efa079ea5fc0aa218" category="inline-xref-macro-rx"></block>。</block>
  <block id="7d978d05ebca2bca32b82488daa9e7db" category="list-text">如有必要，请使用中所示的相同命令调整任何其他广播域并迁移数据 LIF <block ref="8ca8005a6030839efa079ea5fc0aa218" category="inline-xref-macro-rx"></block>。</block>
  <block id="02101c48ebc568e098e7b8c3f32aa89b" category="list-text">调整所有 LIF 故障转移组： `network interface modify -failover-group failover_group -failover-policy failover_policy`</block>
  <block id="fc5f8a7ca5bfb1a8040e796e49ecaa6c" category="paragraph">以下命令会将故障转移策略设置为 `broadcast-domain-wide` ，并使用故障转移组 `fg1` 中的端口作为 LIF `data1` on `node4` 的故障转移目标：</block>
  <block id="87724d5ff91f88d675b5dc5cf4703ebb" category="paragraph">`network interface modify -vserver node4 -lif data1 failover-policy broadcast-domain-wide -failover-group fg1`</block>
  <block id="4729603c33a154fd4e1f1d49888dbeaa" category="summary">在阶段 2 中，您将 node1 聚合和 LIF 重新定位到 node2 ，记录 node1 信息，然后停用 node1 。</block>
  <block id="12398d7db543756eb9aaf57be6ee47a1" category="paragraph">在第 3 阶段，您将安装并启动 node3 ，将集群和节点管理端口从 node1 映射到 node3 ，验证 node3 安装，并将属于 node1 的数据 LIF 和 SAN LIF 从 node2 移动到 node3 。您还可以将所有聚合从 node2 重新定位到 node3 ，并将 node2 拥有的数据 LIF 和 SAN LIF 移动到 node3 。</block>
  <block id="fae618cfa140cbca52d057afef5df1da" category="list-text"><block ref="fae618cfa140cbca52d057afef5df1da" category="inline-link-macro-rx"></block></block>
  <block id="a8d507fcc05a3431c75860216853c15e" category="list-text"><block ref="a8d507fcc05a3431c75860216853c15e" category="inline-link-macro-rx"></block></block>
  <block id="2eb3ddacc3cdbca929068de80db9b0b7" category="list-text"><block ref="2eb3ddacc3cdbca929068de80db9b0b7" category="inline-link-macro-rx"></block></block>
  <block id="c67377fc77151c30a07d038922241b21" category="list-text"><block ref="c67377fc77151c30a07d038922241b21" category="inline-link-macro-rx"></block></block>
  <block id="f7afd5134081c6d88b6809aff0cfe38b" category="summary">在升级的不同阶段，系统可能会崩溃—重新启动，崩溃或重新启动。这些问题的解决方案取决于它们发生的时间。</block>
  <block id="8d2ddd9f1b9624e868ebb43ee6cda365" category="section-title">在阶段 2 期间重新启动，崩溃或重新启动</block>
  <block id="e614ebb551c0186535d784a7b48379a2" category="paragraph">崩溃可能发生在阶段 2 之前，期间或之后，在此阶段中，您可以将聚合从 node1 重新定位到 node2 ，将 node1 拥有的数据 LIF 和 SAN LIF 移动到 node2 ，记录 node1 信息并停用 node1 。</block>
  <block id="f9fc0ccdf6eca6c6dbb00170548006b8" category="section-title">在启用 HA 的情况下，节点 1 或节点 2 在第 2 阶段之前崩溃</block>
  <block id="04818410504d7e5aff0400546dfc87fe" category="paragraph">如果 node1 或 node2 在第 2 阶段之前崩溃，则尚未重新定位任何聚合，并且 HA 配置仍处于启用状态。</block>
  <block id="141bacc3e7a6f502bd3657db72437350" category="list-text">检查控制台是否存在系统可能已发出的 EMS 消息，并采取建议的更正操作。</block>
  <block id="7495ab667ca2ae1018dd9d3dd2908757" category="section-title">在 HA 仍处于启用状态的情况下，节点 1 在第 2 阶段期间或之后崩溃</block>
  <block id="6647bb8df429d773e26f287ab8630e64" category="paragraph">部分或所有聚合已从 node1 重新定位到 node2 ，并且 HA 仍处于启用状态。node2 将接管 node1 的根卷以及未重新定位的任何非根聚合。</block>
  <block id="f4b8ae37ca9898c85f5a495e29540325" category="paragraph">重新定位的聚合的所有权与因主所有者未发生更改而被接管的非根聚合的所有权相同。当 node1 进入 `Waiting for giveback state` 时， node2 将交还所有 node1 非根聚合。</block>
  <block id="91cf7a0902c4d8935fa01c715ec744dc" category="list-text">完成 <block ref="293daa0ef1b8dc10a56298f74ae852e0" category="inline-link-macro-rx"></block> 在 _relocate non-root aggregates from node1 to node2_ 一节中，再次将非根聚合从 node1 重新定位到 node2_ 。</block>
  <block id="74d5b8b871208d748fdac979190074e1" category="section-title">禁用 HA 后， Node1 会在第 2 阶段后崩溃</block>
  <block id="9ad3dc0563b6521da592666e0c96170d" category="paragraph">Node2 不会接管，但它仍在从所有非根聚合提供数据。</block>
  <block id="cf843a9114c64e407d26e842eb2aa5c2" category="inline-link-macro">意外的 "storage failover show" 命令输出</block>
  <block id="94a4747b7f624695a71106c7bd97a9c7" category="paragraph">您可能会看到 `storage failover show` 命令的输出发生一些更改，但这是典型的，不会影响操作步骤。请参见故障排除部分 <block ref="b83b9fc12613c040fac52ff371fe932a" category="inline-link-macro-rx"></block>。</block>
  <block id="15c9d515df1ae9990db781b0882abe66" category="section-title">Node2 在阶段 2 期间或之后出现故障，同时 HA 仍处于启用状态</block>
  <block id="716abd00d1127a1995735a99a806c57a" category="paragraph">node1 已将其部分或全部聚合重新定位到 node2 。已启用 HA 。</block>
  <block id="f0cdf8c3a0614c42ddbb847f4d954ecc" category="paragraph">node1 将接管 node2 的所有聚合以及它已重新定位到 node2 的任何自身聚合。当 node2 进入 `Waiting for Giveback` 状态时， node1 将交还 node2 的所有聚合。</block>
  <block id="d9cfe3ea2fdbf3c16ed9c5e72d3e656c" category="section-title">在第 2 阶段之后以及禁用 HA 后， Node2 会崩溃</block>
  <block id="60d779c99277ce73af20b8df4f5f56d7" category="paragraph">Node1 不会接管。</block>
  <block id="6cd506af8fb7a9917363ff2842c8cc31" category="paragraph">在 node2 启动期间，所有聚合都会发生客户端中断。</block>
  <block id="4fcbd6d017dc3bed8096ddf23845774a" category="list-text">继续执行节点对升级操作步骤的其余部分。</block>
  <block id="a5d750c0f90be33b555932b544614491" category="section-title">在第 3 阶段重新启动，崩溃或重新启动</block>
  <block id="c4ff6b7da7d4d6d1387161732065f7e3" category="paragraph">在第 3 阶段期间或之后立即发生故障，在此阶段中，您可以安装并启动 node3 ，将端口从 node1 映射到 node3 ，将属于 node1 和 node2 的数据 LIF 和 SAN LIF 移动到 node3 ，并将所有聚合从 node2 重新定位到 node3 。</block>
  <block id="6c6e673ed49e2d3170e896afadb82987" category="section-title">在禁用 HA 的情况下的第 3 阶段以及重新定位任何聚合之前， Node2 发生崩溃</block>
  <block id="d0dbe31475820a3a3bf65dc0bcdc3d22" category="paragraph">Node2 崩溃后 Node3 不会接管，因为 HA 已禁用。</block>
  <block id="123d371d6f3654b02ea395d3cdce7a43" category="section-title">在重新定位部分或全部聚合后，节点 2 在第 3 阶段崩溃</block>
  <block id="3312049a8df38d6a9cc500f8d982615c" category="paragraph">node2 已将其部分或全部聚合重新定位到 node3 ，而 node3 将从重新定位的聚合提供数据。HA 已禁用。</block>
  <block id="4293c82d89ec7602e20335979cb19469" category="paragraph">未重新定位的聚合会发生客户端中断。</block>
  <block id="325bf4ef0d3493b41794238266e0490a" category="list-text">完成后重新定位其余聚合 <block ref="789a9a29365551abd6a71d3f355e39cb" category="inline-link-macro-rx"></block> 到 <block ref="a9ed1005965421826d33fd16a9c02ffe" category="inline-link-macro-rx"></block> 在 _relocate non-root aggregates from node2 to node3_ 一节中。</block>
  <block id="7777ccf7f0f06dad3ffad451bb0e83b8" category="section-title">在阶段 3 以及 node2 重新定位任何聚合之前， node3 崩溃</block>
  <block id="ec2cd6235f2c50a1e7fed067fe8301f8" category="section-title">节点 3 在聚合重新定位期间的阶段 3 崩溃</block>
  <block id="bdf12c9e6bf2221b5ef584b80346aaaf" category="paragraph">如果 node2 将聚合重新定位到 node3 时 node3 崩溃，则 node2 将中止任何剩余聚合的重新定位。</block>
  <block id="5f54439349a0049ded037d046c54cb66" category="paragraph">Node2 将继续为其余聚合提供服务，但已重新定位到 Node3 的聚合会在 Node3 启动期间发生客户端中断。</block>
  <block id="e9f32c360440ff87eefc6b2ac000051b" category="list-text">完成 <block ref="a9ed1005965421826d33fd16a9c02ffe" category="inline-link-macro-rx"></block> 再次在 _relocate non-root aggregates from node2 to node3_ 一节中。</block>
  <block id="78d6fd9200a4f713a83c4db59f80581d" category="section-title">Node3 在第 3 阶段崩溃后无法启动</block>
  <block id="1f3a2d115338d5055575085be720a753" category="paragraph">由于发生灾难性故障，在第 3 阶段发生崩溃后无法启动 node3 。</block>
  <block id="50c2d2087402d2dc8c5767a6ac83e96d" category="paragraph">请联系技术支持。</block>
  <block id="cf3f87997342db92eccc23b02a73f26b" category="section-title">Node2 在第 3 阶段之后但在第 5 阶段之前崩溃</block>
  <block id="f9266620f38392278a4002882f41b801" category="paragraph">Node3 将继续为所有聚合提供数据。已禁用 HA 对。</block>
  <block id="45e4e2e875b4e69af2a57be92e35bd6d" category="section-title">Node3 在第 3 阶段之后但在第 5 阶段之前崩溃</block>
  <block id="3558827f5793acfed9bd716ccf9185d2" category="paragraph">Node3 在第 3 阶段之后但在第 5 阶段之前崩溃。已禁用 HA 对。</block>
  <block id="a7b36ae4a63894ec22ce7b4ffc1a7601" category="paragraph">所有聚合都会发生客户端中断。</block>
  <block id="dba18149d1d705af7c19dced9bbd93eb" category="section-title">在第 5 阶段重新启动，崩溃或重新启动</block>
  <block id="6faaefd8133cb9348e7c089d482c5e7d" category="paragraph">在第 5 阶段，即安装和启动 node4 ，将端口从 node2 映射到 node4 ，将属于 node2 的数据 LIF 和 SAN LIF 从 node3 移动到 node4 以及将 node2 的所有聚合从 node3 重新定位到 node4 的阶段，可能会发生崩溃。</block>
  <block id="188229afd48ed8799252ee3f4371adf0" category="section-title">Node3 在第 5 阶段崩溃</block>
  <block id="12c209a765d259bdad104c55c61bccd8" category="paragraph">node3 已将 node2 的部分或全部聚合重新定位到 node4 。Node4 不会接管，但会继续为 Node3 已重新定位的非根聚合提供服务。已禁用 HA 对。</block>
  <block id="b316707438480481b688396bee35435b" category="paragraph">其余聚合会发生中断，直到 node3 重新启动为止。</block>
  <block id="059fe117edfac83eeb29495f9fd915b7" category="list-text">重复重新定位属于 node2 的其余聚合 <block ref="21d698177270cdcc53abb50c511e3bde" category="inline-link-macro-rx"></block> 到 <block ref="c5be787c4fcfd0f49f014e8618d28c15" category="inline-link-macro-rx"></block> 在 _relocate node2 的非根聚合从 node3 重新定位到 node4_ 一节中。</block>
  <block id="a018f0afc69622b99ebe84263c79ed31" category="list-text">继续执行节点对升级操作步骤。</block>
  <block id="17772501b6724fd9858e76539d802bae" category="section-title">Node4 在第 5 阶段崩溃</block>
  <block id="ed77b7aeb374975ae2dc4f8a9a5d5551" category="paragraph">node3 已将 node2 的部分或全部聚合重新定位到 node4 。node3 不会接管，但会继续为 node3 拥有的以及未重新定位的非根聚合提供服务。HA 已禁用。</block>
  <block id="599f33809165d54cb3217e306c6f0f1f" category="paragraph">非根聚合会发生中断，直到 node4 重新启动为止，这些聚合已重新定位。</block>
  <block id="4756394ada9b0ffaa73813469d36b72d" category="list-text">重新完成属于 node2 的其余聚合的重新定位 <block ref="21d698177270cdcc53abb50c511e3bde" category="inline-link-macro-rx"></block> 到 <block ref="c5be787c4fcfd0f49f014e8618d28c15" category="inline-link-macro-rx"></block> 在 _relocate node2 的非根聚合从 node3 重新定位到 node4_ 中。</block>
  <block id="9aaef9dffcf840cad7fb0cb145740a34" category="summary">发送 node2 的 AutoSupport 消息，然后将 node2 所拥有的非根聚合重新定位到 node3 。</block>
  <block id="b8a386efa3c6aa2c0554c650dfc15d81" category="paragraph">在将 node2 替换为 node4 之前，您必须为 node2 发送 AutoSupport 消息，然后将 node2 所拥有的非根聚合重新定位到 node3 。</block>
  <block id="e4fe7514f720448bae21164b8b7a8a98" category="list-text">【第 1 步】向 NetApp 发送 node2 的 AutoSupport 消息：</block>
  <block id="088fc05a96b10d26c3f25411385117f2" category="paragraph">`ssystem node AutoSupport invoke -node node2 -type all -message "upgrading node2 from platform_old to platform_new"`</block>
  <block id="fb876532a1278ecbe2a9e2aa30ef59c2" category="list-text">验证是否已发送 AutoSupport 消息：</block>
  <block id="2e7bb8e758be89869c95ab23b96089a8" category="paragraph">`ssystem node AutoSupport show -node &lt;node2&gt;-instance`</block>
  <block id="632ce4fa5102cfac495b3c1490de0513" category="paragraph">字段 " 上次发送主题： " 和 " 上次发送时间： " 包含上次发送消息的消息标题以及消息发送时间。</block>
  <block id="872a7a7f067f5ac8e7a4df8b55cb3129" category="list-text">【第 3 步】重新定位非根聚合：</block>
  <block id="33cfec7231d81810ac482a09c5b69c00" category="list-text">列出 Node2 所拥有的聚合：</block>
  <block id="ceb3b4f875043e902ad0c2c7df540ac4" category="paragraph">`storage aggregate show -owner-name node2`</block>
  <block id="e5d22039d8dff591d18701d62fb4083d" category="list-text">启动聚合重新定位：</block>
  <block id="2a2be3ec611dd374f220ea53bd3e0758" category="paragraph">`storage aggregate relocation start -node &lt;node2&gt;-destination &lt;node3&gt;-aggregate-list * -no-controller-upgrade true`</block>
  <block id="cba3015195e189328dd15ef19c0cdcff" category="admonition">此命令仅查找非根聚合。</block>
  <block id="c3aa957126a7abd53abe73b1af74dfb8" category="paragraph">重新定位在后台进行。重新定位聚合可能需要几秒到几分钟的时间。此时间既包括客户端中断，也包括非中断部分。此命令不会重新定位任何脱机或受限聚合。</block>
  <block id="00bfced11707df12b7beabc9cb1854c6" category="list-text">返回到管理权限级别：</block>
  <block id="6b5ba31b334c119525a36a4c654c79fc" category="list-text">验证 node2 的重新定位状态：</block>
  <block id="a6f10385b3e5082eca317137f25e29be" category="paragraph">`storage aggregate relocation show -node node2`</block>
  <block id="e0b277bd202f6924948f2209a81b8cb0" category="paragraph">重新定位聚合后，输出将显示 "done" 。</block>
  <block id="5f99044f7fd5dd98c2e83408099900a7" category="admonition">您必须等待 node2 所拥有的所有聚合都重新定位到 node3 ，然后再继续下一步。</block>
  <block id="c8ee48ad015fbbcc6f1c096e31a9b081" category="cell">转至 <block ref="0d8c3ea689b325a11fe26527348a6eff" category="inline-xref-macro-rx"></block>。</block>
  <block id="12d1b6919c7c68de63bfe55847d735a3" category="cell">任何聚合失败或被否决</block>
  <block id="d6e415f41ef651a14c6408b58b5f34fa" category="list-text">显示详细的状态消息：</block>
  <block id="4382ef08403cdc87d0db14f4b0dbe621" category="paragraph">`storage aggregate show -instance`</block>
  <block id="52aa1d8f7452c944bbc112edc69d159d" category="paragraph">您还可以检查 EMS 日志以查看所需的更正操作。</block>
  <block id="64a1f8cc2ee975b38446e3b8f940164e" category="paragraph">* 注释 * ： `event log show` 命令可列出发生的任何错误。</block>
  <block id="3f8dbc42a73ae9a6487e0757b393d2fb" category="paragraph">`storage aggregate relocation start -node &lt;node2&gt;-destination &lt;node3&gt;-aggregate-list * -no-controllerupgrade true`</block>
  <block id="856f354dcadb2aef2f73a7a610300d05" category="paragraph">如有必要，您可以使用以下方法之一强制执行重新定位：</block>
  <block id="6abaecd9da93fcc5260d726fe8a8fa56" category="list-text">通过覆盖否决检查：</block>
  <block id="b62638cdb7e1a6240698379b6c81d35b" category="paragraph">`s存储聚合重新定位 start -override-vetoes true -no-controller-upgrade`</block>
  <block id="230cd704f9f55647ecfe8129ed941e8e" category="list-text">通过覆盖目标检查：</block>
  <block id="35df77bf8b92d76c3b871148e8c46c51" category="paragraph">`storage aggregate relocation start -override-destination-checks true -ndocontroller-upgrade`</block>
  <block id="329fdaa2cd3cf795781d3ee938047475" category="list-text">【 man_relocate_2_3_step6]] 验证 node3 上的所有非根聚合是否联机：</block>
  <block id="ef54d8b76027ced4d5a36092399b0849" category="paragraph">`storage aggregate show -node &lt;node3&gt; -state offline -root false`</block>
  <block id="ecc3f3e0b2ef3c70a30fe8be1af81d75" category="paragraph">如果任何聚合已脱机或变为外部聚合，则必须使其联机，每个聚合一次：</block>
  <block id="1dc7145853b865022c2423c0562bf7ed" category="list-text">验证 node3 上的所有卷是否均已联机：</block>
  <block id="8526a5587200c78144bc2d1fabd13d3a" category="paragraph">如果 node3 上的任何卷脱机，则必须使其联机，每个卷一次：</block>
  <block id="7adac7d8af549857f31077a908e21bf4" category="paragraph">`volume online -vserver vserver-name -volume volume-name`</block>
  <block id="5d28ff5ed2a011a10e2c1fd4e4e77822" category="list-text">验证 node2 不拥有任何联机非根聚合：</block>
  <block id="dcc422920951416bc8ad4e66178b7556" category="paragraph">`storage aggregate show -owner-name &lt;node2&gt;-ha-policy sfo -state online`</block>
  <block id="232cf0d45bdcae298c19689d1bf05bea" category="paragraph">命令输出不应显示联机非根聚合，因为所有非根联机聚合都已重新定位到 node3 。</block>
  <block id="b6742607d26992d00c1c286b5aa83838" category="summary">您可以使用板载密钥管理器管理身份验证密钥。</block>
  <block id="570b3bce33225ec8be6a14d8b8bfecc7" category="paragraph">您可以使用板载密钥管理器管理身份验证密钥。如果您计划使用板载密钥管理器（ OKM ），则必须在开始升级之前记录密码短语和备份材料。</block>
  <block id="775c20f6787aab41a2e8a95674e08cc7" category="list-text">验证密钥管理服务器是否可用于集群中的所有节点：</block>
  <block id="803c74f5b21c1a4dac35d85f254e7d20" category="paragraph">`storage encryption disk modify -disk * （ -data-key-id nonMSID AK ）`</block>
  <block id="71c5d3d7f0857c67830fb002783fd24e" category="paragraph">请参见一节中描述操作步骤不同阶段的表 <block ref="25c64b56e1634b7195570b2ce4c1228b" category="inline-link-macro-rx"></block>。有关可能发生的故障的信息将按操作步骤的阶段列出。</block>
  <block id="96518cf6fc4836f38d5963152c3b52fc" category="list-text"><block ref="96518cf6fc4836f38d5963152c3b52fc" category="inline-link-macro-rx"></block></block>
  <block id="b41eca4a9e61478c5412544da1b31c9f" category="list-text"><block ref="b41eca4a9e61478c5412544da1b31c9f" category="inline-link-macro-rx"></block></block>
  <block id="03f183bce69c6c170ce7d98b73a0da9b" category="list-text"><block ref="03f183bce69c6c170ce7d98b73a0da9b" category="inline-link-macro-rx"></block></block>
  <block id="bffc8177304b2cba0a93e9425c22a1b7" category="list-text"><block ref="bffc8177304b2cba0a93e9425c22a1b7" category="inline-link-macro-rx"></block></block>
  <block id="e74451404fb8d41f6db27c4f815f8cf3" category="list-text"><block ref="e74451404fb8d41f6db27c4f815f8cf3" category="inline-link-macro-rx"></block></block>
  <block id="3a6500123c2f0d42b9a5461a35feb1eb" category="summary">持久启用网络结构中的交换机 Brocade ， Cisco</block>
  <block id="2df3dd26d8dceded8e8da8277098895a" category="paragraph">您必须持久启用网络结构中的交换机。</block>
  <block id="5c399963772634ba1fc18f52ce25b7d5" category="paragraph">持久启用交换机：</block>
  <block id="1b9078b6f6fd34ef368d1162644a9f35" category="list-text">对于 Brocade 交换机，请使用 `sswitch/CfgPersistentenable` 命令。</block>
  <block id="7f53ae5380891cb24e6bd16877533f63" category="list-text">对于 Cisco 交换机，请使用 `no suspend` 命令。</block>
  <block id="b7b905c0afbdf5992546ec3f33f8507f" category="summary">在物理将 node3 和 node4 装入机架后，您可能需要对其进行网络启动。</block>
  <block id="017a287daf9403479607113762fdf28d" category="paragraph">在操作步骤中物理装入 node3 和 node4 后，您可能需要通过网络启动它们。术语 _netboot_ 表示您从远程服务器上存储的 ONTAP 映像启动。在准备网络启动时，您必须将 ONTAP 9 启动映像的副本放在系统可以访问的 Web 服务器上。</block>
  <block id="3dd228d301de455327861edf46a3a6c7" category="paragraph">但是，如果控制器上安装的 ONTAP 9 版本与原始控制器上安装的版本相同，则无需通过网络启动控制器。如果是，您可以跳过此部分并继续 <block ref="2bff11e37a7944fe4126fc6d0031317c" category="inline-link-macro-rx"></block>。</block>
  <block id="021eb7b60dabf41949ccbeca660311c4" category="list-text">【 man_netboot_Step1]] 访问 NetApp 支持站点以下载用于执行系统网络启动的文件。</block>
  <block id="7aaf61c00ba3ad0e715187e2a6df58df" category="cell">将 `ontap_version_image.tgz` 文件的内容解压缩到目标目录： `tar -zxvf ontap_version_image.tgz` * 注：如果要在 Windows 上提取内容，请使用 7-Zip 或 WinRAR 提取网络启动映像。您的目录列表应包含一个包含内核文件的 netboot 文件夹： `netboot/kernel`</block>
  <block id="12ae351e56c133971ddc0802d3e5f372" category="cell">您的目录列表应包含以下文件： `ontap_version_image.tgz` * 注释 * ：您不需要提取 `ontap_version_image.tgz` 文件的内容。</block>
  <block id="7704ef8efcd46a7ed3c60b0b5522a4f5" category="paragraph">您将使用中目录中的信息 <block ref="f7260a7bcbdd09edcf840aac6c5a4af7" category="inline-link-macro-rx"></block>。</block>
  <block id="630cec3291759dd967d8afd9c4e8545f" category="inline-link-macro">将节点 1 拥有的非根聚合和 NAS 数据 LIF 重新定位到节点 2</block>
  <block id="7115fb4a39be3cfe6cee8101025f1504" category="list-text"><block ref="7115fb4a39be3cfe6cee8101025f1504" category="inline-link-macro-rx"></block></block>
  <block id="381638a6e0f7aca4ddd9fcf0b9a1b531" category="inline-link-macro">将 node1 拥有的 NAS 数据 LIF 移动到 node2</block>
  <block id="dcf0f8ecb6c997def559b3960cde05ca" category="list-text"><block ref="dcf0f8ecb6c997def559b3960cde05ca" category="inline-link-macro-rx"></block></block>
  <block id="983e8d5011cadd8bafa613b4879ba72d" category="inline-link-macro">记录节点 1 信息</block>
  <block id="a47c5ad7a0d8f464831a41a2bbd2f0e4" category="list-text"><block ref="a47c5ad7a0d8f464831a41a2bbd2f0e4" category="inline-link-macro-rx"></block></block>
  <block id="ec8e968619d70fa650eb72c40fe2c6fb" category="summary">通过启用 HA 对，确保新控制器设置正确。</block>
  <block id="9049f1bbc92896381d7b5ffdc386e3b2" category="list-text">在其中一个节点上输入以下命令，以启用存储故障转移：</block>
  <block id="4d090b6b4178c6d326829a98b05a4cd7" category="paragraph">`storage failover modify -enabled true -node node3`</block>
  <block id="44b65ecdfbcd9fda48c21d17aae6347e" category="cell">如果集群为 ...</block>
  <block id="f58285c881fa273f24181ed6fc4f5253" category="cell">在任一节点上输入以下命令以启用集群高可用性： `cluster ha modify -configured true`</block>
  <block id="97b53f9857ac13c0da869099d031be38" category="cell">转至 <block ref="822b8237ef75a77ff6f775dfc30b209c" category="inline-xref-macro-rx"></block>。</block>
  <block id="c923a045fa01384244a7d722820ecb7f" category="list-text">【 man_ense_setup_Step4]] 输入以下命令并检查输出，以验证 node3 和 node4 是否属于同一集群：</block>
  <block id="993ec2fcd18633816cf0d4d290fcf5a3" category="list-text">输入以下命令并检查输出，以验证 node3 和 node4 是否可以访问彼此的存储：</block>
  <block id="00c012d0f7127c31c470ac3c1c76aa44" category="list-text">输入以下命令并检查输出，以验证 node3 和 node4 均不拥有集群中其他节点拥有的主数据 LIF ：</block>
  <block id="2a6d96821a4ce6866da866e48a1ece2a" category="paragraph">如果 node3 或 node4 拥有集群中其他节点所拥有的主数据 LIF ，请使用 `network interface revert` 命令将数据 LIF 还原到其主所有者。</block>
  <block id="b7836a7a1972d5f8803e2f44bd3cb658" category="paragraph">`storage aggregate show -owner-name node3` `storage aggregate show -owner-name node4`</block>
  <block id="4655a1857691d25ac0c12a710dad5454" category="paragraph">`volume show -node &lt;node3&gt; -state offline` `volume show -node &lt;node4&gt; -state offline`</block>
  <block id="183048ad5f29710efbac355627777865" category="inline-link-macro">第 19 步（ d ）</block>
  <block id="be3ae65f9ab44c1be767b14ddc884bfc" category="list-text">如果任何卷处于脱机状态，请将其与您在中捕获的脱机卷列表进行比较 <block ref="f226f1513a3b2dc8065e1f4d6987a247" category="inline-link-macro-rx"></block> 在 _Prepare the nodes for upgrade" 中，根据需要输入以下命令使任何脱机卷联机，每个卷一次：</block>
  <block id="5d41e09cfbf05ac79dc026cd1e32857c" category="list-text">通过为每个节点输入以下命令，为新节点安装新许可证：</block>
  <block id="8502756d136a7fbd63f0576ce096751b" category="paragraph">`ssystem license add -license-code &lt; 许可证代码，许可证代码，许可证代码 ...&gt;`</block>
  <block id="65d93c0f2eae68c69877f67ce3781996" category="paragraph">license-code 参数接受一个包含 28 个大写字母字符密钥的列表。您可以一次添加一个许可证，也可以一次添加多个许可证，每个许可证密钥用逗号分隔。</block>
  <block id="1f6c8829a415beddc4ce10181f20094a" category="inline-link-macro">第 16 步</block>
  <block id="c13dda3e4975b286bfb62f3d9aa8cfa5" category="list-text">要从原始节点中删除所有旧许可证，请输入以下命令之一：</block>
  <block id="a0cc12382dcdc36e42046d83b6c7e109" category="paragraph">`ssystem license clean-up -unused -expired` `ssystem license delete -serial number node_serial _number -package licensable_package`</block>
  <block id="f1645d1878d86f7024812da747846642" category="list-text">要删除所有已过期的许可证，请输入：</block>
  <block id="fd6db757e3a6fb12f04139c8f48aab93" category="list-text">要删除所有未使用的许可证，请输入：</block>
  <block id="0fae8f5a8ab68238375deb31e474111d" category="list-text">要从集群中删除特定许可证，请在节点上输入以下命令：</block>
  <block id="d1ee77d0c558bd478284637572157e43" category="list-text">输入以下命令并检查其输出，以验证是否已正确安装许可证：</block>
  <block id="7092e15f19aa79a4b642157f15a4bcf6" category="inline-link-macro">第 30 步</block>
  <block id="332e0dd58dd105f49bb8b855cc6e08e6" category="paragraph">您可能需要将输出与中捕获的输出进行比较 <block ref="aa31de159a7a7903f22336e05c00b63e" category="inline-link-macro-rx"></block> 的 _ 准备节点以进行升级 _ 。</block>
  <block id="65816664fef74fe3f15406730c518f76" category="list-text">通过在两个节点上执行以下命令来配置 SP ：</block>
  <block id="3d39e72120bdfa8b32eb4183896ece25" category="paragraph">转至 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到系统管理参考 _ 以了解 SP 的相关信息，以及 _System 9 ONTAP 命令：手册页参考 _ 以了解有关 `ssystem service-processor network modify` 命令的详细信息。</block>
  <block id="8bd516232448307a629aa2ad8fe64430" category="list-text">输入以下命令，输入高级权限级别：</block>
  <block id="b67e0c8ad4d089069e3751204ab49a05" category="paragraph">`storage failover modify -node &lt;node-name&gt; -cifs-no-duration default-medium_low`</block>
  <block id="ee16bb116206ed27e74abc4888edf806" category="list-text">如果系统的工作负载的 50% 到 75% 的操作小于 4 KB ，请输入 `medium` 。</block>
  <block id="93b838bedea5b323f56d1fb4aec030fe" category="list-text">如果系统的工作负载的 75% 到 100% 的操作小于 4 KB ，请输入 `low` 。</block>
  <block id="52eb8cb5708af7396828abc72517413d" category="list-text">如果要在新节点上设置无交换机集群，请转至 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 要链接到 _Network 支持站点 _ 并按照 _switchover to a two-node switchless cluster_ 中的说明进行操作。</block>
  <block id="a98b8d21a1cabe96a7d765976c724ace" category="paragraph">如果在 node3 和 node4 上启用了存储加密，请完成中的步骤 <block ref="94c0a6a874300fcf012d00a23a1b673f" category="inline-link-macro-rx"></block>。否则，请完成中的步骤 <block ref="6e48b929ca0767f00c15eeb6d7e78755" category="inline-link-macro-rx"></block>。</block>
  <block id="7a7a97b0a4426efc4fdcea55664d34bf" category="summary">在阶段 4 中，您会记录 node2 信息，然后停用 node2 。</block>
  <block id="bf281b48b35a7cc176890f2be65ca906" category="list-text"><block ref="bf281b48b35a7cc176890f2be65ca906" category="inline-link-macro-rx"></block></block>
  <block id="3b878279a04dc47d60932cb294d96259" category="doc">概述</block>
  <block id="3a836223b6604b6ae4f5479bf7fe0514" category="paragraph">在重新配置交换机问题描述之前，您应发送 AutoSupport 消息以通知 NetApp 技术支持正在进行维护。告知技术支持正在进行维护，可防止他们在假定已发生中断的情况下创建案例。</block>
  <block id="68e6b44b3a749a5a92b3130b283a8d5c" category="paragraph">必须在每个 MetroCluster 站点上执行此任务。</block>
  <block id="2582e010e97c2f1b4ef7a684672e4598" category="list-text">登录到集群。</block>
  <block id="ee4b431a595989bb32df666099e34bf8" category="list-text">调用指示维护开始的 AutoSupport 消息：</block>
  <block id="000be743e2bbedc544736fd887cacf7b" category="paragraph">`ssystem node AutoSupport invoke -node * -type all -message MAINT=maintenance-window-in-hours`</block>
  <block id="8b8313711f50dddf1be23555c3e398af" category="paragraph">`m值` 指定维护时段的长度，最长为 72 小时。如果在该时间过后完成维护，您可以调用一条 AutoSupport 消息，指示维护期结束：</block>
  <block id="538f577c4284d097aef57681a2acf728" category="paragraph">`ssystem node AutoSupport invoke -node * -type all -message MAINT=end`</block>
  <block id="047c004f2f53364ce170133f533be47f" category="list-text">在配对站点上重复上述步骤。</block>
  <block id="1914f112a35f8b1c26c1d0c90552a644" category="summary">安装并启动 node3 后，您需要验证它是否已正确安装，是否属于集群，以及是否可以与 node2 通信。</block>
  <block id="a8b14471d941953a592683e741c0ca1c" category="list-text">在系统提示符处，登录到 node3 。然后，验证 node3 与 node2 位于同一集群中且运行状况良好：</block>
  <block id="c526c49b8044ea431a2ad56bde07cd17" category="list-text">【第 2 步】确认 node3 可以与 node2 通信且所有 LIF 均已启动：</block>
  <block id="aeebaeba203eabdcc6fdd7dea27f4674" category="paragraph">`network interface show -curr-node node3`</block>
  <block id="0ccfa81b1f21bfb5655a443ca59f1146" category="inline-link-macro">将 node1 拥有的 NAS 数据 LIF 从 node2 移动到 node3 并验证 node3 上的 SAN LIF</block>
  <block id="d1e338a03ea3eb1b2592ad7856e6b249" category="list-text">【第 4 步】在其中一个节点上输入以下命令并检查其输出，以验证 node2 和 node3 是否处于仲裁状态：</block>
  <block id="6af6b76d592516d40ca101051c678be3" category="doc">AFF 和 FAS 系统升级文档</block>
  <block id="c659f2c431be96152886f89fc8d66545" category="list-text">【第 2 步】修改 node1 和 node2 上所有 LIF 的自动还原设置：</block>
  <block id="7aa10cd63437ec1d1013caeee0bbba13" category="paragraph">`network interface modify -vserver vserver_name -lif LIF_name -auto-revert false`</block>
  <block id="cbda167ce953729cf8b9be29b0e35ede" category="list-text">【第 3 步】执行以下步骤，迁移节点 1 上接口组和 VLAN 上托管的任何 NAS 数据 LIF ：</block>
  <block id="9ebd90a8ee1baaa50f7229ecbad7e8b4" category="list-text">【 ｛ substepa ｝ 】通过为每个 LIF 输入以下命令，将任何接口组上托管的 LIF 以及 node1 上的 VLAN 迁移到 node2 上能够在与接口组相同的网络上托管 LIF 的端口：</block>
  <block id="38dc91fe258c6eeb7ff70deac7ba3ee0" category="list-text">在中修改 LIF 和 VLAN 的主端口和主节点 <block ref="cf21dd79faca0741f745aead7a1f3856" category="inline-xref-macro-rx"></block> 输入以下命令，将 LIF 设置为当前托管 LIF 的端口和节点，每个 LIF 设置为一次：</block>
  <block id="f665edf5cc407acfccaabfb5603ae07e" category="cell">完成 <block ref="a7f3a08749b96b9fef80c08c6457135d" category="inline-xref-macro-rx"></block> 到 <block ref="ebde17035ccd0e1d011f2e188b8e17d6" category="inline-xref-macro-rx"></block>。</block>
  <block id="9afdff3547467f61598636f379b01049" category="list-text">【 man_lif_1_2_step5]] 通过输入以下命令将 NAS 数据 LIF 从 node1 迁移到 node2 ，每个数据 LIF 输入一次：</block>
  <block id="46d8840624eee12f277b28b36bc04ac9" category="list-text">【第 7 步】修改已迁移 LIF 的主节点：</block>
  <block id="399d0e6b3a5d6f6a955d15b76e16dac3" category="list-text">【 man_lif_1_2_step8]] 验证 LIF 是否正在使用此端口作为其主端口或当前端口。如果端口不是主端口或当前端口，请转到 <block ref="9afb853eb1a825acf900d55aa2bce20e" category="inline-xref-macro-rx"></block>：</block>
  <block id="f48b3299d16d6b2107cabf71fe17fc7a" category="list-text">【 ｛ man_lif_1_2_step9]] 如果 LIF 使用此端口作为主端口或当前端口，请修改此 LIF 以使用其他端口：</block>
  <block id="eb107bf9c16173703c7eb7800e543b49" category="list-text">【第 10 步】如果任何 LIF 已关闭，请输入以下命令，将 LIF 的管理状态设置为 "up" ，每个 LIF 一次：</block>
  <block id="5410f279e38e9c157f57b06f35930496" category="list-text">【第 11 步】输入以下命令并检查其输出，以验证 node1 上是否没有剩余数据 LIF ：</block>
  <block id="90506ded7e085b5dfb368983176adad1" category="list-text">您的系统使用运行 ONTAP 9.8 或更高版本的 Fabric MetroCluster 4 节点和 8 节点配置。</block>
  <block id="7ae38f6d8449bab135d62e112d801780" category="paragraph">端口设置可能因节点型号而异。</block>
  <block id="18d6cf18e081291f183ebc71cad11449" category="list-text">【第 1 步】执行以下步骤，验证设置是否为双节点无交换机集群：</block>
  <block id="506c2c0c7f5b70af3df68c45c46f45a7" category="paragraph">例如：</block>
  <block id="813d293c72e7757d7214e56a35a3d239" category="list-text">【第 2 步】进行以下更改：</block>
  <block id="3528faaf395daaaf0d052ce18e3bb68f" category="paragraph">此示例将在 "node1" 上添加集群端口 e1b ：</block>
  <block id="622072baf7f2434ea38f8e00080cf8a9" category="paragraph">`network interface migrate -vserver vserver_name -lif lif_name -source-node node1 -destination-node node1 -destination-port port_name`</block>
  <block id="a2667267edacd035171d6f2c7a379271" category="list-text">显示 node1 和 node3 的运行状况：</block>
  <block id="0dd0951b0ff75b50f90162a4e89cea83" category="list-text">[[man_map_1_step3]] 修改托管数据 LIF 的物理端口的广播域成员资格。</block>
  <block id="8d324785c287a538f58e372f40bed342" category="list-text">在执行可访问性修复时， ONTAP 会尝试将端口放置在正确的广播域中。但是，如果无法确定某个端口的可访问性，并且该端口与任何现有广播域不对应，则 ONTAP 将为这些端口创建新的广播域。如果新创建的广播域的所有成员端口都将成为接口组的成员端口，则可以根据需要删除这些成员端口。删除广播域</block>
  <block id="ad26ddf2e9b94d63fc11537e49b3ecb8" category="list-text">查看接口组配置，并根据需要添加或删除成员端口。</block>
  <block id="4f8ff7a721c81a3185d356f1a33fae2d" category="paragraph">将成员端口添加到接口组端口：</block>
  <block id="656b196d0feecfb88110b2e33cdf3479" category="paragraph">`ifgrp remove-port -node _node_name_ -ifgrp ifgrp_port -port port_name`</block>
  <block id="040a6f3de7a3341ed3e93db753165247" category="paragraph">`vlan delete -node node_name -vlan-name vlan_port_`</block>
  <block id="123012504d494b3b1e04b337be57f7ab" category="paragraph">`vlan create -node node_name -vlan-namevlan_port`</block>
  <block id="615e12bd105ff14dbfe4918eedb06e9c" category="admonition">根据要升级的系统的网络配置的复杂性，可能需要重复子步骤（ a ）到（ g ），直到所有端口都在需要时正确放置为止。</block>
  <block id="f885f903824205e3ac8b26efa5254e8d" category="list-text">【第 4 步】如果系统上未配置任何 VLAN ，请转至 <block ref="4c0abef6869b6cad04a71c175246f8ab" category="inline-xref-macro-rx"></block>。如果已配置 VLAN ，请还原先前在不再存在的端口上配置的或在已移至另一广播域的端口上配置的已替换 VLAN 。</block>
  <block id="5b16c41785a8844c7ae2d2b5c45588ec" category="list-text">自 ONTAP 9.8 起，如果在网络端口可访问性修复操作步骤期间在广播域之间移动了 LIF 的主端口，则 ONTAP 将自动修改 LIF 的主端口。如果 LIF 的主端口已移至另一个节点或未分配，则该 LIF 将显示为已替换的 LIF 。还原主端口不再存在或已重新定位到另一节点的已替换 LIF 的主端口。</block>
  <block id="46d6a65cf0d9843fc970f27931ee26dd" category="paragraph">`displaced interface restore -vserver vserver_name -lif-name LIF_name`</block>
  <block id="aaa2b516ee5f7ea24e6108032acc280f" category="paragraph">如果所有端口均已正确配置并添加到正确的广播域中，则 `network port reachability show` 命令应将所有已连接端口的可访问性状态报告为 "ok" ，而对于没有物理连接的端口，此状态报告为 "no-reachability " 。如果任何端口报告的状态不是这两个端口，请按照中所述修复可访问性 <block ref="908f101af36ad2335dd086df5698bdbf" category="inline-xref-macro-rx"></block>。</block>
  <block id="c2e8f597299baf99355b3fa78126f551" category="list-text">[[man_map_1_step6]] 验证属于正确广播域的端口上的所有 LIF 是否已由管理员启动。</block>
  <block id="2c39c176c9d4024fd61e5bb2e1345301" category="paragraph">`network interface show -vserver vserver_name -status-admin down`</block>
  <block id="294217f067c6d528ded0650ae8192e3f" category="list-text">检查是否有任何 LIF 运行中断：</block>
  <block id="a8afd300d47b2bfbf648bcf7bfe2870a" category="paragraph">`network interface show -vserver vserver_name -status-oper down`</block>
  <block id="e7f316df0ac3e0ff920f7a6b78738937" category="paragraph">`network interface modify -vserver vserver_name -lif LIF_name -home-port home_port`</block>
  <block id="fe26bf863d5eda5137c72987873268a6" category="summary">使用 ARL 升级控制器的准则</block>
  <block id="a58275251c4ceab5ef8fb93df1152efe" category="paragraph">要了解是否可以使用聚合重新定位（ Aggregate Relocation ， ARL ）升级一对运行 ONTAP 9.8 的控制器，取决于原始控制器和替代控制器的平台和配置。</block>
  <block id="b2ea28d5ed885ef7926100979ab12c7a" category="list-text">在升级之前，原始控制器和替代控制器必须运行相同版本的 ONTAP 9.8 。</block>
  <block id="e52edde4a2daa372f1d2553f7b9406eb" category="list-text">与无法运行 ONTAP 9.8 或更高版本的控制器之间的连接。</block>
  <block id="0b7e952693f4986837beff2196d112d7" category="section-title">ONTAP 9.8 或更高版本中的许可</block>
  <block id="12ee56bc4ae8d39a35db35e248722ec3" category="paragraph">所有许可证密钥的长度均为 28 个大写字母字符。请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _NetApp 支持站点 _ ，在此可以获取 ONTAP 9.8 的 28 个字符的新许可证密钥。或更高版本。这些密钥位于 _Software licenses_ 下的 _My Support_ 部分中。如果此站点没有所需的许可证密钥，请联系您的 NetApp 销售代表。</block>
  <block id="94c614d182457fbc97ae1deaaabd5813" category="paragraph">如果要升级双节点无交换机集群中的节点，则可以在执行升级时将这些节点保留在无交换机集群中。您无需将其转换为交换集群。</block>
  <block id="15e92ecabc1153e5c4706af4900297f3" category="paragraph">在第 5 阶段，您可以安装并启动 node4 ，并将集群和节点管理端口从 node2 映射到 node4 。您还可以将节点 2 拥有的数据 LIF 和 SAN LIF 从 node3 移动到 node4 ，并将节点 2 的聚合从 node3 重新定位到 node4 。</block>
  <block id="97acf14b99594c73dbf7bace1a3d2df0" category="paragraph">在将聚合从 node2 重新定位到 node3 之前，您需要将当前位于 node2 上的 node1 的 NAS 数据 LIF 从 node2 移动到 node3 。您还需要验证 node3 上的 SAN LIF 。</block>
  <block id="fdc03a42e0e3399344b3116546b77b4d" category="list-text">【 man_lif_verif_3_step5]] 如果平台上的数据端口不同，请将这些端口添加到广播域：</block>
  <block id="3e874a6c7a8a7acafa16272d6c2b74ee" category="paragraph">以下示例将节点 "8200-1 " 上的端口 "e0a" 和节点 "8060-1 " 上的端口 "e0i" 添加到 IP 空间 "Default" 中的广播域 "mgmt" ：</block>
  <block id="08ac1a2fb254b60e9c511fe04b6536d0" category="cell">外部密钥管理器（ EKM ）</block>
  <block id="f8b56783de7821dd646ebb4440b61d16" category="summary">在将 node1 替换为 node3 之前，必须使用 `storage aggregate relocation` 命令将非根聚合从 node1 移动到 node2 ，然后验证重新定位。</block>
  <block id="a15c700e7f4988ded7f4fadcd587a7ad" category="summary">安装并启动 node4 后，您需要验证是否已正确安装它。</block>
  <block id="e5255775e89f083d8e69c73098e5fff2" category="list-text">输入以下命令，验证 node4 与 node3 位于同一集群中且运行状况良好：</block>
  <block id="a8b841bb612aacb195cf6acc0585fc92" category="list-text">输入以下命令，验证 node4 是否可以与 node3 通信以及所有 LIF 是否均已启动：</block>
  <block id="07d4c533878766923bd46c0ad1c07580" category="list-text">转至 <block ref="861668d9cff26e583cb336053a01f9e4" category="inline-xref-macro-rx"></block>。</block>
  <block id="9bce91076db18294fb11d6102c6ff059" category="cell">转至 <block ref="861668d9cff26e583cb336053a01f9e4" category="inline-xref-macro-rx"></block>。您无需在节点之间手动连接 HA 互连；在同机箱配置中， HA 互连会通过背板自动连接。</block>
  <block id="ff7a118b46f3869beb6bcd084db3f81c" category="cell">完成第 6 步，然后转至部分 <block ref="433d8081a28a0d8c06bf54d23d4e1297" category="inline-link-macro-rx"></block>。</block>
  <block id="55663f6258861b526745aa5208196d3a" category="cell">跳过步骤 6 转至部分<block ref="433d8081a28a0d8c06bf54d23d4e1297" category="inline-link-macro-rx"></block>。</block>
  <block id="66807f2defef8b7eaf2bfaddf801fc4a" category="list-text">在其中一个节点上输入以下命令，以验证 node3 和 node4 是否都处于仲裁状态：</block>
  <block id="b36eedb3dc2096d3226039d46eaf45f8" category="list-text">除了非 MetroCluster 配置之外，这种运行 ONTAP 9.8 及更高版本的操作步骤适用场景光纤 MetroCluster 四节点和八节点配置。</block>
  <block id="ca49ea726cf177756380ffbec6a54a54" category="list-text">对于运行 ONTAP 9.7 及更早版本的 MetroCluster 配置，请转至 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _ 使用聚合重新定位手动升级运行 ONTAP 9.7 或更早版本的控制器硬件 _ 。</block>
  <block id="0be4d29eba4c1cb717ebc96e468c34b9" category="paragraph">将端口从 node2 映射到 node4 之后，在将 node2 聚合从 node3 重新定位到 node4 之前，您需要将当前位于 node3 上的 node2 所拥有的 NAS 数据 LIF 从 node3 移动到 node4 。您还需要验证 node4 上的 SAN LIF 。</block>
  <block id="4839549656731e0245736bfa32bc3606" category="list-text">执行以下步骤以验证此设置是否为双节点无交换机集群：</block>
  <block id="0237dfb60fb0152194b2ef8069110809" category="list-text">使用以下命令返回到管理权限级别：</block>
  <block id="cfcca4ee19f6b4091072ade66937870b" category="list-text">修改将属于 `集群` 广播域的端口：</block>
  <block id="e7556064c17516d1637d45f8010ff06c" category="paragraph">此示例将在 "node2" 上添加集群端口 "e1b" ：</block>
  <block id="1a356c921266e2599c929346ed1cf8f2" category="paragraph">`network port modify -node node2 -port e1b -ipspace cluster -mtu 9000`</block>
  <block id="81ac85f2e0f02b00912d8270470a7ee0" category="paragraph">`network interface migrate -vserver vserver_name -lif lif_name source-node node2 -destination-node node2 -destination-port port_name`</block>
  <block id="cfb6c66ba1b4961d38f6a81889501471" category="paragraph">`network port broadcast-domain remove-ports -ipspace cluster -broadcast-domain cluster -ports node2 ： port`</block>
  <block id="9df9250bef265936667a669a94c73c45" category="list-text">显示 node2/node4 的 `health` 状态：</block>
  <block id="90a80dbcfe2d9dc6015a2d205a26af80" category="paragraph">`cluster show -node node2 -fields health`</block>
  <block id="6897b79e7e86c3bf656b3cf8bb05bc85" category="list-text">[[man_map_2_Step3]] 修改托管数据 LIF 的物理端口的广播域成员资格。</block>
  <block id="322b25940728d29a26180978d33a75a7" category="paragraph">此时将显示类似以下内容的警告。查看并根据需要输入 y 或 n ：</block>
  <block id="7df210e2cef27d20b20df2381abdb2d8" category="paragraph">`ifgrp add-port -node node_name -ifgrp ifgrp_port -port port_name`</block>
  <block id="5faf906f15b68f5c20ff72271d5bf969" category="paragraph">`ifgrp remove-port -node node_name -ifgrp ifgrp_port -port port_name`</block>
  <block id="28ffee9aa7a190ca41675de91fb9710b" category="list-text">如果系统上未配置任何 VLAN ，请转至 <block ref="f0f83db123b2b495e546349e9d3200d8" category="inline-xref-macro-rx"></block>。如果已配置 VLAN ，请还原先前在不再存在的端口上配置的或在已移至另一广播域的端口上配置的已替换 VLAN 。</block>
  <block id="88979d326c7ea690819e5ebc2c65edb9" category="list-text">自 ONTAP 9.8 起，如果在网络端口可访问性修复操作步骤期间在广播域之间移动了 LIF 的主端口，则 ONTAP 将自动修改 LIF 的主端口。如果 LIF 的主端口已移至另一个节点或未分配，则该 LIF 将显示为已替换的 LIF 。还原主端口不再存在或已重新定位到另一节点的已替换 LIF 的主端口。</block>
  <block id="c5c3d54cdf6631e2e290953a91dcd842" category="paragraph">如果所有端口均已正确配置并添加到正确的广播域中，则 `network port reachability show` 命令应将所有已连接端口的可访问性状态报告为 `ok` ，对于无物理连接的端口，此状态报告为 `no-reachability` 。如果任何端口报告的状态不是这两个端口，请按照中所述修复可访问性 <block ref="42e2bf4f4ef15f603bcc30bc206d35c3" category="inline-xref-macro-rx"></block>。</block>
  <block id="a1a54b5bb2c9a480b1b25789e5a2ba99" category="paragraph">`network interface show -vserver vserver_name -status-oper down`</block>
  <block id="e60389070edd39af4fe7aea580d3af71" category="paragraph">`network interface modify -vserver vserver_name -lif lif_name -home-port home_port`</block>
  <block id="ff5630028e7797f87cc34d787d516ef1" category="summary">故障排除，故障排除，问题，错误，故障</block>
  <block id="f9b91d759f1fb65bfed05428a9dff8cf" category="paragraph">在阶段 2 中，您将 node1 聚合和 LIF 重新定位到 node2 ，记录 node1 信息，然后停用 node1 。此过程大部分是自动化的；操作将暂停，以便您可以检查其状态。您必须手动恢复此操作。</block>
  <block id="fd6616fb43f706cbccb578942fa320ab" category="paragraph">通过将非根聚合从原始节点迁移到同一集群中的新节点，您可以无中断地升级运行 ONTAP 9 的一对节点上的控制器硬件。升级期间，可以访问要升级的节点上托管的数据。</block>
  <block id="60b36970c08352c3c476769f29561cf4" category="paragraph">此操作步骤使用一种称为聚合重新定位（ Aggregate Relocation ， ARL ）的方法，该方法利用 HA 配置，可以将非根聚合的所有权从一个节点移动到另一个节点，前提是它们在同一集群中共享存储。</block>
  <block id="645b41b640376c487d825f5296fcae9d" category="paragraph">通过将非根聚合从原始节点迁移到同一集群中的新节点，您可以无中断地升级一对运行 ONTAP 的节点上的控制器硬件。升级期间，可以访问要升级的节点上托管的数据。</block>
  <block id="6e6a93e1bc39df87c56313cbfd41fa2c" category="cell">如果您运行的是此 ONTAP 版本…</block>
  <block id="c8148f766ec78479f303b8e902e9099b" category="cell">要使用 system 命令进行升级，请使用…</block>
  <block id="041dd7a51404fc5dc5a87c2a0bc90b15" category="cell">9.8 或更高版本</block>
  <block id="b9872d104f5b4706bfb3c12a12c6f3d6" category="cell">9.5 到 9.7</block>
  <block id="6af074e0669e408e576b460f5c34b89b" category="cell">要手动升级，请使用…</block>
  <block id="4c41f3a2ec168af1924a7c5a884bdc37" category="cell">9.0 到 9.7</block>
  <block id="be11c74c1dd7f307bb80183a90dc2067" category="sidebar">入门</block>
  <block id="ec01d482cf394f212f073921cfd9d5bd" category="sidebar">《 ONTAP 发行说明》</block>
  <block id="10a85281b4bbd72e21850d0eaab35a67" category="sidebar">通过移动存储或卷（大多数系统）进行升级</block>
  <block id="6c54fdf57ce13c518f1cc0d9d5f32820" category="sidebar">升级控制器硬件</block>
  <block id="ddb75baab241feb0f5773b6f169099d5" category="sidebar">在运行 ONTAP 9.8 及更高版本的系统上移动聚合以进行升级</block>
  <block id="194cc1951d00be469039af6dbda275d0" category="sidebar">使用 system controller replace 命令（大多数系统）</block>
  <block id="b4d25e7f066e6393a7e3a6a7115b4f94" category="sidebar">使用手动命令</block>
  <block id="24f090bf6acc424f4c22ffff65009745" category="sidebar">通过在运行 ONTAP 9.7 及更早版本的系统上移动聚合进行升级</block>
  <block id="5f9c427150012de98abaaa70885c293c" category="sidebar">使用 system controller replace 命令（大多数系统）</block>
  <block id="7d94daad2b6e9d77a6320a64c21fbc4a" category="sidebar">升级 MetroCluster 配置中的系统</block>
  <block id="c6bb96cc8b84319277f00b15adc71d75" category="sidebar">为您的 MetroCluster 配置选择升级操作步骤</block>
  <block id="dfcc398099d6a64026e51ab282e16253" category="sidebar">更多资源</block>
  <block id="aaf23d643347b5921ba9716fa4c13f83" category="sidebar">ONTAP 系统文档</block>
  <block id="743b2bde29eae11996923323c6b89672" category="sidebar">ONTAP 交换机文档</block>
  <block id="dd032435fa83549d8bf3928550409a3e" category="sidebar">ONTAP 软件文档</block>
  <block id="519131237f79eadb2dc6a1e003a087bc" category="sidebar">NetApp Active IQ Config Advisor</block>
  <block id="bc8be72fdc9d6054f356bb2b7f80fd12" category="sidebar">NetApp 互操作性表</block>
  <block id="dd490b81914dd945601e442a41cb4222" category="sidebar">NetApp 社区</block>
  <block id="d087c3faf4708dbb3c8dfcfefd9745e9" category="sidebar">使用 system controller replace 命令将运行 ONTAP 9.5 的控制器硬件升级到 9.7</block>
  <block id="c4d333d48f2e07ddeaa6a230635663cf" category="sidebar">通过移动卷或存储进行升级</block>
  <block id="ea61e2c2ff507048203824add1eb7c21" category="sidebar">注意事项</block>
  <block id="2bfb87bbde1d2f1a85359c4188897f44" category="sidebar">选择方法</block>
  <block id="78ab525858e669cbe2bbf5be70ac71b8" category="sidebar">通过移动存储进行升级</block>
  <block id="24f47cdbe9ddba774a7cc53e51d9032e" category="sidebar">工作流</block>
  <block id="f8199556cf6a62ca9268aa50c99b34a1" category="sidebar">准备</block>
  <block id="1b775107e10aa9acb2f611db5db714f7" category="sidebar">关闭原始节点</block>
  <block id="f4d03224dd15fbdbe8ce7ceae5d94e1b" category="sidebar">删除磁盘所有权</block>
  <block id="8c2a9dc1e3eabd2cf2048386719438d7" category="sidebar">重置默认配置</block>
  <block id="b89f2ce6accc5047e235ddc8dae13aa5" category="sidebar">安装新节点</block>
  <block id="bca5cff73543fb5c182ae115c9e682dc" category="sidebar">设置新节点</block>
  <block id="6a26b76071c114327f8c2765939aa5a7" category="sidebar">可选—移动内部存储或转换为驱动器架</block>
  <block id="2f8a43bf9cc884df869e4198adef3e58" category="sidebar">移动内部驱动器</block>
  <block id="fb96a6f2421e21a53ee4078e03bf0b62" category="sidebar">将节点转换为驱动器架</block>
  <block id="68274bddbfd931594dff2906c4d537d8" category="sidebar">还原根卷配置</block>
  <block id="e2328b54876f0cd6379d9fcbc5572e87" category="sidebar">完成升级</block>
  <block id="d4533ef157c2c7f83b5bc5d9b0283026" category="sidebar">完成 ONTAP 9.8</block>
  <block id="7686c34f0400921210a5e039c6743309" category="sidebar">在 ONTAP 9.8 中执行最终步骤</block>
  <block id="26000c062eace835ce5a8e9b4f5d553a" category="sidebar">在 ONTAP 9.7 或更早版本中完成</block>
  <block id="181a3a0697aaadf877eed027e84ebe7f" category="sidebar">在 ONTAP 9.7 或更早版本中执行最终步骤</block>
  <block id="51e0a0afc4d011a307d3419bfe742eba" category="sidebar">通过移动卷进行升级</block>
  <block id="ff56b4f5944c3419d2cbe4a5a19eb150" category="sidebar">安装并加入新节点</block>
  <block id="04e27e7cb9c80acf93c96099047dadab" category="sidebar">创建聚合并移动卷</block>
  <block id="f86f16f11e093ddd1a9acafc8ee58e6f" category="sidebar">移动非 SAN 数据 LIF 和集群管理 LIF</block>
  <block id="cf3329822cb6acbd3f59abba0514d804" category="sidebar">删除 SAN LIF</block>
  <block id="d2e2f3320c4d610d0815b1405859a98b" category="sidebar">取消加入原始节点</block>
  <block id="ede813b2f7c6a203c236d7726f79da2c" category="sidebar">工作表：在控制器升级之前和期间收集的信息</block>
  <block id="79f3abfd76c996d707b348dbfb91c42b" category="sidebar">在 node4 上设置 FC 或 UTA/UTA2 配置</block>
  <block id="2e546c2ae4e7d18e3a62352f7899f8ad" category="paragraph">按照 node4 平台的 _Installation and Setup Instructions_or the _FlexArray 虚拟化安装要求和参考 _ 中的说明，使用缆线连接以下连接，并参考相应的磁盘架文档和 _High Availability Management_ 。</block>
  <block id="96fc3790ed0f779b648493fc7e4b2e7c" category="paragraph">请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _High Availability Management_ 和 _FlexArray 虚拟化安装要求和参考。</block>
  <block id="c83b4e572cf3ae5eb7bac42baed0ac9e" category="summary">您可以链接到此主题中的其他参考内容和网站。</block>
  <block id="82a3300ad94a5e1dcf0a6abbfe1060e2" category="paragraph">在执行此内容中的过程时，您可能需要查看参考内容或访问参考网站。</block>
  <block id="14f94d0b133a9aa34a775e955c95b8bc" category="list-text"><block ref="13e4a2cf4e0a4edbef519c9af2452c86" category="inline-xref-macro-rx"></block></block>
  <block id="ec5873b9b6861954a7c07d183dd486b0" category="section-title">参考内容</block>
  <block id="bc6bec578fabd4f81f97a21373822230" category="paragraph">下表列出了此升级的特定内容。</block>
  <block id="f15c1cae7882448b3fb0404682e17e61" category="cell">内容</block>
  <block id="e2ea913994dd610f57aa9df505badbaa" category="cell"><block ref="e2ea913994dd610f57aa9df505badbaa" category="inline-link-macro-rx"></block></block>
  <block id="5837907b0451e478a454e8fc87e92342" category="inline-link-macro">光纤连接的 MetroCluster 安装和配置</block>
  <block id="a3b8dcbb945865e5ef0e1c83b68c8824" category="cell"><block ref="a3b8dcbb945865e5ef0e1c83b68c8824" category="inline-link-macro-rx"></block></block>
  <block id="2894d35f6fa87d4eee09a10919737e2f" category="cell"><block ref="2894d35f6fa87d4eee09a10919737e2f" category="inline-link-macro-rx"></block></block>
  <block id="07ae19817dfc58c8d1b72b612a233da3" category="inline-link-macro">MetroCluster 管理和灾难恢复</block>
  <block id="2e78b745dc7527d7e142f60838ac795c" category="cell"><block ref="2e78b745dc7527d7e142f60838ac795c" category="inline-link-macro-rx"></block></block>
  <block id="c750cfcf9c6045b6e0b4b0d6de2212f3" category="inline-link-macro">MetroCluster 升级和扩展</block>
  <block id="61999f6fa7ffc8c1f676441d457e3d86" category="cell"><block ref="61999f6fa7ffc8c1f676441d457e3d86" category="inline-link-macro-rx"></block></block>
  <block id="d1b75581244e03161b57c29a9ac4bb22" category="inline-link-macro">使用 CLI 管理磁盘和聚合</block>
  <block id="c3aed88c9ee3a48f5d62930613f5710f" category="cell"><block ref="c3aed88c9ee3a48f5d62930613f5710f" category="inline-link-macro-rx"></block></block>
  <block id="083222857448e1fa46a20ea7d228c4a3" category="cell">介绍如何使用命令行界面管理 ONTAP 物理存储。其中介绍了如何创建，扩展和管理聚合，如何使用 Flash Pool 聚合，如何管理磁盘以及如何管理 RAID 策略。</block>
  <block id="9fc34575910b3b930388b5434f515842" category="inline-link-macro">高可用性管理</block>
  <block id="8b8cdc632b8dd03afd9af9cf3f0bbb00" category="cell"><block ref="8b8cdc632b8dd03afd9af9cf3f0bbb00" category="inline-link-macro-rx"></block></block>
  <block id="c1a14ef4c1320caf80e81dff4161eb9b" category="inline-link-macro">使用 CLI 进行逻辑存储管理</block>
  <block id="23806251831778e9042b7dc8e04e42d9" category="cell"><block ref="23806251831778e9042b7dc8e04e42d9" category="inline-link-macro-rx"></block></block>
  <block id="9dc1904e0c3ace141704b477cd9b345d" category="inline-link-macro">网络管理</block>
  <block id="378e9004462b7ecfad8256f25b57fbf6" category="cell"><block ref="378e9004462b7ecfad8256f25b57fbf6" category="inline-link-macro-rx"></block></block>
  <block id="65fd0eeec8bd27e4c5c654edfee09feb" category="inline-link-macro">使用 CLI 进行 SAN 管理</block>
  <block id="664cc44494bab5cf2c42eaaf2e325791" category="cell"><block ref="664cc44494bab5cf2c42eaaf2e325791" category="inline-link-macro-rx"></block></block>
  <block id="47773d8cdfca4f560a96f33d81b47858" category="cell">介绍如何使用 iSCSI 和 FC 协议配置和管理 LUN ， igroup 和目标，以及使用 NVMe/FC 协议的命名空间和子系统。</block>
  <block id="121d9e4993fb92968420c9621abc9dd8" category="inline-link-macro">SAN 配置参考</block>
  <block id="b6cd49332e8e4e167bacc80f785766b6" category="cell"><block ref="b6cd49332e8e4e167bacc80f785766b6" category="inline-link-macro-rx"></block></block>
  <block id="52e0bf29e7e2fb64c989717df1d63c01" category="inline-link-macro">确定是使用 System Manager 还是使用 ONTAP 命令行界面进行集群设置</block>
  <block id="c8043f5acc6a28fdf197d7834583500e" category="cell"><block ref="c8043f5acc6a28fdf197d7834583500e" category="inline-link-macro-rx"></block></block>
  <block id="a2960939186ae78b824d694e2cbba800" category="inline-link-macro">CLI 管理概述</block>
  <block id="1baf9f7ecc4554f61d6168e4897ea002" category="cell"><block ref="1baf9f7ecc4554f61d6168e4897ea002" category="inline-link-macro-rx"></block></block>
  <block id="d04e5f519989e5f2ca95f9541ffe17a0" category="inline-link-macro">升级 ONTAP</block>
  <block id="52fe96f88349d1bc6c73acbb2110bf86" category="cell"><block ref="52fe96f88349d1bc6c73acbb2110bf86" category="inline-link-macro-rx"></block></block>
  <block id="10c0930f56be634af04f178b42398018" category="paragraph">。 <block ref="a578dfd24b9ac76011d432b13fc1b9d1" category="inline-link-macro-rx"></block> 此外，还包含有关网络接口卡（ NIC ）以及可能与系统结合使用的其他硬件的文档。它还包含 <block ref="9c839fcdfb8699a63c787254d7b1ae03" category="inline-link-macro-rx"></block>，提供有关新系统支持的硬件的信息。</block>
  <block id="c09b5be4c2da04f4040eef1878f258aa" category="inline-link">ONTAP 9 文档</block>
  <block id="4c77344094e11bcee3a61c5cd6d9d092" category="paragraph">访问<block ref="10428d07d2ebc7af9af6725963887c6d" category="inline-link-rx"></block>。</block>
  <block id="4c6af378b95f57bc3cd0d3c8aeab771d" category="paragraph">访问 <block ref="5fbf315c6f5ea598be883d972c599456" category="inline-link-macro-rx"></block> 工具。</block>
  <block id="4ba8d4701b7c72b570a63797aff938e0" category="list-text">从 ONTAP 9.10.1 开始，基于自动协商切换（ Automated Negotiated switchover ， NSO ）的升级操作步骤是四节点 MetroCluster FC 配置的默认配置。如果要升级四节点 MetroCluster FC 配置，则在执行问题描述 `ssystem controller replace start` 命令时，必须通过将 ` -NSO` 参数设置为 `false` 来防止基于 NSO 的操作步骤启动：</block>
  <block id="b3afc5631bd5d3ad4780733ad83b3ed3" category="paragraph">`ssystem controller replace start -nodes &lt;node_name&gt; -NSO false`</block>
  <block id="b5217a01cec2b264eab0761f085ee2eb" category="list-text">`ssystem controller replace start` 命令只能在高级权限级别执行：</block>
  <block id="45e3f26bb2c9a72d8467afe9a6c33e38" category="cell">检查要更换的节点是否运行相同版本的 ONTAP 。如果 ONTAP 映像版本不同，则此任务将失败。新节点上安装的 ONTAP 9.x 版本必须与原始节点上安装的版本相同。如果新节点安装的 ONTAP 版本不同，则在安装新控制器后，需要通过网络启动这些控制器。有关如何升级 ONTAP 的说明，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _Upgrade ONTAP 。</block>
  <block id="954ad5efed3e43bfb3badad9c505735b" category="cell">如果要更换的任何节点缺少磁盘或磁盘出现故障，则此任务将失败。如果缺少任何磁盘，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 使用 cli_ 链接到 _Disk 和聚合管理，使用 cli_ 链接到 _Logical storage management 以及 _High Availability management_ ，为 HA 对配置存储。</block>
  <block id="3f906c041fb469b2794aa7ce7964b2a7" category="list-text">按照系统控制台上控制器更换操作步骤的指示运行以下一组命令。</block>
  <block id="c209ee9c3a703005ec3303b04dddff2f" category="paragraph">请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _RAID MetroCluster 管理和灾难恢复 _ 内容，并使用所述的协商切换，修复和切回过程。</block>
  <block id="b029dd94e134cfaf963a04051ff43f6d" category="admonition">如果要升级的系统支持内部驱动器（例如 FAS2700 或 AFF A250 ），但没有内部驱动器，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 并使用 _aggregate relocation 中的操作步骤手动升级适用于您的 ONTAP 版本的控制器 Hardware_ 内容。</block>
  <block id="14fc1fec490b9f5ad23d58c3c55d4441" category="paragraph">如果要使用内部驱动器升级入门级控制器，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 要链接到 _Upgrade by moving volumes or storage_ 并转到操作步骤 _upgrading a pair of nodes running candlused_by Data ONTAP moving volumes_ 。</block>
  <block id="5ab1ba3aba863ed7175637aaa48e2f73" category="paragraph">使用适用于 node3 平台的 _Installation and Setup Instructions_or the _FlexArray Virtualization Installation Requirements and Refertion_ ，相应的磁盘架文档和 _High Availability Management_ 为以下连接布线。</block>
  <block id="3220ae1a7e96353e5be6c31af0b5207a" category="paragraph">此升级操作步骤主要是适用场景升级情形，其中您要更换的控制器型号不支持更高的 ONTAP 版本，而新控制器不支持更早的 ONTAP 版本。* 您可以使用此操作步骤升级具有两个以上节点的集群中的控制器硬件；但是，您需要为集群中的每个高可用性（ HA ）对单独执行操作步骤。* 此操作步骤适用场景 FAS 系统， V 系列系统， AFF 系统以及安装了 FlexArray 虚拟化软件的系统。如果安装了所需的许可证，则在 ONTAP 9.5 之后发布的 FAS 系统可以连接到存储阵列。有关存储阵列和 V 系列型号的详细信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 要链接到 _V Hardware Universe 系列支持表，请访问 V 系列支持表。* 此操作步骤适用场景系统运行 4 节点 NetApp MetroCluster 配置或更高版本。由于 MetroCluster 配置站点可以位于两个物理上不同的位置，因此对于 HA 对，必须在每个 MetroCluster 站点上单独执行控制器自动升级。* 如果要从 AFF A320 系统升级，可以使用卷移动升级控制器硬件或联系技术支持。请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 通过移动卷或存储链接到 _Upgrade 。</block>
  <block id="c78fd54aa1461d651da28406676f336f" category="admonition">在此操作步骤中， _re-creating VLANs ， ifgrp 和 broadcast domains_section 已重命名为 _restoring network configuration on node4_ 。</block>
  <block id="de1d1723e281ecfbe16611cb895dd237" category="paragraph">有关创建和重新创建 VLAN ，接口组和广播域的详细信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _Network Management_ 。</block>
  <block id="84b1703925b211a597f4b166b1d80848" category="list-text">对于非 MetroCluster 系统，例如 HA 集群， ARL 升级是唯一受支持的操作步骤。</block>
  <block id="598121171fa3c84a4730985ce38a5809" category="list-text">如果要从 AFF A320 系统升级，您可以使用卷移动升级控制器硬件或联系技术支持。请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 通过移动卷或存储链接到 _Upgrade 。</block>
  <block id="ca130918e8c1cca37cee5e91d913b35b" category="summary">此内容介绍如何使用新控制器升级 HA 对中的存储控制器。</block>
  <block id="7502f8f780af629ea69a176b286f5472" category="doc">确定是否使用聚合重新定位内容</block>
  <block id="3f798c20b7ed33a5dda01b83754704c2" category="paragraph">此内容介绍如何使用新控制器升级 HA 对中的存储控制器，同时保留所有现有数据和磁盘。这是一个复杂的操作步骤，只能由经验丰富的管理员使用。</block>
  <block id="5db2a90135780e31de828df5452d32e1" category="paragraph">在以下情况下，应使用此内容：</block>
  <block id="6068cafb9274839f4dfb371ae190757e" category="list-text">如果要升级 MetroCluster 配置，则此配置为四节点或更高版本的 FC 配置，并且所有节点均运行 ONTAP 9.8 或更高版本。</block>
  <block id="4c9c9eda5f5430e91b4aed6f35a5e99d" category="paragraph">有关升级 MetroCluster IP 配置的信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _RAID MetroCluster 升级和扩展 _ 内容。</block>
  <block id="10d20d0fff1a2bb0b064f8b1a068b234" category="paragraph">如果您希望使用其他方法升级控制器硬件并愿意执行卷移动，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 通过移动卷或存储链接到 _Upgrade 。</block>
  <block id="5faf3e9d007712b89cd716c2cbabed9f" category="paragraph">在控制器升级期间，此控制器将被替换为另一个运行更新或功能更强大的平台的控制器。此内容的早期版本包含无中断控制器更新过程的说明，该过程由完全手动的步骤组成。此内容介绍了新的自动化操作步骤的步骤，该 利用自动网络端口可访问性检查进一步简化了控制器升级体验。</block>
  <block id="794c7b1870555759c37165eedd11e861" category="admonition">在此操作步骤中， _re-creating VLAN ， ifgrp 和 broadcast domains_一 节已重命名为 _Restore node3_ 上的网络配置。</block>
  <block id="2618ba1924760141eb8ebfb30bb1d8a9" category="paragraph">有关创建和重新创建 VLAN ，接口组和广播域的详细信息，请访问 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 并链接到 _Network Management_ 。</block>
  <block id="b838d4fde6c980fa55cf1649eccebfb3" category="paragraph">请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 要链接到 _Network Management_ 或 _ONTAP 9 命令：手册页参考 _ 以了解详细信息。</block>
  <block id="9b4a7067960efcb28456ef46d4ac8143" category="cell">如果要更换的任何节点缺少磁盘或磁盘出现故障，则此任务将失败。如果缺少任何磁盘，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 使用 cli_ 链接到 _Disk 和聚合管理，使用 cli_ 链接到 _Logical storage management 以及 _High Availability management_ ，为 HA 对配置存储。</block>
  <block id="eff04d06fc1c15ba7f721c6eb771ca87" category="list-text">如果要从 AFF A320 系统升级，您可以使用卷移动升级控制器硬件或联系技术支持。如果您愿意执行卷移动，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 通过移动卷或存储链接到 _Upgrade 。</block>
  <block id="07a8ab3686b15a3d9a083f4d17e1ff66" category="summary">此内容介绍如何使用新控制器升级 HA 对中的存储控制器，同时保留所有现有数据和磁盘。</block>
  <block id="9897d9d5a6dc54cd05e35a06df6d54b5" category="paragraph">请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 要链接到 _Network Management_ 或 _LIF_ ONTAP 9 命令：手册页参考 _ 并参见 _Configuring failover settings on a LIF_ 了解详细信息。</block>
  <block id="a9d3faafd0ef9c5ec130e05dd480e7d3" category="summary">您需要使用特定工具来安装新硬件。此外，您还可以参考其他文档和其他信息。</block>
  <block id="c27e64cafb401d038cff1543dd15a9f5" category="paragraph">此内容的早期版本包含无中断控制器更新过程的说明，该过程由完全手动的步骤组成。此内容提供了新的自动化操作步骤的步骤。</block>
  <block id="0fe674cba26a6125717793de11bb3096" category="inline-link">集群扩展管理</block>
  <block id="ba4c26e136f2c434b8b6af81213365cf" category="paragraph"><block ref="ba4c26e136f2c434b8b6af81213365cf" category="inline-link-rx"></block></block>
  <block id="9d9192129e1b9a1e59bd50fc144f8867" category="paragraph"><block ref="9d9192129e1b9a1e59bd50fc144f8867" category="inline-link-rx"></block></block>
  <block id="579f7a458ea3f243e9743154fab94bfb" category="inline-link">使用 CLI 管理加密</block>
  <block id="6aee45ea83745bd29b2b86870d2afe83" category="list-text">使用中的相应操作步骤还原存储或卷加密功能<block ref="713156fa56254a04d458a101e174aa50" category="inline-link-rx"></block> 内容</block>
  <block id="086420e81e05bfb84cdecaa4b231e80e" category="paragraph"><block ref="086420e81e05bfb84cdecaa4b231e80e" category="inline-link-rx"></block></block>
  <block id="fbe34624578a760349ae68127c704b12" category="paragraph"><block ref="fbe34624578a760349ae68127c704b12" category="inline-link-rx"></block></block>
  <block id="22e61f778fcc138303ee1a3352b40770" category="list-text">登录到<block ref="9a6f401ca1e7e89d8a0c29fb0cbe81b7" category="inline-link-rx"></block> 站点</block>
  <block id="32f214bce43cce7090d2126fda118b4f" category="paragraph">如果您的系统未在上面列出，请参见<block ref="f73c85a53b5d65cc9c35da0b9e0d2f09" category="inline-link-rx"></block> 以检查它是否具有内部驱动器。</block>
  <block id="60dc130e71debefeec3618ac3017c8cc" category="list-text">如果需要，请按照相应适配器安装操作步骤中的说明在 node3 和 node4 中安装任何适配器。</block>
  <block id="05a828bdf3e9eb5eb73dbd8f32fc87ba" category="inline-link">查找所需的数据保护操作步骤</block>
  <block id="830476e871eedc92e5ffda6c2c33b533" category="paragraph"><block ref="331cb63b7c37688cf0c07ea29b8a4923" category="inline-link-rx"></block>。</block>
  <block id="605eb2ff368b7d55e14901ea718fa36c" category="list-text">您必须已查看 <block ref="3548781d8fe3c65e8421c7698ed973f9" category="inline-link-macro-rx"></block> 关于移动内部驱动器。</block>
  <block id="7c5ee56a01b06b00d2d910cc295d8c56" category="paragraph"><block ref="7c5ee56a01b06b00d2d910cc295d8c56" category="inline-link-rx"></block></block>
  <block id="5fbaf3818e4461fbf39776037d449b56" category="paragraph"><block ref="5fbaf3818e4461fbf39776037d449b56" category="inline-link-rx"></block></block>
  <block id="b834460d0f5479ce8ff8376257efb419" category="paragraph">有关根聚合大小要求，请参见<block ref="f73c85a53b5d65cc9c35da0b9e0d2f09" category="inline-link-rx"></block></block>
  <block id="58e1fb49e8eda8dc590e37ebdffc8e85" category="list-text">如果要升级双节点 MetroCluster 配置，请参见：<block ref="a3f8fb08d450ed0f7b5dc460c9a9149e" category="inline-link-rx"></block></block>
  <block id="b71567cb9c157f9c9b7aa387b9fe6ae0" category="paragraph"><block ref="b71567cb9c157f9c9b7aa387b9fe6ae0" category="inline-link-rx"></block></block>
  <block id="b1ddd6d6d90c80426e14d10c6ded3cc0" category="paragraph"><block ref="b1ddd6d6d90c80426e14d10c6ded3cc0" category="inline-link-rx"></block></block>
  <block id="8481ff5a6197df6d5f77cc03a2cc6d88" category="paragraph"><block ref="8481ff5a6197df6d5f77cc03a2cc6d88" category="inline-link-rx"></block></block>
  <block id="793b486187db5ad7f686089607c08fea" category="list-text">参数 ` node1_sysid_` 是您在关闭原始节点 _ 中记录的值， <block ref="1e1f8cc7c148a6ce0e555a2eab402733" category="inline-link-macro-rx"></block>。</block>
  <block id="cfd2431baff6fc4122f2c8fed540c128" category="paragraph">During the process of upgrading by moving storage, you power on node3 and node4, boot the software image, and configure the nodes.Physical port layout between original and new nodes can be different.Mapping of ports between original and replacement nodes should be done to identify proper layout of ports and connections.</block>
  <block id="a57aac48a821a53a307169a496e18118" category="inline-link-macro">第 5 步</block>
  <block id="2b74e29dce2257a68211617c402f9061" category="paragraph">如果在新节点上运行的 ONTAP 版本与原始节点上的版本不同，则必须已从 NetApp 支持站点将正确的 ` &lt;ontap_version&gt;_image.tgz` 文件下载到可通过 Web 访问的目录中（请参见 _prepare for the upgrade when moving storage_ ， <block ref="a49c2511b21eba354c03ca701f675aae" category="inline-link-macro-rx"></block>）。要对系统执行网络启动，您需要使用 ` &lt;ontap_version&gt;_image.tgz` 文件。</block>
  <block id="e1ce4559a42a4367692a8dd680a8a25c" category="paragraph">您必须已查看 <block ref="3548781d8fe3c65e8421c7698ed973f9" category="inline-link-macro-rx"></block> 关于将节点转换为驱动器架。如果您需要特定于您的配置的指导，应联系技术支持。</block>
  <block id="fb466db54f62bed3a97d8ba7d3ed2c8e" category="list-text">使用中的相应操作步骤还原存储或卷加密功能<block ref="9dcdd70dc160b50ece72ebdfa01ae45b" category="inline-link-rx"></block> 内容</block>
  <block id="ac8600b2addf6ed639b9f65bda812bde" category="list-text">获取有关要升级到的每个新节点的默认集群端口，数据端口和节点管理端口的信息：<block ref="f73c85a53b5d65cc9c35da0b9e0d2f09" category="inline-link-rx"></block></block>
  <block id="2c6817284baf4051a1411668b9c30fcb" category="list-text">【预备 _move_store_5]] 下载并准备用于执行网络启动的文件。</block>
  <block id="f18720a1eb7d7bace925c2a97a20075f" category="list-text">访问<block ref="3725c06f412bedb14ffd610de312875d" category="inline-link-rx"></block> 下载用于执行系统网络启动的文件。</block>
  <block id="7d29fb6edb20ce6f3fcde443c39ef137" category="inline-xref-macro">设置新节点</block>
  <block id="ca8b0b541358f7e84a5255015051bf42" category="paragraph">您将使用目录中的信息 <block ref="8bfb8dcff60c45f1bd8ce7151db542d5" category="inline-xref-macro-rx"></block>。</block>
  <block id="3098dc1e81196ed0a5c7526536b21dc6" category="list-text">找到您在 _prepare for upgrade when moving storage_ 中记录的 node1 和 node2 的端口和 LIF 配置信息， <block ref="54c74de3517b342dfae1a3129a67e9ec" category="inline-link-macro-rx"></block>。</block>
  <block id="785fd52ca2c4957e9caba4406db084c0" category="list-text">找到您在移动存储时准备升级中记录的端口，广播域和 IP 空间的信息， <block ref="54c74de3517b342dfae1a3129a67e9ec" category="inline-link-macro-rx"></block>。</block>
  <block id="d6c1fabab1e38229f8993970016f410e" category="list-text">[[MAP_98_5]] 修改托管数据 LIF 的物理端口的广播域成员资格。您可以手动执行此操作，如 _Map network ports using ONTAP 9.7 or earlier 中所示， <block ref="db0e021b647d866bb2f507379ea311cb" category="inline-link-macro-rx"></block>。建议的方法是使用 ONTAP 9.8 中引入的增强型网络可访问性扫描和修复操作步骤，如以下步骤 5 的子步骤（ a ）到（ g ）所示。</block>
  <block id="b27e1f5014645cf6a835fb2e11524da4" category="list-text">如果系统上未配置任何 VLAN ，请转至 <block ref="44c817ee9110592f40577b67e8940aff" category="inline-xref-macro-rx"></block>。如果已配置 VLAN ，请还原先前在不再存在的端口上配置的或在已移至另一广播域的端口上配置的已替换 VLAN 。</block>
  <block id="ebabbc1ebee66becea669b0e9c3afadc" category="list-text">自 ONTAP 9.8 起，如果在网络端口可访问性修复操作步骤期间在广播域之间移动了 LIF 的主端口，则 ONTAP 将自动修改 LIF 的主端口。如果 LIF 的主端口已移至另一个节点或未分配，则该 LIF 将显示为已替换的 LIF 。还原主端口不再存在或已重新定位到另一节点的已替换 LIF 的主端口。</block>
  <block id="72a19323d192a6a70bcf03b98d5355ae" category="paragraph">如果所有端口均已正确配置并添加到正确的广播域中，则 network port reachability show 命令应将所有已连接端口的可访问性状态报告为 ok ，而对于没有物理连接的端口，此状态报告为 no-reachability 。如果任何端口报告的状态不是这两个端口，请按照中所述修复可访问性 <block ref="84a764803e273063ea87749716b7c654" category="inline-xref-macro-rx"></block>。</block>
  <block id="2c6770803baeb326c3573c2c99ff387a" category="summary">此内容介绍如何通过移动存储或卷来升级集群中 AFF 系统或 FAS 系统的控制器硬件。</block>
  <block id="10ce071fec41e8ee934d0d2c7ef28c46" category="doc">确定是通过移动卷还是存储进行升级</block>
  <block id="4f6f8ce25595fc7944ee0e4e1667d92a" category="paragraph">如果要在以下情况下升级控制器硬件，应使用此操作步骤：</block>
  <block id="ec9ed7bffd77d0096865ed2f7cdcc6cb" category="inline-link">MetroCluster ® 升级和扩展</block>
  <block id="b57acc6aae5b9384209bb66a6c83f8e9" category="paragraph">如果要升级双节点 MetroCluster 配置，则必须使用中的操作步骤<block ref="8f8223d27ded43641f85508576e6eb9a" category="inline-link-rx"></block> 内容</block>
  <block id="ee50784c4307d33a05ee2e7ea5146e6b" category="inline-link-macro">ARL 控制器硬件升级</block>
  <block id="a96bbb56bf9f254d0e2034d1d7d6da26" category="paragraph">此内容不介绍如何使用聚合重新定位（ Aggregate Relocation ， ARL ）升级控制器硬件，如中所述 <block ref="f1bb1f12e9cbaac696243166fca7cc1f" category="inline-link-macro-rx"></block> 内容</block>
  <block id="4888a1163bab7e13f5a9de829f599dba" category="inline-link">从何处查找 MetroCluster 维护任务的过程</block>
  <block id="effb241d20cc6c1913b072368a57f470" category="paragraph"><block ref="effb241d20cc6c1913b072368a57f470" category="inline-link-rx"></block></block>
  <block id="8b6679d6197b72adb78dae0febbb41a1" category="list-text">找到您在移动存储时准备升级中记录的端口，广播域和 IP 空间的信息， <block ref="54c74de3517b342dfae1a3129a67e9ec" category="inline-link-macro-rx"></block>。</block>
  <block id="f7099f8383ed0316e1e0935c4d6ccef1" category="list-text">[[map_97_7]] 调整节点管理广播域，并根据需要迁移节点管理和集群管理 LIF ：</block>
  <block id="273df14d79796f9686588da9d3449080" category="list-text">如有必要，请使用中的命令调整集群间广播域并迁移集群间 LIF <block ref="ff47d2d93900744c317edfe39ed00899" category="inline-xref-macro-rx"></block>。</block>
  <block id="34c3e41105245eedc58a41b84d06a8da" category="list-text">如果需要，请使用中的命令调整任何其他广播域并迁移数据 LIF <block ref="ff47d2d93900744c317edfe39ed00899" category="inline-xref-macro-rx"></block>。</block>
  <block id="da988c28044d8fc8463a4db2336f20f0" category="list-text">node4 平台的 _Installation and Setup Instructions_or _FlexArray 虚拟化安装要求和参考 _ 。</block>
  <block id="72860e73833a237fd9811df9152c9a7a" category="list-text">相应的磁盘架操作步骤</block>
  <block id="b9b51f95b333e31e76a0f718bee344fa" category="list-text">高可用性管理 _ 文档</block>
  <block id="a4f00211b8c08beb36ddb01f259c12c9" category="summary">是否使用此内容。</block>
  <block id="6afaaeefe5c37f69581ad1614c57cff4" category="paragraph">转至 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 要链接到 _Network Management_ 或 _ONTAP 9 命令：手册页参考 _ 以了解详细信息。</block>
  <block id="9f60baa5d0a7e514432de3c5beb88857" category="paragraph">如果要升级内部磁盘驱动器上具有根聚合或数据聚合的控制器，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 要链接到 _Upgrade by moving volumes or storage_ 并转到操作步骤 _upgrading a pair of nodes running candlused_by Data ONTAP moving volumes_ 。</block>
  <block id="ae307041467b0820fea754d90cc7abda" category="admonition">如果要升级集群中节点上的 ONTAP ，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _Upgrade ONTAP 。</block>
  <block id="986991a93176ee231138e71796e3557e" category="paragraph">请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _High Availability management_ 并按照 _Best Practices for HA pairs_一 节进行操作。原始节点均不应以 50% 以上的利用率运行；如果某个节点以低于 50% 的利用率运行，则它可以在控制器升级期间处理这两个节点的负载。</block>
  <block id="870f3919ccdf915afce9d1fca690c412" category="paragraph">新节点上安装的 ONTAP 9.x 版本必须与原始节点上安装的版本相同。如果新节点安装的 ONTAP 版本不同，则在安装新控制器后，需要通过网络启动这些控制器。有关如何升级 ONTAP 的说明，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _Upgrade ONTAP 。</block>
  <block id="e1cbc9b64c5a195f57ded4409cfe8fbc" category="paragraph">如果任一节点处于部分交还状态，请使用 `storage failover giveback` 命令执行交还，然后使用 `storage failover show-giveback` 命令确保仍不需要交还聚合。有关命令的详细信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _High Availability management_ 。</block>
  <block id="f6ad618b685a2a7a446cddb4787d965d" category="paragraph">如果缺少任何磁盘，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 使用 cli_ 链接到 _Disk 和聚合管理，使用 cli_ 链接到 _Logical storage management 以及 _High Availability management_ ，为 HA 对配置存储。</block>
  <block id="26284a568c7e38bb6355694c41ff5f8d" category="paragraph">如果任何磁盘出现故障，请按照 _Disk 和使用 cli_ 进行聚合管理中的说明将其删除。请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 使用 cli_ 链接到 _Disk 和聚合管理。）</block>
  <block id="2722bd9e96d97f6dd8c071e92fb500ce" category="list-text">node3 平台的 _Installation and Setup Instructions_or _FlexArray 虚拟化安装要求和参考 _ 。</block>
  <block id="025b7f36f1c9c8c4d48374557ce1ad36" category="paragraph">有关存储聚合重新定位命令的详细信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 要使用 cli_ 和 _disk ONTAP 9 命令链接到 _disk 和聚合管理：手册页参考 _ 。</block>
  <block id="30e26e7bc72201dff893ca95a6a239d8" category="paragraph">请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 要链接到包含 cli_ 内容 ONTAP 的 _Disk 和聚合管理以及 _storage 9 命令：手册页参考 _ ，请了解有关存储聚合重新定位命令的详细信息。</block>
  <block id="b146e8621e721a92c4b9d852f016cd74" category="paragraph">FC 交换机端口使用情况必须与 _Fabric-Attached MetroCluster 安装和配置 _ 内容中所述的使用情况匹配，才能使用这些 RCF 。转至 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _Fabric-Attached MetroCluster 安装和配置 _ 内容。</block>
  <block id="c7ed61befb59e9d4925fe6dba2f74da6" category="paragraph">使用 _Fabric-Attached MetroCluster 安装和配置 _ 内容，使用八节点 MetroCluster 配置的端口使用情况确定您的交换机类型的布线布局。FC 交换机端口使用情况必须与内容中所述的使用情况匹配，才能使用参考配置文件（ Reference Configuration Files ， RCF ）。</block>
  <block id="873e03798738ee8f4ea5e24bbff9d693" category="paragraph">转至 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _Fabric-Attached MetroCluster 安装和配置 _ 内容。</block>
  <block id="d603be65c0654d63c4817725f161fe00" category="cell">继续执行此操作步骤。* 注 * ：继续操作之前，必须将聚合置于脱机状态，然后销毁内部磁盘驱动器上的聚合。请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 使用 cli_ 内容链接到 _Disk 和聚合管理，以了解有关管理聚合的信息。</block>
  <block id="0c9aa3612df5d94ae5897306ed0ce042" category="cell">继续执行此操作步骤。* 注 * ：在继续操作之前，必须先将卷移动到外部磁盘架，使聚合脱机，然后销毁内部磁盘驱动器上的聚合。请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 使用 cli_ 内容链接到 _Disk 和聚合管理，以获取有关移动卷的信息。</block>
  <block id="bba101d4874014cacb5b1fc7fbe7165c" category="paragraph">请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _RAID MetroCluster 管理和灾难恢复 _ 内容，并按照协商切换，修复和切回的过程进行操作。</block>
  <block id="d39db7fce48b58f92b4d2b9b0c3351df" category="paragraph">有关详细信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 要链接到 _Network Management_ 或 _LIF_ ONTAP 9 命令：手册页参考 _ ，请转到 _Configuring failover settings on a LIF_ 。</block>
  <block id="2c075b61ab1e5a7bc43a337e5b594a77" category="paragraph">有关 storage aggregate relocation 命令的详细信息，请转至 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 要使用 cli_ 和 _disk ONTAP 9 命令链接到 _disk 和聚合管理：手册页参考 _ 。</block>
  <block id="5f57a66b3e1d6733761d27be10e87b12" category="list-text">有关 MetroCluster IP 配置以及适用于 Fabric MetroCluster 配置的其他升级选项，请转至 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _RAID MetroCluster 升级和扩展 _ 内容。</block>
  <block id="8ccdb707cd31c1e478505a54dfa90f7a" category="paragraph">此内容介绍如何通过聚合重新定位在不中断的情况下升级控制器硬件。</block>
  <block id="6e58652b4dc76659a9eeef1a0ccc6daf" category="paragraph">此内容介绍了如何使用聚合重新定位（ Aggregate Relocation ， ARL ）在不造成中断的情况下升级控制器硬件。</block>
  <block id="35deab861c4c6574ac8f1f1318cc7d5e" category="paragraph">有关升级控制器硬件的其他方法，请参见 <block ref="503464dd540ecb373e0d8f614f4262f2" category="inline-xref-macro-rx"></block> 通过移动卷或存储链接到 _Upgrade 。</block>
  <block id="f7a0874d2fe18058d08d01fb0120a9d9" category="paragraph">ARL 利用 HA 配置，您可以将非根聚合的所有权从一个节点移动到另一个节点，前提是它们在同一集群中共享存储。</block>
  <block id="baf4103e3ee1058b17cd4da23c15704b" category="paragraph">您可以通过两种 ARL 方法使用系统命令或执行手动升级来升级控制器硬件。开始之前，您必须确认为控制器硬件升级选择了正确的内容。</block>
  <block id="757f3d0794e578256e35f77de45e53d1" category="paragraph">如果您要使用 system 命令执行升级，请参见下表：</block>
  <block id="f205bf1a1b77ff86829c2c9003e57d32" category="paragraph">如果要执行手动升级，请参见下表：</block>
  <block id="55b615d5a5d5462e3f46ce9376778ab0" category="list-text">记录 VLAN 和接口组信息，以便在启动 node3 后在 node3 上重新创建 VLAN 和接口组。</block>
  <block id="a2e30cff23423051f81bd802a4867e92" category="list-text">如果尚未保存这些 VLAN 和接口组，请记录 VLAN 和接口组信息，以便在启动 node3 后在 node3 上重新创建 VLAN 和接口组。</block>
  <block id="d5736566f3b38c38d89537f2b1d352ca" category="list-text">如果尚未保存这些 VLAN 和 ifgrp 信息，请记录 VLAN 和 ifgrp 信息，以便在启动 node3 后在 node3 上重新创建 VLAN 和 ifgrp 。</block>
  <block id="1b4080c52526ea8390adef3facc6646f" category="doc">从原始节点中删除不再需要的 SAN LIF</block>
  <block id="94e9d0bee98aefbd97c04b1401f6c790" category="paragraph">如果集群位于 SAN 环境中，则必须先从原始节点中删除不再需要的任何 SAN LIF ，然后才能从集群中取消原始节点的连接。</block>
  <block id="e756ac7d9a5fd3abb4a55029a22c0817" category="summary">根据集群内容和集群环境，您需要移动，删除或重新创建 SAN LIF 。</block>
  <block id="2b3144340f2db340218f76914a6af256" category="doc">创建新的 SAN LIF 或重新创建已删除的 SAN LIF</block>
  <block id="051662f99e538a90d87104fddd664c40" category="inline-link">创建网络接口</block>
  <block id="0b3461f9ff1cc0e9748c51914f12d1ac" category="paragraph">根据集群环境要求，您可以决定创建新的 SAN LIF 或重新创建先前在此操作步骤中删除的 SAN LIF 。您可以使用创建或重新创建 SAN LIF<block ref="307c1988750a87c4014551385f0a3aa7" category="inline-link-rx"></block> 使用 OnCommand ® System Manager_ 文档进行集群管理中的操作步骤。</block>
  <block id="9755bcbb5a429349c5615c0f3ada05c7" category="summary">只有在更改集群内容时才需要移动 SAN LIF 。</block>
  <block id="25f08d7b61860ee1109108f6e40dfa08" category="doc">移动 SAN LIF 的注意事项</block>
  <block id="78e610b85ab6101167c6fa157b66555f" category="paragraph">只有在更改集群内容时才需要移动 SAN LIF ，例如，向集群添加节点或从集群中删除节点。移动 LIF 时，您无需重新对 FC 网络结构进行分区，也无需在集群连接的主机与新目标接口之间创建新的 iSCSI 会话。</block>
  <block id="cea2f29230da8c2fef3774a56b365b07" category="paragraph">您可以使用 `network interface modify` 命令移动 SAN LIF 。要移动 SAN LIF ，您必须使 LIF 脱机，将 LIF 移动到其他主节点或端口，然后将其重新联机到新位置。非对称逻辑单元访问（ Asymmetric Logical Unit Access ， ALUA ）可在任何 ONTAP SAN 解决方案中提供冗余路径和自动路径选择。因此，当 LIF 脱机进行移动时，不会发生 I/O 中断。主机只需重试，然后将 I/O 移动到另一个 LIF 即可。</block>
  <block id="5a7069a59566aed43a1807b999c67b98" category="paragraph">在 LIF 移动期间，您可以无中断地执行以下任务：</block>
  <block id="e30c2c276ce1db1c06a2b1d0b484ce01" category="list-text">将集群中的一个 HA 对替换为升级后的 HA 对，其方式对访问 LUN 数据的主机是透明的</block>
  <block id="6122825da89f3a77f8980f730d12d268" category="list-text">升级目标接口卡</block>
  <block id="995489fe191f249d97b2746413c8ce51" category="list-text">将 Storage Virtual Machine （ SVM ）的资源从集群中的一组节点移至同一集群中的另一组节点</block>
  <block id="56156496b19659e54135677ece56f2f7" category="list-text">当主机服务器联机时，您可以将 SAN LUN 移动到新的 HA 对，而不会中断主机服务器对 LUN 数据的访问</block>
  <block id="2dd82882bae57f157f720bee2e0f1c24" category="inline-link">SAN LIF 移动</block>
  <block id="f6e1595cdf693f15c733ea3348445b77" category="paragraph">有关详细信息，请参见<block ref="52d99da56caea8d9bc5c4380abc20d71" category="inline-link-rx"></block> SAN 存储管理 _ 文档中的操作步骤。</block>
  <block id="b5d4cb67b7812ac1a600c8741c4e6c3e" category="summary">根据集群内容和集群环境的不同，您需要移动，删除或创建 SAN LIF ，或者重新创建已删除的 SAN LIF 。</block>
  <block id="8093d580d9cc0468991044c64c97b174" category="doc">移动，删除或创建 SAN LIF</block>
  <block id="a0b6fb238d938d8b3632372a4084f575" category="inline-link-macro">移动 SAN LIF 的注意事项</block>
  <block id="6c4c7e577e407c3d612b2254ba5aeaad" category="list-text"><block ref="6c4c7e577e407c3d612b2254ba5aeaad" category="inline-link-macro-rx"></block></block>
  <block id="4a0fbf919570309e7272750b2374a969" category="list-text"><block ref="4a0fbf919570309e7272750b2374a969" category="inline-link-macro-rx"></block></block>
  <block id="7411801636d93c5890addb910d57f9f3" category="list-text"><block ref="7411801636d93c5890addb910d57f9f3" category="inline-link-macro-rx"></block></block>
  <block id="a0b4daa7e353d3d7dd1a62bec6a63421" category="list-text"><block ref="a0b4daa7e353d3d7dd1a62bec6a63421" category="inline-xref-macro-rx"></block></block>
  <block id="fa332b15cdfbb22760413e4a60513a40" category="cell">完成 <block ref="a4882b71f5935aea43154f35b1a6d350" category="inline-xref-macro-rx"></block> 然后转到部分 <block ref="7401650b9cd3ea8be2a2d31b363b2b3c" category="inline-link-macro-rx"></block>。</block>
  <block id="b6481dacfe88e9c856041be2326875ff" category="cell">跳过步骤 4 ，然后转到 <block ref="7401650b9cd3ea8be2a2d31b363b2b3c" category="inline-link-macro-rx"></block>。</block>
  <block id="5055165524bf9c633a40b424396e9008" category="section-title">暂停 SnapMirror 关系（可选）。</block>
  <block id="511701430e4fbf5079759a7c3b7c28ff" category="doc">第 4 阶段。记录 node2 信息并停用 node2</block>
  <block id="d21a0858f74e1b40b984bb621122ad41" category="doc">第 5 阶段。安装并启动节点 4.</block>
  <block id="0df71f161bb7f6f4a1dd4c0ceefcb245" category="sidebar">第 4 阶段。记录信息并停用 node2</block>
  <block id="a0f8aeff2834e59d628ba56c42b411bc" category="sidebar">第 4 阶段。重新定位和停用节点</block>
  <block id="69dd6fe430ae07730e1c32b2939c278c" category="inline-link-macro">《 ONTAP 9.9.1 命令：手册页参考》</block>
  <block id="9d844ecf2e54ad978b96146975590298" category="cell"><block ref="9d844ecf2e54ad978b96146975590298" category="inline-link-macro-rx"></block></block>
  <block id="aaf9449e1999e9c9362cfeac571fbaee" category="cell">介绍支持的 ONTAP 9.9.1 命令的语法和用法。</block>
  <block id="b76266f70180ffb55ceb5ea73e67d7c7" category="inline-link-macro">《 ONTAP 9.10.1 命令：手册页参考》</block>
  <block id="c08479ef32255dff91c1115570f6aff4" category="cell"><block ref="c08479ef32255dff91c1115570f6aff4" category="inline-link-macro-rx"></block></block>
  <block id="d361c32c7588b81ad0ce225fabf9cc83" category="cell">介绍支持的 ONTAP 9.10.1 命令的语法和用法。</block>
  <block id="1bcbe4bd68c550a7ed28f4bdd586bc74" category="inline-link-macro">使用 system controller replace 命令将 AFF A700 升级到运行 ONTAP 9.10.1 RC2 或更高版本的 AFF A900</block>
  <block id="2b1fefdeeb661a741761da67d9a06d72" category="cell">介绍使用 system controller replace 命令将 AFF A700 无中断升级到运行 ONTAP 9.10.1 RC2 或更高版本的 AFF A900 所需的聚合重新定位过程。</block>
  <block id="b4c7c005a4b2204b56da4bbb5a2e62b0" category="doc">确定是否使用聚合重新定位操作步骤</block>
  <block id="7550b1d2ff94ade0badf7313d5af406e" category="paragraph">* 您可以使用此聚合重新定位操作步骤手动升级运行 ONTAP 9.7 或更早版本的控制器硬件。 *</block>
  <block id="28f38d2621df64a3408634ed62310686" category="paragraph">`volume online -vserver &lt;vserver_name&gt; -volume &lt;volume_name&gt;`</block>
  <block id="46107b0e8c934a3f1f1051ed0edf1d48" category="list-text">如果在配置中使用了 NetApp 存储加密（ NSE ），并且您将 `setenv bootarg.storageencryption.support` 命令设置为 "true" ，并将 `kmip.init.maxwait` 变量 "off" （在中 <block ref="c34adc28d35ee24325c874eba95a8786" category="inline-link-macro-rx"></block> 对于 _Install and boot node3_ ），您需要重置变量： `set diag ； systemshell -node &lt;node_name&gt; -command sudo kenv -u -p kmip.init.maxwait`</block>
  <block id="29d22afc321b012279dd6e65d63787dd" category="paragraph">`ssystem license delete -serial -number &lt;node1_serial number&gt; -package *` `ssystem license delete -serial -number &lt;node2_serial number&gt; -package *`</block>
  <block id="8a0208d39b7cf58f7d76559678e6cfb4" category="paragraph">上一阶段的后处理检查完成后， node2 的资源释放将自动启动。非根聚合和非 SAN 数据 LIF 将从 node2 迁移到 node3 。</block>
  <block id="2c8d5d299ae32bda89da96f78562714b" category="paragraph">要与此命令结合使用的 ` &lt;vserver_name&gt;` 可在上一个 `volume show` 命令的输出中找到。</block>
  <block id="696de6ab891de690d36689a5b8520665" category="paragraph">`network interface modify -vserver &lt;vserver_name&gt; - lif &lt;LIF_name&gt; -home-node &lt;node_name&gt; - status-admin up`</block>
  <block id="ef3d7350487977f271f56e19fff958fa" category="paragraph">在使用 ARL 升级节点之前，您应了解操作步骤的工作原理。在此内容中，操作步骤将分为多个阶段。</block>
  <block id="c76a89f966d60816d2016df1cbb1b151" category="paragraph">转至 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 第节以访问此升级所需的参考文档和参考站点列表</block>
  <block id="e24d54125503270a46b4d9fcf026b51e" category="paragraph">`storage encryption disk modify -disk * （ -fips-key-id nonMSID AK ）`</block>
  <block id="4c8b55d155015695884299d539ae7e00" category="paragraph">在继续使用操作步骤之前，您必须确认所有 SnapMirror 关系均已暂停。暂停 SnapMirror 关系后，它会在重新启动和故障转移后保持静默状态。</block>
  <block id="650777fb12bf02795637a644c3e71650" category="paragraph">如果状态为 "Transferring" ，则必须中止这些传输： `snapmirror abort -destination-vserver &lt;vserver_name&gt;`</block>
  <block id="fbde754942948696870db0175df11dd9" category="paragraph">`snapmirror quiesce -destination-vserver &lt;vserver_name&gt;`</block>
  <block id="de1d667bca673b8cf1cb4612cfd06564" category="paragraph">* 您可以使用此聚合重新定位操作步骤通过使用 `ssystem controller replace` 命令来升级控制器硬件。此操作步骤适用场景控制器硬件运行 ONTAP 9.5 至 ONTAP 9.7*</block>
  <block id="a90582eb821ba3299ffb22cfeaf2069c" category="paragraph">要停用 node2 ，您需要正确关闭 node2 并将其从机架或机箱中卸下。</block>
  <block id="d62ce8b165f2d134de4a161b0ce71f49" category="list-text">继续执行节点对升级操作步骤的其余部分。</block>
  <block id="fe067063882aa7bb9087ace330c94951" category="paragraph">`ssystem license delete -serial -number &lt;node1_serial number&gt; -package *`</block>
  <block id="ae1fd14d266df956140018dd0a7d3aee" category="paragraph">`ssystem license delete -serial -number &lt;node2_serial _number&gt; -package *`</block>
  <block id="7ae7b85041346021fa869537081fa931" category="paragraph">`set diag ； systemshell -node &lt;node_name&gt; -command sudo kenv -u -p kmip.init.maxwait`</block>
  <block id="2275b38e5279b78660b012808a4cb08e" category="cell">9.10.1 或更高版本</block>
  <block id="9485cc727d9d60c0c782449790411372" category="cell"><block ref="9485cc727d9d60c0c782449790411372" category="inline-link-macro-rx"></block></block>
  <block id="a80362d8850ea6131db54e8994d7ece8" category="cell"><block ref="a80362d8850ea6131db54e8994d7ece8" category="inline-link-macro-rx"></block></block>
  <block id="987d908c963b953e34ffd0bc33ebfd50" category="inline-link-macro">手动升级运行 ONTAP 9.8 或更高版本的控制器硬件</block>
  <block id="4a5512afba1f93dd83104eaac4237453" category="cell"><block ref="4a5512afba1f93dd83104eaac4237453" category="inline-link-macro-rx"></block></block>
  <block id="9732e7498adc911676ddbf1eb96c90f1" category="inline-link-macro">手动升级运行 ONTAP 9.7 或更早版本的控制器硬件</block>
  <block id="c96cad4c802036afa3176e87bcda336b" category="cell"><block ref="c96cad4c802036afa3176e87bcda336b" category="inline-link-macro-rx"></block></block>
  <block id="f306dd59c4187690d6160e9e36979f77" category="paragraph">* 您可以使用此聚合重新定位操作步骤手动升级运行 ONTAP 9.8 或更高版本的控制器硬件。 *</block>
  <block id="88ccaee28fb62fc1b21cac7778ab4453" category="summary">通过准备原始节点并在原始节点和新节点上执行一系列步骤来升级节点对。</block>
  <block id="6b59e02d44f3b3b53fa01e425648f233" category="summary">链接到支持升级所需的参考内容和网站。</block>
  <block id="a58071471f67ff5cff57bebb11741614" category="summary">使用 AFF A900 控制器模块和 NVS 启动 node2 。</block>
  <block id="3dbeb57f4799181a57384b357e7e74a5" category="doc">使用 AFF A900 控制器模块和 NVS 启动 node2</block>
  <block id="a45bc09412779a602b1322d96968599a" category="paragraph">带有 AFF A900 控制器模块和 NVS 的 Node2 现在可以升级了。通过交换控制器模块和 NVS 从 AFF A700 升级到 AFF A900 只涉及移动控制台和管理连接。本节介绍使用 AFF A900 控制器模块和 NVS 启动 node2 所需的步骤。</block>
  <block id="ae6b0fe852f04d15268deac1bff0bc14" category="list-text">`s此配置正在使用 NetApp 存储加密（ NSE ），则必须将` etenv bootarg.storageencryption.support `命令设置为` true `，并将 kmip.init.maxwait` `变量设置为` off ，以避免在加载 node2 配置后出现启动环路：</block>
  <block id="22d219ca4c61aa27b2616b43ecd9678a" category="list-text">将节点启动至 `boot_menu` ：</block>
  <block id="2bbe578e5c09f7900dc7f227b86c3682" category="list-text">节点将停留在启动菜单处。输入 "22/7" 并选择隐藏选项 `boot_after_controller_replacement` 。要将 AFF A700 节点 1 磁盘重新分配给 AFF A900 节点 1 ，请在提示符处输入节点 2 的实际名称。请使用以下示例作为参考：</block>
  <block id="a0597ee31ba19b58e7dea556d59b7025" category="paragraph">上述示例中显示的系统 ID 是示例 ID 。要升级的节点的实际系统 ID 将不同。</block>
  <block id="e3a878334fd2b918ae58df67169ebb51" category="paragraph">在提示符和登录提示符处输入节点名称之间，节点会重新启动几次以还原环境变量，更新系统中卡上的固件以及进行其他 ONTAP 更新。</block>
  <block id="d8a5506f1c8c1c86158c9c0d1d4742fc" category="summary">如果更换的控制器或新控制器的 HA 配对项使用 NetApp 卷加密，则必须为 NVE 配置新控制器模块。</block>
  <block id="3a1b2c38a4df46a98276dff5f167cf5a" category="cell">适用于…</block>
  <block id="ca1ca50323446209228f3f72af231354" category="cell">`security key-manager external restore` 此命令需要 OKM 密码短语</block>
  <block id="7d658c9a89b8497c162f9111ae5111dc" category="list-text">运行预检以验证是否可以执行此操作</block>
  <block id="8e490bd535c0b48fe8a594afea8a5f73" category="list-text">如果预检失败，请更正聚合所有权</block>
  <block id="eab10223a55d1eb3906a74203c54c3b1" category="list-text">输入集群基础许可证密钥</block>
  <block id="10623903188f292ff7edcdd04a4bde0a" category="list-text">获取用于存储加密的 IP 地址</block>
  <block id="8b6cdf5587bb3c668c391531800a425e" category="list-text">使用 KMIP 服务器管理身份验证</block>
  <block id="8a1a86dbdee96725569b0f5771407ad9" category="list-text">使用板载密钥管理器（ OKM ）管理存储加密</block>
  <block id="5967cd2dd5257e032e2c1568e265b057" category="list-text">node1 是 node1 聚合的主所有者和当前所有者</block>
  <block id="a324d0a89d17fcc011978fff16b784da" category="list-text">node2 是 node2 聚合的主所有者和当前所有者</block>
  <block id="2752e749ec326bfcd5d2b1c8a96e0eec" category="cell">第 2 阶段：从 node1 重新定位资源并停用 AFF A700 node1</block>
  <block id="a3003386d0cf2efe6ff31df05d49979a" category="list-text">卸下 AFF A700 控制器模块和 NVS 模块</block>
  <block id="bcca7f2aa4a63af073052a396e3172ee" category="list-text">在节点 1 上安装 AFF A900 NVS 和控制器模块</block>
  <block id="2c30aa39504a6789bd63ff5987a52060" category="list-text">网络启动节点 1</block>
  <block id="70bfac3efc816446939b969cb549c8b8" category="list-text">node2 是 node1 聚合的当前所有者</block>
  <block id="ec258c431af242bb93ebbf0d82a4afd2" category="list-text">node2 是 node2 聚合的主所有者和当前所有者</block>
  <block id="bca2010fe13cf2e45f68eaa23567e695" category="cell">第 3 阶段：使用 AFF A900 控制器模块 NVS 启动 node1</block>
  <block id="87a89403b31b512256b240deacdf60b3" category="list-text">使用 AFF A900 控制器模块和 NVS 启动 node1</block>
  <block id="c355563dc6e37024ffcd7f18d583279e" category="list-text">验证 node1 是否已成功安装</block>
  <block id="8bc1591998d3254a215a1fea9cd0e4be" category="list-text">还原 node1 网络配置</block>
  <block id="0ac66da022e888300d8ec43f47b716d6" category="list-text">在升级后的节点 1 上还原密钥管理器配置</block>
  <block id="e1275af58e555e9cc3d59dc17d1d1ab1" category="list-text">将节点 1 拥有的非根聚合和 NAS 数据 LIF 从节点 2 移动到升级后的节点 1</block>
  <block id="78f9df4f95654214c6e34228379e988b" category="list-text">升级后的 AFF A900 node1 是 node1 聚合的主所有者和当前所有者</block>
  <block id="fff8cb6f4bd9c58d6037356a96d73247" category="cell">第 4 阶段：从 node2 重新定位资源并停用 node2</block>
  <block id="487b7a723d50ceb8e8e166efb4cef927" category="list-text">将非根聚合和 NAS 数据 LIF 从 node2 重新定位到 node1</block>
  <block id="be74d1508b2732e00219890be181ffa6" category="list-text">升级后的 node1 是最初属于 node1 的聚合的主所有者和当前所有者</block>
  <block id="2749cc92bd0dcac6365232852f87d5ed" category="list-text">node2 是 node2 聚合的主所有者</block>
  <block id="5e4cf46306e58ecb7565589182d4efcf" category="list-text">升级后的 node1 是 node2 聚合的当前所有者</block>
  <block id="0871c6e0a065e7fe8fa9c259f64d3375" category="cell">第 5 阶段：在节点 2 上安装 AFF A900 NVS 和控制器模块</block>
  <block id="36fbd64ab69777c4881ed340aaff207a" category="list-text">在节点 2 上安装 AFF A900 NVS 和控制器模块</block>
  <block id="f28e6dd67b477412b5b29af155fdd706" category="list-text">网络启动节点 2.</block>
  <block id="b9d700c14c433794754c2dcdea895b9f" category="list-text">node1 是最初属于 node1 的聚合的主所有者和当前所有者。</block>
  <block id="bc594bc91cd11d472f20e22d31df3f8a" category="list-text">升级后的 node2 是最初属于 node2 的聚合的主所有者和当前所有者。</block>
  <block id="1f6d0d509479c49848684a25777e4dee" category="cell">第 6 阶段：使用 AFF A900 控制器模块和 NVS 启动 node2</block>
  <block id="a9545d4e2e159386ef9b0e397e4672ac" category="list-text">验证 node2 是否已正确安装</block>
  <block id="58f283896d00f6d1826f08e4ff47d9e0" category="list-text">还原 node2 网络配置</block>
  <block id="cf76afd058516dd90fe89aedbec6904e" category="list-text">将非根聚合和 NAS 数据 LIF 移回 node2</block>
  <block id="52a370bfb3df9d6787958443a448c014" category="cell">第 7 阶段：完成升级</block>
  <block id="e3f4bd1f6c7349052d132a5e591ea454" category="list-text">验证是否已正确设置新控制器</block>
  <block id="ca821390724c296a0ea0b07a911d5d46" category="list-text">在新控制器模块上设置 NetApp 卷加密。</block>
  <block id="f17a785a69324188f6b04ccc7b05d636" category="list-text">恢复 NetApp SnapMirror 操作</block>
  <block id="b7d2dd68a616ff5846545cdb7a4d940b" category="section-title">升级完成后， node1 上的聚合将归 node2 所有</block>
  <block id="a6092067c1f4eef24a7887959e25fb77" category="paragraph">升级操作步骤结束时， node1 应为聚合的新主节点，而这些聚合最初将 node1 作为主节点。您可以在升级后重新定位它们。</block>
  <block id="a98ce2caf38bef05082af61a7b3cfd2a" category="paragraph">在以下情况下，聚合可能无法正确重新定位，也就是说，它们的主节点可能为 node2 ，而不是 node1 ：</block>
  <block id="17d6197f66fac0500a1052e1756381a7" category="list-text">在第 3 阶段，聚合从 node2 重新定位到 node1 。</block>
  <block id="b64ff0aed650d75434d24e770d7ac535" category="paragraph">要重新定位的某些聚合的主节点为 node1 。例如，此类聚合可以称为 aggr_node_1 。如果 aggr_node_1 的重新定位在第 3 阶段失败，并且无法强制重新定位，则聚合将留在 node2 上。</block>
  <block id="d2755d5ec111fef82f9587f3e72becd1" category="list-text">在第 4 阶段之后，将 node2 更换为 AFF A900 控制器模块和 NVS 。</block>
  <block id="bbc15afd4ded8ef20f852908a9e94008" category="paragraph">更换 node2 后， aggr_node_1 将联机，并将 node1 作为其主节点，而不是 node2 。</block>
  <block id="7161e79fb43252db4d620ecbcfbe0672" category="paragraph">在启用存储故障转移后，您可以通过完成以下步骤在第 6 阶段后修复不正确的所有权问题：</block>
  <block id="99fb891a920a0a874aa601c151d5ef1b" category="list-text">获取聚合列表：</block>
  <block id="17a1790ffb18c9a641cad0dc7c20a3ec" category="paragraph">`storage aggregate show -nodes node2 -is-home true`</block>
  <block id="4db16bef5cbc6f50c437fd04132472a1" category="paragraph">要确定未正确重新定位的聚合，请参阅在一节中获取的主所有者为 node1 的聚合列表 <block ref="cd8ad1809865824065fe011b80800cd6" category="inline-link-macro-rx"></block> 并将其与上述命令的输出进行比较。</block>
  <block id="0cdc803707489b410a938130768dfdb6" category="list-text">重新定位节点 2 上遗留的聚合：</block>
  <block id="f89fcc2b710de2a30470cc4107dd770c" category="paragraph">`s存储聚合重新定位 start -node node2 -aggr aggr_node_1 -destination node1`</block>
  <block id="1204caf15b63ea601a42b09bd0feafca" category="paragraph">在此重新定位期间，请勿使用 -nt-controller-upgrade 参数。</block>
  <block id="9840fa5d3c651e50130a98db335d1163" category="list-text">验证 node1 现在是否为聚合的主所有者：</block>
  <block id="445fae138e0209c0bbf33e92c38c82b6" category="paragraph">如果聚合的主所有者不是 node1 ，则可以使用步骤 3 中的相同重新定位命令将其重新定位到 node1 。</block>
  <block id="bbb3dce2d4857c4e5311c19a03a40766" category="summary">恢复升级前暂停的 SnapMirror 传输并恢复 SnapMirror 关系。</block>
  <block id="7bc9202b155c1f6bdde7882775324c58" category="summary">如果使用 NetApp 卷加密（ NVE ）对升级后的系统上的卷进行加密，请将加密配置同步到新节点。</block>
  <block id="961892a8e5f7bb9328d303cade402bcd" category="paragraph">如果使用 NetApp 卷加密（ NVE ）对要升级的系统上的卷进行加密，则加密配置必须与新节点同步。从 node2 到 node1 的 node1 聚合的 ARL 完成后，加密卷将脱机。</block>
  <block id="ca4e61b897d2aba15caa170b29123c28" category="summary">在验证 node1 上的网络配置以及将聚合从 node2 重新定位到 node1 之前，必须验证 node1 上的 LIF 所有权。</block>
  <block id="8276e73e0912c13126bc9f47a3a0ed73" category="paragraph">在验证 node1 上的网络配置以及将聚合从 node2 重新定位到 node1 之前，您必须验证当前位于 node2 上的 node1 所属的 NAS 数据 LIF 是否已从 node2 重新定位到 node1 。此外，还必须验证 node1 上是否存在 SAN LIF 。</block>
  <block id="6224b74d5b0b8d2ad6d1e4b341f1fa19" category="paragraph">在升级操作步骤期间，远程 LIF 处理 SAN LUN 的流量。升级期间，集群或服务运行状况无需移动 SAN LIF 。除非需要将 SAN LIF 映射到新端口，否则不会移动这些 LIF 。使 node1 联机后，您必须验证 LIF 是否运行正常并位于相应的端口上。</block>
  <block id="0bff73dcb819ba800842aebfbaa1ea03" category="list-text">执行网络可访问性检查：</block>
  <block id="97ea31dc3aa1f9bc892dfd894fdd9fb5" category="paragraph">`network port reachability -show-detail -node node1`</block>
  <block id="22754bd796837dc212cb05d513ad94cb" category="paragraph">确认所有已连接端口（包括接口组和 VLAN 端口）的状态均显示为 `OK` 。</block>
  <block id="d22abe120efea253d7c808e8381ed917" category="paragraph">执行这些检查后，系统会将 node1 拥有的非根聚合和 NAS 数据 LIF 重新定位到新的 node1 。</block>
  <block id="7d7b11f14dacd1dc55ecbacf79121ab1" category="paragraph">资源重新定位完成后，控制器更换操作将暂停。</block>
  <block id="371a52c6bb799f6fb34f1a8ac8617b35" category="paragraph">如果控制器更换操作步骤已暂停，请检查并更正错误（如果有），然后选择问题描述 `reume` 继续操作。</block>
  <block id="3757d9b51a1e3f55c16c5d25fae22e61" category="paragraph">如果已替换任何 LIF ，请将主节点还原回 node1 ：</block>
  <block id="d181e0da27c4e78665387a7ff1771168" category="summary">对升级节点对时可能发生的故障进行故障排除。</block>
  <block id="5ca028d4c5c14734b97ab83e8a4da7e7" category="summary">您需要使用特定工具来执行升级，并且需要在升级过程中参考其他文档。</block>
  <block id="1b8060cb5ae9dd21090d2ec07cc376b2" category="paragraph">要执行升级，您必须具有接地线，并且在升级过程中需要参考其他文档。</block>
  <block id="eca9749cfcafbfbf086cab4bb011827d" category="paragraph">转至 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 第节以访问此升级所需的参考文档和参考站点列表。</block>
  <block id="87ef01a22276692bd8002ba49df43200" category="summary">在开始升级之前，请确认您具有正确的硬件将 AFF A700 系统升级到 AFF A900 系统。</block>
  <block id="0c28f03f85d0a7cc4b82f95fce4d86da" category="doc">验证升级硬件</block>
  <block id="4724ad316e6c99786068171b2b781c0a" category="paragraph">在开始升级之前，您必须验证是否具有正确的硬件将 AFF A700 系统升级到 AFF A900 系统。对于要升级的每个 HA 对，您应具有两个系统控制器模块和两个 NVS 模块。如果缺少部件，请联系技术支持或 NetApp 销售联系人以获得帮助。</block>
  <block id="086ffca4babb160d824dacd6fe414742" category="summary">使用 AFF A900 控制器模块和 NVS 验证 node1 安装。</block>
  <block id="af9d3f15b5098b02572b4a5b4c346c3d" category="doc">验证 node1 安装</block>
  <block id="84bbe3cd2fa7a3bd0ebc823f5a083cc8" category="paragraph">您必须使用 AFF A900 控制器模块和 NVS 验证 node1 安装。由于物理端口不变，您无需将物理端口从 AFF A700 node1 映射到 AFF A900 node1 。</block>
  <block id="050ee0f77aff38c6ec36f73da8a54e1c" category="paragraph">使用 AFF A900 控制器模块启动 node1 后，必须验证是否已正确安装它。您必须等待 node1 加入仲裁，然后恢复控制器更换操作。</block>
  <block id="c6fd244601cc323697fc7e6249268acd" category="paragraph">此时，在操作步骤中，控制器升级操作应已暂停，因为 node1 会自动尝试加入仲裁。</block>
  <block id="ff5725f7647773e4bb6ba48f86580a14" category="list-text">验证 node1 是否已加入仲裁：</block>
  <block id="73dac86302530c6371ee49f4ae0c3157" category="paragraph">`cluster show -node node1 -fields health`</block>
  <block id="967e808cebc82f90bb9dbf3b8e84c3b3" category="list-text">验证 node1 是否与 node2 属于同一集群，并且其运行状况是否良好：</block>
  <block id="a877d77b53f7818728787e578280c690" category="list-text">控制器更换操作将暂停以进行干预，并显示以下消息：</block>
  <block id="12bff50c4c9a968aed8dc809f95008c3" category="admonition">在本指南中， _re-creating VLAN ， ifgrp 和 broadcast domains_has been re命名 为 _Restore network configuration on node1_ 。</block>
  <block id="ae76f3c30991fdb1e3693cb5811cb1dc" category="list-text">在控制器更换处于暂停状态的情况下，继续执行 <block ref="a4e280a8ee04f7ed15cf014345b7be25" category="inline-xref-macro-rx"></block>。</block>
  <block id="830de75aac3de476490ce8697cfc84ee" category="section-title">还原 node1 上的网络配置</block>
  <block id="7b3bcbfe626392f126d3c9c59049f669" category="paragraph">确认 node1 处于仲裁状态并可与 node2 通信后，请确认 node1 上显示了 node1 的 VLAN ，接口组和广播域。此外，验证所有 node1 网络端口是否均已配置在其正确的广播域中。</block>
  <block id="97d81579a938e85b79eb326c1bccdb4a" category="paragraph">有关创建和重新创建 VLAN ，接口组和广播域的详细信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _Network Management_ 内容。</block>
  <block id="909b05c70a22b9f37b5b0dd91c33c2da" category="list-text">列出已升级的节点 1 上的所有物理端口：</block>
  <block id="85aa04fa5dfb58230ad2b2fb89c2b86d" category="paragraph">此时将显示节点上的所有物理网络端口， VLAN 端口和接口组端口。在此输出中，您可以看到 ONTAP 已将任何物理端口移至 `集群` 广播域。您可以使用此输出来帮助确定应将哪些端口用作接口组成员端口， VLAN 基本端口或用于托管 LIF 的独立物理端口。</block>
  <block id="97a140c436b20824a78c55187d8f3252" category="list-text">列出节点 1 上所有端口的网络端口可访问性：</block>
  <block id="cceb77422957d2a7588c1df43f5eacd8" category="paragraph">`network port reachability show -node node1`</block>
  <block id="2bee4653d7e1eb232ee10310aea5cc5c" category="paragraph">在上述示例中， node1 在更换控制器后启动。某些端口不具有可访问性，因为没有物理连接。您必须修复状态为 `ok` 以外的可访问性的任何端口。</block>
  <block id="9eff901780752a19a1be28a5abb8114f" category="admonition">在将 AFF A700 升级到 AFF A900 控制器期间，网络端口及其连接不应发生变化。所有端口都应驻留在正确的广播域中，并且网络端口可访问性不应更改。但是，在将 LIF 从 node2 移回 node1 之前，您必须验证网络端口的可访问性和运行状况。</block>
  <block id="a5fb308a92e4604c009062c3de7b2789" category="list-text">[[restore_node1_step4]] 使用以下命令按以下顺序修复 node1 上每个端口的可访问性状态不是 `ok` 的可访问性：</block>
  <block id="2c7aa9454c1ca6be9ef48b69c5b8cab5" category="list-text">VLAN 端口</block>
  <block id="cf45ec2f4095abbc4f4afca15dbaa0f3" category="paragraph">如果所有端口均已正确配置并添加到正确的广播域中，则 `network port reachability show` 命令应将所有已连接端口的可访问性状态报告为 `ok` ，对于无物理连接的端口，此状态报告为 `no-reachability` 。如果任何端口报告的状态不是这两个端口，请按照中的说明执行可访问性修复并在其广播域中添加或删除端口 <block ref="b6d8caf83cd967ca96a109c1173cf68b" category="inline-xref-macro-rx"></block>。</block>
  <block id="d652f04b0c47ec3200904bc82c8d5ff7" category="paragraph">`displaced interface restore-home-node -node node_name -vserver vserver_name -lif-name LIF_name`</block>
  <block id="c34ebe5a54f4ac62ebd2695c126240e9" category="paragraph">`network interface show -fields home-port ， status-admin`</block>
  <block id="340327b7236c5a0113c51327f951754b" category="paragraph">从 ONATP 9.10.1 开始，您可以使用密钥管理互操作性协议（ Key Management Interoperability Protocol ， KMIP ）服务器管理身份验证密钥。</block>
  <block id="7a7988caa9fbea853c36e33b0ed26970" category="summary">在将 node2 更换为 AFF A900 控制器模块和 NVS 之前，您必须将 node2 所拥有的非根聚合重新定位到 node1 。</block>
  <block id="f47e31209dbc0c9c074996e9ce017311" category="paragraph">在将 node2 更换为 AFF A900 控制器模块和 NVS 之前，必须先将 node2 所拥有的非根聚合重新定位到 node1 。</block>
  <block id="9d9f265fd42c463def1909297104525a" category="paragraph">上一阶段的后处理检查完成后， node2 的资源释放将自动启动。非根聚合和非 SAN 数据 LIF 将从 node2 迁移到新的 node1 。</block>
  <block id="e254cf6efdd2e615e6727237969d6011" category="paragraph">迁移聚合和 LIF 后，此操作将暂停以进行验证。在此阶段，您必须验证所有非根聚合和非 SAN 数据 LIF 是否均已迁移到新的节点 1 。</block>
  <block id="e7fbff0ca3f51e1ef167cd5ff9eba89b" category="list-text">验证所有非根聚合是否均已联机及其在 node1 上的状态：</block>
  <block id="ced536efc0a82fa41600b180eeacc30a" category="paragraph">`storage aggregate show -node node1 -state online -root false`</block>
  <block id="1ef0b56555ccbaef35e99c2bfb8ce9df" category="paragraph">以下示例显示 node1 上的非根聚合处于联机状态：</block>
  <block id="f69a858b07bbad6343f4772f5dcbe1fe" category="paragraph">如果 node1 上的聚合脱机或变为外部聚合，请在新的 node1 上使用以下命令将其联机，每个聚合一次：</block>
  <block id="8ffd93ea6386b629720c74b50bc25c2e" category="list-text">在 node1 上使用以下命令并检查其输出，以验证 node1 上的所有卷是否联机：</block>
  <block id="30c92ab6acc222d81011f6b7ee804f3f" category="paragraph">`volume show -node node1 -state offline`</block>
  <block id="85e5ea53a85c7a28840f38eea6491b3c" category="paragraph">如果 node1 上的任何卷脱机，请在 node1 上使用以下命令将其联机，每个卷一次：</block>
  <block id="8977859bd55d40dd07f2cd92a82b410d" category="list-text">验证 LIF 是否已移至正确的端口且状态为 `up` 。如果任何 LIF 已关闭，请通过为每个 LIF 输入以下命令将 LIF 的管理状态设置为 up ：</block>
  <block id="6e13fc9d1e75c160461788f1b750083d" category="list-text">使用以下命令并检查输出，以验证 node2 上是否没有剩余数据 LIF ：</block>
  <block id="e8089d3b06db6f1f4decc29895f8aa01" category="summary">验证 node2 上的网络配置后，在将聚合从 node1 重新定位到 node2 之前，必须验证 node2 上的 LIF 所有权。</block>
  <block id="701fa495284f4a753f53b83d9db59d99" category="paragraph">在验证 node2 上的网络配置以及将聚合从 node1 重新定位到 node2 之前，您必须验证当前位于 node1 上的 node2 所属的 NAS 数据 LIF 是否已从 node1 重新定位到 node2 。您还必须验证 node2 上是否存在 SAN LIF 。</block>
  <block id="ee2ce060961db1c7ec1f363acef87d91" category="paragraph">在升级操作步骤期间，远程 LIF 处理 SAN LUN 的流量。升级期间，集群或服务运行状况无需移动 SAN LIF 。除非需要将 SAN LIF 映射到新端口，否则不会移动这些 LIF 。使 node2 联机后，您必须验证 LIF 是否运行正常并位于相应的端口上。</block>
  <block id="1e3871757d9d19ba71a4bda385282d88" category="paragraph">执行这些检查后，系统会将非根聚合和 NAS 数据 LIF 重新定位回 node2 ，而 node2 目前正在 AFF A900 控制器上运行。</block>
  <block id="b990f6960d7072e815b8e4d805f92035" category="paragraph">如果已替换任何 LIF ，请将主节点还原回 node2 ：</block>
  <block id="57b35a4807158b0c84b33308cd272adc" category="summary">您可以使用 AFF A900 控制器硬件升级 AFF A700 控制器硬件，从而重新定位非根聚合的所有权。</block>
  <block id="4fe14399c7ba2d61fd08cb661eaee960" category="paragraph">您可以通过交换控制器模块和非易失性存储模块（ NVS ），无中断地将 AFF A700 节点 HA 对上的控制器硬件升级到 AFF A900 系统。您可以在 AFF A700 节点之间迁移非根聚合，然后迁移到 HA 对中的 AFF A900 节点。在升级操作步骤期间，您可以访问要升级的节点上托管的数据。</block>
  <block id="b4487973401042be49d7ce291f0a7816" category="paragraph">在此控制器升级操作步骤期间，您可以将 AFF A700 升级到 AFF A900 系统。</block>
  <block id="b506bf2d759395dc5e9a526b8a8a5085" category="admonition">您只能将 AFF A700 系统上每个节点上的两个现场可更换单元（ Field Replaceable Unit ， FRU ）更换为新的 FRU 。您无需移动，断开或重新连接 I/O 卡，数据缆线，磁盘架和磁盘。</block>
  <block id="65fee2ced8d2429c655c060ae9377a21" category="paragraph">在操作步骤期间，您可以使用替代控制器硬件升级原始控制器硬件，从而重新定位非根聚合的所有权。您可以在节点之间多次迁移聚合，以确保在整个升级操作步骤中至少有一个节点从聚合提供数据。此外，您还可以在集群中的节点之间迁移数据逻辑接口（ LIF ）。</block>
  <block id="61d5cfba7704fb82d2cf6a1ebdf016a2" category="admonition">术语 * 节点 1 * 和 * 节点 2 * 仅用作本文档中节点名称的参考。在操作步骤之后，您必须替换节点的实际名称。</block>
  <block id="09ae20b09a8c19ed0bbb39e5bb05e664" category="inline-link-macro">从 AFF A700 升级到采用 ARL 的 AFF A900 的准则</block>
  <block id="32898fc8f4a5029e42e4dec90f47aacf" category="list-text">此操作步骤非常复杂，假定您具备高级 ONTAP 管理技能。您还应阅读并了解 <block ref="b49755eb65062586cd5b4474d108ae63" category="inline-link-macro-rx"></block> 和 <block ref="57e14e08755134bb6fef9ad899bb58ee" category="inline-link-macro-rx"></block> 开始升级前的章节。</block>
  <block id="51108f40a613018fdc6b3ad89f42122e" category="list-text">此操作步骤假定更换用的控制器硬件是新的，尚未在其他系统中使用。使用 `wipeconfig` 命令准备已用控制器所需的步骤不在此操作步骤中。如果更换用的控制器硬件先前已用作另一个 ONTAP 集群的一部分或用作独立的单节点系统，则必须联系技术支持。</block>
  <block id="032e383323d25667eb1cf2fd98d90920" category="list-text">此操作步骤仅适用于 AFF A700 系统。有关需要升级到 AFF A900 系统的所有其他控制器型号，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 要链接到 _use "system controller replace " 命令升级运行 ONTAP 9.8 或更高版本的控制器硬件，以及使用聚合重新定位手动升级运行 ONTAP 9.8 或更高版本的控制器硬件内容。</block>
  <block id="3ad849030cc8cbffe73ee39692333dfd" category="list-text">如果要在停机的情况下从 AFF A700 系统升级，您可以通过移动存储来升级控制器硬件，也可以联系技术支持。请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 通过移动卷或存储链接到 _Upgrade 。</block>
  <block id="5e90150825423e2dd002f3765afde1a0" category="summary">确定是否使用 ARL 使用新的 AFF A900 控制器升级 AFF A700 HA 对中的存储控制器。</block>
  <block id="907aff731fdff77dd937f103d185946f" category="paragraph">此内容介绍如何使用新的 AFF A900 控制器升级 AFF A700 HA 对中的存储控制器，同时保留所有现有数据和磁盘。这是一个复杂的操作步骤，只能由经验丰富的管理员使用。</block>
  <block id="8a5876fc5aff9d4ba29b01b35732f36b" category="paragraph">在以下情况下，应使用本指南：</block>
  <block id="dc7983a418237284d6c2d76af591c70b" category="list-text">您已向 NetApp 销售代表确认收到 AFF A900 控制器模块， NVS 以及升级所需的部件。</block>
  <block id="1d6bdacfa641f11b641c1b58d3be071a" category="list-text">您正在运行 ONTAP 9.10.1 RC2 或更高版本。</block>
  <block id="2e98499b8b5cb935f1408287edd1e55e" category="paragraph">在以下情况下，不应使用本指南：</block>
  <block id="c69b540c0c261b1ff72c0a6795db11d7" category="list-text">如果您在 AFF A700 系统上使用 FlexArray 虚拟化软件，请勿 * 使用此操作步骤。</block>
  <block id="3d8406df7c413f90c8c3fc695f7e355b" category="list-text">如果使用共享交换机进行集群互连和以太网连接存储，请勿 * 使用此操作步骤。</block>
  <block id="1de0c9b4406826abeab1058bc7d52010" category="paragraph">有关升级 Fabric MetroCluster 或 MetroCluster IP 配置的信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _RAID MetroCluster 升级和扩展 _ 内容。</block>
  <block id="b6b93f00b59274d240800f866b51bae9" category="summary">正确关闭 node2 并将其从机架或机箱中卸下，从而停用 node2 。</block>
  <block id="71a227e766879a981c6aa0fd0ee08687" category="paragraph">在第 1 阶段，您必须准备好节点进行升级并运行一系列预检。您还必须准备通过网络启动新控制器。</block>
  <block id="5077f34346404c6e6b1972588ad2c047" category="list-text">在 ONTAP 命令行的高级权限模式下输入以下命令，开始控制器更换过程：</block>
  <block id="78bcaff6352913ee1a07493a6be91635" category="paragraph">您将看到类似于以下内容的输出：</block>
  <block id="759581506ebf47eea7a59cbe0525d4ae" category="list-text">选择 `y` ，您将看到以下输出：</block>
  <block id="db4336e2ca46622010f5ba0c4094ec50" category="paragraph">在预检查阶段，系统会在后台运行以下检查列表。</block>
  <block id="7942d4a5601e595b14239338945355c9" category="cell">检查要更换的两个节点是否采用高可用性（ HA ）对配置。如果未为控制器启用存储故障转移，则任务将失败。</block>
  <block id="f51ac25569c065e7813718ef345e9ddc" category="cell">检查要更换的任何节点是否具有非本地数据 LIF 。节点不应包含其不是主所有者的任何数据 LIF 。如果其中一个节点包含非本地数据 LIF ，则任务将失败。</block>
  <block id="b2687f3f332164d5cd95b64d9d3a60b4" category="list-text">在启动控制器更换操作并完成预检后，此操作将暂停，以便收集稍后在控制器升级过程中可能需要的输出信息。</block>
  <block id="704a15d7928e671b1f24dd0bcbc6463a" category="list-text">network interface show -curr-node nodename -role cluster ， intercluster ， node-mgmt ， cluster-mgmt ， data</block>
  <block id="d19c25fee0ce17b764b3816c8f662c2f" category="paragraph">请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _NetApp 支持站点 _ ，在此可以获取 9.10.1 或更高版本的新 2 字符许可证密钥。这些密钥位于 _Software licenses_ 下的 _My Support_ 部分中。如果此站点没有所需的许可证密钥，您可以联系您的 NetApp 销售代表。</block>
  <block id="6047449904db059117b4a03dc6e4d8ec" category="summary">如果聚合无法重新定位或被否决，您必须手动重新定位聚合或覆盖否决或目标检查。</block>
  <block id="89ce83a80a7e1ee01dd6a7721396baad" category="summary">通过恢复自动操作来禁用带有 node2 的 HA 对并正确关闭 node1 ，从而停用 node1 。</block>
  <block id="3cd6639a74c739a7956d4b7ac0840af4" category="paragraph">要停用 node1 ，请恢复自动操作，以使用 node2 禁用 HA 对并正确关闭 node1 。您必须稍后从 node1 机箱中卸下 AFF A700 控制器模块和 NVS ，然后在 node1 上安装 AFF A900 NVS 和控制器模块。</block>
  <block id="c293ce688a142a8943b3fa428c09e414" category="paragraph">node1 完全暂停后， node1 应出现在 LOADER 提示符处。要查看加载程序提示符，请连接到 node1 的串行控制台。</block>
  <block id="230d6b0a6b20071d69dd5b6e92842ab3" category="section-title">卸下 AFF A700 控制器模块和 NVS</block>
  <block id="1d9e79131a1953fb2daa3742dadda209" category="paragraph">在此阶段， node1 已关闭，所有数据均由 node2 提供。由于 node1 和 node2 位于同一机箱中，并由同一组电源供电，因此请勿关闭机箱电源。您必须注意仅删除 node1 控制器模块和 node1 NVS 。通常， node1 是从系统背面查看控制器时位于机箱左侧的控制器 A 。控制器标签位于机箱上，控制器模块正上方。</block>
  <block id="30ba799d12bc55203e3416a6ec482bf4" category="paragraph">如果您尚未接地，请正确接地。</block>
  <block id="7772cd0198105a3d1385b2e8a38dfd13" category="section-title">卸下 AFF A700 控制器模块</block>
  <block id="aa7985a89f1c2f960f222e4a5876a369" category="paragraph">使用以下操作步骤删除 AFF A700 控制器模块。</block>
  <block id="21ae48aa7bbdbaeb1a967d5328b891b6" category="list-text">从 node1 控制器模块中卸下控制器模块之前，请断开控制台缆线（如果有）和管理缆线与 node1 控制器模块的连接。</block>
  <block id="16597a9dd20f2d5db13339b0bf3ad60c" category="admonition">在处理 node1 时，只需从 node1 中拔下控制台和 e0M 缆线。在此过程中，您不能移除或更改 node1 或 node2 上的任何其他缆线或连接。</block>
  <block id="4f15dffc58c8598c508fa46cd5335ebb" category="list-text">解锁控制器模块 A 并将其从机箱中卸下。</block>
  <block id="c1ed0cd23ea77c49b5611e5929537b3f" category="list-text">Slide the orange button on the cam handle downward until it unlocks.</block>
  <block id="f58d98f433350ee3e614bfdfe3036a89" category="image-alt">Remove controller module</block>
  <block id="fb6d576fd0865356efea00348612bf65" category="image-alt">第一</block>
  <block id="b05aea0ff1931b3ce07289e5c24c4357" category="cell">Cam handle release button</block>
  <block id="72f0f1912ae3ec72b1995b632a2cc692" category="image-alt">第二</block>
  <block id="b733ab833a64f07b84375a26a6af83f0" category="cell">Cam handle</block>
  <block id="1ce9441378e5288a31f9dee89eb4cb1d" category="list-text">Rotate the cam handle so that it completely disengages the controller module from the chassis, and then slide the controller module out of the chassis.</block>
  <block id="838771143f1029cc3b1ac5c3be2796bc" category="paragraph">Make sure that you support the bottom of the controller module as you slide it out of the chassis.</block>
  <block id="fd22b7848c5af6378d0b6f4b2d27e00f" category="section-title">卸下 AFF A700 NVS 模块</block>
  <block id="79c5d41bbb72ea24170f3061addd9ece" category="paragraph">使用以下操作步骤删除 AFF A700 NVS 模块。</block>
  <block id="87f2b2201ecbf070e4e854d1304aeeac" category="admonition">AFF A700 NVS 模块位于插槽 6 中，与系统中的其他模块相比，其高度是原来的两倍。</block>
  <block id="eced59d7d6e175973d862c632ed36570" category="list-text">从 node1 的插槽 6 中解锁 NVS 并将其卸下。</block>
  <block id="1746c03166c1029bf12087835ea936f0" category="list-text">Depress the lettered and numbered cam button.</block>
  <block id="e73d298eda7538e8d44a7ca445767962" category="paragraph">The cam button moves away from the chassis.</block>
  <block id="805f241c9acf04968d6f84157a96e0c1" category="list-text">Rotate the cam latch down until it is in a horizontal position.</block>
  <block id="3f0512a898d30239d9cf3c19f2cf0b7f" category="paragraph">NVS 从机箱中分离并移动几英寸。</block>
  <block id="14fddb164ec13c3ab68d7ba81a70f9ac" category="list-text">拉动模块侧面的拉片，将 NVS 从机箱中卸下。</block>
  <block id="790819866571b776f001339e71cdbf11" category="image-alt">删除 NVS</block>
  <block id="c6e52defde912721ad3ec5315c5d9664" category="cell">Lettered and numbered I/O cam latch</block>
  <block id="0e50691d6ac3e9df529fa546f2486bd7" category="cell">I/O latch completely unlocked</block>
  <block id="aed11184fe6c60f1c9bb541185f56027" category="list-text">如果您在 AFF A700 NVS 上使用任何附加模块作为核心转储设备，请勿将其传输到 AFF A900 NVS 。</block>
  <block id="968bed5a18df2b6d3ff797a3dff9d8a5" category="paragraph">您必须在 node1 上安装为升级而收到的 AFF A900 NVS 和控制器模块。请勿将核心转储设备从 AFF A700 NVS 模块移至 AFF A900 NVS 模块。</block>
  <block id="34290340b4b3829c1db8fd373c38d431" category="section-title">安装 AFF A900 NVS</block>
  <block id="89a2d1bbb4309909f0397b1fdb26b174" category="paragraph">使用以下操作步骤将 AFF A900 NVS 安装在 node1 的插槽 6 中。</block>
  <block id="3f417eabfc9204738789b7d35e1ec889" category="list-text">将 NVS 与插槽 6 中机箱开口的边缘对齐。</block>
  <block id="89ecb4d27fdab7dab9977862e3a2aea5" category="list-text">将 NVS 轻轻滑入插槽，直到带字母和编号的 I/O 凸轮闩锁开始与 I/O 凸轮销啮合，然后将 I/O 凸轮闩锁一直向上推，以将 NVS 锁定到位。</block>
  <block id="98d7b10e1eb4742a2329a1e76d5987d3" category="image-alt">安装 NVS</block>
  <block id="65aec26ee881486d9f784225cd0751c8" category="section-title">在节点 1 上安装 AFF A900 控制器模块。</block>
  <block id="3624eaadadde076eadac129a6945d35a" category="paragraph">使用以下操作步骤在 node1 中安装 AFF A900 控制器模块。</block>
  <block id="4ca20afddb50988acb9000e601503f49" category="list-text">将控制器模块的末端与机箱中的开口 A 对齐，然后将控制器模块轻轻推入系统的一半。</block>
  <block id="2ccb8d39c31ae4e3e946af20b7027094" category="admonition">Do not completely insert the controller module in the chassis until instructed to do so.</block>
  <block id="85b0e5132d3bec02fcda8eb6f24b6062" category="list-text">使用缆线将管理和控制台端口连接到 node1 控制器模块。</block>
  <block id="b169047622e729bf81ad35acc4380bbf" category="admonition">由于机箱已启动， node1 将启动 BIOS 初始化，然后在完全就位后立即启动自动启动。要中断 node1 启动，在将控制器模块完全插入插槽之前，建议将串行控制台和管理缆线连接到 node1 控制器模块。</block>
  <block id="9ce6fd0a8d01a2b4341b85fdb23f1ba5" category="list-text">Firmly push the controller module into the chassis until it meets the midplane and is fully seated.</block>
  <block id="9d3d5ccff9d9d7f336c5f4adfb3eea08" category="paragraph">控制器模块完全就位后，锁定闩锁会上升。</block>
  <block id="ca40fd9083dd4ade691492058e938f48" category="admonition">Do not use excessive force when sliding the controller module into the chassis to avoid damaging the connectors.</block>
  <block id="2811be1070e46d4c0821ee319a3a08af" category="image-alt">安装控制器模块</block>
  <block id="f39c570aa40591b3a07f64b52d7d04bd" category="cell">凸轮把手锁定闩锁</block>
  <block id="3f5e8e551ad561c269d0656e1bd198f0" category="cell">凸轮把手处于解锁位置</block>
  <block id="2ea32610c0c34642fe97bf6f44009b1f" category="list-text">一旦模块就位，请立即连接串行控制台，并准备好中断 node1 的自动启动。</block>
  <block id="b970babbfb43c0b0f3cf0d1977141675" category="list-text">中断自动启动后， node1 将停留在 LOADER 提示符处。如果不中断自动启动，而 node1 开始启动，请等待提示符按 * Ctrl-C* 进入启动菜单。在节点停留在启动菜单后，使用选项 `8` 重新启动节点，并在重新启动期间中断自动启动。</block>
  <block id="941f1a1f76f1ea9874688b46955c3e10" category="list-text">在 LOADER 提示符 node1 处，设置默认环境变量：</block>
  <block id="bb54a67e0ba8edb77dda51dedb81fec0" category="list-text">保存默认环境变量设置：</block>
  <block id="753fbbab7087d2d0ed1ee7008bb7cf3d" category="list-text">继续执行其余节点对升级操作步骤。</block>
  <block id="4268d96ccc42c6690ac8aae29513a187" category="paragraph">Node2 崩溃后 Node1 不会接管，因为 HA 对已禁用。</block>
  <block id="407e2777bfd7bd53cdb708f5debf979e" category="section-title">在禁用 HA 对的情况下，节点 1 在第一个验证阶段崩溃</block>
  <block id="b1d9db53b400440509215a88326131de" category="paragraph">node2 已将其部分或全部聚合从 node1 重新定位到 node1 。node1 用于从已重新定位的聚合提供数据。HA 对已禁用，因此不存在接管。</block>
  <block id="1079e854ebb97bcd056598f1d85d2d41" category="paragraph">未重新定位的聚合发生客户端中断。启动 node2 时， node1 的聚合将重新定位到 node1 。</block>
  <block id="34bef26d43d2971beb837b24432bf29f" category="section-title">在聚合重新定位期间，节点 1 在第一个资源重新获取阶段崩溃</block>
  <block id="6567edc5b92aa998986653af564fb84d" category="paragraph">如果 node2 将聚合重新定位到 node1 时 node1 崩溃，则在 node1 启动后，此任务将继续执行。</block>
  <block id="eb7af4b5a2136599dcb38458658acd79" category="paragraph">Node2 将继续为其余聚合提供服务，但已重新定位到 node1 的聚合会在 node1 启动期间发生客户端中断。</block>
  <block id="3bbbd3988dc6983974f5205284fa9cec" category="section-title">在后检查阶段，节点 1 或节点 2 崩溃</block>
  <block id="eea59a2de6754c9ba099cb152770e327" category="section-title">Node1 在第二个资源释放阶段崩溃</block>
  <block id="cf352bc2feea6caf0c382dc7013ccc96" category="paragraph">如果 node2 重新定位聚合时 node1 崩溃，则在 node1 启动后，此任务将继续执行。</block>
  <block id="069b00a46005a091a86bc4c0fa514dcf" category="paragraph">Node2 继续为其余聚合提供服务，但已重新定位到 node1 和 node1 自己的聚合的聚合会在 node1 启动期间发生客户端中断。</block>
  <block id="8a8dae69aeea749618a3f3fab32fb26c" category="paragraph">node1 将继续为已重新定位的聚合提供服务，但 node2 拥有的聚合会发生客户端中断。</block>
  <block id="8e1b610012ea588eb83fba108e3403b6" category="section-title">Node1 在第二个验证阶段崩溃</block>
  <block id="a811b72e20218470dc07093ef4249bdf" category="paragraph">如果节点 1 在此阶段崩溃，则不会发生接管，因为 HA 对已禁用。</block>
  <block id="26f30b0cbca3c1ffde0236a5a136b1c4" category="paragraph">在 node1 重新启动之前，所有聚合都会发生客户端中断。</block>
  <block id="92c94fd4970b81f16fb965f2eaf5c5f3" category="section-title">节点 2 在第二个验证阶段崩溃</block>
  <block id="913675daad9fd7d57823502b858e93f3" category="paragraph">如果节点 2 在此阶段崩溃，则不会发生接管。node1 从聚合提供数据。</block>
  <block id="e035160959e76686219645967f202317" category="paragraph">非根聚合发生中断，这些聚合已重新定位，直到 node2 重新启动。</block>
  <block id="439a6315bc634daedea1ded08453c483" category="summary">如果更换的控制器或新控制器的 HA 配对项使用存储加密，则必须为新控制器模块配置存储加密。</block>
  <block id="909aad142d3484b00d7c589078bfb1b4" category="summary">在交换相应的 AFF A900 node1 控制器模块和 NVS 之后，您必须通过网络启动 node1 。</block>
  <block id="8fec9698e48614a1961275dcbf888442" category="doc">网络启动节点 1</block>
  <block id="90e185e0d63cf46b7c399cc5a05e9112" category="paragraph">在交换相应的 AFF A900 node1 控制器模块和 NVS 之后，您必须通过网络启动 node1 。术语 netboot 表示从远程服务器上存储的 ONTAP 映像启动。在准备网络启动时，您必须将 ONTAP 9 启动映像的副本添加到系统可以访问的 Web 服务器上。</block>
  <block id="08fb307c9f15802a3c7b6efc5e7d69de" category="paragraph">无法检查 AFF A900 控制器模块启动介质上安装的 ONTAP 版本，除非该模块安装在机箱中并已启动。AFF A900 启动介质上的 ONTAP 版本应与要升级的 AFF A700 系统上运行的 ONTAP 版本相同，并且主启动映像和备份启动映像都应匹配。您可以通过在启动菜单中依次执行 netboot 和 `wipeconfig` 命令来配置映像。如果控制器模块先前已在另一个集群中使用，则 `wipeconfig` 命令将清除启动介质上的任何剩余配置。</block>
  <block id="479797897f076c1b85379ce2582f407d" category="inline-link-macro">NetApp 知识库文章： How to use the boot_recovery loader command for installing ONTAP for initial setup of a system</block>
  <block id="439ee18cc3b8447dc7005ee865a16034" category="admonition">您也可以使用 USB 启动选项执行网络启动。请参见 <block ref="bf492b442968a212511cdeeb769ceb71" category="inline-link-macro-rx"></block>。</block>
  <block id="dc4e68dae6f2c9aa089b7b7f44a400c0" category="list-text">从 _NetApp 支持站点 _ 下载适用于您的系统和正确版本的 ONTAP 所需的系统文件。请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _NetApp 支持站点 _ 。</block>
  <block id="2ba573cec1f6a3141c471fb88430735b" category="list-text">请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _NetApp 支持站点 _ 以下载用于执行系统网络启动的文件。</block>
  <block id="b3fa942f65431caf219b9891c77a7cc2" category="list-text">[netboot_node1_step2]] 从 _NetApp 支持站点 _ 的软件下载部分下载相应的 ONTAP 软件，并将 `ontap_version_image.tgz` 文件存储在可通过 Web 访问的目录中。</block>
  <block id="6ecb92f5d83c8c88c6eee4e21a07fa4b" category="list-text">您的目录列表应包含 `ontap_version_image.tgz` 。</block>
  <block id="f47f57e3434d00c4cb0ddb03933b3fc5" category="list-text">通过选择以下操作之一来配置网络启动连接。</block>
  <block id="0eb401888569af4a0be116c8fcb2e960" category="paragraph">在启动环境提示符处使用以下命令手动配置连接： `ifconfig e0M -addr=filer_addr -mask=netmask -gw=gateway - dns=dns_addr domain=dns_domain` `filer_addr` 是存储系统的 IP 地址。`netmask` 是存储系统的网络掩码。`gateway` 是存储系统的网关。`dns_addr` 是网络上名称服务器的 IP 地址。此参数是可选的。`dns_domain` 是域名服务（ DNS ）域名。此参数是可选的。</block>
  <block id="1e23f3f1f1ff4c1174660749785a3e47" category="admonition">您的接口可能需要其他参数。有关详细信息，请在固件提示符处输入 `help ifconfig` 。</block>
  <block id="2e9296c7316d4c4c76380224c1db72b2" category="list-text">对 node1 执行网络启动：</block>
  <block id="99002edb0db3876428b0f60105beedae" category="paragraph">`netboot \http://web_server_ip/path_to_web_accessible_directory/netboot/kernel`</block>
  <block id="7158cb602a75d71a43fc88a8cc225d1e" category="list-text">等待 AFF A900 控制器模块上当前运行的 node1 启动并显示启动菜单选项，如下所示：</block>
  <block id="b0cf2f9b05191bd2a4d5a0a854fe9fee" category="paragraph">请忽略以下消息： `HA 对上的无中断升级不支持此操作步骤` 。本说明将适用场景无中断 ONTAP 软件升级，而不是控制器升级。</block>
  <block id="5401a55d9c4318be587707f2931a86b0" category="paragraph">请始终使用 netboot 将新节点更新为所需映像。如果使用其他方法在新控制器上安装映像，则可能安装了错误的映像。此问题描述适用场景所有 ONTAP 版本。</block>
  <block id="a303e403af842ae1a3aee97050fd5dcf" category="list-text">如果系统提示您继续运行操作步骤，请输入 `y` ，然后在系统提示您输入软件包时，输入 URL ： ` \http://web_server_ip/path_to_web-accessible_directory/ontap_version_image.tgz`</block>
  <block id="e581180eb51e0c55c220313efa4f6d03" category="paragraph">`path_to_the_web-accessible_directory` 应指向下载 `ontap_version_image.tgz` 的位置 <block ref="3c453ca3ddf73b988300a74fd18c23c3" category="inline-xref-macro-rx"></block>。</block>
  <block id="963f89f538a2fcd5d086c865807c540a" category="list-text">在提示符处，运行 `wipeconfig` 命令以清除启动介质上先前的任何配置：</block>
  <block id="19447c446165b59a012b755c1aa9b173" category="list-text">当您看到以下消息时，问题解答 `yes` ：</block>
  <block id="d9942055ef69c8d0b4c6c187ca017527" category="list-text">节点将重新启动以完成 `wipeconfig` ，然后停留在启动菜单处。</block>
  <block id="e3dcb6e98d703b4041ac7a4b6d40412e" category="list-text">从启动菜单中选择选项 `5` 以转到维护模式。问题解答 `yes` 显示提示符，直到节点在维护模式下停止，并且命令提示符为 ` *` 。</block>
  <block id="e45b434885da7370501c14b198e0d2e4" category="list-text">验证控制器和机箱是否配置为 `ha` ：</block>
  <block id="c88945f452b82e198d1feb0b8588ed41" category="list-text">验证 `ha-config` 设置：</block>
  <block id="1fc3994f37da8b8908bef1c9bf2acf39" category="list-text">暂停 node1 ：</block>
  <block id="c81f7065b2f44e30972bdae18530e5c8" category="paragraph">node1 应在 LOADER 提示符处停止。</block>
  <block id="ce12a4bf50a5a230a60ced68a1d299b9" category="list-text">在 node2 上，检查系统日期，时间和时区：</block>
  <block id="2282aeb7788cacc368146303b22e4114" category="list-text">在 node1 上，在启动环境提示符处使用以下命令检查日期：</block>
  <block id="6169e268732842e26b1f460c798a9b1c" category="list-text">如有必要，请在 node1 上设置日期：</block>
  <block id="a696e7909c208805ac0eb6dbf1915519" category="admonition">在 node1 上设置相应的 UTC 日期。</block>
  <block id="546dffd75f02d9ea5fb5b2b1c3e32430" category="list-text">在 node1 上，在启动环境提示符处使用以下命令检查时间：</block>
  <block id="b7f0c2363c0b962e051ab6e71f426536" category="list-text">如有必要，请在 node1 上设置时间：</block>
  <block id="36a69b26aa6ef29ce10557879031670f" category="admonition">在 node1 上设置相应的 UTC 时间。</block>
  <block id="0b0ffc724c1bc5094f0087b16afb9c41" category="list-text">在 node1 上设置配对系统 ID ：</block>
  <block id="cc4fba651c95861e343ecd57ad3f82c8" category="paragraph">您可以从 node2 上的 `node show -node node2` 命令输出中获取 node2 系统 ID 。</block>
  <block id="7e5ff4c47768ca2af743308193d67ed3" category="list-text">在 node1 上的 LOADER 提示符处，您应验证 `partner-sysid` 。对于 node1 ， `partner-sysid` 必须为 node2 。验证 node1 的 `partner-sysid` ：</block>
  <block id="a92b747aad46a6ddf1b9e550637c0ba3" category="summary">在交换相应的 AFF A900 node2 控制器模块和 NVS 之后，您可能需要通过网络启动它们。</block>
  <block id="6dacb4b7b83a4982cb50c54e1b53f94c" category="paragraph">在交换相应的 AFF A900 node2 控制器模块和 NVS 之后，您可能需要通过网络启动它们。术语 netboot 表示从远程服务器上存储的 ONTAP 映像启动。在准备网络启动时，您必须将 ONTAP 9 启动映像的副本放在系统可以访问的 Web 服务器上。</block>
  <block id="68757294a9e11cada8382926574adf4d" category="list-text">【 netboot_node2_step2]] 从 NetApp 支持站点的软件下载部分下载相应的 ONTAP 软件，并将 `ontap_version_image.tgz` 文件存储在可通过 Web 访问的目录中。</block>
  <block id="521d2e7a8ad46807c0ef8c12e39a788c" category="list-text">对 node2 执行网络启动：</block>
  <block id="05195465293ceacab37141d470c27efc" category="list-text">等待 AFF A900 控制器模块上当前运行的 node2 启动，并显示启动菜单选项，如下所示：</block>
  <block id="69c80750b2ca197795d12a8c04c972ec" category="paragraph">`path_to_the_web-accessible_directory` 应指向下载 `ontap_version_image.tgz` 的位置 <block ref="76bd6b715ce71dc5a44082b74fc8f01f" category="inline-xref-macro-rx"></block>。</block>
  <block id="06b516c1cb199a53869f7c022b7addc3" category="list-text">在提示符处，运行 `wipeconfig` 命令以清除启动介质上先前的任何配置。</block>
  <block id="d254d61b5be1df9d2c66c57fd4212982" category="list-text">暂停节点 2 ：</block>
  <block id="13eaf17fec5f96e644d7f96eacceff2d" category="paragraph">node2 应在 LOADER 提示符处停止。</block>
  <block id="eaa06243d79c8afa1405151e312e38dd" category="list-text">在 node2 上，在启动环境提示符处使用以下命令检查日期：</block>
  <block id="cb34b4f010c7f4a67f9f369e6bcaaca2" category="list-text">如有必要，请在 node2 上设置日期：</block>
  <block id="203bd2f32b8f21bd7ddbf50feca53f2d" category="admonition">在 node2 上设置相应的 UTC 日期。</block>
  <block id="fe00ea02f2b926e29ff2f68aaf7fa198" category="list-text">在 node2 上，在启动环境提示符处使用以下命令检查时间：</block>
  <block id="9e84800f4ac2f15c0e92f8a0bfedcb2c" category="list-text">如有必要，请在 node2 上设置时间：</block>
  <block id="dc7e3044e4900ae357994969cd1ff606" category="admonition">在 node2 上设置相应的 UTC 时间。</block>
  <block id="93b0552d846cadbf1761e192e1b974a8" category="list-text">如有必要，请在 node2 上设置配对系统 ID ：</block>
  <block id="3baeda84b3e5fe7c80a71e2bb18f15ed" category="admonition">这是要升级到 AFF A900 的 node1 的系统 ID 。</block>
  <block id="08b43247e14b9d72a58205ddb14b21ab" category="paragraph">`setenv partner-sysid node1_sysid`</block>
  <block id="31ce0918fc7ff2acce6828a4a5d8a974" category="list-text">在 node2 上的 LOADER 提示符处，您应验证 `partner-sysid` 。对于 node2 ， `partner-sysid` 必须为 node1 。验证 node1 的 `partner-sysid` ：</block>
  <block id="20db60e5409fb0144c1223bde2a61fba" category="summary">在节点 2 上安装 AFF A900 NVS 和控制器模块。</block>
  <block id="b048df8b9ad9344f250a9e7f17740a7a" category="doc">在节点 2 上安装 AFF A900 NVS 和控制器模块</block>
  <block id="b779e27f1d595a8bcde29fbc02ceb1ca" category="paragraph">您必须在 node2 上安装为升级而收到的 AFF A900 NVS 和控制器模块。node2 是从系统背面查看控制器时位于机箱右侧的控制器 B 。</block>
  <block id="c6bc6e1a22c6fe87c37c91faa974e413" category="paragraph">使用以下操作步骤将 AFF A900 NVS 安装在节点 2 的插槽 6 中。</block>
  <block id="206a1a8dfd426c156b48ab46846acc00" category="section-title">在节点 2 中安装 AFF A900 控制器模块。</block>
  <block id="5290116daec6e79a183cfb76bc74414e" category="paragraph">使用以下操作步骤在 node2 中安装 AFF A900 控制器模块。</block>
  <block id="9242c558140d9a52d10f2e6b57f75893" category="list-text">将控制器模块的末端与机箱中的托架 B 对齐，然后将控制器模块轻轻推入系统的一半。</block>
  <block id="1ba57f7982d64e52fcc3eb0235996968" category="admonition">托架标签位于机箱上控制器模块正上方。</block>
  <block id="d8ab5939da4c6c87882ece7cbdd119f0" category="admonition">在系统指示您将控制器模块完全插入机箱之前，请勿将其插入。</block>
  <block id="2cd913fdf7e7f2f1c4a048df3be22534" category="list-text">使用缆线将管理和控制台端口连接到 node2 控制器模块。</block>
  <block id="12620db597bf851930eb07d39883499a" category="admonition">由于机箱已启动，因此 Node2 在完全就位后即开始启动。为了避免 node2 启动，建议在将控制器模块完全插入插槽之前，先将控制台和管理缆线连接到 node2 控制器模块。</block>
  <block id="fac78f9c5e15854e519e3d589bb696d1" category="list-text">中断自动启动后， node2 将停留在 LOADER 提示符处。如果不中断自动启动，而 node2 开始启动，请等待提示符按 * Ctrl-C* 进入启动菜单。在节点停留在启动菜单后，使用选项 `8` 重新启动节点，并在重新启动期间中断自动启动。</block>
  <block id="45a772e12ee765d08d22b7179bbcba79" category="summary">在将 node1 更换为 AFF A900 控制器模块和 NVS 之前，必须将非根聚合和 NAS 数据 LIF 从 node1 移动到 node2 。</block>
  <block id="319d6168b91ae4b4b608817af014dca4" category="paragraph">在将 node1 替换为 AFF A900 控制器模块和 NVS 之前，必须先将非根聚合和 NAS 数据 LIF 从 node1 移动到 node2 ，然后才能最终将 node1 的资源恢复回运行在 AFF A900 系统上的 node1 上。此过程大部分是自动化的；操作将暂停，以便您可以检查其状态。</block>
  <block id="35275fabaa2468d01cfdfe24836fec99" category="paragraph">在升级操作步骤期间，远程 LIF 处理 SAN LUN 的流量。在升级期间，您无需移动 SAN LIF 即可实现集群或服务运行状况。在将 node1 作为 AFF A900 联机后，您必须验证 LIF 是否运行正常并位于相应的端口上。</block>
  <block id="da2b45cbcbfabc951a211d4aed4ae9d5" category="doc">还原 node2 上的 key-manager 配置</block>
  <block id="15d209e4cadd5533a0ad00341991f412" category="summary">使用 ARL 将一对运行 ONTAP 9.10.1 RC2 或更高版本的 AFF A700 控制器升级到 AFF A900 系统取决于系统和控制器配置。</block>
  <block id="4c74b0760efcafadaea9e769b0125362" category="paragraph">使用 ARL 将一对运行 ONTAP 9.10.1 RC2 或更高版本的 AFF A700 控制器升级到 AFF A900 系统取决于系统以及原始控制器和更换控制器的配置。</block>
  <block id="10dcc68b1fd270d68f4e5b2901551fb5" category="paragraph">支持使用 ARL 将 AFF A700 升级到 AFF A900 ，并仅交换控制器模块和 NVS 。如果您收到的新 AFF A900 系统是一个完整系统，包括一个新机箱，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 要链接到 _use "system controller replace " 命令升级运行 ONTAP 9.8 或更高版本内容的控制器硬件。</block>
  <block id="64477b164562a0fae4bae92e2ca6e899" category="admonition">本指南严格地将 AFF A700 适用场景升级到运行 ONTAP 9.10.1 RC2 或更高版本的 AFF A900 。请勿使用本指南在任何其他系统组合之间执行升级。</block>
  <block id="8ec9dcb34f09496bfb877249e8b20474" category="paragraph">如果在升级控制器时出现任何问题，请参见 <block ref="8b711d7eff849b62a32d0b2d66f85a6c" category="inline-link-macro-rx"></block> 部分，请参见操作步骤末尾的详细信息和可能的解决方案。</block>
  <block id="f2ae9bd135f92754624e2feffc91e8b1" category="summary">通过启用 HA 对并验证 node1 和 node2 是否可以访问彼此的存储来确保设置正确。</block>
  <block id="538ca7af52f04407d894cd2575dd344a" category="paragraph">要确保设置正确，您必须验证是否已启用 HA 对。此外，还必须验证 node1 和 node2 是否可以访问彼此的存储，并且它们都不拥有属于集群上其他节点的数据 LIF 。此外，您还必须确保所有数据聚合都位于其正确的主节点上，并且两个节点的卷均联机。如果其中一个新节点具有统一目标适配器，则必须还原任何端口配置，并且可能需要更改此适配器的使用。</block>
  <block id="c33d1193fa61b53992488cb1598a346b" category="list-text">在对 node2 执行后检之后，将为 node2 集群启用存储故障转移和集群 HA 对。操作完成后，两个节点均显示为已完成，系统将执行一些清理操作。</block>
  <block id="9eabbc872717665c9d6cf452e2e948ce" category="list-text">使用以下命令并检查输出，验证 node1 和 node2 是否属于同一集群：</block>
  <block id="7de71753e32700489d3b6afdd9b1e417" category="list-text">使用以下命令并检查输出，验证 node1 和 node2 是否可以访问彼此的存储：</block>
  <block id="0fe6701c2bd4920c5d453b5ee906eed1" category="list-text">使用以下命令并检查输出，验证 node1 和 node2 均不拥有集群中其他节点拥有的主数据 LIF ：</block>
  <block id="6a4e3b384743506a60b9d8b065cd9569" category="paragraph">如果 node1 或 node2 均不拥有集群中其他节点拥有的主数据 LIF ，请将数据 LIF 还原到其主所有者：</block>
  <block id="539dfd2d954ae3879b62b16e5593152b" category="list-text">验证聚合是否属于其各自的主节点。</block>
  <block id="78afe52f3d782a64e711de589b4df3d3" category="paragraph">`storage aggregate show -owner-name node1`</block>
  <block id="ee003f27b169d76d97322f42ff3b1684" category="paragraph">`volume show -node node1 -state offline`</block>
  <block id="8f3c31fbc98a55b30d3c8c6b6ba60ad1" category="list-text">使用以下命令并检查其输出，以验证是否已正确安装许可证：</block>
  <block id="c5f4170df1857e1ab8fd788fe116d336" category="paragraph">您可能需要将输出与中捕获的输出进行比较 <block ref="cd8ad1809865824065fe011b80800cd6" category="inline-link-macro-rx"></block> 部分。</block>
  <block id="bac64830839c2c46ea9aea68500f9c99" category="list-text">如果在配置中使用了 NetApp 存储加密（ NSE ），并且您将 `setenv bootarg.storageencryption.support` 命令设置为 `true` with the `kmip.init.maxwait` variable `off` （ in _Boot node2 with the AFF A900 controller module and NVS_ ， <block ref="30eda0c27e5ac7524ed5f5f264f13489" category="inline-link-macro-rx"></block>），您需要重置变量：</block>
  <block id="83384f48b367d39b20d627f5230807a9" category="list-text">在两个节点上使用以下命令配置 SP ：</block>
  <block id="09e9f7abfe1cdfbd7b4465d4dbc6bd0c" category="paragraph">如果在 node1 和 node2 上启用了存储加密，请完成此部分 <block ref="18c90c300c0b71334b8b427eaf4f38a3" category="inline-link-macro-rx"></block>。否则，请完成部分 <block ref="6e48b929ca0767f00c15eeb6d7e78755" category="inline-link-macro-rx"></block>。</block>
  <block id="def77e7acbbef5c58f83a26f2a75a5d1" category="summary">使用 AFF A900 控制器模块和 NVS 启动 node1 。</block>
  <block id="1e24bb58151105c90c9bd9fc681c2eb7" category="paragraph">带有 AFF A900 控制器模块和 NVS 的 Node1 现在可以启动。通过交换控制器模块和 NVS 从 AFF A700 升级到 AFF A900 只涉及移动控制台和管理连接。本节介绍使用 AFF A900 控制器模块和 NVS 启动 node1 所需的步骤。</block>
  <block id="20cba2cce8bf251a0de11e5d6bbe7c02" category="list-text">如果此配置正在使用 NetApp 存储加密（ NSE ），则必须将 `setenv bootarg.storageencryption.support` 命令设置为 `true` ，并将 `kmip.init.maxwait` 变量设置为 `off` ，以避免在加载 node1 配置后出现启动环路：</block>
  <block id="e1d4223a486d75812a7653769a14285b" category="list-text">节点将停留在启动菜单处。输入 "22/7" 并选择隐藏选项 `boot_after_controller_replacement` 。要将 AFF A700 node1 磁盘重新分配给 AFF A900 node1 ，请在提示符处输入 node1 的实际节点名称。请使用以下示例作为参考：</block>
  <block id="6c0325df544d18e6d470def86c341a35" category="summary">使用自动操作步骤将 AFF A700 控制器更换为 AFF A900 控制器。</block>
  <block id="2e6c9c4daa89b2f00bbb9e34f1d84ce7" category="paragraph">在此控制器升级期间，您需要将 AFF A700 控制器更换为 AFF A900 控制器。此内容介绍了自动化操作步骤的步骤，它利用自动磁盘分配和网络端口可访问性检查来简化控制器升级体验。</block>
  <block id="915a001de8955eec5d38aa5f6dbcbe5e" category="summary">使用 AFF A900 控制器模块和 NVS 验证 node2 安装。</block>
  <block id="ab8666705fb8255d0f27c0919160c1e4" category="doc">验证 node2 安装</block>
  <block id="c20bf882a5762815a67b2dabe4f30966" category="paragraph">您必须使用 AFF A900 控制器模块和 NVS 验证 node2 安装。由于物理端口不变，您无需将物理端口从 AFF A700 节点 2 映射到 AFF A900 节点 2 。</block>
  <block id="c82f2298e8b3c76974b76a8ddcdc4261" category="paragraph">使用 AFF A900 控制器模块启动 node1 后，必须验证是否已正确安装它。您必须等待 node2 加入仲裁，然后恢复控制器更换操作。</block>
  <block id="ba7d8f5ebb18592d91d949241848dfe6" category="paragraph">此时，在操作步骤中，操作将暂停，而 node2 加入仲裁。</block>
  <block id="c32050bd0152940e859c61963c8eac2b" category="list-text">验证 node2 是否已加入仲裁：</block>
  <block id="4944974c6eb515b06e75893287e18f10" category="list-text">确认 node2 与 node1 属于同一集群，并且运行状况良好：</block>
  <block id="aa4f1ae296f22b70b2245f395e8b0865" category="list-text">检查控制器更换操作的状态，并验证其是否处于暂停状态以及在 node2 暂停之前的状态，以便执行安装新控制器和移动缆线的物理任务：</block>
  <block id="a5a3a42770f0913244b28357378d4e76" category="admonition">在本指南中， _re-creating VLAN ， ifgrp 和 broadcast domains_has been re命名 为 _Restore network configuration on node2_ 。</block>
  <block id="8c8bbdd54247874dc95cb56adf2233aa" category="list-text">在控制器更换处于暂停状态的情况下，继续执行 <block ref="cf2f6e65074eee957c362f92c9fdd8b5" category="inline-xref-macro-rx"></block>。</block>
  <block id="c7ac27a6d6c91af26ae2248d25a66f1f" category="section-title">还原 node2 上的网络配置</block>
  <block id="26c2308a63a61c5f8f6891347ee8e59b" category="paragraph">确认 node2 处于仲裁状态并可与 node1 通信后，请确认 node2 上显示了 node1 的 VLAN ，接口组和广播域。此外，验证是否已在其正确的广播域中配置所有 node2 网络端口。</block>
  <block id="2d9a324d737623f68053a45037166f3b" category="list-text">列出已升级的节点 2 上的所有物理端口：</block>
  <block id="37d34a6dfe6383da0e88e7b677055d44" category="paragraph">`network port show -node node2`</block>
  <block id="5b2006e0f6d482c797a962849e1eccf4" category="list-text">列出节点 2 上所有端口的网络端口可访问性：</block>
  <block id="7c587f95f797c282f896f4e149ba42f0" category="paragraph">`network port reachability show -node node2`</block>
  <block id="6996b4514e4836b99cfcaa0e279b06fe" category="paragraph">您应看到类似于以下示例的输出。端口和广播名称会有所不同。</block>
  <block id="2efafcfce345df4a65a26677edc43a1c" category="paragraph">在上述示例中， node2 已在更换控制器后启动并加入仲裁。它具有多个不可访问的端口，并且正在等待可访问性扫描。</block>
  <block id="f73c63fe868c9eadae0867a98f883222" category="list-text">[[restore_node2_step4]] 使用以下命令按以下顺序修复 node2 上每个端口的可访问性状态不是 `ok` 的可访问性：</block>
  <block id="cdd786773bbaae1529cd3ffa5c7d238c" category="paragraph">如果所有端口均已正确配置并添加到正确的广播域中，则 `network port reachability show` 命令应将所有已连接端口的可访问性状态报告为 `ok` ，对于无物理连接的端口，此状态报告为 `no-reachability` 。如果任何端口报告的状态不是这两个端口，请按照中的说明执行可访问性修复并在其广播域中添加或删除端口 <block ref="9da9497007dcbdf9ea585e9965505651" category="inline-xref-macro-rx"></block>。</block>
  <block id="5042d04c33524bcbd54a634369ce4d6b" category="list-text">列出节点 4 上所有端口的网络端口可访问性：</block>
  <block id="5e997021ee0d4607339bb16384449e18" category="list-text">【第 3 步】列出节点 3 上所有端口的网络端口可访问性：</block>
  <block id="5f3b5dc9ededb8351d3d25772cf0e8a5" category="paragraph">* 您可以使用此聚合重新定位操作步骤通过使用 `ssystem controller replace` 命令来升级控制器硬件。此操作步骤适用场景控制器硬件运行 ONTAP 9.8 或更高版本。 *</block>
  <block id="9d84cc48ac59ed03e236e199b8e72aa8" category="paragraph">^1^有关 AFF A800 系统所需的其他步骤，请转至第节中引用 A800 的步骤 <block ref="46e0d635bf9a753e435b3e56ea555b72" category="inline-link-macro-rx"></block>或 <block ref="916a396aec2ea8c5191dac1b7e554adf" category="inline-link-macro-rx"></block>。</block>
  <block id="9bded937f001956ffed1ee6ccceb37db" category="sidebar">使用 system controller replace 命令（ AFF A700 至 AFF A900 ）</block>
  <block id="2500b2e21dbe74e889f94334876e761f" category="sidebar">第 2 阶段。重新定位资源并停用 AFF A700 节点 1</block>
  <block id="bbfffc5187f9a9190e510f9bbf965dac" category="sidebar">第 3 阶段。使用 AFF A900 控制器模块和 NVS 启动 node1</block>
  <block id="7f34c3c52d70c0425b1f8f450d9011fa" category="sidebar">第 4 阶段。重新定位节点 2 中的资源并停用节点 2</block>
  <block id="bb0d2681400a8bd80cea4ec618ce8873" category="sidebar">第 5 阶段。在节点 2 上安装 AFF A900 NVS 和控制器模块</block>
  <block id="69181db8c0a5d3ee51bd9816fcf73f89" category="sidebar">第 6 阶段。使用 AFF A900 控制器模块和 NVS 启动 node2</block>
  <block id="e58fe7640209496d4d7a887457b3a8c5" category="sidebar">第 7 阶段。完成升级</block>
  <block id="9bc5ca62c85c48a5608cc66a5119aff4" category="cell"><block ref="9bc5ca62c85c48a5608cc66a5119aff4" category="inline-link-macro-rx"></block></block>
  <block id="941f4b0595c8574b9f353fa86ce98d4e" category="cell"><block ref="941f4b0595c8574b9f353fa86ce98d4e" category="inline-link-macro-rx"></block></block>
  <block id="815c0aa063df3c53b17744c860357708" category="paragraph">升级完成后，您可以停用 node2 。请参见 <block ref="6e48b929ca0767f00c15eeb6d7e78755" category="inline-link-macro-rx"></block>。</block>
  <block id="328d06d80ac652817a19edc359847e7a" category="paragraph">* 您可以使用此聚合重新定位操作步骤通过使用 `ssystem controller replace` 命令将 AFF A700 升级到 AFF A900 系统。此操作步骤适用场景 AFF A700 和 AFF A900 系统运行 ONTAP 9.10.1 RC2 或更高版本。 *</block>
  <block id="f886cde8cf41513338837f7a3aacf806" category="list-text">AFF A900 系统仅支持高端电源（ 200V 到 240V ）。如果 AFF A700 系统使用低端电源（ 100V 到 140V ）运行，则必须先转换 AFF A700 输入电源，然后再使用此操作步骤。</block>
</blocks>